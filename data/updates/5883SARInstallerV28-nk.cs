'From Squeak3.7beta of ''1 April 2004'' [latest update: #5878] on 17 April 2004 at 8:50:27 am'!"Change Set:		SARInstallerV28-nkDate:			17 April 2004Author:			Ned KonzThis change set updates the 3.7b SARInstaller to v28, which is the latest version on SqueakMap.It also marks the SqueakMap package relase as being installed."!!SARInstaller methodsFor: 'client services' stamp: 'nk 2/13/2004 12:12'!fileInGenieDictionaryNamed: memberName 	"This is to be used from preamble/postscript code to file in zip 	members as Genie gesture dictionaries.	Answers a dictionary."	| member object crDictionary stream |	crDictionary _ Smalltalk at: #CRDictionary ifAbsent: [ ^self error: 'Genie not installed' ].	"don't know how to recursively load"	member _ self memberNamed: memberName.	member ifNil: [ ^self errorNoSuchMember: memberName ].	stream _ ReferenceStream on: member contentStream.	[ object _ stream next ]		on: Error do: 		[:ex |  stream close.		self inform: 'Error on loading: ' , ex description. ^ nil ].	stream close.	(object notNil and: [object name isEmptyOrNil])		ifTrue: [object _ crDictionary name: object storedName].	self installed: member.	^ object! !!SARInstaller methodsFor: 'client services' stamp: 'nk 10/14/2003 15:40'!importImage: memberOrName	| member form |	member _ self memberNamed: memberOrName.	member ifNil: [ ^self errorNoSuchMember: memberOrName ].	form _ ImageReadWriter formFromStream: member contentStream binary.	form ifNil: [ ^self ].	Imports default importImage: form named: (FileDirectory localNameFor: member fileName) sansPeriodSuffix.	self installed: member.! !!SARInstaller methodsFor: 'client services' stamp: 'nk 2/13/2004 12:14'!installMember: memberOrName	| memberName extension isGraphic stream member |	member _ self memberNamed: memberOrName.	member ifNil: [ ^false ].	memberName _ member fileName.	extension _ (FileDirectory extensionFor: memberName) asLowercase.	Smalltalk at: #CRDictionary ifPresent: [ :crDictionary |		(extension = crDictionary fileNameSuffix) ifTrue: [  self fileInGenieDictionaryNamed: memberName. ^true ] ].	extension caseOf: {		[ Project projectExtension ] -> [ self fileInProjectNamed: memberName createView: true ].		[ 'st' ] -> [ self fileInPackageNamed: memberName ].		[ 'cs' ] -> [  self fileInMemberNamed: memberName  ].		[ 'mc' ] -> [ self fileInMonticelloPackageNamed: memberName ].		[ 'mcv' ] -> [ self fileInMonticelloVersionNamed: memberName ].		[ 'mcz' ] -> [ self fileInMonticelloZipVersionNamed: memberName ].		[ 'morph' ] -> [ self fileInMorphsNamed: member addToWorld: true ].		[ 'ttf' ] -> [ self fileInTrueTypeFontNamed: memberName ].	} otherwise: [		('t*xt' match: extension) ifTrue: [ self openTextFile: memberName ]			ifFalse: [ stream _ member contentStream.		isGraphic _ ImageReadWriter understandsImageFormat: stream.		stream reset.		isGraphic			ifTrue: [ self openGraphicsFile: member ]			ifFalse: [ "now what?" ^false ]]	].	^true! !!SARInstaller methodsFor: 'client services' stamp: 'nk 10/14/2003 18:58'!memberNamed: aString	^(zip member: aString)		ifNil: [ | matching |			matching _ zip membersMatching: aString.			matching isEmpty ifFalse: [ matching last ]].! !!SARInstaller methodsFor: 'fileIn' stamp: 'nk 10/12/2003 20:41'!installAllMembers	"Try to install all the members, in order, based on their filenames and/or contents."	| uninstalled |	uninstalled _ OrderedCollection new.	zip members do: [ :member | self installMember: member ].	uninstalled _ self uninstalledMembers.	uninstalled isEmpty ifTrue: [ ^self ].	uninstalled inspect.! !!SARInstaller methodsFor: 'private' stamp: 'nk 10/13/2003 12:56'!errorNoSuchMember: aMemberName	(self confirm: 'No member named ', aMemberName, '. Do you want to stop loading?')		== true ifTrue: [ self error: 'aborted' ].! !"Postscript:Note v28 as installed."((SMSqueakMap default packageWithId: '75c970ab-dca7-48ee-af42-5a013912c880') releaseWithVersion: '28') noteInstalled!