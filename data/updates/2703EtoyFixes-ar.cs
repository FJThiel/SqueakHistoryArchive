'From Squeak2.9BJ of 22 September 2000 [latest update: #2710] on 25 September 2000 at 12:31:51 pm'!"Change Set:		EtoyFixes-arDate:			25 September 2000Author:			Andreas RaabThree fixes for eToys:#1: Aggressively force recompilation of the script if user presses the expand arrow.#2: Make sure new costumes are stepping.#3: Make sure both, old and new costume get #changed when switching between costumes."!!Player methodsFor: 'costume' stamp: 'ar 9/25/2000 12:31'!renderedCostume: aMorph	"Make aMorph be the receiver's rendered costume; if flexing is currently in effect, make the new morph be flexed correspondingly"	| renderedMorph known anEventHandler w |	renderedMorph _ costume renderedMorph.	renderedMorph == aMorph ifTrue: [^ self].	self rememberCostume: renderedMorph.	renderedMorph changed.	w _ renderedMorph world.	aMorph copyCostumeStateFrom: renderedMorph.	anEventHandler _ renderedMorph eventHandler.	costume isFlexMorph		ifTrue:			[costume adjustAfter:				[costume replaceSubmorph: renderedMorph by: aMorph]]		ifFalse:			[costume owner replaceSubmorph: costume by: aMorph.			aMorph player: self.			aMorph actorState: costume actorState.			(known _ costume knownName) ifNotNil:				[aMorph setNameTo: known].			costume _ aMorph.			w ifNotNil:[				w stopStepping: renderedMorph.				w startStepping: aMorph]].	aMorph eventHandler: anEventHandler.	aMorph changed.! !!TileMorph methodsFor: 'arrows' stamp: 'ar 9/24/2000 19:11'!deleteLastTwoTiles	"Remove the current suffix (last two tiles) in this line of tiles"	| phrase pad goodPad |	(phrase _ self couldRetract) ifNil: [^ self].	pad _ phrase ownerThatIsA: TilePadMorph.	goodPad _ phrase firstSubmorph.	pad owner addMorphBack: goodPad.	pad delete.	(goodPad lastSubmorph respondsTo: #addSuffixArrow) 		ifTrue: [goodPad lastSubmorph addSuffixArrow; addRetractArrow]		ifFalse: [goodPad lastSubmorph lastSubmorph addSuffixArrow; addRetractArrow].	goodPad topEditor install. "recompile"! !!TileMorph methodsFor: 'arrows' stamp: 'ar 9/24/2000 19:10'!showSuffixChoices	"The suffix arrow has been hit, so respond appropriately"	| plusPhrase phrase pad outer num |	(phrase _ self ownerThatIsA: PhraseTileMorph) ifNil: [^ self].	(type == #literal) & (literal isNumber) ifTrue: ["Tile is a constant number"		phrase lastSubmorph == owner "pad"			ifTrue: ["we are adding the first time (at end of our phrase)"				plusPhrase _ self presenter phraseForReceiver: literal 						op: #+ arg: 1 resultType: #number.				plusPhrase submorphs second submorphs last setBalloonText: (ScriptingSystem helpStringForOperator: #+).				owner acceptDroppingMorph: plusPhrase event: self primaryHand lastEvent.				num _ plusPhrase firstSubmorph firstSubmorph.				num deleteSuffixArrow]].	type == #operator ifTrue: ["Tile is accessor of an expression"		phrase resultType == #number ifTrue:			[outer _ phrase ownerThatIsA: PhraseTileMorph.			pad _ self ownerThatIsA: TilePadMorph.			outer ifNotNil:				[outer lastSubmorph == pad ifTrue: [ "first time"					plusPhrase _ self presenter phraseForReceiver: 1 							op: #+ arg: 1 resultType: #number.					plusPhrase submorphs second submorphs last setBalloonText: (ScriptingSystem helpStringForOperator: #+).					pad acceptDroppingMorph: plusPhrase event: self primaryHand lastEvent.					plusPhrase firstSubmorph removeAllMorphs; addMorph: phrase.	"car's heading"					self deleteSuffixArrow.					pad topEditor install "recompile"]]]].	(phrase topEditor ifNil: [phrase]) enforceTileColorPolicy! !