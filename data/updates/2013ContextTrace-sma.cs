'From Squeak2.8alpha of 4 February 2000 [latest update: #2005] on 22 April 2000 at 5:31:13 pm'!"Change Set:		1031ContextTrace-smaDate:			22 April 2000Author:			Stefan Matthias AustAs discussed in the mailing list, #trace: walkbacked if traced object didn't have correct print strings. This patch wrapps printing in an exception handler and unifies tracing on Transcript and on files, also providing a new method trace: aBlock on: aStream for general usage."!!ContextPart class methodsFor: 'examples' stamp: 'sma 4/22/2000 17:03'!trace: aBlock		"ContextPart trace: [3 factorial]"	"This method uses the simulator to print calls and returned values in the Transcript."	Transcript clear.	^ self trace: aBlock on: Transcript! !!ContextPart class methodsFor: 'examples' stamp: 'sma 4/22/2000 17:03'!trace: aBlock on: aStream		"ContextPart trace: [3 factorial]"	"This method uses the simulator to print calls to a file."	| prev |	prev _ aBlock.	^ thisContext sender		runSimulated: aBlock		contextAtEachStep:			[:current |			Sensor anyButtonPressed ifTrue: [^ nil].			current == prev				ifFalse:					[prev sender ifNil:						[aStream space; nextPut: $^.						self carefullyPrint: current top on: aStream].					aStream cr.					(current depthBelow: aBlock) timesRepeat: [aStream space].					self carefullyPrint: current receiver on: aStream.					aStream space; nextPutAll: current selector; flush.					prev _ current]]! !!ContextPart class methodsFor: 'examples' stamp: 'sma 4/22/2000 17:05'!trace: aBlock onFileNamed: fileName		"ContextPart trace: [3 factorial] onFileNamed: 'trace'"	"This method uses the simulator to print calls to a file."	| aStream |	^ [aStream _ FileStream fileNamed: fileName.		self trace: aBlock on: aStream] ensure: [aStream close]! !!ContextPart class methodsFor: 'private' stamp: 'sma 4/22/2000 17:01'!carefullyPrint: anObject on: aStream	aStream nextPutAll: ([anObject printString]		on: Error		do: ['unprintable ' , anObject class name])! !!Stream methodsFor: 'accessing' stamp: 'sma 4/22/2000 17:07'!flush	"Do nothing by default"! !!TranscriptStream methodsFor: 'stream extensions' stamp: 'sma 4/22/2000 16:58'!flush	self endEntry! !