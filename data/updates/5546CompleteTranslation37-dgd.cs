'From Squeak3.7alpha of ''11 September 2003'' [latest update: #5545] on 15 November 2003 at 7:34:13 pm'!"Change Set:		CompleteTranslationFor37-FIXED-dgdDate:			15 November 2003Author:			Diego Gomez Deck <DiegoGomezDeck@ConsultAr.com>This changeset includes the changes all over the image to make it translatable.Basically it means:- sending of #translated message to visible strings to make them translatable- some few #format: messages to replace string concatenations of strings where the order make sense only in EnglishThis changeset was tested in a 3.7a (5423) and I solved 43 conflicts (most of them with MCP-Complete changeset).Second revision: Tested in 3.71 (5545) 19 conflicts was solved.  Thanks Stef!!"!!Object methodsFor: 'error handling' stamp: 'sd 11/13/2003 21:11'!deprecated: aBlock explanation: aString 	 "This method is OBSOLETE.  Use #deprecated:block: instead."	self deprecated: 'Use Object>>deprecated:block: instead of deprecated:explanation:.'.	Preferences showDeprecationWarnings ifTrue:		[Deprecation			signal: ('{1} has been deprecated. {2}' translated format: {thisContext sender printString. aString})].	^ aBlock value.! !!Object methodsFor: 'error handling' stamp: 'sd 11/13/2003 21:10'!deprecatedExplanation: aString     "This method is OBSOLETE.  Use #deprecated: instead."	self deprecated: 'Use Object>>deprecated: instead of deprecatedExplanation:.'.	Preferences showDeprecationWarnings ifTrue:		[Deprecation signal: ('{1} has been deprecated. {2}' translated format: {thisContext sender printString. aString})]! !!ChangeSet class methodsFor: 'defaults' stamp: 'dgd 9/6/2003 19:56'!defaultName	^ self uniqueNameLike: 'Unnamed' translated! !!Command methodsFor: 'private' stamp: 'dgd 8/26/2003 21:43'!cmdWording	"Answer the wording to be used to refer to the command in a menu"	^ cmdWording ifNil: ['last command' translated]! !!CommandHistory methodsFor: 'menu' stamp: 'dgd 8/26/2003 21:42'!undoOrRedoMenuWording	"Answer the wording to be used in a menu item offering undo/redo (i.e., the form used when the #infiniteUndo preference is false)"	| pre |	lastCommand ifNil: [^ 'can''t undo' translated].	pre _ lastCommand phase == #done		ifTrue: ['undo' translated]		ifFalse: ['redo' translated].	^ pre, ' "', (lastCommand cmdWording truncateWithElipsisTo: 20), '" (z)'! !!CurrentProjectRefactoring class methodsFor: 'flaps' stamp: 'dgd 8/31/2003 18:06'!suppressFlapsString	"Answer a string characterizing whether flaps are suppressed 	at the moment or not"	^ (self currentFlapsSuppressed		ifTrue: ['<no>']		ifFalse: ['<yes>']), 'show shared tabs (F)' translated! !!DataType methodsFor: 'tiles' stamp: 'dgd 9/6/2003 20:29'!addWatcherItemsToMenu: aMenu forGetter: aGetter	"Add watcher items to the menu if appropriate, provided the getter is not an odd-ball one for which a watcher makes no sense"	(#(colorSees copy newClone getNewClone color:sees: touchesA: overlaps:) includes: aGetter) ifFalse:		[aMenu add: 'simple watcher' translated selector: #tearOffWatcherFor: argument: aGetter]! !!DescriptionForPartsBin methodsFor: 'access' stamp: 'dgd 9/2/2003 18:57'!translatedCategories	"Answer translated the categoryList of the receiver"	^ self categories		collect: [:each | each translated]! !!FileList methodsFor: 'file list menu' stamp: 'dgd 9/19/2003 11:20'!fileContentsMenu: aMenu shifted: shifted	"Construct aMenu to have items appropriate for the file browser's code pane, given the shift state provided"	| shiftMenu services maybeLine extraLines |	shifted ifTrue:		[shiftMenu _ ParagraphEditor shiftedYellowButtonMenu.		^ aMenu 			labels: shiftMenu labelString 			lines: shiftMenu lineArray			selections: shiftMenu selections].	fileName ifNotNil:		[services _ OrderedCollection new.		(#(briefHex briefFile needToGetBriefHex needToGetBrief) includes: brevityState) ifTrue:			[services add: self serviceGet].		(#(fullHex briefHex needToGetFullHex needToGetBriefHex) includes: brevityState) ifFalse:			[services add: self serviceGetHex].		maybeLine _ services size.		(#('st' 'cs') includes: self suffixOfSelectedFile) ifTrue:			[services addAll:				(self servicesFromSelectorSpecs:					#(fileIntoNewChangeSet: fileIn: browseChangesFile: browseFile:))].		extraLines _ OrderedCollection new.		maybeLine > 0 ifTrue: [extraLines add: maybeLine].		services size > maybeLine ifTrue: [extraLines add: services size].		aMenu 			addServices: services			for: self fullName			extraLines: extraLines].	aMenu addList: {			{'find...(f)' translated.		#find}.			{'find again (g)' translated.		#findAgain}.			{'set search string (h)' translated.	#setSearchString}.			#-.			{'do again (j)' translated.		#again}.			{'undo (z)' translated.			#undo}.			#-.			{'copy (c)' translated.			#copySelection}.			{'cut (x)' translated.			#cut}.			{'paste (v)' translated.		#paste}.			{'paste...' translated.			#pasteRecent}.			#-.			{'do it (d)' translated.		#doIt}.			{'print it (p)' translated.		#printIt}.			{'inspect it (i)' translated.		#inspectIt}.			{'fileIn selection (G)' translated.	#fileItIn}.			#-.			{'accept (s)' translated.		#accept}.			{'cancel (l)' translated.		#cancel}.			#-.			{'more...' translated.			#shiftedYellowButtonActivity}}.	^ aMenu! !!FileList methodsFor: 'file menu action' stamp: 'dgd 9/21/2003 17:37'!deleteFile	"Delete the currently selected file"	listIndex = 0 ifTrue: [^ self].	(self confirm: ('Really delete {1}?' translated format:{fileName})) ifFalse: [^ self].	directory deleteFileNamed: fileName.	self updateFileList.	brevityState _ #FileList.	self get! !!FileList methodsFor: 'to be transformed in registration' stamp: 'dgd 9/19/2003 12:06'!volumeMenu: aMenu	^ aMenu addList: {			{'recent...' translated.		#recentDirs}.			#-.			{'add server...' translated.		#askServerInfo}.			{'remove server...' translated.		#removeServer}.			#-.			{'delete directory...' translated.	#deleteDirectory}}.! !!FileList methodsFor: 'volume list and pattern' stamp: 'dgd 9/21/2003 17:36'!deleteDirectory	"Remove the currently selected directory"	| localDir |	directory entries size = 0 ifFalse:[^self inform:'Directory must be empty' translated].	localDir _ directory pathParts last.	(self confirm: ('Really delete {1}?' translated format:{localDir printString})) ifFalse: [^ self].	self volumeListIndex: self volumeListIndex-1.	directory deleteDirectory: localDir.	self updateFileList.! !!FileList2 class methodsFor: 'blue ui' stamp: 'dgd 9/6/2003 19:53'!morphicViewProjectLoader2InWorld: aWorld reallyLoad: aBoolean dirFilterType: aSymbol	| window aFileList buttons treePane textColor1 fileListPane pane2a pane2b treeExtent filesExtent |	window _ AlignmentMorphBob1 newColumn.	window hResizing: #shrinkWrap; vResizing: #shrinkWrap.	textColor1 _ Color r: 0.742 g: 0.839 b: 1.0.	aFileList _ self new directory: FileDirectory default.	aFileList 		optionalButtonSpecs: aFileList servicesForProjectLoader;		fileSelectionBlock: (			aSymbol == #limitedSuperSwikiDirectoryList ifTrue: [				MessageSend receiver: self selector: #projectOnlySelectionMethod:			] ifFalse: [				self projectOnlySelectionBlock			]		);		"dirSelectionBlock: self hideSqueakletDirectoryBlock;"		modalView: window.	window		setProperty: #FileList toValue: aFileList;		wrapCentering: #center; cellPositioning: #topCenter;		borderWidth: 4;		borderColor: (Color r: 0.355 g: 0.516 b: 1.0);		useRoundedCorners.	buttons _ #('OK' 'Cancel') collect: [ :each |		self blueButtonText: each translated textColor: textColor1 inWindow: window	].	aWorld width < 800 ifTrue: [		treeExtent _ 150@300.		filesExtent _ 350@300.	] ifFalse: [		treeExtent _ 250@300.		filesExtent _ 350@300.	].	(treePane _ aFileList morphicDirectoryTreePaneFiltered: aSymbol)		extent: treeExtent; 		retractable: false;		borderWidth: 0.	fileListPane _ aFileList morphicFileListPane 		extent: filesExtent; 		retractable: false;		borderWidth: 0.	window		addARow: {			window fancyText: 'Load A Project' translated ofSize: 21 color: textColor1		};		addARowCentered: {			buttons first. 			(Morph new extent: 30@5) color: Color transparent. 			buttons second		};		addARow: {			window fancyText: 'Please select a project' translated ofSize: 21 color: Color blue		};		addARow: {			(window inAColumn: {(pane2a _ window inARow: {window inAColumn: {treePane}}) 				useRoundedCorners; layoutInset: 6}) layoutInset: 10.			(window inAColumn: {(pane2b _ window inARow: {window inAColumn: {fileListPane}}) 				useRoundedCorners; layoutInset: 6}) layoutInset: 10.		}.	window fullBounds.	window fillWithRamp: self blueRamp1 oriented: 0.65.	pane2a fillWithRamp: self blueRamp3 oriented: (0.7 @ 0.35).	pane2b fillWithRamp: self blueRamp3 oriented: (0.7 @ 0.35).	buttons do: [ :each |		each fillWithRamp: self blueRamp2 oriented: (0.75 @ 0).	].	buttons first 		on: #mouseUp 		send: (aBoolean ifTrue: [#okHitForProjectLoader] ifFalse: [#okHit])		to: aFileList.	buttons second on: #mouseUp send: #cancelHit to: aFileList.	aFileList postOpen.	window position: aWorld topLeft + (aWorld extent - window extent // 2).	window adoptPaneColor: (Color r: 0.548 g: 0.677 b: 1.0).	^ window openInWorld: aWorld.! !!FileList2 class methodsFor: 'blue ui' stamp: 'jm 9/2/2003 21:14'!morphicViewProjectSaverFor: aProject"(FileList2 morphicViewProjectSaverFor: Project current) openInWorld"	| window aFileList buttons treePane pane2 textColor1 option treeExtent buttonData buttonRow |	textColor1 _ Color r: 0.742 g: 0.839 b: 1.0.	aFileList _ self new directory: ServerDirectory projectDefaultDirectory.	aFileList dirSelectionBlock: self hideSqueakletDirectoryBlock.	window _ AlignmentMorphBob1 newColumn.	window hResizing: #shrinkWrap; vResizing: #shrinkWrap.	aFileList modalView: window.	window		setProperty: #FileList toValue: aFileList;		wrapCentering: #center; cellPositioning: #topCenter;		borderWidth: 4;		borderColor: (Color r: 0.355 g: 0.516 b: 1.0);		useRoundedCorners.	buttonData _ Preferences enableLocalSave		ifTrue: [#( 			('Save' okHit 'Save in the place specified below, and in the 	Squeaklets folder on your local disk') 			('Save on local disk only' saveLocalOnlyHit 'saves in the Squeaklets folder')			('Cancel' cancelHit 'return without saving') 			)]		ifFalse: [#( 			('Save' okHit 'Save in the place specified below, and in the 	Squeaklets folder on your local disk') 			('Cancel' cancelHit 'return without saving') 			)].	buttons _ buttonData collect: [ :each |		(self blueButtonText: each first translated textColor: textColor1 inWindow: window)			setBalloonText: each third translated;			hResizing: #shrinkWrap;			on: #mouseUp send: each second to: aFileList	].	option _ aProject world 		valueOfProperty: #SuperSwikiPublishOptions 		ifAbsent: [#initialDirectoryList].	aProject world removeProperty: #SuperSwikiPublishOptions.	World height < 500 ifTrue: [		treeExtent _ 350@150.	] ifFalse: [		treeExtent _ 350@300.	].	(treePane _ aFileList morphicDirectoryTreePaneFiltered: option) 		extent: treeExtent; 		retractable: false;		borderWidth: 0.	window		addARowCentered: {			window fancyText: 'Publish This Project' translated ofSize: 21 color: textColor1		}.	buttonRow _ OrderedCollection new.	buttons do: [:button | buttonRow add: button] separatedBy: [buttonRow add: ((Morph new extent: 30@5) color: Color transparent)]."	addARowCentered: {			buttons first. 			(Morph new extent: 30@5) color: Color transparent. 			buttons second.			(Morph new extent: 30@5) color: Color transparent. 			buttons third		};"	window		addARowCentered: buttonRow;		addARowCentered: { (window inAColumn: {(ProjectViewMorph on: aProject) lock}) layoutInset: 4};		addARowCentered: {			window fancyText: 'Please select a folder' translated ofSize: 21 color: Color blue		};		addARow: {			(				window inAColumn: {					(pane2 _ window inARow: {window inAColumn: {treePane}}) 						useRoundedCorners; layoutInset: 6				}			) layoutInset: 10		}.	window fullBounds.	window fillWithRamp: self blueRamp1 oriented: 0.65.	pane2 fillWithRamp: self blueRamp3 oriented: (0.7 @ 0.35).	buttons do: [ :each |		each fillWithRamp: self blueRamp2 oriented: (0.75 @ 0).	].	window setProperty: #morphicLayerNumber toValue: 11.	aFileList postOpen.	window adoptPaneColor: (Color r: 0.548 g: 0.677 b: 1.0).	^ window ! !!FileList2 class methodsFor: 'morphic ui' stamp: 'dgd 9/19/2003 12:18'!morphicViewFileSelectorForSuffixes: aList	"Answer a morphic file-selector tool for the given suffix list"	| dir aFileList window fixedSize midLine gap |	dir _ FileDirectory default.	aFileList _ self new directory: dir.	aFileList optionalButtonSpecs: aFileList okayAndCancelServices.	aList ifNotNil:		[aFileList fileSelectionBlock: [:entry :myPattern |			entry isDirectory				ifTrue:					[false]				ifFalse:					[aList includes: (FileDirectory extensionFor: entry name asLowercase)]] fixTemps].	window _ BorderedMorph new		layoutPolicy: ProportionalLayout new;		color: Color lightBlue;		borderColor: Color blue;		borderWidth: 4;		layoutInset: 4;		extent: 600@400;		useRoundedCorners.	window setProperty: #fileListModel toValue: aFileList.	aFileList modalView: window.	midLine _ 0.4.	fixedSize _ 25.	gap _ 5.	self addFullPanesTo: window from: {		{self textRow: 'Please select a file' translated. 0 @ 0 corner: 1 @ 0. 0@0 corner: 0@fixedSize}.		{aFileList optionalButtonRow. 0 @ 0 corner: 1 @ 0. 0@fixedSize corner: 0@(fixedSize * 2)}.		{aFileList morphicDirectoryTreePane. 0@0 corner: midLine@1. 					gap @(fixedSize * 2) corner: gap negated@0}.		{aFileList morphicFileListPane. midLine @ 0 corner: 1@1. 					gap@(fixedSize * 2) corner: gap negated@0}.	}.	aFileList postOpen.	^ window ! !!Flaps class methodsFor: 'flap mechanics' stamp: 'dgd 10/7/2003 22:47'!reinstateDefaultFlaps	"Remove all existing 'standard' global flaps clear the global list, and and add fresh ones.  To be called by doits in updates etc.  This is a radical step, but it does *not* clobber non-standard global flaps or local flaps.  To get the effect of the *former* version of this method, call Flaps freshFlapsStart"	"Flaps reinstateDefaultFlaps"	self globalFlapTabsIfAny do:		[:aFlapTab |			({				'Painting' translated.				'Stack Tools' translated.				'Squeak' translated.				'Menu' translated.				'Widgets' translated.				'Tools' translated.				'Supplies' translated.				'Scripting' translated.				'Objects' translated.				'Navigator' translated			  } includes: aFlapTab flapID) ifTrue:				[self removeFlapTab: aFlapTab keepInList: false]].	"The following reduces the risk that flaps will be created with variant IDs		such as 'Stack Tools2', potentially causing some shared flap logic to fail."		"Smalltalk garbageCollect."  "-- see if we are OK without this"	self addStandardFlaps.	"self disableGlobalFlapWithID: 'Scripting'.	self disableGlobalFlapWithID: 'Objects'."	self currentWorld addGlobalFlaps.	self currentWorld reformulateUpdatingMenus.! !!Flaps class methodsFor: 'menu commands' stamp: 'dgd 8/31/2003 19:01'!disableGlobalFlaps: interactive	"Clobber all the shared flaps structures.  First read the user her Miranda rights."	interactive		ifTrue: [(self confirm: 'CAUTION!! This will destroy all the sharedflaps, so that they will not be present in *any* project.  If, later, you want themback, you will have to reenable them, fromthis same menu, whereupon the standarddefault set of shared flaps will be created.Do you really want to go ahead and clobberall shared flaps at this time?' translated) ifFalse: [^ self]].	self globalFlapTabsIfAny do:		[:aFlapTab | self removeFlapTab: aFlapTab keepInList: false.		aFlapTab isInWorld ifTrue: [self error: 'Flap problem' translated]].	self clobberFlapTabList.	SharedFlapsAllowed _ false.	Smalltalk isMorphic ifTrue:		[ActiveWorld restoreMorphicDisplay.		ActiveWorld reformulateUpdatingMenus].	"The following reduces the risk that flaps will be created with variant IDs		such as 'Stack Tools2', potentially causing some shared flap logic to fail."		"Smalltalk garbageCollect."  "-- see if we are OK without this"! !!Flaps class methodsFor: 'menu commands' stamp: 'dgd 8/31/2003 19:02'!explainFlaps"Flaps are like drawers on the edge of the screen, which can be opened so that you can use what is inside them, and closed when you do not need them.  They have many possible uses, a few of which are illustrated by the default set of flaps you can get as described below.'Shared flaps' are available in every morphic project.  As you move from project to project, you will see these same shared flaps in each, though there are also options, on a project-by-project basis, to choose which of the shared flaps should be shown, and also momentarily to suppress the showing of all shared flaps.   To get started using flaps, bring up the desktop menu and choose 'flaps...', and make the menu stay up by choosing 'keep this menu up'.  If you see, in this flaps menu,  a list of flap names such as 'Squeak', 'Tools', etc., it means that shared flaps are already set up in your image.  If you do not see the list, you will instead see a menu item that invites you to 'install default shared flaps'; choose that, and new flaps will be created, and the flaps menu will change to reflect their presence.'Project flaps' are flaps that belong to a single morphic project.  You will see them when you are in that project, but not when you are in any other morphic project.If a flap is set up as a parts bin (such as the default Tools and Supplies flaps), you can use it to create new objects -- just open the flap, then find the object you want, and drag it out; when the cursor leaves the flap, the flap itself will snap closed, and you''ll be left holding the new object -- just click to place it exactly where you want it.If a flap is *not* set up as a parts bin (such as the default 'Squeak' flap at the left edge of the screen) you can park objects there (this is an easy way to move objects from project to project) and you can place your own private controls there, etc.  Everything in the default 'Squeak' flap (and all the other default flaps, for that matter) is there only for illustrative purposes -- every user will want to fine-tune the flaps to suit his/her own style and needs.Each flap may be set up to appear on mouseover, dragover, both, or neither.  See the menu items described below for more about these and other options.You can open a closed flap by clicking on its tab, or by dragging the tab toward the center of the screenYou can close an open flap by clicking on its tab or by dragging the tab back off the edge of the screen.Drag the tab of a flap to reposition the tab and to resize the flap itself.  Repositioning starts when you drag the cursor out of the original tab area.If flaps or their tabs seem wrongly positioned or lost, try issuing a restoreDisplay from the screen menu.The red-halo menu on a flap allows you to change the flap's properties.   For greatest ease of use, request 'keep this menu up' here -- that way, you can easily explore all the options in the menu.tab color...				Lets you change the color of the flap's tab.flap color...				Lets you change the color of the flap itself.use textual tab...		If the tab is not textual, makes it become textual.change tab wording...	If the tab is already textual, allows you to edit							its wording.use graphical tab...		If the tab is not graphical, makes it become							graphical.choose tab graphic...	If the tab is already graphical, allows you							to change the picture.use solid tab...			If the tab is not solid, makes it become solid, i.e.							appear as a solid band of color along the							entire length or width of the screen.parts-bin behavior		If set, then dragging an object from the flap							tears off a new copy of the object.dragover				If set, the flap opens on dragover and closes							again on drag-leave.mouseover				If set, the flap opens on mouseover and closes							again on mouse-leave. cling to edge...			Governs which edge (left, right, top, bottom)							the flap adheres to.shared					If set, the same flap will be available in all projects; if not, the							flap will will occur only in one project.destroy this flap		Deletes the flap.To define a new flap, use 'make a new flap', found in the 'flaps' menu.To reinstate the default system flaps, you can use 'destroy all shared flaps' from the 'flaps' menu, and once they are destroyed, choose 'install default shared flaps'.To add, delete, or edit things on a given flap, it is often wise first to suspend the flap''s mouse-over and drag-over sensitivity, so it won''t keep disappearing on you while you''re trying to work with it.Besides the three standard flaps delivered with the default system, there are two other flaps readily available on demand from the 'flaps' menu -- one is called 'Stack Tools', which provides some tools useful for building stack-like content, the other is called 'Painting', which provides a quick way to make a new painting.  Simply clicking on the appropriate checkbox in the 'flaps' menu will toggle the corresponding flap between being visible and not being visible in the project."	  	"Open a window giving flap help."	(StringHolder new contents: (self class firstCommentAt: #explainFlaps) translated)		openLabel: 'Flaps' translated"Flaps explainFlaps"	! !!Flaps class methodsFor: 'menu support' stamp: 'dgd 8/31/2003 19:39'!setUpSuppliesFlapOnly	"Set up the Supplies flap as the only shared flap.  A special version formulated for this stand-alone use is used, defined in #newLoneSuppliesFlap"	| supplies |	SharedFlapTabs isEmptyOrNil ifFalse:  "get rid of pre-existing guys if any"		[SharedFlapTabs do:			[:t | t referent delete.  t delete]].	SharedFlapsAllowed _ true.	SharedFlapTabs _ OrderedCollection new.	SharedFlapTabs add: (supplies _ self newLoneSuppliesFlap).	self enableGlobalFlapWithID: 'Supplies' translated.	supplies setToPopOutOnMouseOver: false.	Smalltalk isMorphic ifTrue:		[ActiveWorld addGlobalFlaps.		ActiveWorld reformulateUpdatingMenus]! !!Flaps class methodsFor: 'miscellaneous' stamp: 'dgd 8/31/2003 19:26'!enableClassicNavigatorChanged	"The #classicNavigatorEnabled preference has changed.   No senders in easily traceable in the image, but this is really sent by a Preference object!!"	Preferences classicNavigatorEnabled		ifTrue:			[Flaps disableGlobalFlapWithID: 'Navigator' translated.			Preferences enable: #showProjectNavigator.			self disableGlobalFlapWithID: 'Navigator' translated.]		ifFalse:			[self enableGlobalFlapWithID: 'Navigator' translated.			ActiveWorld addGlobalFlaps].	self doAutomaticLayoutOfFlapsIfAppropriate.	Project current assureNavigatorPresenceMatchesPreference.	ActiveWorld reformulateUpdatingMenus! !!Flaps class methodsFor: 'miscellaneous' stamp: 'dgd 8/31/2003 19:28'!makeNavigatorFlapResembleGoldenBar	"At explicit request, make the flap-based navigator resemble the golden bar.  No senders in the image, but sendable from a doit"	"Flaps makeNavigatorFlapResembleGoldenBar"	Preferences setPreference: #classicNavigatorEnabled toValue: false.	Preferences setPreference: #showProjectNavigator toValue: false.	(self globalFlapTabWithID: 'Navigator' translated) ifNil:		[SharedFlapTabs add: self newNavigatorFlap delete].	self enableGlobalFlapWithID: 'Navigator' translated.	Preferences setPreference: #navigatorOnLeftEdge toValue: true.	(self globalFlapTabWithID: 'Navigator' translated) arrangeToPopOutOnMouseOver: true.	ActiveWorld addGlobalFlaps.	self doAutomaticLayoutOfFlapsIfAppropriate.	Project current assureNavigatorPresenceMatchesPreference.	! !!Flaps class methodsFor: 'new flap' stamp: 'dgd 8/31/2003 18:58'!addLocalFlap	"Menu command -- let the user add a new project-local flap.  Once the new flap is born, the user can tell it to become a shared flap.  Obtain an initial name and edge for the flap, launch the flap, and also launch a menu governing the flap, so that the user can get started right away with customizing it."	| aMenu reply aFlapTab aWorld edge |	aMenu _ MVCMenuMorph entitled: 'Where should the new flap cling?' translated.	aMenu defaultTarget: aMenu.	#(left right top bottom) do:		[:sym | aMenu add: sym asString translated selector: #selectMVCItem: argument: sym].	edge _ aMenu invokeAt: self currentHand position in: self currentWorld.	edge ifNotNil:		[reply _ FillInTheBlank request: 'Wording for this flap: ' translated initialAnswer: 'Flap' translated.		reply isEmptyOrNil ifFalse:			[aFlapTab _ self newFlapTitled: reply onEdge: edge.			(aWorld _ self currentWorld) addMorphFront: aFlapTab.			aFlapTab adaptToWorld: aWorld.			aMenu _ aFlapTab buildHandleMenu: ActiveHand.			aFlapTab addTitleForHaloMenu: aMenu.			aFlapTab computeEdgeFraction.			aMenu popUpEvent: ActiveEvent in: ActiveWorld]]	! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 8/31/2003 18:59'!addAndEnableEToyFlaps	"Initialize the standard default out-of-box set of global flaps.  This method creates them and places them in my class variable #SharedFlapTabs, but does not itself get them displayed."	| aSuppliesFlap |	SharedFlapTabs		ifNotNil: [^ self].	SharedFlapTabs _ OrderedCollection new.	aSuppliesFlap _ self newSuppliesFlapFromQuads: self quadsDefiningPlugInSuppliesFlap positioning: #right.	aSuppliesFlap referent setNameTo: 'Supplies Flap' translated.  "Per request from Kim Rose, 7/19/02"	SharedFlapTabs add: aSuppliesFlap.  "The #center designation doesn't quite work at the moment"	SharedFlapTabs add: self newNavigatorFlap.	self enableGlobalFlapWithID: 'Supplies' translated.	self enableGlobalFlapWithID: 'Navigator' translated.	SharedFlapsAllowed _ true.	Project current flapsSuppressed: false.	^ SharedFlapTabs"Flaps addAndEnableEToyFlaps"! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 8/31/2003 18:44'!addNewDefaultSharedFlaps	"Add the stack tools flap and the navigator flap to the global list, but do not have them showing initially.  Transitional, called by the postscript of the FlapsOnBottom update; probably dispensable afterwards."	SharedFlapTabs ifNotNil:		[(self globalFlapTabWithID: 'Stack Tools' translated) ifNil:			[SharedFlapTabs add: self newStackToolsFlap delete].		self enableGlobalFlapWithID: 'Stack Tools' translated.		(self globalFlapTabWithID: 'Navigator' translated) ifNil:			[SharedFlapTabs add: self newNavigatorFlap delete].		self enableGlobalFlapWithID: 'Navigator' translated.		self currentWorld addGlobalFlaps]! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 10/7/2003 22:47'!addStandardFlaps	"Initialize the standard default out-of-box set of global flaps. 	This method creates them and places them in my class 	variable #SharedFlapTabs, but does not itself get them 	displayed. "	SharedFlapTabs		ifNil: [SharedFlapTabs := OrderedCollection new].	SharedFlapTabs add: self newSqueakFlap.	SharedFlapTabs add: self newSuppliesFlap.	SharedFlapTabs add: self newToolsFlap.	SharedFlapTabs add: self newWidgetsFlap.	SharedFlapTabs add: self newStackToolsFlap.	SharedFlapTabs add: self newNavigatorFlap.	SharedFlapTabs add: self newPaintingFlap.	self disableGlobalFlapWithID: 'Stack Tools' translated.	self disableGlobalFlapWithID: 'Painting' translated.	self disableGlobalFlapWithID: 'Navigator' translated.	^ SharedFlapTabs! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 8/31/2003 19:38'!newLoneSuppliesFlap	"Answer a fully-instantiated flap named 'Supplies' to be placed at the bottom of the screen, for use when it is the only flap shown upon web launch"	|  aFlapTab aStrip leftEdge |  "Flaps setUpSuppliesFlapOnly"	aStrip _ PartsBin newPartsBinWithOrientation: #leftToRight from:	 #(	(TrashCanMorph			new						'Trash'				'A tool for discarding objects')		(ScriptingSystem 		scriptControlButtons 			'Status'				'Buttons to run, stop, or single-step scripts')	(AllScriptsTool			allScriptsToolForActiveWorld	'All Scripts' 		'A tool that lets you control all the running scripts in your world')	(PaintInvokingMorph	new						'Paint'				'Drop this into an area to start making a fresh painting there')	(RectangleMorph 		authoringPrototype		'Rectangle' 		'A rectangle'	)	(RectangleMorph		roundRectPrototype		'RoundRect'		'A rectangle with rounded corners')	(EllipseMorph			authoringPrototype		'Ellipse'			'An ellipse or circle')	(StarMorph				authoringPrototype		'Star'			'A star')	(CurveMorph			authoringPrototype		'Curve'			'A curve')	(PolygonMorph			authoringPrototype		'Polygon'		'A straight-sided figure with any number of sides')	(TextMorph				authoringPrototype		'Text'			'Text that you can edit into anything you desire.')	(SimpleSliderMorph		authoringPrototype		'Slider'			'A slider for showing and setting numeric values.')	(JoystickMorph			authoringPrototype		'Joystick'		'A joystick-like control')	(ScriptingSystem		prototypicalHolder 		'Holder'			'A place for storing alternative pictures in an animation, ec.')	(ScriptableButton		authoringPrototype		'Button'			'A Scriptable button')	(PasteUpMorph			authoringPrototype		'Playfield'		'A place for assembling parts or for staging animations')	(BookMorph				authoringPrototype		'Book'			'A multi-paged structure')	(TabbedPalette			authoringPrototype		'Tabs'			'A structure with tabs')	(RecordingControlsMorph authoringPrototype			'Sound'				'A device for making sound recordings.')	(MagnifierMorph		newRound					'Magnifier'			'A magnifying glass')	(ImageMorph			authoringPrototype		'Picture'		'A non-editable picture of something')	(ClockMorph				authoringPrototype		'Clock'			'A simple digital clock')	(BookMorph				previousPageButton 		'Previous'		'A button that takes you to the previous page')	(BookMorph				nextPageButton			'Next'			'A button that takes you to the next page')		).	aFlapTab _ FlapTab new referent: aStrip beSticky.	aFlapTab setName: 'Supplies' translated edge: #bottom color: Color red lighter.	aStrip extent: self currentWorld width @ 78.	leftEdge _ ((Display width - (16  + aFlapTab width)) + 556) // 2.	aFlapTab position: (leftEdge @ (self currentWorld height - aFlapTab height)).	aStrip beFlap: true.	aStrip color: Color red muchLighter.	aStrip autoLineLayout: true.		^ aFlapTab! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 8/31/2003 19:03'!newNavigatorFlap	"Answer a newly-created flap which adheres to the bottom edge of the screen and which holds the project navigator controls. "	|  aFlapTab navBar aFlap |	navBar _ ProjectNavigationMorph preferredNavigator new.	aFlap _ PasteUpMorph newSticky borderWidth: 0;			extent: navBar extent + (0@20);			color: (Color orange alpha: 0.8);			beFlap: true;			addMorph: navBar beSticky.	aFlap hResizing: #shrinkWrap; vResizing: #shrinkWrap.	aFlap useRoundedCorners.	aFlap setNameTo: 'Navigator Flap' translated.	navBar fullBounds.  "to establish width"		aFlapTab _ FlapTab new referent: aFlap.	aFlapTab setName: 'Navigator' translated edge: #bottom color: Color orange.	aFlapTab position: ((navBar width // 2) - (aFlapTab width // 2))					@ (self currentWorld height - aFlapTab height).	aFlapTab setBalloonText: aFlapTab balloonTextForFlapsMenu.	^ aFlapTab"Flaps replaceGlobalFlapwithID: 'Navigator' translated "! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 8/31/2003 19:56'!newObjectsFlap	"Answer a fully-instantiated flap named 'Objects' to be placed at the top of the screen.  Not currently called; this worked once, but probably not at the moment."	|  aFlapTab anObjectsTool |	anObjectsTool _ ObjectsTool new.	anObjectsTool initializeForFlap.	anObjectsTool showCategories.	aFlapTab _ FlapTab new referent: anObjectsTool beSticky.	aFlapTab setName: 'Objects' translated edge: #top color: Color red lighter.	aFlapTab position: ((Display width - (aFlapTab width + 22)) @ 0).	aFlapTab setBalloonText: aFlapTab balloonTextForFlapsMenu.	anObjectsTool extent: self currentWorld width @ 200.	anObjectsTool beFlap: true.	anObjectsTool color: Color red muchLighter.	anObjectsTool clipSubmorphs: true.		^ aFlapTab! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 8/31/2003 19:50'!newPaintingFlap	"Add a flap with the paint palette in it"	| aFlap aFlapTab  |	"Flaps reinstateDefaultFlaps. Flaps addPaintingFlap"	aFlap _ PasteUpMorph new borderWidth: 0.	aFlap color: Color transparent.	aFlap layoutPolicy: TableLayout new.	aFlap hResizing: #shrinkWrap.	aFlap vResizing: #shrinkWrap.	aFlap cellPositioning: #topLeft.	aFlap clipSubmorphs: false.	aFlap beSticky. "really?!!"	aFlap addMorphFront: PaintBoxMorph new.	aFlap setProperty: #flap toValue: true.	aFlap fullBounds. "force layout"	aFlapTab _ FlapTab new referent: aFlap.	aFlapTab setNameTo: 'Painting' translated.	aFlapTab setProperty: #priorWording toValue: 'Paint' translated.	aFlapTab useGraphicalTab.	aFlapTab removeAllMorphs.	aFlapTab setProperty: #paintingFlap toValue: true.	aFlapTab addMorphFront: 		"(SketchMorph withForm: (ScriptingSystem formAtKey: #PaintingFlapPic))"		self paintFlapButton.	aFlapTab cornerStyle: #rounded.	aFlapTab edgeToAdhereTo: #right.	aFlapTab setToPopOutOnDragOver: false.	aFlapTab setToPopOutOnMouseOver: false.	aFlapTab on: #mouseUp send: #startOrFinishDrawing: to: aFlapTab.	aFlapTab setBalloonText:'Click here to start or finish painting.' translated.	aFlapTab fullBounds. "force layout"	aFlapTab position: (0@6).	self currentWorld addMorphFront: aFlapTab.  	^ aFlapTab! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 9/1/2003 11:42'!newSqueakFlap	"Answer a new default 'Squeak' flap for the left edge of the screen"	| aFlap aFlapTab aButton aClock buttonColor anOffset bb aFont |	aFlap _ PasteUpMorph newSticky borderWidth: 0.	aFlapTab _ FlapTab new referent: aFlap.	aFlapTab setName: 'Squeak' translated edge: #left color: Color brown lighter lighter.	aFlapTab position: (0 @ ((Display height - aFlapTab height) // 2)).	aFlapTab setBalloonText: aFlapTab balloonTextForFlapsMenu.	aFlap cellInset: 14@14.	aFlap beFlap: true.	aFlap color: (Color brown muchLighter lighter "alpha: 0.3").	aFlap extent: 150 @ self currentWorld height.	aFlap layoutPolicy: TableLayout new.	aFlap wrapCentering: #topLeft.	aFlap layoutInset: 2.	aFlap listDirection: #topToBottom.	aFlap wrapDirection: #leftToRight.	"self addProjectNavigationButtonsTo: aFlap."	anOffset _ 16.	aClock _ ClockMorph newSticky.	aClock color: Color red.	aClock showSeconds: false.	aClock font: (TextStyle default fontAt: 3).	aClock step.	aClock setBalloonText: 'The time of day.  If you prefer to see seconds, check out my menu.' translated.	aFlap addCenteredAtBottom: aClock offset: anOffset.	buttonColor _  Color cyan muchLighter.	bb _ SimpleButtonMorph new target: Smalltalk.	bb color: buttonColor.	aButton _ bb copy.	aButton actionSelector: #saveSession.	aButton setBalloonText: 'Make a complete snapshot of the current state of the image onto disk.' translated.	aButton label: 'save' translated font: (aFont _ ScriptingSystem fontForTiles).	aFlap addCenteredAtBottom: aButton offset: anOffset.	aButton _ bb copy target: Utilities.	aButton actionSelector: #updateFromServer.	aButton label: 'load code updates' translated font: aFont.	aButton color: buttonColor.	aButton setBalloonText: 'Check the Squeak server for any new code updates, and load any that are found.' translated.	aFlap addCenteredAtBottom: aButton offset: anOffset.	aButton _ SimpleButtonMorph new target: Smalltalk; actionSelector: #aboutThisSystem;		label: 'about this system' translated font: aFont.	aButton color: buttonColor.	aButton setBalloonText: 'click here to find out version information' translated.	aFlap addCenteredAtBottom: aButton offset: anOffset.	aFlap addCenteredAtBottom: (Preferences themeChoiceButtonOfColor: buttonColor font: aFont) offset: anOffset.	aButton _ TrashCanMorph newSticky.	aFlap addCenteredAtBottom: aButton offset: anOffset.	aButton startStepping.	^ aFlapTab"Flaps replaceGlobalFlapwithID: 'Squeak' translated "! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 8/31/2003 19:40'!newStackToolsFlap	"Add a flap with stack tools in it"	| aFlapTab aStrip |	aStrip _ PartsBin newPartsBinWithOrientation: #leftToRight from:	 self quadsDefiningStackToolsFlap.	aFlapTab _ FlapTab new referent: aStrip beSticky.	aFlapTab setName: 'Stack Tools' translated edge: #bottom color: Color brown lighter lighter.	aFlapTab position: ((Display width - (aFlapTab width + 226)) @ (self currentWorld height - aFlapTab height)).	aFlapTab setBalloonText: aFlapTab balloonTextForFlapsMenu.	aStrip extent: self currentWorld width @ 78.	aStrip beFlap: true.	aStrip autoLineLayout: true.	aStrip color: (Color red muchLighter "alpha: 0.2").	aStrip extent: self currentWorld width @ 70.	^ aFlapTab"Flaps replaceGlobalFlapwithID: 'Stack Tools' translated"! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 8/31/2003 19:39'!newSuppliesFlapFromQuads: quads positioning: positionSymbol	"Answer a fully-instantiated flap named 'Supplies' to be placed at the bottom of the screen.  Use #center as the positionSymbol to have it centered at the bottom of the screen, or #right to have it placed off near the right edge."	|  aFlapTab aStrip hPosition |	aStrip _ PartsBin newPartsBinWithOrientation: #leftToRight from:	 quads.	aFlapTab _ FlapTab new referent: aStrip beSticky.	aFlapTab setName: 'Supplies' translated edge: #bottom color: Color red lighter.	hPosition _ positionSymbol == #center		ifTrue:			[(Display width // 2) - (aFlapTab width // 2)]		ifFalse:			[Display width - (aFlapTab width + 22)].	aFlapTab position: (hPosition @ (self currentWorld height - aFlapTab height)).	aFlapTab setBalloonText: aFlapTab balloonTextForFlapsMenu.	aStrip extent: self currentWorld width @ 78.	aStrip beFlap: true.	aStrip color: Color red muchLighter.	aStrip autoLineLayout: true.		^ aFlapTab"Flaps replaceGlobalFlapwithID: 'Supplies' translated"! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 8/31/2003 19:41'!newToolsFlap	"Answer a newly-created flap which adheres to the right edge of the screen and which holds prototypes of standard tools."	|  aFlapTab aStrip |	aStrip _ PartsBin newPartsBinWithOrientation: #topToBottom from: self quadsDefiningToolsFlap. 	aFlapTab _ FlapTab new referent: aStrip beSticky.	aFlapTab setName: 'Tools' translated edge: #right color: Color orange lighter.	aFlapTab position: (self currentWorld width - aFlapTab width) @ ((Display height - aFlapTab height) // 2).	aFlapTab setBalloonText: aFlapTab balloonTextForFlapsMenu.	aStrip extent: (90 @ self currentWorld height).	aStrip beFlap: true.	aStrip color: (Color orange muchLighter alpha: 0.8).		^ aFlapTab"Flaps replaceGlobalFlapwithID: 'Tools' translated "! !!Flaps class methodsFor: 'predefined flaps' stamp: 'dgd 8/31/2003 19:43'!newWidgetsFlap	"Answer a newly-created flap which adheres to the bottom edge of the screen and which holds prototypes of standard widgets. "	|  aFlapTab aStrip |	aStrip _ PartsBin newPartsBinWithOrientation: #leftToRight from:	 self quadsDefiningWidgetsFlap.	aFlapTab _ FlapTab new referent: aStrip beSticky.	aFlapTab setName: 'Widgets' translated edge: #bottom color: Color blue lighter lighter.	aFlapTab position: ((Display width - (aFlapTab width + 122)) @ (self currentWorld height - aFlapTab height)).	aFlapTab setBalloonText: aFlapTab balloonTextForFlapsMenu.	aStrip extent: self currentWorld width @ 78.	aStrip beFlap: true.	aStrip color: (Color blue muchLighter alpha: 0.8).	aStrip autoLineLayout: true.		^ aFlapTab"Flaps replaceGlobalFlapwithID: 'Widgets' translated "! !!Flaps class methodsFor: 'replacement' stamp: 'dgd 10/7/2003 22:47'!replaceGlobalFlapwithID: flapID	"If there is a global flap with flapID, replace it with an updated one."	| replacement tabs |	(tabs _ self globalFlapTabsWithID: flapID) size = 0 ifTrue: [^ self].	tabs do: [:tab |		self removeFlapTab: tab keepInList: false].	flapID = 'Stack Tools' translated ifTrue: [replacement _ self newStackToolsFlap].	flapID = 'Supplies' translated ifTrue: [replacement _ self newSuppliesFlap].	flapID = 'Tools' translated ifTrue: [replacement _ self newToolsFlap].	flapID = 'Widgets' translated ifTrue: [replacement _ self newWidgetsFlap].	flapID = 'Navigator' translated ifTrue: [replacement _ self newNavigatorFlap].	flapID = 'Squeak' translated ifTrue: [replacement _ self newSqueakFlap].	replacement ifNil: [^ self].	self addGlobalFlap: replacement.	self currentWorld ifNotNil: [self currentWorld addGlobalFlaps]"Flaps replaceFlapwithID: 'Widgets' translated "! !!Flaps class methodsFor: 'replacement' stamp: 'dgd 8/31/2003 19:41'!replaceToolsFlap	"if there is a global tools flap, replace it with an updated one."	self replaceGlobalFlapwithID: 'Tools' translated"Flaps replaceToolsFlap"! !!Flaps class methodsFor: 'shared flaps' stamp: 'dgd 8/31/2003 19:27'!positionNavigatorAndOtherFlapsAccordingToPreference	"Lay out flaps along the designated edge right-to-left, possibly positioning the navigator flap, exceptionally, on the left."	| ids |	ids _ Preferences navigatorOnLeftEdge ifTrue: [{'Navigator' translated}] ifFalse: [#()].	Flaps positionVisibleFlapsRightToLeftOnEdge: #bottom butPlaceAtLeftFlapsWithIDs: ids"Flaps positionNavigatorAndOtherFlapsAccordingToPreference"! !!Flaps class methodsFor: 'shared flaps' stamp: 'dgd 8/31/2003 19:29'!positionVisibleFlapsRightToLeftOnEdge: edgeSymbol butPlaceAtLeftFlapsWithIDs: idList	"Lay out flaps along the designated edge right-to-left, while laying left-to-right any flaps found in the exception list	Flaps positionVisibleFlapsRightToLeftOnEdge: #bottom butPlaceAtLeftFlapWithIDs: {'Navigator' translated. 'Supplies' translated}	Flaps sharedFlapsAlongBottom"	| leftX flapList flapsOnRight flapsOnLeft |	flapList _ self globalFlapTabsIfAny select:		[:aFlapTab | aFlapTab isInWorld and: [aFlapTab edgeToAdhereTo == edgeSymbol]].	flapsOnLeft _ flapList select: [:fl | idList includes: fl flapID].	flapList removeAll: flapsOnLeft.	flapsOnRight _ flapList asSortedCollection:		[:f1 :f2 | f1 left > f2 left].	leftX _ ActiveWorld width - 15.	flapsOnRight do:		[:aFlapTab |			aFlapTab right: leftX - 3.			leftX _ aFlapTab left].	leftX _ ActiveWorld left.	flapsOnLeft _ flapsOnLeft asSortedCollection:		[:f1 :f2 | f1 left > f2 left].	flapsOnLeft do:		[:aFlapTab |			aFlapTab left: leftX + 3.			leftX _ aFlapTab right].	(flapsOnLeft asOrderedCollection, flapsOnRight asOrderedCollection) do:		[:ft | ft computeEdgeFraction.		ft flapID = 'Navigator' translated ifTrue:			[ft referent left: (ft center x - (ft referent width//2) max: 0)]]! !!Flaps class methodsFor: 'shared flaps' stamp: 'dgd 10/7/2003 22:47'!sharedFlapsAlongBottom	"Put all shared flaps (except Painting which can't be moved) along the bottom"	"Flaps sharedFlapsAlongBottom"	| leftX unordered ordered |	unordered _ self globalFlapTabsIfAny asIdentitySet.	ordered _ Array streamContents:		[:s | {				'Squeak' translated.				'Navigator' translated.				'Supplies' translated.				'Widgets' translated.				'Stack Tools' translated.				'Tools' translated.				'Painting' translated.			} do:			[:id | (self globalFlapTabWithID: id) ifNotNilDo:				[:ft | unordered remove: ft.				id = 'Painting' translated ifFalse: [s nextPut: ft]]]].	"Pace off in order from right to left, setting positions"	leftX _ Display width-15.	ordered , unordered asArray reverseDo:		[:ft | ft setEdge: #bottom.		ft right: leftX - 3.  leftX _ ft left].	"Put Nav Bar centered under tab if possible"	(self globalFlapTabWithID: 'Navigator' translated) ifNotNilDo:		[:ft | ft referent left: (ft center x - (ft referent width//2) max: 0)].	self positionNavigatorAndOtherFlapsAccordingToPreference.! !!FlashFileReader methodsFor: 'reading' stamp: 'dgd 9/21/2003 17:38'!processHeader	"Read header information from the source stream.	Return true if successful, false otherwise."	| twipsFrameSize frameRate frameCount |	self processSignature ifFalse:[^false].	version _ stream nextByte.	"Check for the version supported"	version > self maximumSupportedVersion ifTrue:[		(self confirm:('This file''s version ({1}) is higher than the currently supported version ({2}). It may contain features that are not supported and it may not display correctly.Do you want to continue?' translated format:{version. self maximumSupportedVersion})) ifFalse:[^false]].	dataSize _ stream nextLong.	"Check for the minimal file size"	dataSize < 21 ifTrue:[^false].	twipsFrameSize _ stream nextRect.	self recordGlobalBounds: twipsFrameSize.	frameRate _ stream nextWord / 256.0.	self recordFrameRate: frameRate.	frameCount _ stream nextWord.	self recordFrameCount: frameCount.	log ifNotNil:[		log cr; nextPutAll:'------------- Header information --------------'.		log cr; nextPutAll:'File version		'; print: version.		log cr; nextPutAll:'File size			'; print: dataSize.		log cr; nextPutAll:'Movie width		'; print: twipsFrameSize extent x // 20.		log cr; nextPutAll:'Movie height	'; print: twipsFrameSize extent y // 20.		log cr; nextPutAll:'Frame rate		'; print: frameRate.		log cr; nextPutAll:'Frame count	'; print: frameCount.		log cr; cr.		self flushLog].	^true! !!Form methodsFor: 'displaying' stamp: 'dgd 8/26/2003 21:44'!setAsBackground	"Set this form as a background image."	| world newColor |	Smalltalk isMorphic 		ifTrue:			[world _ self currentWorld.			newColor _ InfiniteForm with: self.			self rememberCommand:				(Command new cmdWording: 'set background to a picture' translated;					undoTarget: world selector: #color: argument: world color;					redoTarget: world selector: #color: argument: newColor).			world color: newColor]		ifFalse:			[ScheduledControllers screenController model form: self.			Display restoreAfter: []]! !!GZipReadStream class methodsFor: 'fileIn/Out' stamp: 'dgd 9/21/2003 17:46'!uncompressedFileName: fullName	^((fullName endsWith: '.gz') and: [self confirm: ('{1}appears to be a compressed file.Do you want to uncompress it?' translated format:{fullName})])		ifFalse: [fullName]		ifTrue:[self saveContents: fullName]! !!MethodHolder methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:54'!addModelMenuItemsTo: aCustomMenu forMorph: aMorph hand: aHandMorph	aCustomMenu addLine.	aCustomMenu add: 'whose script is this?' translated target: self action: #identifyScript	! !!Morph methodsFor: 'debug and other' stamp: 'dgd 8/30/2003 20:36'!addDebuggingItemsTo: aMenu hand: aHandMorph	aMenu add: 'debug...' translated subMenu:  (self buildDebugMenu: aHandMorph)! !!Morph methodsFor: 'debug and other' stamp: 'dgd 11/15/2003 19:28'!buildDebugMenu: aHand	"Answer a debugging menu for the receiver.  The hand argument is seemingly historical and plays no role presently"	| aMenu aPlayer |	aMenu _ MenuMorph new defaultTarget: self.	aMenu addStayUpItem.	(self hasProperty: #errorOnDraw) ifTrue:		[aMenu add: 'start drawing again' translated action: #resumeAfterDrawError.		aMenu addLine].	(self hasProperty: #errorOnStep) ifTrue:		[aMenu add: 'start stepping again' translated action: #resumeAfterStepError.		aMenu addLine].	aMenu add: 'inspect morph' translated action: #inspectInMorphic:.	aMenu add: 'inspect owner chain' translated action: #inspectOwnerChain.	Smalltalk isMorphic ifFalse:		[aMenu add: 'inspect morph (in MVC)' translated action: #inspect].	self isMorphicModel ifTrue:		[aMenu add: 'inspect model' translated target: self model action: #inspect].	(aPlayer _ self player) ifNotNil:		[aMenu add: 'inspect player' translated target: aPlayer action: #inspect].     aMenu add: 'explore morph' translated target: self selector: #explore.	aMenu addLine.	aMenu add: 'viewer for Player' translated target: self player action: #beViewed.	aMenu balloonTextForLastItem: 'Opens a viewer on my Player -- this is the same thing you get if you click on the cyan "View" halo handle' translated.	aMenu add: 'viewer for Morph' translated target: self action: #viewMorphDirectly.	aMenu balloonTextForLastItem: 'Opens a Viewer on this Morph, rather than on its Player' translated.	aMenu addLine.	aPlayer ifNotNil:		[aPlayer class isUniClass ifTrue: [			aMenu add: 'browse player class' translated target: aPlayer action: #browseHierarchy]].	aMenu add: 'browse morph class' translated target: self selector: #browseHierarchy.	(self isMorphicModel)		ifTrue: [aMenu				add: 'browse model class'				target: self model				selector: #browseHierarchy].	aMenu addLine.	aPlayer ifNotNil:		[aMenu add: 'player protocol (tiles)' translated target: aPlayer action: #openInstanceBrowserWithTiles			"#browseProtocolForPlayer"].	aMenu add: 'morph protocol (text)' translated target: self selector: #haveFullProtocolBrowsed.	aMenu add: 'morph protocol (tiles)' translated target: self selector: #openInstanceBrowserWithTiles.	aMenu addLine.	self addViewingItemsTo: aMenu.	aMenu 		add: 'make own subclass' translated action: #subclassMorph;		add: 'internal name ' translated action: #choosePartName;		add: 'save morph in file' translated  action: #saveOnFile;		addLine;		add: 'call #tempCommand' translated action: #tempCommand;		add: 'define #tempCommand' translated action: #defineTempCommand;		addLine;		add: 'control-menu...' translated target: self selector: #invokeMetaMenu:;		add: 'edit balloon help' translated action: #editBalloonHelpText.	^ aMenu! !!Morph methodsFor: 'debug and other' stamp: 'dgd 8/30/2003 20:43'!tempCommand	"Generic backstop.  If you care to, you can comment out what's below here, and substitute your own code, though the intention of design of the feature is that you leave this method as it is, and instead reimplement tempCommand in the class of whatever individual morph you care to.  In any case, once you have your own #tempCommand in place, you will then be able to invoke it from the standard debugging menus."	self inform: 'Before calling tempCommand, youshould first give it a definition.  Todo this, choose "define tempCommand"from the debug menu.' translated! !!Morph methodsFor: 'drawing' stamp: 'dgd 8/30/2003 20:20'!hasClipSubmorphsString	"Answer a string that represents the clip-submophs checkbox"	^ (self clipSubmorphs		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'provide clipping' translated! !!Morph methodsFor: 'drop shadows' stamp: 'dgd 8/30/2003 16:48'!addDropShadowMenuItems: aMenu hand: aHand	| menu |	menu _ MenuMorph new defaultTarget: self.	menu		addUpdating: #hasDropShadowString		action: #toggleDropShadow.	menu addLine.	menu add: 'shadow color...' translated target: self selector: #changeShadowColor.	menu add: 'shadow offset...' translated target: self selector: #setShadowOffset:.	aMenu add: 'drop shadow' translated subMenu: menu.! !!Morph methodsFor: 'drop shadows' stamp: 'dgd 8/30/2003 16:49'!hasDropShadowString	^ (self hasDropShadow		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'show shadow' translated! !!Morph methodsFor: 'dropping/grabbing' stamp: 'dgd 8/26/2003 21:44'!undoGrabCommand	"Return an undo command for grabbing the receiver"	| cmd |	owner ifNil:		[^ nil]. "no owner - no undo"	^ (cmd _ Command new)		cmdWording: 'move ' translated, self nameForUndoWording;		undoTarget: self		selector: #undoMove:redo:owner:bounds:predecessor:		arguments: {cmd. false. owner. self bounds. (owner morphPreceding: self)};		yourself! !!Morph methodsFor: 'e-toy support' stamp: 'dgd 9/6/2003 18:10'!makeGraphPaper	| smallGrid backColor lineColor |	smallGrid _ Compiler evaluate: (FillInTheBlank request: 'Enter grid size' translated initialAnswer: '16').	smallGrid ifNil: [^ self].	Utilities informUser: 'Choose a background color' translated during: [backColor _ Color fromUser].	Utilities informUser: 'Choose a line color' translated during: [lineColor _ Color fromUser].	self makeGraphPaperGrid: smallGrid background: backColor line: lineColor.! !!Morph methodsFor: 'e-toy support' stamp: 'dgd 10/8/2003 19:30'!unlockOneSubpart	| unlockables aMenu reply |	unlockables _ self submorphs select:		[:m | m isLocked].	unlockables size <= 1 ifTrue: [^ self unlockContents].	aMenu _ SelectionMenu labelList: (unlockables collect: [:m | m externalName]) selections: unlockables.	reply _ aMenu startUpWithCaption: 'Who should be be unlocked?' translated.	reply isNil ifTrue: [^ self].	reply unlock! !!Morph methodsFor: 'fileIn/out' stamp: 'dgd 11/15/2003 19:31'!saveOnFile	"Ask the user for a filename and save myself on a SmartReferenceStream file.  Writes out the version and class structure.  The file is fileIn-able.  UniClasses will be filed out."	| aFileName fileStream ok |	aFileName _ ('my {1}' translated format: {self class name}) asFileName.	"do better?"	aFileName _ FillInTheBlank request: 'File name? (".morph" will be added to end)' translated 			initialAnswer: aFileName.	aFileName isEmpty ifTrue: [^ Beeper beep].	self allMorphsDo: [:m | m prepareToBeSaved].	ok _ aFileName endsWith: '.morph'.	"don't double them"	ok _ ok | (aFileName endsWith: '.sp').	ok ifFalse: [aFileName _ aFileName,'.morph'].	fileStream _ FileStream newFileNamed: aFileName.	fileStream fileOutClass: nil andObject: self.	"Puts UniClass definitions out anyway"! !!Morph methodsFor: 'layout-menu' stamp: 'dgd 8/30/2003 16:57'!addCellLayoutMenuItems: aMenu hand: aHand	"Cell (e.g., child) related items"	| menu sub |	menu _ MenuMorph new defaultTarget: self.		menu addUpdating: #hasDisableTableLayoutString action: #changeDisableTableLayout.		menu addLine.		sub _ MenuMorph new defaultTarget: self.		#(rigid shrinkWrap spaceFill) do:[:sym|			sub addUpdating: #hResizingString: target: self selector: #hResizing: argumentList: (Array with: sym)].		menu add:'horizontal resizing' translated subMenu: sub.		sub _ MenuMorph new defaultTarget: self.		#(rigid shrinkWrap spaceFill) do:[:sym|			sub addUpdating: #vResizingString: target: self selector: #vResizing: argumentList: (Array with: sym)].		menu add:'vertical resizing' translated subMenu: sub.	aMenu ifNotNil:[aMenu add: 'child layout' translated subMenu: menu].	^menu! !!Morph methodsFor: 'layout-menu' stamp: 'dgd 8/30/2003 16:51'!addLayoutMenuItems: topMenu hand: aHand	| aMenu |	aMenu _ MenuMorph new defaultTarget: self.	aMenu addUpdating: #hasNoLayoutString action: #changeNoLayout.	aMenu addUpdating: #hasProportionalLayoutString action: #changeProportionalLayout.	aMenu addUpdating: #hasTableLayoutString action: #changeTableLayout.	aMenu addLine.	aMenu add: 'change layout inset...' translated action: #changeLayoutInset:.	aMenu addLine.	self addCellLayoutMenuItems: aMenu hand: aHand.	self addTableLayoutMenuItems: aMenu hand: aHand.	topMenu ifNotNil:[topMenu add: 'layout' translated subMenu: aMenu].	^aMenu! !!Morph methodsFor: 'layout-menu' stamp: 'dgd 8/30/2003 20:07'!addTableLayoutMenuItems: aMenu hand: aHand	| menu sub |	menu _ MenuMorph new defaultTarget: self.	menu addUpdating: #hasReverseCellsString action: #changeReverseCells.	menu addUpdating: #hasClipLayoutCellsString action: #changeClipLayoutCells.	menu addUpdating: #hasRubberBandCellsString action: #changeRubberBandCells.	menu addLine.	menu add: 'change cell inset...' translated action: #changeCellInset:.	menu add: 'change min cell size...' translated action: #changeMinCellSize:.	menu add: 'change max cell size...' translated action: #changeMaxCellSize:.	menu addLine.	sub _ MenuMorph new defaultTarget: self.	#(leftToRight rightToLeft topToBottom bottomToTop) do:[:sym|		sub addUpdating: #listDirectionString: target: self selector: #changeListDirection: argumentList: (Array with: sym)].	menu add: 'list direction' translated subMenu: sub.	sub _ MenuMorph new defaultTarget: self.	#(none leftToRight rightToLeft topToBottom bottomToTop) do:[:sym|		sub addUpdating: #wrapDirectionString: target: self selector: #wrapDirection: argumentList: (Array with: sym)].	menu add: 'wrap direction' translated subMenu: sub.	sub _ MenuMorph new defaultTarget: self.	#(center topLeft topRight bottomLeft bottomRight topCenter leftCenter rightCenter bottomCenter) do:[:sym|		sub addUpdating: #cellPositioningString: target: self selector: #cellPositioning: argumentList: (Array with: sym)].	menu add: 'cell positioning' translated subMenu: sub.	sub _ MenuMorph new defaultTarget: self.	#(topLeft bottomRight center justified) do:[:sym|		sub addUpdating: #listCenteringString: target: self selector: #listCentering: argumentList: (Array with: sym)].	menu add: 'list centering' translated subMenu: sub.	sub _ MenuMorph new defaultTarget: self.	#(topLeft bottomRight center justified) do:[:sym|		sub addUpdating: #wrapCenteringString: target: self selector: #wrapCentering: argumentList: (Array with: sym)].	menu add: 'wrap centering' translated subMenu: sub.	sub _ MenuMorph new defaultTarget: self.	#(none equal) do:[:sym|		sub addUpdating: #listSpacingString: target: self selector: #listSpacing: argumentList: (Array with: sym)].	menu add: 'list spacing' translated subMenu: sub.	sub _ MenuMorph new defaultTarget: self.	#(none localRect localSquare globalRect globalSquare) do:[:sym|		sub addUpdating: #cellSpacingString: target: self selector: #cellSpacing: argumentList: (Array with: sym)].	menu add: 'cell spacing' translated subMenu: sub.	aMenu ifNotNil:[aMenu add: 'table layout' translated subMenu: menu].	^menu! !!Morph methodsFor: 'layout-menu' stamp: 'dgd 8/30/2003 20:09'!hasClipLayoutCellsString	^ (self clipLayoutCells		ifTrue: ['<on>']		ifFalse: ['<off>']), 'clip to cell size' translated! !!Morph methodsFor: 'layout-menu' stamp: 'dgd 8/30/2003 16:58'!hasDisableTableLayoutString	^ (self disableTableLayout		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'disable layout in tables' translated! !!Morph methodsFor: 'layout-menu' stamp: 'dgd 10/8/2003 19:23'!hasNoLayoutString	^ (self layoutPolicy isNil		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'no layout' translated! !!Morph methodsFor: 'layout-menu' stamp: 'dgd 8/30/2003 16:55'!hasProportionalLayoutString	| layout |	^ (((layout := self layoutPolicy) notNil			and: [layout isProportionalLayout])		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'proportional layout' translated! !!Morph methodsFor: 'layout-menu' stamp: 'dgd 8/30/2003 20:08'!hasReverseCellsString	^ (self reverseTableCells		ifTrue: ['<on>']		ifFalse: ['<off>']), 'reverse table cells' translated! !!Morph methodsFor: 'layout-menu' stamp: 'dgd 8/30/2003 20:09'!hasRubberBandCellsString	^ (self rubberBandCells		ifTrue: ['<on>']		ifFalse: ['<off>']), 'rubber band cells' translated! !!Morph methodsFor: 'layout-menu' stamp: 'dgd 8/30/2003 16:59'!hasTableLayoutString	| layout |	^ (((layout := self layoutPolicy) notNil			and: [layout isTableLayout])		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'table layout' translated! !!Morph methodsFor: 'menus' stamp: 'dgd 10/8/2003 19:16'!adMiscExtrasTo: aMenu	"Add a submenu of miscellaneous extra items to the menu."	| realOwner realMorph subMenu |	subMenu _ MenuMorph new defaultTarget: self.	(self isWorldMorph not and: [self renderedMorph isSystemWindow not])		ifTrue: [subMenu add: 'put in a window' translated action: #embedInWindow].	self isWorldMorph ifFalse:		[subMenu add: 'adhere to edge...' translated action: #adhereToEdge.		subMenu addLine].	realOwner _ (realMorph _ self topRendererOrSelf) owner.	(realOwner isKindOf: TextPlusPasteUpMorph) ifTrue:		[subMenu add: 'GeeMail stuff...' translated subMenu: (realOwner textPlusMenuFor: realMorph)].	self affiliatedSelector ifNotNil:		[subMenu add: 'open a messenger' translated action: #openMessenger.		subMenu balloonTextForLastItem: 'Open a Messenger on the actual method call used when the button action of this object is triggered.' translated.		subMenu addLine].	subMenu		add: 'add mouse up action' translated action: #addMouseUpAction;		add: 'remove mouse up action' translated action: #removeMouseUpAction;		add: 'hand me tiles to fire this button' translated action: #handMeTilesToFire.	subMenu addLine.	subMenu add: 'arrowheads on pen trails...' translated action: #setArrowheads.	subMenu addLine.	subMenu defaultTarget: self topRendererOrSelf.	subMenu add: 'draw new path' translated action: #definePath.	subMenu add: 'follow existing path' translated action: #followPath.	subMenu add: 'delete existing path' translated action: #deletePath.	subMenu addLine.	self addGenieMenuItems: subMenu hand: ActiveHand.	aMenu add: 'extras...' translated subMenu: subMenu! !!Morph methodsFor: 'menus' stamp: 'dgd 11/15/2003 19:25'!addCopyItemsTo: aMenu	"Add copy-like items to the halo menu"	| subMenu |	subMenu _ MenuMorph new defaultTarget: self.	subMenu add: 'copy to paste buffer' translated action: #copyToPasteBuffer:.	subMenu add: 'copy text' translated action: #clipText.	subMenu add: 'copy Postscript' translated action: #clipPostscript.	subMenu add: 'print Postscript to file...' translated target: self selector: #printPSToFile.	aMenu add: 'copy & print...' translated subMenu: subMenu! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:32'!addExportMenuItems: aMenu hand: aHandMorph	"Add export items to the menu"	aMenu ifNotNil:		[ | aSubMenu |		aSubMenu _ MenuMorph new defaultTarget: self.		aSubMenu add: 'BMP file' translated action: #exportAsBMP.		aSubMenu add: 'GIF file' translated action: #exportAsGIF.		aSubMenu add: 'JPEG file' translated action: #exportAsJPEG.		aMenu add: 'export...' translated subMenu: aSubMenu]! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 16:44'!addFillStyleMenuItems: aMenu hand: aHand	"Add the items for changing the current fill style of the Morph"	| menu |	self canHaveFillStyles ifFalse:[^aMenu add: 'change color...' translated target: self action: #changeColor].	menu _ MenuMorph new defaultTarget: self.	self fillStyle addFillStyleMenuItems: menu hand: aHand from: self.	menu addLine.	menu add: 'solid fill' translated action: #useSolidFill.	menu add: 'gradient fill' translated action: #useGradientFill.	menu add: 'bitmap fill' translated action: #useBitmapFill.	menu add: 'default fill' translated action: #useDefaultFill.	aMenu add: 'fill style' translated subMenu: menu.	"aMenu add: 'change color...' translated action: #changeColor"! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:14'!addHaloActionsTo: aMenu	"Add items to aMenu representing actions requestable via halo"	| subMenu |	subMenu _ MenuMorph new defaultTarget: self.	subMenu addTitle: self externalName.	subMenu addStayUpItemSpecial.	subMenu addLine.	subMenu add: 'delete' translated action: #dismissViaHalo.	subMenu balloonTextForLastItem: 'Delete this object -- warning -- can be destructive!!' translated.	self maybeAddCollapseItemTo: subMenu.	subMenu add: 'grab' translated action: #openInHand.	subMenu balloonTextForLastItem: 'Pick this object up -- warning, since this removes it from its container, it can have adverse effects.' translated.	subMenu addLine.	subMenu add: 'resize' translated action: #resizeFromMenu.	subMenu balloonTextForLastItem: 'Change the size of this object' translated.	subMenu add: 'duplicate' translated action: #maybeDuplicateMorph.	subMenu balloonTextForLastItem: 'Hand me a copy of this object' translated.	subMenu addLine.	subMenu add: 'property sheet' translated target: self renderedMorph action: #openAPropertySheet.	subMenu balloonTextForLastItem: 'Open a property sheet for me. Allows changing lots of stuff at once.' translated.	subMenu add: 'set color' translated target: self renderedMorph action: #changeColor.	subMenu balloonTextForLastItem: 'Change the color of this object' translated.	subMenu add: 'viewer' translated target: self action: #beViewed.	subMenu balloonTextForLastItem: 'Open a Viewer that will allow everything about this object to be seen and controlled.' translated.	subMenu add: 'tile browser' translated target: self action: #openInstanceBrowserWithTiles.	subMenu balloonTextForLastItem: 'Open a tool that will facilitate tile scripting of this object.' translated.	subMenu add: 'hand me a tile' translated target: self action: #tearOffTile.	subMenu balloonTextForLastItem: 'Hand me a tile represting this object' translated.	subMenu addLine.	subMenu add: 'inspect' translated target: self action: #inspect.	subMenu balloonTextForLastItem: 'Open an Inspector on this object' translated.	aMenu add: 'halo actions...' translated subMenu: subMenu! !!Morph methodsFor: 'menus' stamp: 'dgd 9/5/2003 19:26'!addPaintingItemsTo: aMenu hand: aHandMorph	| subMenu movies |	subMenu _ MenuMorph new defaultTarget: self.	subMenu add: 'repaint' translated action: #editDrawing.	subMenu add: 'set rotation center' translated action: #setRotationCenter.	subMenu add: 'reset forward-direction' translated action: #resetForwardDirection.	subMenu add: 'set rotation style' translated action: #setRotationStyle.	subMenu add: 'erase pixels of color' translated action: #erasePixelsOfColor:.	subMenu add: 'recolor pixels of color' translated action: #recolorPixelsOfColor:.	subMenu add: 'reduce color palette' translated action: #reduceColorPalette:.	subMenu add: 'add a border around this shape...' translated action: #addBorderToShape:.	movies _		(self world rootMorphsAt: aHandMorph targetOffset)			select: [:m | (m isKindOf: MovieMorph) or:						[m isKindOf: SketchMorph]].	(movies size > 1) ifTrue:		[subMenu add: 'insert into movie' translated action: #insertIntoMovie:].	aMenu add: 'painting...' translated subMenu: subMenu! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:30'!addPlayerItemsTo: aMenu	"Add player-related items to the menu if appropriate"	| aPlayer subMenu |	aPlayer _ self topRendererOrSelf player.	subMenu _ MenuMorph new defaultTarget: self.	subMenu add: 'make a sibling instance' translated target: self action: #makeNewPlayerInstance:.	subMenu balloonTextForLastItem: 'Makes another morph whose player is of the same class as this one.  Both siblings will share the same scripts' translated.	subMenu add: 'make multiple siblings...' translated target: self action: #makeMultipleSiblings:.	subMenu balloonTextForLastItem: 'Make any number of sibling instances all at once' translated.	(aPlayer belongsToUniClass and: [aPlayer class instanceCount > 1]) ifTrue:		[subMenu addLine.		subMenu add: 'make all siblings look like me' translated target: self action: #makeSiblingsLookLikeMe:.		subMenu balloonTextForLastItem: 'make all my sibling instances look like me.' translated.		subMenu add: 'bring all siblings to my location' translated target: self action: #bringAllSiblingsToMe:.		subMenu balloonTextForLastItem: 'find all sibling instances and bring them to me' translated.		subMenu add: 'apply status to all siblngs' translated target: self action: #applyStatusToAllSiblings:.		subMenu balloonTextForLastItem: 'apply the current status of all of my scripts to the scripts of all my siblings' translated].		aMenu add: 'siblings...' translated subMenu: subMenu! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:34'!addStackItemsTo: aMenu	"Add stack-related items to the menu"	| stackSubMenu |	stackSubMenu _ MenuMorph new defaultTarget: self.	(owner notNil and: [owner isStackBackground]) ifTrue:		[self isShared			ifFalse:				[self couldHoldSeparateDataForEachInstance					ifTrue:						[stackSubMenu add: 'Background field, shared value' translated target: self action: #putOnBackground.						stackSubMenu add: 'Background field, individual values' translated target: self action: #becomeSharedBackgroundField]					ifFalse:						[stackSubMenu add: 'put onto Background' translated target: self action: #putOnBackground]]			ifTrue:				[stackSubMenu add: 'remove from Background' translated target: self action: #putOnForeground.				self couldHoldSeparateDataForEachInstance ifTrue:					[self holdsSeparateDataForEachInstance						ifFalse:							[stackSubMenu add: 'start holding separate data for each instance' translated target: self action: #makeHoldSeparateDataForEachInstance]						ifTrue:							[stackSubMenu add: 'stop holding separate data for each instance' translated target: self action: #stopHoldingSeparateDataForEachInstance].							stackSubMenu add: 'be default value on new card' translated target: self action: #setAsDefaultValueForNewCard.							(self hasProperty: #thumbnailImage)								ifTrue:									[stackSubMenu add: 'stop using for reference thumbnail' translated target: self action: #stopUsingForReferenceThumbnail]								ifFalse:									[stackSubMenu add: 'start using for reference thumbnail' translated target: self action: #startUsingForReferenceThumbnail]]].				stackSubMenu addLine].	(self isStackBackground) ifFalse:		[stackSubMenu add: 'be a card in an existing stack...' translated action: #insertAsStackBackground].	stackSubMenu add: 'make an instance for my data' translated action: #abstractAModel.	(self isStackBackground) ifFalse:		[stackSubMenu add: 'become a stack of cards' translated action: #wrapWithAStack].	aMenu add: 'stacks and cards...' translated subMenu: stackSubMenu! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 16:39'!addStandardHaloMenuItemsTo: aMenu hand: aHandMorph	"Add standard halo items to the menu"	| unlockables |	self isWorldMorph ifTrue:		[^ self addWorldHaloMenuItemsTo: aMenu hand: aHandMorph].	self mustBeBackmost ifFalse:		[aMenu add: 'send to back' translated action: #goBehind.		aMenu add: 'bring to front' translated action: #comeToFront.		self addEmbeddingMenuItemsTo: aMenu hand: aHandMorph.		aMenu addLine].	self addFillStyleMenuItems: aMenu hand: aHandMorph.	self addBorderStyleMenuItems: aMenu hand: aHandMorph.	self addDropShadowMenuItems: aMenu hand: aHandMorph.	self addLayoutMenuItems: aMenu hand: aHandMorph.	self addHaloActionsTo: aMenu.	owner isTextMorph ifTrue:[self addTextAnchorMenuItems: aMenu hand: aHandMorph].	aMenu addLine.	self addToggleItemsToHaloMenu: aMenu.	aMenu addLine.	self addCopyItemsTo: aMenu.	self addPlayerItemsTo: aMenu.	self addExportMenuItems: aMenu hand: aHandMorph.	self addStackItemsTo: aMenu.	self adMiscExtrasTo: aMenu.	Preferences noviceMode ifFalse:		[self addDebuggingItemsTo: aMenu hand: aHandMorph].	aMenu addLine.	aMenu defaultTarget: self.	aMenu addLine.	unlockables _ self submorphs select:		[:m | m isLocked].	unlockables size == 1 ifTrue:		[aMenu			add: ('unlock "{1}"' translated format: unlockables first externalName)			action: #unlockContents].	unlockables size > 1 ifTrue:		[aMenu add: 'unlock all contents' translated action: #unlockContents.		aMenu add: 'unlock...' translated action: #unlockOneSubpart].	aMenu defaultTarget: aHandMorph.! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:22'!addToggleItemsToHaloMenu: aMenu	"Add standard true/false-checkbox items to the memu"	#(	(resistsRemovalString toggleResistsRemoval 'whether I should be reistant to easy deletion via the pink X handle')	(stickinessString toggleStickiness 'whether I should be resistant to a drag done by mousing down on me')	(lockedString lockUnlockMorph 'when "locked", I am inert to all user interactions')	(hasClipSubmorphsString changeClipSubmorphs 'whether the parts of objects within me that are outside my bounds should be masked.')	(hasDirectionHandlesString changeDirectionHandles 'whether direction handles are shown with the halo')	(hasDragAndDropEnabledString changeDragAndDrop 'whether I am open to having objects dropped into me')	) do:		[:trip | aMenu addUpdating: trip first action: trip second.			aMenu balloonTextForLastItem: trip third translated].	self couldHaveRoundedCorners ifTrue:		[aMenu addUpdating: #roundedCornersString action: #toggleCornerRounding.		aMenu balloonTextForLastItem: 'whether my corners should be rounded']! !!Morph methodsFor: 'menus' stamp: 'dgd 10/8/2003 18:29'!dismissButton	"Answer a button whose action would be to dismiss the receiver, and whose action is to send #delete to the receiver"	| aButton |	aButton _ SimpleButtonMorph new.	aButton		target: self topRendererOrSelf;		color:  Color tan;		label: 'X' font: Preferences standardButtonFont;		actionSelector: #delete;		setBalloonText: 'dismiss' translated.	^ aButton! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:23'!hasDirectionHandlesString	^ (self wantsDirectionHandles		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'direction handles' translated! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:24'!hasDragAndDropEnabledString	"Answer a string to characterize the drag & drop status of the  	receiver"	^ (self dragNDropEnabled		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'accept drops' translated! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 16:19'!helpButton	"Answer a button whose action would be to put up help concerning the receiver"	| aButton |	aButton _ SimpleButtonMorph new.	aButton		target: self;		color:  Color magenta lighter lighter lighter;		label: '?' translated font: Preferences standardButtonFont;		actionSelector: #presentHelp;		setBalloonText: 'click here for help' translated.	^ aButton! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:20'!lockedString	"Answer the string to be shown in a menu to represent the 	'locked' status"	^ (self isLocked		ifTrue: ['<on>']		ifFalse: ['<off>']), 'be locked' translated! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:15'!maybeAddCollapseItemTo: aMenu	"If appropriate, add a collapse item to the given menu"	| anOwner |	(anOwner _ self topRendererOrSelf owner) ifNotNil:			[anOwner isWorldMorph ifTrue:				[aMenu add: 'collapse' translated target: self action: #collapse]]! !!Morph methodsFor: 'menus' stamp: 'dgd 11/15/2003 19:31'!printPSToFileNamed: aString	"Ask the user for a filename and print this morph as postscript."	| fileName rotateFlag |	fileName _ aString asFileName.	fileName _ FillInTheBlank 		request: 'File name? (".eps" will be added to end)' translated		initialAnswer: fileName.	fileName isEmpty ifTrue: [^ Beeper beep].	(fileName endsWith: '.eps') ifFalse: [fileName _ fileName,'.eps'].	rotateFlag _ ((PopUpMenu labels:'portrait (tall)landscape (wide)') translated			startUpWithCaption: 'Choose orientation...' translated) = 2.	(FileStream newFileNamed: fileName)		nextPutAll: (			PostscriptCanvas defaultCanvasType morphAsPostscript: self rotated: rotateFlag		); close.! !!Morph methodsFor: 'menus' stamp: 'dgd 9/5/2003 18:25'!putOnForeground	"Place the receiver, formerly on the background, onto the foreground.  If the receiver needs data carried on its behalf by the card, those data will be lost, so in this case get user confirmation before proceeding."	self holdsSeparateDataForEachInstance "later add the refinement of not putting up the following confirmer if only a single instance of the current background's uniclass exists"		ifTrue:			[self confirm: 'Caution -- every card of this backgroundformerly had its own value for thisitem.  If you put it on the foreground,the values  of this item on all othercards will be lost' translated				orCancel: [^ self]].	self removeProperty: #shared.	self stack reassessBackgroundShape.	"still work to be done here!!"! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:18'!resistsRemovalString	"Answer the string to be shown in a menu to represent the 	'resistsRemoval' status"	^ (self resistsRemoval		ifTrue: ['<on>']		ifFalse: ['<off>']), 'resist being deleted' translated! !!Morph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:19'!stickinessString	"Answer the string to be shown in a menu to represent the  	stickiness status"	^ (self isSticky		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'resist being picked up' translated! !!Morph methodsFor: 'meta-actions' stamp: 'dgd 8/30/2003 16:42'!addEmbeddingMenuItemsTo: aMenu hand: aHandMorph	| menu |	menu _ MenuMorph new defaultTarget: self.	self potentialEmbeddingTargets reverseDo: [:m | 		menu add: (m knownName ifNil:[m class name asString]) target: m selector: #addMorphFrontFromWorldPosition: argumentList: {self}].	aMenu ifNotNil:[		menu submorphCount > 0 			ifTrue:[aMenu add:'embed into' translated subMenu: menu].	].	^menu! !!Morph methodsFor: 'meta-actions' stamp: 'dgd 11/15/2003 19:29'!buildMetaMenu: evt	"Build the morph menu. This menu has two sections. The first section contains commands that are handled by the hand; the second contains commands handled by the argument morph."	| menu |	menu _ MenuMorph new defaultTarget: self.	menu addStayUpItem.	menu add: 'grab' translated action: #grabMorph:.	menu add: 'copy to paste buffer' translated action: #copyToPasteBuffer:.	self maybeAddCollapseItemTo: menu.	menu add: 'delete' translated action: #dismissMorph:.	menu addLine.	menu add: 'copy text' translated action: #clipText.	menu add: 'copy Postscript' translated action: #clipPostscript.	menu add: 'print Postscript to file...' translated action: #printPSToFile.	menu addLine.	menu add: 'go behind' translated action: #goBehind.	menu add: 'add halo' translated action: #addHalo:.	menu add: 'duplicate' translated action: #maybeDuplicateMorph:.	self addEmbeddingMenuItemsTo: menu hand: evt hand.	menu add: 'resize' translated action: #resizeMorph:.	"Give the argument control over what should be done about fill styles"	self addFillStyleMenuItems: menu hand: evt hand.	self addDropShadowMenuItems: menu hand: evt hand.	self addLayoutMenuItems: menu hand: evt hand.	menu addUpdating: #hasClipSubmorphsString target: self selector: #changeClipSubmorphs argumentList: #().	menu addLine.	(self morphsAt: evt position) size > 1 ifTrue:		[menu add: 'submorphs...' translated			target: self			selector: #invokeMetaMenuAt:event:			argument: evt position].	menu addLine.	menu add: 'inspect' translated selector: #inspectAt:event: argument: evt position.	menu add: 'explore' translated action: #explore.	menu add: 'browse hierarchy' translated action: #browseHierarchy.	menu add: 'make own subclass' translated action: #subclassMorph.	menu addLine.	menu add: 'set variable name...' translated action: #choosePartName.	(self isMorphicModel) ifTrue:		[menu add: 'save morph as prototype' translated action: #saveAsPrototype.		(self ~~ self world modelOrNil) ifTrue:			 [menu add: 'become this world''s model' translated action: #beThisWorldsModel]].	menu add: 'save morph in file' translated action: #saveOnFile.	(self hasProperty: #resourceFilePath)		ifTrue: [((self valueOfProperty: #resourceFilePath) endsWith: '.morph')				ifTrue: [menu add: 'save as resource' translated action: #saveAsResource].				menu add: 'update from resource' translated action: #updateFromResource]		ifFalse: [menu add: 'attach to resource' translated action: #attachToResource].	menu add: 'show actions' translated action: #showActions.	menu addLine.	self addDebuggingItemsTo: menu hand: evt hand.	self addCustomMenuItems: menu hand: evt hand.	^ menu! !!Morph methodsFor: 'meta-actions' stamp: 'sd 11/13/2003 21:28'!makeMultipleSiblings: evt	"Make multiple siblings, first prompting the user for how many"	| result |	result _ FillInTheBlank request: 'how many siblings do you want?' translated initialAnswer: '2'.	result isEmptyOrNil ifTrue: [^ self].	result first isDigit ifFalse: [^ Beeper beep].	self topRendererOrSelf makeSiblings: result asInteger.! !!Morph methodsFor: 'naming' stamp: 'dgd 8/30/2003 15:52'!innocuousName	"Choose an innocuous name for the receiver -- one that does not end in the word Morph"	| className allKnownNames |	className _ self defaultNameStemForInstances.	(className size > 5 and: [className endsWith: 'Morph'])		ifTrue: [className _ className copyFrom: 1 to: className size - 5].	className _ className asString translated.	allKnownNames _ self world ifNil: [OrderedCollection new] ifNotNil: [self world allKnownNames].	^ Utilities keyLike: className asString satisfying:		[:aName | (allKnownNames includes: aName) not]! !!Morph methodsFor: 'rounding' stamp: 'dgd 9/6/2003 18:27'!roundedCornersString	"Answer the string to put in a menu that will invite the user to 	switch to the opposite corner-rounding mode"	^ (self wantsRoundedCorners		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'round corners' translated! !!Morph methodsFor: 'text-anchor' stamp: 'dgd 9/6/2003 18:14'!hasDocumentAnchorString	^ (self textAnchorType == #document		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'Document' translated! !!Morph methodsFor: 'text-anchor' stamp: 'dgd 9/6/2003 18:14'!hasInlineAnchorString	^ (self textAnchorType == #inline		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'Inline' translated! !!Morph methodsFor: 'text-anchor' stamp: 'dgd 9/6/2003 18:14'!hasParagraphAnchorString	^ (self textAnchorType == #paragraph		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'Paragraph' translated! !!BackgroundMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:56'!addCustomMenuItems: aCustomMenu hand: aHandMorph 	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	running		ifTrue: [aCustomMenu add: 'stop' translated action: #stopRunning]		ifFalse: [aCustomMenu add: 'start' translated action: #startRunning]! !!BorderedMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 16:47'!addBorderStyleMenuItems: aMenu hand: aHandMorph	"Add border-style menu items"	| subMenu |	subMenu _ MenuMorph new defaultTarget: self.	subMenu addTitle: 'border' translated.	subMenu addStayUpItemSpecial.	subMenu addList: 		{{'border color...' translated. #changeBorderColor:}.		{'border width...' translated. #changeBorderWidth:}}.	subMenu addLine.	BorderStyle borderStyleChoices do:		[:sym | (self borderStyleForSymbol: sym)			ifNotNil:				[subMenu add: sym target: self selector: #setBorderStyle: argument: sym]].	aMenu add: 'border style...' translated subMenu: subMenu! !!BorderedMorph methodsFor: 'menu' stamp: 'dgd 8/26/2003 21:44'!changeBorderWidth: evt	| handle origin aHand newWidth oldWidth |	aHand _ evt ifNil: [self primaryHand] ifNotNil: [evt hand].	origin _ aHand position.	oldWidth _ borderWidth.	handle _ HandleMorph new		forEachPointDo:			[:newPoint | handle removeAllMorphs.			handle addMorph:				(LineMorph from: origin to: newPoint color: Color black width: 1).			newWidth _ (newPoint - origin) r asInteger // 5.			self borderWidth: newWidth]		lastPointDo:			[:newPoint | handle deleteBalloon.			self halo doIfNotNil: [:halo | halo addHandles].			self rememberCommand:				(Command new cmdWording: 'border change' translated;					undoTarget: self selector: #borderWidth: argument: oldWidth;					redoTarget: self selector: #borderWidth: argument: newWidth)].	aHand attachMorph: handle.	handle setProperty: #helpAtCenter toValue: true.	handle showBalloon:'Move cursor farther fromthis point to increase border width.Click when done.' hand: evt hand.	handle startStepping! !!AlignmentMorph class methodsFor: 'instance creation' stamp: 'dgd 9/20/2003 19:05'!columnPrototype	"Answer a prototypical column"	| sampleMorphs aColumn |	sampleMorphs _ #(red yellow green) collect:		[:aColor | Morph new extent: 130 @ 38; color: (Color perform: aColor); setNameTo: aColor asString; yourself].	aColumn _ self inAColumn: sampleMorphs.	aColumn setNameTo: 'Column'.	aColumn color: Color veryVeryLightGray.	aColumn cellInset: 4; layoutInset: 6.	aColumn enableDragNDrop.	aColumn setBalloonText: 'Things dropped into here will automatically be organized into a column. Once you have added your own items here, you will want to remove the sample colored rectangles that this started with, and you will want to change this balloon help message to one of your own!!' translated.	^ aColumn! !!AlignmentMorph class methodsFor: 'instance creation' stamp: 'dgd 9/20/2003 19:05'!rowPrototype	"Answer a prototypical row"	| sampleMorphs aRow |	sampleMorphs _ (1 to: (2 + 3 atRandom)) collect:		[:integer | EllipseMorph new extent: ((60 + (20 atRandom)) @ (80 + ((20 atRandom)))); color: Color random; setNameTo: ('egg',  integer asString); yourself].	aRow _ self inARow: sampleMorphs.	aRow setNameTo: 'Row'.	aRow enableDragNDrop.	aRow cellInset: 6.	aRow layoutInset: 8.	aRow setBalloonText: 'Things dropped into here will automatically be organized into a row. Once you have added your own items here, you will want to remove the sample colored eggs that this started with, and you will want to change this balloon help message to one of your own!!' translated.	aRow color: Color veryVeryLightGray.	^ aRow			"AlignmentMorph rowPrototype openInHand"! !!AllScriptsTool methodsFor: 'initialization' stamp: 'dgd 9/19/2003 14:34'!addSecondLineOfControls	"Add the second line of controls"	| aRow outerButton aButton worldToUse |	aRow _ AlignmentMorph newRow listCentering: #center; color: Color transparent.	outerButton _ AlignmentMorph newRow.	outerButton wrapCentering: #center; cellPositioning: #leftCenter.	outerButton color:  Color transparent.	outerButton hResizing: #shrinkWrap; vResizing: #shrinkWrap.	outerButton addMorph: (aButton _ UpdatingThreePhaseButtonMorph checkBox).	aButton		target: self;		actionSelector: #toggleWhetherShowingOnlyActiveScripts;		getSelector: #showingOnlyActiveScripts.	outerButton addTransparentSpacerOfSize: (4@0).	outerButton addMorphBack: (StringMorph contents: 'tickers only' translated) lock.	outerButton setBalloonText: 'If checked, then only scripts that are paused or ticking will be shown' translated.	aRow addMorphBack: outerButton.	aRow addTransparentSpacerOfSize: 20@0.	aRow addMorphBack: self helpButton.	aRow addTransparentSpacerOfSize: 20@0.	outerButton _ AlignmentMorph newRow.	outerButton wrapCentering: #center; cellPositioning: #leftCenter.	outerButton color:  Color transparent.	outerButton hResizing: #shrinkWrap; vResizing: #shrinkWrap.	outerButton addMorph: (aButton _ UpdatingThreePhaseButtonMorph checkBox).	aButton		target: self;		actionSelector: #toggleWhetherShowingAllInstances;		getSelector: #showingAllInstances.	outerButton addTransparentSpacerOfSize: (4@0).	outerButton addMorphBack: (StringMorph contents: 'all instances' translated) lock.	outerButton setBalloonText: 'If checked, then entries for all instances will be shown, but if not checked, scripts for only one representative of each different kind of object will be shown.  Consult the help available by clicking on the purple ? for more information.' translated.	aRow addMorphBack: outerButton.	self addMorphBack: aRow.	worldToUse _ self isInWorld ifTrue: [self world] ifFalse: [ActiveWorld].	worldToUse presenter reinvigorateAllScriptsTool: self.	self layoutChanged.! !!AllScriptsTool methodsFor: 'initialization' stamp: 'dgd 8/31/2003 19:43'!dismissButton	"Answer a button whose action would be to dismiss the 	receiver "	| aButton |	aButton := super dismissButton.	aButton setBalloonText: 'Click here to remove this tool from the screen; you can get another one any time you want from the Widgets flap' translated.	^ aButton! !!AllScriptsTool methodsFor: 'initialization' stamp: 'dgd 9/19/2003 14:35'!presentHelp	"Sent when a Help button is hit; provide the user with some form of help for the tool at hand"	| aString |	aString _ 'This tool allows you to see all the scripts for all the objects in this project.Sometimes you are only interested in those scripts that are ticking, or that are *ready* to tick when you hit the GO button (which are said to be "paused.")Check "tickers only" if you only want to see such scripts -- i.e., scripts that are either paused or ticking.If "tickers only" is *not* checked, then all scripts will be shown, whatever their status.The other checkbox, labeled "all instances", only comes into play if you have created "multiple sibling instances" (good grief) of the same object, which share the same scripts; if you have such things, it is often convenient to see the scripts of just *one* such sibling, because it will take up less space and require less mindshare -- and note that you can control a script for an object *and* all its siblings from the menu of that one that you see, via menu items such as "propagate status to siblings".If "all instances" is checked, scripts for all sibling instances will be shown, whereas if "all instances" is *not* checked, only one of each group of siblings will be selected to have its scripts shown.But how do you get "multiple sibling instances" of the same object?  There are several ways:(1)  Use the "make a sibling instance" or the "make multiple siblings..." menu item in the halo menu of a scripted object(2)  Use the "copy" tile in a script.(3)  Request "give me a copy now" from the menu associated with the "copy" item in a ViewerIf you have on your screen multiple sibling instances of the same object, then you may or may want to see them all in the All Scripts tool, and that is what the "all instances" checkbox governs.Set "all instances" if you want a separate entry for each instance, asopposed to a single representative of that kind of object.Note that if you obtain a copy of an object by using the green halo handle, it will *not* be a sibling instance of the original.  It will in many ways seem to be, because it will start out its life having the same scripts as the original.  But it will then lead an independent life, so that changes to scripts of the original will not be reflected in it, and vice-versa.This is an important distinction, and an unavoidable one because people sometimes want the deep sharing of sibling instances and sometimes they clearly do not.  But the truly understandable description of these concepts and distinctions certainly lies *ahead* of us!!'.	(StringHolder new contents: aString translated)		openLabel: 'About the All Scripts tool' translated! !!AllScriptsTool methodsFor: 'toggles' stamp: 'dgd 9/19/2003 14:37'!openUpButton	"Answer a button whose action would be to open up the receiver or snap it back closed"	| aButton |	aButton _ SimpleButtonMorph new.	aButton		target: self topRendererOrSelf;		color: (Color r: 0.452 g: 0.839 b: 0.935);		label: '' font: Preferences standardButtonFont;		actionSelector: #toggleWhetherShowingOnlyTopControls;		setBalloonText: 'open or close the lower portion that shows individual scripts' translated.	^ aButton! !!BasicButton methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:56'!addCustomMenuItems: aCustomMenu hand: aHandMorph 	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'change label...' translated action: #setLabel! !!BooklikeMorph methodsFor: 'misc' stamp: 'dgd 8/30/2003 21:13'!addBookMenuItemsTo: aCustomMenu hand: aHandMorph	(self hasSubmorphWithProperty: #pageControl)		ifTrue: [aCustomMenu add: 'hide page controls' translated action: #hidePageControls]		ifFalse: [aCustomMenu add: 'show page controls' translated action: #showPageControls]! !!BooklikeMorph methodsFor: 'misc' stamp: 'dgd 9/19/2003 11:04'!showingFullScreenString	^ (self isInFullScreenMode		ifTrue: ['exit full screen']		ifFalse: ['show full screen']) translated! !!BooklikeMorph methodsFor: 'misc' stamp: 'dgd 9/19/2003 11:04'!showingPageControlsString	^ (self pageControlsVisible		ifTrue: ['hide page controls']		ifFalse: ['show page controls']) translated! !!BooklikeMorph methodsFor: 'page controls' stamp: 'dgd 9/19/2003 11:34'!fullControlSpecs	^ {		#spacer.		#variableSpacer.		{'-'.		#deletePage.				'Delete this page' translated}.		#spacer.		{''.		#firstPage.				'First page' translated}.		#spacer.		{'<'. 		#previousPage.			'Previous page' translated}.		#spacer.		{''.		#invokeBookMenu. 		'Click here to get a menu of options for this book.' translated}.		#spacer.		{'>'.		#nextPage.				'Next page' translated}.		#spacer.		{ ''.		#lastPage.				'Final page' translated}.		#spacer.		{'+'.		#insertPage.				'Add a new page after this one' translated}.		#variableSpacer.		{''.		#fewerPageControls.	'Fewer controls' translated}}! !!BooklikeMorph methodsFor: 'page controls' stamp: 'dgd 9/19/2003 11:35'!shortControlSpecs^ {		#spacer.		#variableSpacer.		{'<'. 		#previousPage.			'Previous page' translated}.		#spacer.		{''.		#invokeBookMenu. 		'Click here to get a menu of options for this book.' translated}.		#spacer.		{'>'.		#nextPage.				'Next page' translated}.		#spacer.		#variableSpacer.		{''.		#showMoreControls.		'More controls' translated}}! !!BookMorph methodsFor: 'insert and delete' stamp: 'dgd 9/21/2003 17:45'!deletePage	| message |	message _ 'Are you certain that youwant to delete this page andeverything that is on it? ' translated.	(self confirm: message) ifTrue: 			[self deletePageBasic].	! !!BookMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:13'!addBookMenuItemsTo: aMenu hand: aHandMorph	| controlsShowing subMenu |	subMenu _ MenuMorph new defaultTarget: self.	subMenu add: 'previous page' translated action: #previousPage.	subMenu add: 'next page' translated action: #nextPage.	subMenu add: 'goto page' translated action: #goToPage.	subMenu add: 'insert a page' translated action: #insertPage.	subMenu add: 'delete this page' translated action: #deletePage.	controlsShowing _ self hasSubmorphWithProperty: #pageControl.	controlsShowing		ifTrue:			[subMenu add: 'hide page controls' translated action: #hidePageControls.			subMenu add: 'fewer page controls' translated action: #fewerPageControls]		ifFalse:			[subMenu add: 'show page controls' translated action: #showPageControls].	self isInFullScreenMode ifTrue: [		subMenu add: 'exit full screen' translated action: #exitFullScreen.	] ifFalse: [		subMenu add: 'show full screen' translated action: #goFullScreen.	].	subMenu addLine.	subMenu add: 'sound effect for all pages' translated action: #menuPageSoundForAll:.	subMenu add: 'sound effect this page only' translated action: #menuPageSoundForThisPage:.	subMenu add: 'visual effect for all pages' translated action: #menuPageVisualForAll:.	subMenu add: 'visual effect this page only' translated action: #menuPageVisualForThisPage:.	subMenu addLine.	subMenu add: 'sort pages' translated action: #sortPages:.	subMenu add: 'uncache page sorter' translated action: #uncachePageSorter.	(self hasProperty: #dontWrapAtEnd)		ifTrue: [subMenu add: 'wrap after last page' translated selector: #setWrapPages: argument: true]		ifFalse: [subMenu add: 'stop at last page' translated selector: #setWrapPages: argument: false].	subMenu addLine.	subMenu add: 'search for text' translated action: #textSearch.	(aHandMorph pasteBuffer class isKindOf: PasteUpMorph class) ifTrue:		[subMenu add: 'paste book page' translated	action: #pasteBookPage].	subMenu add: 'send all pages to server' translated action: #savePagesOnURL.	subMenu add: 'send this page to server' translated action: #saveOneOnURL.	subMenu add: 'reload all from server' translated action: #reload.	subMenu add: 'copy page url to clipboard' translated action: #copyUrl.	subMenu add: 'keep in one file' translated action: #keepTogether.	subMenu add: 'save as new-page prototype' translated action: #setNewPagePrototype.	newPagePrototype ifNotNil:		[subMenu add: 'clear new-page prototype' translated action: #clearNewPagePrototype].	aMenu add: 'book...' translated subMenu: subMenu! !!BookMorph methodsFor: 'menu' stamp: 'dgd 9/19/2003 11:06'!invokeBookMenu	"Invoke the book's control panel menu."	| aMenu |	aMenu _ MenuMorph new defaultTarget: self.	aMenu addStayUpItem.	aMenu add: 'find...' translated action: #textSearch.	aMenu add: 'go to page...' translated action: #goToPage.	aMenu addLine.	aMenu addList: {		{'sort pages' translated.		#sortPages}.		{'uncache page sorter' translated.	#uncachePageSorter}}.	(self hasProperty: #dontWrapAtEnd)		ifTrue: [aMenu add: 'wrap after last page' translated selector: #setWrapPages: argument: true]		ifFalse: [aMenu add: 'stop at last page' translated selector: #setWrapPages: argument: false].	aMenu addList: {		{'make bookmark' translated.		#bookmarkForThisPage}.		{'make thumbnail' translated.		#thumbnailForThisPage}}.	aMenu addUpdating: #showingPageControlsString action: #toggleShowingOfPageControls.	aMenu addUpdating: #showingFullScreenString action: #toggleFullScreen.	aMenu addLine.	aMenu add: 'sound effect for all pages' translated action: #menuPageSoundForAll:.	aMenu add: 'sound effect this page only' translated action: #menuPageSoundForThisPage:.	aMenu add: 'visual effect for all pages' translated action: #menuPageVisualForAll:.	aMenu add: 'visual effect this page only' translated action: #menuPageVisualForThisPage:.	aMenu addLine.	(self primaryHand pasteBuffer class isKindOf: PasteUpMorph class) ifTrue:		[aMenu add: 'paste book page' translated   action: #pasteBookPage].	aMenu add: 'save as new-page prototype' translated action: #setNewPagePrototype.	newPagePrototype ifNotNil: [		aMenu add: 'clear new-page prototype' translated action: #clearNewPagePrototype].	aMenu add: (self dragNDropEnabled ifTrue: ['close dragNdrop'] ifFalse: ['open dragNdrop']) translated			action: #toggleDragNDrop.	aMenu add: 'make all pages this size' translated action: #makeUniformPageSize.	aMenu add: 'send all pages to server' translated action: #savePagesOnURL.	aMenu add: 'send this page to server' translated action: #saveOneOnURL.	aMenu add: 'reload all from server' translated action: #reload.	aMenu add: 'copy page url to clipboard' translated action: #copyUrl.	aMenu add: 'keep in one file' translated action: #keepTogether.	aMenu addLine.	aMenu add: 'load PPT images from slide #1' translated action: #loadImagesIntoBook.	aMenu add: 'background color for all pages...' translated action: #setPageColor.	aMenu add: 'make a thread of projects in this book' translated action: #buildThreadOfProjects.	aMenu popUpEvent: self world activeHand lastEvent in: self world! !!BookMorph methodsFor: 'printing' stamp: 'sd 11/13/2003 21:04'!printPSToFile	"Ask the user for a filename and print this morph as postscript."	| fileName rotateFlag |	fileName _ ('MyBook') translated asFileName.	fileName _ FillInTheBlank request: 'File name? (".ps" will be added to end)' translated 			initialAnswer: fileName.	fileName isEmpty ifTrue: [^ Beeper beep].	(fileName endsWith: '.ps') ifFalse: [fileName _ fileName,'.ps'].	rotateFlag _ ((PopUpMenu labels:'portrait (tall)landscape (wide)') translated			startUpWithCaption: 'Choose orientation...' translated) = 2.	(FileStream newFileNamed: fileName)		nextPutAll: (DSCPostscriptCanvas morphAsPostscript: self rotated: rotateFlag); close.! !!BouncingAtomsMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:15'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'startInfection' translated action: #startInfection.	aCustomMenu add: 'set atom count' translated action: #setAtomCount.	aCustomMenu add: 'show infection history' translated action: #showInfectionHistory:.! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:00'!mouseDownEvent: evt for: aSubmorph	| why aMenu |	why _ aSubmorph valueOfProperty: #intentOfDroppedMorphs.	why == #changeTargetMorph ifTrue: [		aMenu _ MenuMorph new			defaultTarget: self.		{			{'Rectangle'. RectangleMorph}.			{'Ellipse'. EllipseMorph}		} do: [ :pair |			aMenu					add: pair first translated				target: self 				selector: #attachMorphOfClass:to: 				argumentList: {pair second. evt hand}.		].		aMenu popUpEvent: evt in: self world.		^self	].! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:01'!paneForActsOnMouseDownToggle	^self inARow: {		self			directToggleButtonFor: self 			getter: #targetActsOnMouseDown			setter: #toggleTargetActsOnMouseDown			help: 'If the button is to act when the mouse goes down' translated.		self lockedString: ' Mouse-down action' translated.	}! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:01'!paneForActsOnMouseUpToggle	^self inARow: {		self			directToggleButtonFor: self 			getter: #targetActsOnMouseUp			setter: #toggleTargetActsOnMouseUp			help: 'If the button is to act when the mouse goes up' translated.		self lockedString: ' Mouse-up action' translated.	}! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:01'!paneForButtonSelectorReport	^self inARow: {		self lockedString: 'Action: ' translated. 		UpdatingStringMorph new			useStringFormat;			getSelector: #actionSelector;			target: self targetProperties;			growable: true;			minimumWidth: 24;			lock.	}! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:01'!paneForButtonTargetReport	| r |	r _ self inARow: {		self lockedString: 'Target: ' translated. 		UpdatingStringMorph new			useStringFormat;			getSelector: #target;			target: self targetProperties;			growable: true;			minimumWidth: 24;			lock.	}.	r hResizing: #shrinkWrap.	self allowDropsInto: r withIntent: #changeTargetTarget.	r setBalloonText: 'Drop another morph here to change the target and action of this button. (Only some morphs will work)' translated.	^self inARow: {r}! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:01'!paneForChangeMouseDownLook	| r |	r _ self inARow: {		self lockedString: ' Mouse-down look ' translated.	}.	self allowDropsInto: r withIntent: #changeTargetMouseDownLook.	r setBalloonText: 'Drop another morph here to change the visual appearance of this button when the mouse is clicked in it.' translated.	^r! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:01'!paneForChangeMouseEnterLook	| r |	r _ self inARow: {		self lockedString: ' Mouse-enter look ' translated.	}.	self allowDropsInto: r withIntent: #changeTargetMouseEnterLook.	r setBalloonText: 'Drop another morph here to change the visual appearance of this button when the mouse enters it.' translated.	^r! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:01'!paneForChangeVisibleMorph	| r |	r _ self inARow: {		self lockedString: ' Change morph ' translated.	}.	r on: #mouseDown send: #mouseDownEvent:for: to: self.	self allowDropsInto: r withIntent: #changeTargetMorph.	r setBalloonText: 'Drop another morph here to change the visual appearance of this button. Or click here to get a menu of possible replacement morphs.' translated.	^r! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:01'!paneForMouseDownColorPicker	^self 		inAColumn: {			(self inAColumn: {				self colorPickerFor: self targetProperties						 getter: #mouseDownHaloColor setter: #mouseDownHaloColor:.				self lockedString: 'mouse-down halo color' translated.				self paneForMouseDownHaloWidth.			}			named: #pickerForMouseDownColor) layoutInset: 0.		}! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:01'!paneForMouseDownHaloWidth	^(self inARow: {		self			buildFakeSlider: #valueForMouseDownHaloWidth 			selector: #adjustTargetMouseDownHaloSize:			help: 'Drag in here to change the halo width' translated	}) hResizing: #shrinkWrap! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:02'!paneForMouseOverColorPicker	^self 		inAColumn: {			(self inAColumn: {				self colorPickerFor: self targetProperties						 getter: #mouseOverHaloColor setter: #mouseOverHaloColor:.				self lockedString: 'mouse-over halo color' translated.				self paneForMouseOverHaloWidth.			}			named: #pickerForMouseOverColor) layoutInset: 0.		}! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:02'!paneForMouseOverHaloWidth	^(self inARow: {		self			buildFakeSlider: #valueForMouseOverHaloWidth			selector: #adjustTargetMouseOverHaloSize:			help: 'Drag in here to change the halo width' translated	}) hResizing: #shrinkWrap! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:02'!paneForRepeatingInterval	^(self 		inAColumn: {			self				buildFakeSlider: #valueForRepeatingInterval				selector: #adjustTargetRepeatingInterval:				help: 'Drag in here to change how often the button repeats while the mouse is down' translated		}		 named: #paneForRepeatingInterval	) hResizing: #shrinkWrap! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:02'!paneForWantsFiringWhileDownToggle	^self inARow: {		self			directToggleButtonFor: self 			getter: #targetRepeatingWhileDown			setter: #toggleTargetRepeatingWhileDown			help: 'Turn repeating while mouse is held down on or off' translated.		self lockedString: ' Mouse-down repeating ' translated.	}! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:02'!paneForWantsRolloverToggle	^self inARow: {		self			directToggleButtonFor: self 			getter: #targetWantsRollover			setter: #toggleTargetWantsRollover			help: 'Turn mouse-over highlighting on or off' translated.		self lockedString: ' Mouse-over highlighting' translated.	}! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:03'!rebuild	| buttonColor |	myTarget ensuredButtonProperties.	"self targetProperties unlockAnyText."	"makes styling the text easier"	self removeAllMorphs.	self addAColumn: {		self lockedString: ('Button Properties for {1}' translated format: {myTarget name}).	}.	self addAColumn: {		self paneForButtonTargetReport.	}.	self addAColumn: {		self paneForButtonSelectorReport.	}.	self addAColumn: {		(self inARow: {			self paneForActsOnMouseDownToggle.			self paneForActsOnMouseUpToggle.		})  hResizing: #shrinkWrap.	}.	self addAColumn: {		self inARow: {			(self paneForWantsFiringWhileDownToggle) hResizing: #shrinkWrap.			self paneForRepeatingInterval.		}.	}.	self addAColumn: {		(self inAColumn: {			self paneForWantsRolloverToggle.		}) hResizing: #shrinkWrap.	}.	self addARow: {		self paneForMouseOverColorPicker.		self paneForMouseDownColorPicker.	}.	self addARow: {		self paneForChangeMouseEnterLook.		self paneForChangeMouseDownLook.	}.	buttonColor _ color lighter.	self addARow: {		self inAColumn: {			self addARow: {				self 					buttonNamed: 'Add label' translated action: #addTextToTarget color: buttonColor					help: 'add some text to the button' translated.				self 					buttonNamed: 'Remove label' translated action: #removeTextFromTarget color: buttonColor					help: 'remove text from the button' translated.			}.			self addARow: {				self 					buttonNamed: 'Accept' translated action: #doAccept color: buttonColor					help: 'keep changes made and close panel' translated.				self 					buttonNamed: 'Cancel' translated action: #doCancel color: buttonColor					help: 'cancel changes made and close panel' translated.				self transparentSpacerOfSize: 10@3.				self 					buttonNamed: 'Main' translated action: #doMainProperties color: color lighter 					help: 'open a main properties panel for the morph' translated.				self 					buttonNamed: 'Remove' translated action: #doRemoveProperties color: color lighter 					help: 'remove the button properties of this morph' translated.			}.		}.		self inAColumn: {			self paneForChangeVisibleMorph		}.	}.! !!ButtonPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 22:04'!valueForRepeatingInterval	| n s |	n _ self targetProperties delayBetweenFirings.	s _ n ifNil: [		'*none*'	] ifNotNil: [		n < 1000 ifTrue: [n printString,' ms'] ifFalse: [(n // 1000) printString,' secs']	].	^'interval: ' translated, s! !!CategoryViewer methodsFor: 'categories' stamp: 'dgd 10/8/2003 18:50'!chooseCategory	"The mouse went down on my category-list control; pop up a list of category choices"	| aList aMenu reply aLinePosition lineList |	aList _ scriptedPlayer categoriesForViewer: self.	aLinePosition _ aList indexOf: #miscellaneous ifAbsent: [nil].	aList _ aList collect:			[:aCatSymbol | self currentVocabulary categoryWordingAt: aCatSymbol].	lineList _ aLinePosition ifNil: [#()] ifNotNil: [Array with: aLinePosition].	aList isEmpty ifTrue: [aList add: #'instance variables'].	aMenu _ CustomMenu labels: aList lines: lineList selections: aList.	reply _ aMenu startUpWithCaption: 'category' translated.	reply ifNil: [^ self].	self chooseCategoryWhoseTranslatedWordingIs: reply asSymbol! !!CategoryViewer methodsFor: 'entries' stamp: 'dgd 9/1/2003 13:50'!infoButtonFor: aScriptOrSlotSymbol	"Answer a fully-formed morph that will serve as the 'info button' alongside an entry corresponding to the given slot or script symbol.  If no such button is appropriate, answer a transparent graphic that fills the same space."	| aButton |	(self wantsRowMenuFor: aScriptOrSlotSymbol) ifFalse:		["Fill the space with sweet nothing, since there is no meaningful menu to offer".		aButton _ RectangleMorph new beTransparent extent: (17@20).		aButton borderWidth: 0.		^ aButton].	aButton _ IconicButton new labelGraphic: Cursor menu.	aButton target: scriptedPlayer;		actionSelector: #infoFor:inViewer:;		arguments: (Array with:aScriptOrSlotSymbol with: self);		color: Color transparent;		borderWidth: 0;		shedSelvedge;		actWhen: #buttonDown.	aButton setBalloonText: 'Press here to get a menu' translated.	^ aButton! !!CategoryViewer methodsFor: 'entries' stamp: 'dgd 9/1/2003 15:01'!phraseForCommandFrom: aMethodInterface	"Answer a phrase for the non-slot-like command represented by aMethodInterface - classic tiles"	| aRow resultType cmd names argType argTile selfTile aPhrase balloonTextSelector stat inst aDocString universal tileBearingHelp |	aDocString _ aMethodInterface documentationOrNil.	aDocString = 'no help available' ifTrue: [aDocString _ nil].	names _ scriptedPlayer class namedTileScriptSelectors.	resultType _ aMethodInterface resultType.	cmd _ aMethodInterface selector.	(universal _ scriptedPlayer isUniversalTiles)		ifTrue:			[aPhrase _ scriptedPlayer universalTilesForInterface: aMethodInterface]		ifFalse: [cmd numArgs == 0			ifTrue:				[aPhrase _ PhraseTileMorph new vocabulary: self currentVocabulary.				aPhrase setOperator: cmd					type: resultType					rcvrType: #Player]			ifFalse:				["only one arg supported in classic tiles, so if this is fed				with a selector with > 1 arg, results will be very strange"				argType _ aMethodInterface typeForArgumentNumber: 1.				aPhrase _ PhraseTileMorph new vocabulary: self currentVocabulary.				aPhrase setOperator: cmd					type: resultType					rcvrType: #Player					argType: argType.				argTile _ ScriptingSystem tileForArgType: argType.				argTile position: aPhrase lastSubmorph position.				aPhrase lastSubmorph addMorph: argTile]].	(scriptedPlayer slotInfo includesKey: cmd)		ifTrue: [balloonTextSelector _ #userSlot].	(scriptedPlayer belongsToUniClass and: [scriptedPlayer class includesSelector: cmd])		ifTrue:			[aDocString ifNil:				[aDocString _ (scriptedPlayer class userScriptForPlayer: scriptedPlayer selector: cmd) documentationOrNil].			aDocString ifNil:				[balloonTextSelector _ #userScript]].	tileBearingHelp _ universal ifTrue: [aPhrase submorphs second] ifFalse: [aPhrase operatorTile]. 	aDocString		ifNotNil:			[tileBearingHelp setBalloonText: aDocString]		ifNil:			[balloonTextSelector ifNil:				[tileBearingHelp setProperty: #inherentSelector toValue: cmd.				balloonTextSelector _ #methodComment].			tileBearingHelp balloonTextSelector: balloonTextSelector].	aPhrase markAsPartsDonor.	cmd == #emptyScript ifTrue:		[aPhrase setProperty: #newPermanentScript toValue: true.		aPhrase setProperty: #newPermanentPlayer toValue: scriptedPlayer.		aPhrase submorphs second setBalloonText: 'drag and drop to add a new script' translated].	universal ifFalse:		[selfTile _ self tileForSelf.		selfTile position: aPhrase firstSubmorph position.		aPhrase firstSubmorph addMorph: selfTile].	aRow _ ViewerLine newRow borderWidth: 0; color: self color.	aRow elementSymbol: cmd asSymbol.	aRow addMorphBack: (ScriptingSystem tryButtonFor: aPhrase).	aRow addMorphBack: (Morph new extent: 2@2; beTransparent).	aRow addMorphBack: (self infoButtonFor: cmd).	aRow addMorphBack: aPhrase.	(names includes: cmd) ifTrue:		[aPhrase userScriptSelector: cmd.		cmd numArgs == 0 ifTrue:			[aPhrase beTransparent.			aRow addMorphBack: AlignmentMorph newVariableTransparentSpacer.			aRow addMorphBack: (stat _ (inst _ scriptedPlayer scriptInstantiationForSelector: cmd) statusControlMorph).			inst updateStatusMorph: stat]].	aRow beSticky; disableDragNDrop.	^ aRow! !!CategoryViewer methodsFor: 'get/set slots' stamp: 'dgd 9/1/2003 13:51'!arrowSetterButton: sel args: argArray	| m |	m _ RectangleMorph new		color: (ScriptingSystem colorForType: #command);		extent: 24@TileMorph defaultH;		borderWidth: 0.	m addMorphCentered: (ImageMorph new image: (ScriptingSystem formAtKey: 'Gets')).	m setBalloonText: 'drag from here to obtain an assignment phrase.' translated.	m on: #mouseDown send: sel		to: self		withValue: argArray.	^ m! !!CategoryViewer methodsFor: 'get/set slots' stamp: 'dgd 9/1/2003 13:51'!arrowSetterButtonFor: partName type: partType	| m |	m _ RectangleMorph new		color: (ScriptingSystem colorForType: #command);		extent: 24@TileMorph defaultH;		borderWidth: 0.	m addMorphCentered: (ImageMorph new image: (ScriptingSystem formAtKey: 'Gets')).	m setBalloonText: 'drag from here to obtain an assignment phrase.' translated.	m on: #mouseDown send: #makeSetter:event:from:		to: self		withValue: (Array with: partName with: partType).	^ m! !!CategoryViewer methodsFor: 'header pane' stamp: 'dgd 9/1/2003 15:02'!addHeaderMorph	"Add the header at the top of the viewer, with a control for choosing the category, etc."	| header aFont aButton |	header _ AlignmentMorph newRow color: self color; wrapCentering: #center; cellPositioning: #leftCenter.	aFont _ Preferences standardButtonFont.	header addMorph: (aButton _ SimpleButtonMorph new label: 'O' font: aFont).	aButton target: self;			color:  Color tan;			actionSelector: #delete;			setBalloonText: 'remove this pane from the screendon''t worry -- nothing will be lost!!.' translated.	self maybeAddArrowsTo: header.	header beSticky.	self addMorph: header.	self addNamePaneTo: header.	chosenCategorySymbol _ #basic! !!CategoryViewer methodsFor: 'header pane' stamp: 'dgd 9/1/2003 13:46'!addNamePaneTo: header 	"Add the namePane, which may be a popup or a type-in 	depending on the type of CategoryViewer"	| aButton |	namePane := RectangleMorph newSticky color: Color brown veryMuchLighter.	namePane borderWidth: 0.	aButton := (StringButtonMorph				contents: '-----'				font: Preferences standardEToysFont)				color: Color black.	aButton target: self;		 arguments: Array new;		 actionSelector: #chooseCategory.	aButton actWhen: #buttonDown.	namePane addMorph: aButton.	aButton position: namePane position.	namePane align: namePane topLeft with: bounds topLeft + (50 @ 0).	namePane setBalloonText: 'category (click here to choose a different one)' translated.	header addMorphBack: namePane.	(namePane isKindOf: RectangleMorph)		ifTrue: [namePane addDropShadow.			namePane shadowColor: Color gray]! !!CategoryViewer methodsFor: 'header pane' stamp: 'dgd 9/1/2003 13:47'!maybeAddArrowsTo: header	"Maybe add up/down arrows to the header"	| wrpr |	header addTransparentSpacerOfSize: 5@5.	header addUpDownArrowsFor: self.	(wrpr _ header submorphs last) submorphs second setBalloonText: 'previous category' translated.		wrpr submorphs first  setBalloonText: 'next category' translated! !!CodecDemoMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 21:17'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'select codec' translated action: #selectCodec.! !!CompoundTileMorph methodsFor: 'initialization' stamp: 'dgd 10/8/2003 18:51'!initialize	"initialize the state of the receiver"	| r |	super initialize.	""	self layoutInset: 2.	self listDirection: #topToBottom.	self hResizing: #spaceFill;		 vResizing: #shrinkWrap;		 cellInset: 0 @ 1;		 minCellSize: 200 @ 14.	r _ AlignmentMorph newRow color: color;				 layoutInset: 0.	r setProperty: #demandsBoolean toValue: true.	r addMorphBack: (Morph new color: color;			 extent: 2 @ 5).	"spacer"	r		addMorphBack: (StringMorph new contents: 'Test' translated).	r addMorphBack: (Morph new color: color;			 extent: 5 @ 5).	"spacer"	r addMorphBack: (testPart _ BooleanScriptEditor new borderWidth: 0;					 layoutInset: 1).	testPart color: Color transparent.	testPart hResizing: #spaceFill.	self addMorphBack: r.	r _ AlignmentMorph newRow color: color;				 layoutInset: 0.	r addMorphBack: (Morph new color: color;			 extent: 30 @ 5).	"spacer"	r		addMorphBack: (StringMorph new contents: 'Yes' translated).	r addMorphBack: (Morph new color: color;			 extent: 5 @ 5).	"spacer"	r addMorphBack: (yesPart _ ScriptEditorMorph new borderWidth: 0;					 layoutInset: 2).	yesPart hResizing: #spaceFill.	yesPart color: Color transparent.	self addMorphBack: r.	r _ AlignmentMorph newRow color: color;				 layoutInset: 0.	r addMorphBack: (Morph new color: color;			 extent: 35 @ 5).	"spacer"	r		addMorphBack: (StringMorph new contents: 'No' translated).	r addMorphBack: (Morph new color: color;			 extent: 5 @ 5).	"spacer"	r addMorphBack: (noPart _ ScriptEditorMorph new borderWidth: 0;					 layoutInset: 2).	noPart hResizing: #spaceFill.	noPart color: Color transparent.	self addMorphBack: r.	self bounds: self fullBounds! !!DoubleClickExample methodsFor: 'accessing' stamp: 'dgd 8/31/2003 18:37'!balloonText	^ 'Double-click on me to change my color; single-click on me to change border color;hold mouse down within me to grow (if I''m red) or shrink (if I''m blue).' translated! !!EToyProjectHistoryMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/20/2003 18:52'!rebuild	| history r1 |	history _ ProjectHistory currentHistory mostRecentCopy.	changeCounter _ ProjectHistory changeCounter.	self removeAllMorphs.	self rubberBandCells: false. "enable growing"	r1 _ self addARow: {		self inAColumn: {			StringMorph new contents: 'Jump...' translated; lock.		}.	}.	r1 on: #mouseUp send: #jumpToProject to: self.	history do: [ :each |		(			self addARow: {				(self inAColumn: {					StretchyImageMorph new form: each second; minWidth: 35; minHeight: 35; lock				}) vResizing: #spaceFill.				self inAColumn: {					StringMorph new contents: each first; lock.					"StringMorph new contents: each third; lock."				}.			}		)			color: Color paleYellow;			borderWidth: 1;			borderColor: #raised;			vResizing: #spaceFill;			on: #mouseUp send: #mouseUp:in: to: self;			on: #mouseDown send: #mouseDown:in: to: self;			on: #mouseMove send: #mouseMove:in: to: self;			on: #mouseLeave send: #mouseLeave:in: to: self;			setProperty: #projectParametersTuple toValue: each;			setBalloonText: (each third isEmptyOrNil ifTrue: ['not saved'] ifFalse: [each third])	]."---	newTuple _ {		aProject name.		aProject thumbnail.		aProject url.		WeakArray with: aProject.	}.---"! !!EToyProjectRenamerMorph methodsFor: 'as yet unclassified' stamp: 'jm 9/2/2003 19:39'!buttonNamed: aString action: aSymbol color: aColor help: helpString	| f col |	f _ SimpleButtonMorph new		target: self;		label: aString translated font: self myFont;		color: aColor;		actionSelector: aSymbol;		setBalloonText: helpString translated.	col _ (self inAColumn: {f}) hResizing: #spaceFill.	^col! !!EToyProjectRenamerMorph methodsFor: 'as yet unclassified' stamp: 'dgd 10/8/2003 18:53'!validateTheProjectName	| proposed |	proposed _ (namedFields at: 'projectname') contents string withBlanksTrimmed.	proposed isEmpty ifTrue: [		self inform: 'I do need a name for the project' translated.		^false	].	proposed size > 24 ifTrue: [		self inform: 'Please make the name 24 characters or less' translated.		^false	].	(Project isBadNameForStoring: proposed) ifTrue: [		self inform: 'Please remove any funny characters from the name' translated.		^false	].	proposed = theProject name ifTrue: [^true].	(ChangeSorter changeSetNamed: proposed) ifNotNil: [		Utilities inform: 'Sorry that name is already used' translated.		^false	].	^true! !!EToyProjectDetailsMorph methodsFor: 'as yet unclassified' stamp: 'jm 9/2/2003 19:39'!rebuild	| bottomButtons |	self removeAllMorphs.	self addARow: {		self lockedString: 'Please describe this project' translated.	}.	self addARow: {		self lockedString: 'Name:' translated.		self inAColumnForText: {self fieldForProjectName}	}.	self expandedFormat ifTrue: [		self fieldToDetailsMappings do: [ :each |			self addARow: {				self lockedString: each third translated.				self inAColumnForText: {(self genericTextFieldNamed: each first) height: each fourth}			}.		].	].	bottomButtons _ self expandedFormat ifTrue: [		{			self okButton.			self cancelButton.		}	] ifFalse: [		{			self okButton.			self expandButton.			self cancelButton.		}	].	self addARow: bottomButtons.	self fillInDetails.! !!EnvelopeEditorMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:19'!addCustomMenuItems: menu hand: aHandMorph	super addCustomMenuItems: menu hand: aHandMorph.	menu addLine.	envelope updateSelector = #ratio: ifTrue:		[menu add: 'choose denominator...' translated action: #chooseDenominator:].	menu add: 'adjust scale...' translated action: #adjustScale:.	SoundPlayer isReverbOn		ifTrue: [menu add: 'turn reverb off' translated target: SoundPlayer selector: #stopReverb]		ifFalse: [menu add: 'turn reverb on' translated target: SoundPlayer selector: #startReverb].	menu addLine.	menu add: 'get sound from lib' translated action: #chooseSound:.	menu add: 'put sound in lib' translated action: #saveSound:.	menu add: 'read sound from disk...' translated action: #readFromDisk:.	menu add: 'save sound on disk...' translated action: #saveToDisk:.	menu add: 'save library on disk...' translated action: #saveLibToDisk:.! !!EtoyLoginMorph methodsFor: 'actions' stamp: 'dgd 10/8/2003 18:58'!doOK	| proposed |	proposed _ theNameMorph contents string.	proposed isEmpty ifTrue: [^self inform: 'Please enter your login name' translated].	proposed size > 24 ifTrue: [^self inform: 'Please make the name 24 characters or less' translated].	(Project isBadNameForStoring: proposed) ifTrue: [		^self inform: 'Please remove any funny characters' translated	].	(actionBlock value: proposed) ifTrue:[self delete].! !!EventRecorderMorph methodsFor: 'commands' stamp: 'dgd 9/21/2003 17:54'!shrink	"Shorten the tape by deleting mouseMove events that can just as well be	interpolated later at playback time."	| oldSize priorSize |	self writeCheck.	oldSize _ priorSize _ tape size.	[self condense.  tape size < priorSize] whileTrue: [priorSize _ tape size].	self inform: ('{1} events reduced to {2}' translated format:{oldSize. tape size}).	voiceRecorder ifNotNil: [voiceRecorder suppressSilence].	saved _ false.! !!EventRecorderMorph methodsFor: 'initialization' stamp: 'dgd 8/30/2003 21:19'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'add voice controls' translated action: #addVoiceControls.	aCustomMenu add: 'add journal file' translated action: #addJournalFile.! !!FillInTheBlankMorph methodsFor: 'initialization' stamp: 'sd 11/13/2003 21:07'!createAcceptButton	"create the [accept] button"	| result frame |	result := SimpleButtonMorph new target: self;				 color: Color lightGreen.	result		borderColor: (Preferences menuAppearance3d				ifTrue: [#raised]				ifFalse: [result color twiceDarker]).	result label: 'Accept(s)' translated;		 actionSelector: #accept.	result setNameTo: 'accept'.	frame := LayoutFrame new.	frame rightFraction: 0.5;		 rightOffset: -10;		 bottomFraction: 1.0;		 bottomOffset: -2.	result layoutFrame: frame.	self addMorph: result.	self		updateColor: result		color: result color		intensity: 2.	^ result! !!FillInTheBlankMorph methodsFor: 'initialization' stamp: 'sd 11/13/2003 21:07'!createCancelButton	"create the [cancel] button"	| result frame |	result := SimpleButtonMorph new target: self;				 color: Color lightRed.	result		borderColor: (Preferences menuAppearance3d				ifTrue: [#raised]				ifFalse: [result color twiceDarker]).	result label: 'Cancel(l)' translated;		 actionSelector: #cancel.	result setNameTo: 'cancel'.	frame := LayoutFrame new.	frame leftFraction: 0.5;		 leftOffset: 10;		 bottomFraction: 1.0;		 bottomOffset: -2.	result layoutFrame: frame.	self addMorph: result.	self		updateColor: result		color: result color		intensity: 2.	^ result! !!FlashMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:42'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addUpdating: #getSmoothingLevel action: #nextSmoothingLevel.	aCustomMenu add:'show compressed size' translated action: #showCompressedSize.! !!FlashMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:42'!getSmoothingLevel	"Menu support"	| aaLevel |	aaLevel := self defaultAALevel				ifNil: [1].	aaLevel = 1		ifTrue: [^ 'turn on smoothing' translated].	aaLevel = 2		ifTrue: [^ 'more smoothing' translated].	aaLevel = 4		ifTrue: [^ 'turn off smoothing' translated]! !!FlashCharacterMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:41'!addCustomMenuItems: aMenu hand: aHand	super addCustomMenuItems: aMenu hand: aHand.	aMenu add:'add project target' translated action: #addProjectTarget.	aMenu add:'remove project target' translated action: #removeProjectTarget.! !!FlashButtonMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:41'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addLine.	aCustomMenu add: 'set custom action' translated action: #addCustomAction.	aCustomMenu add: 'remove all actions' translated action: #removeActions.! !!FlashPlayerMorph methodsFor: 'initialize' stamp: 'dgd 9/20/2003 16:42'!openInMVC	| window extent |	self localBounds: localBounds.	extent _ bounds extent.	window _ FlashPlayerWindow labelled:'Flash Player' translated.	window model: (FlashPlayerModel player: self).	window addMorph: self frame:(0@0 corner: 1@1).	window openInMVCExtent: extent! !!FlashPlayerMorph methodsFor: 'initialize' stamp: 'dgd 9/20/2003 16:42'!openInWorld	| window extent |	self localBounds: localBounds.	extent _ bounds extent.	window _ FlashPlayerWindow labelled:'Flash Player' translated.	window model: (FlashPlayerModel player: self).	window addMorph: self frame:(0@0 corner: 1@1).	window openInWorldExtent: extent! !!FlashPlayerMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:42'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'open sorter' translated action: #openSorter.	aCustomMenu add: 'make controls' translated action: #makeControls.	aCustomMenu addLine.! !!GradientFillMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:45'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'gradient color' translated action: #setGradientColor:.	gradientDirection == #vertical		ifTrue: [aCustomMenu add: 'horizontal pan' translated action: #beHorizontal]		ifFalse: [aCustomMenu add: 'vertical pan' translated action: #beVertical].! !!GraphMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:45'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'open wave editor' translated action: #openWaveEditor.	aCustomMenu add: 'read file' translated action: #readDataFromFile.! !!HaloMorph methodsFor: 'private' stamp: 'dgd 8/28/2003 15:15'!addGraphicalHandle: formKey at: aPoint on: eventName send: selector to: recipient	"Add the supplied form as a graphical handle centered at the given point, and set it up to respond to the given event by sending the given selector to the given recipient.  Return the handle."	| handle |	handle _ self addGraphicalHandleFrom: formKey at: aPoint.	handle on: eventName send: selector to: recipient.	handle setBalloonText: (target balloonHelpTextForHandle: handle) translated.	^ handle! !!HaloMorph methodsFor: 'private' stamp: 'dgd 8/28/2003 15:15'!addHandle: handleSpec on: eventName send: selector to: recipient	"Add a handle within the halo box as per the haloSpec, and set it up to respond to the given event by sending the given selector to the given recipient.  Return the handle."	| handle aPoint iconName colorToUse |	aPoint _ self positionIn: haloBox horizontalPlacement: handleSpec horizontalPlacement verticalPlacement: handleSpec verticalPlacement.	handle _ EllipseMorph		newBounds: (Rectangle center: aPoint extent: HandleSize asPoint)		color: (colorToUse _ Color colorFrom: handleSpec color).	self addMorph: handle.	(iconName _ handleSpec iconSymbol) ifNotNil:		[ | form |		form _ ScriptingSystem formAtKey: iconName.		form ifNotNil:			[handle addMorphCentered: (ImageMorph new				image: form; 				color: colorToUse makeForegroundColor;				lock)]].	handle on: #mouseUp send: #endInteraction to: self.	handle on: eventName send: selector to: recipient.	self isMagicHalo ifTrue:[		handle on: #mouseEnter send: #handleEntered to: self.		handle on: #mouseLeave send: #handleLeft to: self].	handle setBalloonText: (target balloonHelpTextForHandle: handle) translated.	^ handle! !!HaloMorph methodsFor: 'private' stamp: 'dgd 8/28/2003 15:15'!addHandleAt: aPoint color: aColor icon: iconName on: eventName send: selector to: recipient	"Add a handle centered at the given point with the given color, and set it up to respond to the given event by sending the given selector to the given recipient.  Return the handle."	| handle |	handle _ EllipseMorph		newBounds: (Rectangle center: aPoint extent: self handleSize asPoint)		color: aColor.	self addMorph: handle.	iconName ifNotNil:		[ | form |		form _ ScriptingSystem formAtKey: iconName.		form ifNotNil:			[handle addMorphCentered: (ImageMorph new				image: form; 				color: aColor makeForegroundColor;				lock)]].	handle on: #mouseUp send: #endInteraction to: self.	handle on: eventName send: selector to: recipient.	handle setBalloonText: (target balloonHelpTextForHandle: handle) translated.	^ handle! !!HaloMorph methodsFor: 'private' stamp: 'dgd 9/5/2003 18:32'!maybeDismiss: evt with: dismissHandle	"Ask hand to dismiss my target if mouse comes up in it."	evt hand obtainHalo: self.	(dismissHandle containsPoint: evt cursorPoint)		ifFalse:			[self delete.			target addHalo: evt]		ifTrue:			[target resistsRemoval ifTrue:				[(PopUpMenu					confirm: 'Really throw this away' translated					trueChoice: 'Yes' translated					falseChoice: 'Um, no, let me reconsider' translated) ifFalse: [^ self]].			Preferences preserveTrash				ifTrue:					[Preferences soundsEnabled ifTrue:						[TrashCanMorph playDeleteSound].					self stopStepping.					super delete.					target slideToTrash: evt]				ifFalse:					[self delete.					target dismissViaHalo]]! !!HaloMorph methodsFor: 'private' stamp: 'dgd 10/8/2003 19:07'!startGrow: evt with: growHandle	"Initialize resizing of my target.  Launch a command representing it, to support Undo"	| botRt |	self obtainHaloForEvent: evt andRemoveAllHandlesBut: growHandle.	botRt _ target point: target bottomRight in: owner.	positionOffset _ (self world viewBox containsPoint: botRt)		ifTrue: [evt cursorPoint - botRt]		ifFalse: [0@0].	self setProperty: #commandInProgress toValue:		(Command new			cmdWording: 'resizing' translated;			undoTarget: target selector: #setExtentFromHalo: argument: target extent)! !!HaloMorph methodsFor: 'private' stamp: 'dgd 8/26/2003 21:44'!startRot: evt with: rotHandle	"Initialize rotation of my target if it is rotatable.  Launch a command object to represent the action"	self obtainHaloForEvent: evt andRemoveAllHandlesBut: rotHandle.	target isFlexMorph ifFalse: 		[target isInWorld ifFalse: [self setTarget: target player costume].		target addFlexShellIfNecessary].	growingOrRotating _ true.	self removeAllHandlesBut: rotHandle.  "remove all other handles"	angleOffset _ evt cursorPoint - (target pointInWorld: target referencePosition).	angleOffset _ Point			r: angleOffset r			degrees: angleOffset degrees - target rotationDegrees.	self setProperty: #commandInProgress toValue:		(Command new			cmdWording: 'rotating' translated;			undoTarget: target selector: #rotationDegrees: argument: target rotationDegrees)! !!ImageMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:46'!opacityString	^ (self isOpaque		ifTrue: ['<on>']		ifFalse: ['<off>']), 'opaque' translated! !!MIDIControllerMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:50'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'set channel' translated action: #setChannel:.	aCustomMenu add: 'set controller' translated action: #setController:.! !!MIDIPianoKeyboardMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 21:50'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	midiPort		ifNil: [aCustomMenu add: 'play via MIDI' translated action: #openMIDIPort]		ifNotNil: [			aCustomMenu add: 'play via built in synth' translated action: #closeMIDIPort.			aCustomMenu add: 'new MIDI controller' translated action: #makeMIDIController:].! !!MPEGDisplayMorph methodsFor: 'commands' stamp: 'dgd 10/8/2003 19:10'!setFrameRate	"Ask the user to specify the desired frame rate."	| rateString |	rateString := FillInTheBlank request: 'Desired frames per second?' translated				initialAnswer: desiredFrameRate printString.	rateString isEmpty ifTrue: [^self].	desiredFrameRate := rateString asNumber asFloat.	desiredFrameRate := desiredFrameRate max: 0.1! !!MPEGDisplayMorph methodsFor: 'menu' stamp: 'dgd 9/19/2003 12:17'!invokeMenu	"Invoke a menu of additonal functions."	| aMenu |	aMenu _ CustomMenu new.	repeat		ifTrue: [aMenu add: 'turn off repeat (now on)' translated action: #toggleRepeat]		ifFalse: [aMenu add: 'turn on repeat (now off)' translated action: #toggleRepeat].	aMenu addList:	{		#-.		{'set frame rate' translated.				#setFrameRate}.		#-.		{'create JPEG movie from MPEG' translated.		#createJPEGfromMPEG}.		{'create JPEG movie from SqueakMovie' translated.	#createJPEGfromSqueakMovie}.		{'create JPEG movie from folder of frames' translated.	#createJPEGfromFolderOfFrames}.		#-}.	(mpegFile isKindOf: JPEGMovieFile) ifTrue: [		mpegFile hasAudio			ifTrue: [aMenu add: 'remove all soundtracks' translated action: #removeAllSoundtracks]			ifFalse: [aMenu add: 'add soundtrack' translated action: #addSoundtrack]].	aMenu invokeOn: self defaultSelection: nil.! !!MPEGMoviePlayerMorph methodsFor: 'menu' stamp: 'dgd 9/19/2003 12:14'!invokeMenu	"Invoke a menu of additonal functions."	| aMenu |	aMenu _ CustomMenu new.	aMenu addList:	{		{'set frame rate' translated.						#setFrameRate}.		{'convert MPEG to JPEG movie' translated.	#showFFTAtCursor}}.	aMenu invokeOn: moviePlayer defaultSelection: nil.! !!MPEGMoviePlayerMorph methodsFor: 'private' stamp: 'dgd 9/19/2003 12:12'!addButtonRow	| r |	r _ AlignmentMorph newRow vResizing: #shrinkWrap; color: Color transparent.	r addMorphBack: (self buttonName: 'Open' translated action: #openMPEGFile).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Menu' translated action: #invokeMenu).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Rewind' translated action: #rewindMovie).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Play' translated action: #startPlaying).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Stop' translated action: #stopPlaying).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: '<' action: #previousFrame).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: '>' action: #nextFrame).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	self addMorphBack: r.! !!MPEGMoviePlayerMorph methodsFor: 'private' stamp: 'dgd 9/19/2003 12:19'!addPositionSlider	| r |	positionSlider _ SimpleSliderMorph new		color: (Color r: 0.71 g: 0.871 b: 1.0);		extent: 200@2;		target: moviePlayer;		actionSelector: #moviePosition:;		adjustToValue: 0.	r _ AlignmentMorph newRow		color: Color transparent;		layoutInset: 0;		wrapCentering: #center; cellPositioning: #leftCenter;		hResizing: #shrinkWrap;		vResizing: #rigid;		height: 24.	r addMorphBack: (StringMorph contents: 'start ' translated).	r addMorphBack: positionSlider.	r addMorphBack: (StringMorph contents: ' end' translated).	self addMorphBack: r.! !!MPEGMoviePlayerMorph methodsFor: 'private' stamp: 'dgd 9/19/2003 12:19'!addQuitButton	self submorphs second		addMorphFront: (Morph new extent: 4@1; color: Color transparent);		addMorphFront: ( SimpleButtonMorph new			target: self;			label: 'Quit' translated;			actionSelector: #quit;			color: (Color gray: 0.8);  "old color"			fillStyle: self buttonFillStyle;			borderWidth: 0;			borderColor: #raised)! !!MPEGMoviePlayerMorph methodsFor: 'private' stamp: 'dgd 9/19/2003 12:19'!addVolumeSlider	| levelSlider r |	levelSlider _ SimpleSliderMorph new		color: (Color r: 0.71 g: 0.871 b: 1.0);		extent: 200@2;		target: moviePlayer;		actionSelector: #volume:;		adjustToValue: 0.5.	r _ AlignmentMorph newRow		color: Color transparent;		layoutInset: 0;		wrapCentering: #center; cellPositioning: #leftCenter;		hResizing: #shrinkWrap;		vResizing: #rigid;		height: 24.	r addMorphBack: (StringMorph contents: '  soft ' translated).	r addMorphBack: levelSlider.	r addMorphBack: (StringMorph contents: ' loud' translated).	self addMorphBack: r.! !!MagnifierMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:50'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu		addLine;		add: 'magnification...' translated action: #chooseMagnification;		addUpdating: #trackingPointerString action: #toggleTrackingPointer;		addUpdating: #toggleRoundString action: #toggleRoundness.! !!MagnifierMorph methodsFor: 'menu' stamp: 'dgd 10/8/2003 19:13'!chooseMagnification	| result |	result _ (SelectionMenu selections: #(1.5 2 4 8))		startUpWithCaption: ('Choose magnification(currently {1})' translated format:{magnification}).	(result isNil or: [result = magnification]) ifTrue: [^ self].	magnification _ result.	self extent: self extent. "round to new magnification"	self changed. "redraw even if extent wasn't changed".! !!MagnifierMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:51'!trackingPointerString	^ (trackPointer		ifTrue: ['stop tracking pointer']		ifFalse: ['start tracking pointer']) translated! !!MagnifierMorph methodsFor: 'round view' stamp: 'dgd 8/30/2003 21:51'!toggleRoundString	^ (self isRound		ifTrue: ['be square']		ifFalse: ['be round'])  translated! !!FishEyeMorph methodsFor: 'menus' stamp: 'dgd 9/21/2003 17:55'!chooseMagnification	self inform: 'Magnification is fixed, sorry.' translated! !!MenuMorph methodsFor: 'accessing' stamp: 'dgd 8/30/2003 20:44'!allWordings	"Answer a collection of the wordings of all items and subitems, omitting the window-list in the embed... branch and (unless a certain hard-coded preference is set) also omitting items from the debug menu"	| verboten |	verboten _ OrderedCollection with: 'embed into'.	Preferences debugMenuItemsInvokableFromScripts 		ifFalse:	[verboten add: 'debug...' translated].	^ self allWordingsNotInSubMenus: verboten! !!MenuMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:52'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addLine.	aCustomMenu add: 'add title...' translated action: #addTitle.	aCustomMenu add: 'set target...' translated action: #setTarget:.	defaultTarget ifNotNil: [		aCustomMenu add: 'add item...' translated action: #addItem].	aCustomMenu add: 'add line' translated action: #addLine.	(self items count:[:any| any hasSubMenu]) > 0		ifTrue:[aCustomMenu add: 'detach submenu' translated action: #detachSubMenu:].! !!MidiInputMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/19/2003 13:33'!invokeMenu	"Invoke a menu of additonal commands."	| aMenu |	aMenu _ CustomMenu new.	aMenu add: 'add channel' translated action: #addChannel.	aMenu add: 'reload instruments' translated target: AbstractSound selector: #updateScorePlayers.	midiSynth isOn ifFalse: [		aMenu add: 'set MIDI port' translated action: #setMIDIPort.		midiSynth midiPort			ifNotNil: [aMenu add: 'close MIDI port' translated action: #closeMIDIPort]].		aMenu invokeOn: self defaultSelection: nil.! !!MonthMorph methodsFor: 'controls' stamp: 'dgd 8/30/2003 21:53'!startMondayOrSundayString	^ (Week startMonday		ifTrue: ['start Sunday']		ifFalse: ['start Monday']) translated! !!MonthMorph methodsFor: 'all' stamp: 'dgd 8/30/2003 21:53'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu 		addLine;		addUpdating: #startMondayOrSundayString action: #toggleStartMonday;		add: 'jump to year...' translated action: #chooseYear.! !!MorphicModel methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:53'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	model ifNotNil: [model addModelMenuItemsTo: aCustomMenu forMorph: self hand: aHandMorph].	self isOpen ifTrue: [aCustomMenu add: 'close editing' translated action: #closeToEdits]			ifFalse: [aCustomMenu add: 'open editing' translated action: #openToEdits].! !!MovieMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:55'!addCustomMenuItems: aCustomMenu hand: aHandMorph	| movies subMenu |	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addLine.	subMenu _ MenuMorph new defaultTarget: self.	frameList size > 1 ifTrue: [		subMenu add: 'repaint' translated action: #editDrawing.		subMenu add: 'set rotation center' translated action: #setRotationCenter.		subMenu add: 'play once' translated action: #playOnce.		subMenu add: 'play loop' translated action: #playLoop.		subMenu add: 'stop playing' translated action: #stopPlaying.		currentFrameIndex > 1 ifTrue: [			subMenu add: 'previous frame' translated action: #previousFrame].		currentFrameIndex < frameList size ifTrue: [			subMenu add: 'next frame' translated action: #nextFrame]].	subMenu add: 'extract this frame' translated action: #extractFrame:.	movies _		(self world rootMorphsAt: aHandMorph targetOffset)			select: [:m | (m isKindOf: MovieMorph) or:						[m isKindOf: SketchMorph]].	(movies size > 1) ifTrue:		[subMenu add: 'insert into movie' translated action: #insertIntoMovie:].	aCustomMenu add: 'movie...' translated subMenu: subMenu! !!MoviePlayerMorph methodsFor: 'menu' stamp: 'dgd 10/8/2003 19:32'!invokeBookMenu	"Invoke the book's control panel menu."	| aMenu |	aMenu _ MVCMenuMorph new defaultTarget: self.	aMenu add:	'make a new movie' translated action: #makeAMovie.	aMenu add:	'open movie file' translated action: #openMovieFile.	aMenu add:	'add sound track' translated action: #addSoundTrack.	aMenu addLine.	scorePlayer ifNotNil:		[soundTrackForm isNil			ifTrue: [aMenu add:	'show sound track' translated action: #showHideSoundTrack]			ifFalse: [aMenu add:	'hide sound track' translated action: #showHideSoundTrack]].	aMenu add:	'make thumbnail' translated action: #thumbnailForThisPage.	cueMorph ifNotNil:		["Should check if piano roll and score already have a start event		prior to this time."		aMenu add:	'end clip here' translated action: #endClipHere].	aMenu popUpEvent: self world activeHand lastEvent in: self world! !!NumberType methodsFor: 'tiles' stamp: 'dgd 9/6/2003 20:30'!addExtraItemsToMenu: aMenu forSlotSymbol: slotSym	"If the receiver has extra menu items to add to the slot menu, here is its chance to do it.  The defaultTarget of the menu is the player concerned."	aMenu add: 'decimal places...' translated selector: #setPrecisionFor: argument: slotSym.	aMenu balloonTextForLastItem: 'Lets you choose how many decimal places should be shown in readouts for this variable' translated! !!NumberType methodsFor: 'tiles' stamp: 'dgd 9/6/2003 20:29'!addWatcherItemsToMenu: aMenu forGetter: aGetter	"Add watcher items to the menu if appropriate, provided the getter is not an odd-ball one for which a watcher makes no sense"	super addWatcherItemsToMenu: aMenu forGetter: aGetter.	aMenu add: 'detailed watcher' translated selector: #tearOffFancyWatcherFor: argument: aGetter! !!ObjectPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 10/8/2003 19:35'!rebuild	self removeAllMorphs.	self addARow: {		self lockedString: ('Properties for {1}' translated format: {myTarget name}).	}.	self addARow: {		self inAColumn: {			self paneForCornerRoundingToggle.			self paneForStickinessToggle.			self paneForLockedToggle.		}.	}.	self addARow: {		self paneForMainColorPicker.		self paneFor2ndGradientColorPicker.	}.	self addARow: {		self paneForBorderColorPicker.		self paneForShadowColorPicker.	}.	self addARow: {		self 			buttonNamed: 'Accept' translated action: #doAccept color: color lighter 			help: 'keep changes made and close panel' translated.		self 			buttonNamed: 'Cancel' translated action: #doCancel color: color lighter 			help: 'cancel changes made and close panel' translated.	}, self rebuildOptionalButtons.	thingsToRevert _ Dictionary new.	"thingsToRevert at: #fillStyle: put: myTarget fillStyle."	myTarget isSystemWindow ifTrue: [		thingsToRevert at: #setWindowColor: put: myTarget paneColorToUse	].	thingsToRevert at: #hasDropShadow: put: myTarget hasDropShadow.	thingsToRevert at: #shadowColor: put: myTarget shadowColor.	(myTarget respondsTo: #borderColor:) ifTrue: [		thingsToRevert at: #borderColor: put: myTarget borderColor.	].	thingsToRevert at: #borderWidth: put: myTarget borderWidth.	thingsToRevert at: #cornerStyle: put: myTarget cornerStyle.	thingsToRevert at: #sticky: put: myTarget isSticky.	thingsToRevert at: #lock: put: myTarget isLocked.! !!ObjectPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 10/8/2003 19:37'!rebuildOptionalButtons	| answer |	answer _ {		self transparentSpacerOfSize: 20@3.		self 			buttonNamed: 'Button' translated action: #doButtonProperties color: color lighter 			help: 'open a button properties panel for the morph' translated.	}.	myTarget isTextMorph ifTrue: [		answer _ answer, {			self 				buttonNamed: 'Text' translated action: #doTextProperties color: color lighter 				help: 'open a text properties panel for the morph' translated.		}.	].	^answer! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'sd 11/13/2003 21:03'!borderPrototype: aBorderStyle help: helpString	| selector proto |	selector _ BorderedMorph new.	selector borderWidth: 0.	selector color: Color transparent.	proto _ Morph new extent: 16@16.	proto color:  Color transparent.	proto borderStyle: aBorderStyle.	selector extent: proto extent + 4.	selector addMorphCentered: proto.	(myTarget canDrawBorder: aBorderStyle) ifTrue:[		selector setBalloonText: helpString.		selector on: #mouseDown send: #toggleBorderStyle:with:from: to: self withValue: proto.		(myTarget borderStyle species == aBorderStyle species and:[			myTarget borderStyle style == aBorderStyle style]) ifTrue:[selector borderWidth: 1].	] ifFalse:[		selector setBalloonText: 'This border style cannot be used here' translated.		selector on: #mouseDown send: #beep to: Beeper.		selector addMorphCentered: ((Morph new) color: (Color black alpha: 0.5); extent: selector extent).	].	^selector! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:21'!paneFor2ndGradientColorPicker	^self 		inAColumn: {			(self inAColumn: {				self colorPickerFor: self getter: #tgt2ndGradientColor setter: #tgt2ndGradientColor:.				self lockedString: '2nd gradient color' translated.				self paneForRadialGradientToggle hResizing: #shrinkWrap.				(					self inARow: {self paneForGradientOrigin. self paneForGradientDirection}				) hResizing: #shrinkWrap.			}			named: #pickerFor2ndGradientColor) layoutInset: 0.			self paneForGradientFillToggle hResizing: #shrinkWrap 		}! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:23'!paneForBorderColorPicker	^self 		inAColumn: {			self 				colorPickerFor: self				getter: #targetBorderColor				setter: #targetBorderColor:.			self lockedString: 'Border Color' translated.			(self paneForBorderStyle) hResizing: #shrinkWrap; layoutInset: 5.			self lockedString: 'Border style' translated.			self paneForBorderWidth.		} 		named: #pickerForBorderColor.! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:25'!paneForBorderStyle	^self inARow: {		self borderPrototype: (BorderStyle width: 4 color: Color black)			help:'Click to select a simple colored border' translated.		self borderPrototype: (BorderStyle raised width: 4)			help:'Click to select a simple raised border' translated.		self borderPrototype: (BorderStyle inset width: 4)			help:'Click to select a simple inset border' translated.		self borderPrototype: (BorderStyle complexFramed width: 4)			help:'Click to select a complex framed border' translated.		self borderPrototype: (BorderStyle complexRaised width: 4)			help:'Click to select a complex raised border' translated.		self borderPrototype: (BorderStyle complexInset width: 4)			help:'Click to select a complex inset border' translated.		self borderPrototype: (BorderStyle complexAltFramed width: 4)			help:'Click to select a complex framed border' translated.		self borderPrototype: (BorderStyle complexAltRaised width: 4)			help:'Click to select a complex raised border' translated.		self borderPrototype: (BorderStyle complexAltInset width: 4)			help:'Click to select a complex inset border' translated.	}! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:29'!paneForBorderWidth	^(self inARow: {		self			buildFakeSlider: 'Border width' translated			selector: #adjustTargetBorderWidth:			help: 'Drag in here to change the border width' translated	}) hResizing: #shrinkWrap! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:18'!paneForCornerRoundingToggle	^self inARow: {		self			directToggleButtonFor: myTarget 			getter: #wantsRoundedCorners setter: #toggleCornerRounding			help: 'Turn rounded corners on or off' translated.		self lockedString: ' Rounded corners' translated.	}! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:40'!paneForDropShadowToggle	^self inARow: {		self			directToggleButtonFor: myTarget 			getter: #hasDropShadow setter: #toggleDropShadow			help: 'Turn drop shadows on or off' translated.		self lockedString: ' Drop shadow color' translated.	}! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:22'!paneForGradientDirection	^(self inARow: {		self			buildFakeSlider: 'Direction' translated			selector: #adjustTargetGradientDirection:			help: 'Drag in here to change the direction of the gradient' translated	}) hResizing: #shrinkWrap! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:22'!paneForGradientFillToggle	^self inARow: {		self			directToggleButtonFor: self 			getter: #targetHasGradientFill			setter: #toggleTargetGradientFill			help: 'Turn gradient fill on or off' translated.		self lockedString: ' Gradient fill' translated.	}! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:21'!paneForGradientOrigin	^(self inARow: {		self			buildFakeSlider: 'Origin' translated			selector: #adjustTargetGradientOrigin:			help: 'Drag in here to change the origin of the gradient' translated	}) hResizing: #shrinkWrap! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:19'!paneForLockedToggle	^self inARow: {		self			directToggleButtonFor: myTarget 			getter: #isLocked setter: #toggleLocked			help: 'Turn lock on or off' translated.		self lockedString: ' Lock' translated.	}! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:20'!paneForMainColorPicker	^self 		inAColumn: {			self 				colorPickerFor: self 				getter: #numberOneColor 				setter: #numberOneColor:.			self lockedString: 'Color' translated.			(self paneForSolidFillToggle)  hResizing: #shrinkWrap.		} 		named: #pickerForColor.! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:21'!paneForRadialGradientToggle	^self inARow: {		self			directToggleButtonFor: self 			getter: #targetRadial setter: #toggleTargetRadial			help: 'Turn radial gradient on or off' translated.		self lockedString: ' Radial gradient' translated.	}! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:36'!paneForShadowOffset	^(self inARow: {		self			buildFakeSlider: 'Offset' translated			selector: #adjustTargetShadowOffset:			help: 'Drag in here to change the offset of the shadow' translated	}) hResizing: #shrinkWrap! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:20'!paneForSolidFillToggle	^self inARow: {		self			directToggleButtonFor: self 			getter: #targetHasSolidFill			setter: #toggleTargetSolidFill			help: 'Turn solid fill on or off' translated.		self lockedString: ' Solid fill' translated.	}! !!ObjectPropertiesMorph methodsFor: 'panes' stamp: 'dgd 8/31/2003 21:18'!paneForStickinessToggle	^self inARow: {		self			directToggleButtonFor: myTarget 			getter: #isSticky setter: #toggleStickiness			help: 'Turn stickiness on or off' translated.		self lockedString: ' Sticky' translated.	}! !!ObjectsTool methodsFor: 'initialization' stamp: 'dgd 8/30/2003 16:10'!initializeForFlap	"Initialize the receiver to operate in a flap at the top of the screen.  This worked in the past, but is not currently in the released UI and is not likely to work without some fixup."	| aPane aBin |	self borderWidth: 2; borderColor: Color darkGray.	self layoutInset: 0.	self hResizing: #shrinkWrap; vResizing: #rigid.	self listDirection: #topToBottom.	self listCentering: #topLeft.	self cellPositioning: #topLeft.	self wrapCentering: #center.	aPane _ self paneForTabs: self modeTabs.	aPane color: aPane color darker.	aPane listSpacing: #equal.	aPane cellInset: 10 @ 10.	aPane listCentering: #center; height: 38.	aPane wrapDirection: nil.	self addMorphFront: aPane.	self addMorphBack: Morph new.  "Place holder for a tabs or text pane"	aBin _ PartsBin newPartsBinWithOrientation: #leftToRight from: #().	aBin listDirection: #leftToRight.	aBin wrapDirection: #topToBottom.	aBin hResizing: #spaceFill; vResizing: #spaceFill.	aBin extent: (self currentWorld width) @ 250.	aBin color: Color orange muchLighter.	aBin setNameTo: 'Objects' translated.	aBin dropEnabled: false.	self addMorphBack: aBin! !!ObjectsTool methodsFor: 'initialization' stamp: 'dgd 8/30/2003 16:09'!initializeToStandAlone	"Initialize the receiver so that it can live as a stand-alone morph"	| aPane aBin aColor |	self basicInitialize.	self layoutInset: 6. 	self listCentering: #topLeft.	self cellPositioning: #topLeft.	self wrapCentering: #center.	self useRoundedCorners.	self listDirection: #topToBottom.	self hResizing: #shrinkWrap; vResizing: #shrinkWrap.	aPane _ self paneForTabs: self modeTabs.	aPane addMorphFront: self dismissButton.	aPane addMorphBack: self helpButton.	aPane color: (aColor _ aPane color) darker.	aPane listSpacing: #equal.	aPane cellInset: 10 @ 10.	aPane listCentering: #center; height: 38.	aPane wrapDirection: nil.	self addMorphFront: aPane.	self addMorphBack: Morph new.  "Place holder for a tabs or text pane"	aBin _ PartsBin newPartsBinWithOrientation: #leftToRight from: #().	aBin listDirection: #leftToRight.	aBin wrapDirection: #topToBottom.	aBin hResizing: #spaceFill; vResizing: #spaceFill.	aBin extent: (self currentWorld width) @ 250.	aBin color: aColor lighter lighter.	aBin setNameTo: 'parts'.	aBin dropEnabled: false.	self addMorphBack: aBin.	self submorphs last width: 350; hResizing: #rigid.	self color: (Color r: 0.0 g: 0.839 b: 0.226).	self setProperty: #initialWidth toValue: 268.	self setNameTo: 'Objects' translated.	self showCategories.! !!ObjectsTool methodsFor: 'major modes' stamp: 'dgd 8/30/2003 16:11'!modeTabs	"Answer a list of buttons which, when hit, will trigger the choice of mode of the receiver"	| buttonList aButton tupleList |	tupleList _  #(		('alphabetic'	alphabetic	showAlphabeticTabs		'A separate tab for each letter of the alphabet')		('find'		search		showSearchPane		'Provides a type-in pane allowing you to match')		('categories'		categories	showCategories			'Grouped by category')		"('standard'		standard	showStandardPane		'Standard Squeak tools supplies for building')").					buttonList _ tupleList collect:		[:tuple |			aButton _ SimpleButtonMorph new label: tuple first translated.			aButton actWhen: #buttonUp.			aButton setProperty: #modeSymbol toValue: tuple second.			aButton target: self; actionSelector: tuple third.			aButton setBalloonText: tuple fourth translated.			aButton].	^ buttonList"ObjectsTool new modeTabs"! !!ObjectsTool methodsFor: 'menu' stamp: 'dgd 8/30/2003 16:22'!addCustomMenuItems: aMenu hand: aHand	"Add items to the given halo-menu, given a hand"	super addCustomMenuItems: aMenu hand: aHand.	aMenu addLine.	aMenu add: 'alphabetic' translated target: self selector: #showAlphabeticTabs.	aMenu add: 'find' translated target: self selector: #showSearchPane.	aMenu add: 'categories' translated target: self selector: #showCategories.	aMenu addLine.	aMenu add: 'reset thumbnails' translated target: self selector: #resetThumbnails.! !!ObjectsTool methodsFor: 'search' stamp: 'dgd 8/30/2003 16:25'!newSearchPane	"Answer a type-in pane for searches"	| aTextMorph aBox |	aTextMorph _ TextMorph new.	aTextMorph setProperty: #defaultContents toValue: '' asText allBold.	aTextMorph on: #keyStroke send: #searchPaneCharacter: to: self.	aTextMorph setNameTo: 'SearchPane'.	aTextMorph setBalloonText: 'Type here and all entries that match will be shown.' translated.	aTextMorph extent: ((self innerBounds width - 16) @ 20).	aTextMorph vResizing: #rigid.	aBox _ AlignmentMorph new hResizing: #spaceFill; vResizing: #shrinkWrap.	aBox color: Color white.	aBox addMorphBack: aTextMorph.	^ aBox! !!ObjectsTool methodsFor: 'tabs' stamp: 'dgd 8/30/2003 16:09'!presentHelp	"Sent when a Help button is hit; provide the user with some form of help for the tool at hand"'The Objects tool allows you to browse through, and obtain copies of, many kinds of objects.  You can obtain an Objects tool by choosing "Objects" from the world menu, or by the shortcut of typing alt-o (cmd-o) any time the cursor is over the desktop.There are three ways to use Objects, corresponding to the three tabs seen at the top:alphabetic - gives you separate tabs for a, b, c, etc.  Click any tab, and you will see the icons of all the objects whose names begin with that lettersearch - gives you a type-in pane for a search string.  Type any letters there, and icons of all the objects whose names match what you have typed will appear in the bottom pane.categories - provides tabs representing categories of related items.  Click on any tab to see the icons of all the objects in the category.When the cursor lingers over the icon of any object, you will get balloon help for the item.When you drag an icon from Objects, it will result in a new copy of it in your hand; the new object will be deposited wherever you next click.' translated	openInWorkspaceWithTitle: 'About Objects' translated! !!PaintBoxMorph methodsFor: 'other' stamp: 'dgd 8/30/2003 21:55'!addCustomMenuItems: aCustomMenu hand: aHandMorph	"super addCustomMenuItems: aCustomMenu hand: aHandMorph."		"don't want the ones from ImageMorph"	aCustomMenu add: 'grab stamp from screen' translated action: #grabFromScreen:.! !!ParagraphEditor class methodsFor: 'class initialization' stamp: 'dgd 9/5/2003 19:02'!initializeTextEditorMenus	"Initialize the yellow button pop-up menu and corresponding messages."	"ParagraphEditor initializeTextEditorMenus"	TextEditorYellowButtonMenu _ SelectionMenu		fromArray: {		{'find...(f)' translated.		#find}.			     		{'find again (g)' translated.		#findAgain}.		     		{'set search string (h)' translated.	#setSearchString}.		#-.	     		{'do again (j)' translated.		#again}.		     		{'undo (z)' translated.			#undo}.			     		#-.	     		{'copy (c)' translated.			#copySelection}.	     		{'cut (x)' translated.			#cut}.			     		{'paste (v)' translated.		#paste}.		     		{'paste...' translated.			#pasteRecent}.		     		#-.	     		{'do it (d)' translated.		#doIt}.			     		{'print it (p)' translated.		#printIt}.		     		{'inspect it (i)' translated.		#inspectIt}.		     		{'explore it (I)' translated.		#exploreIt}.		     		{'debug it' translated.			#debugIt}.		     		#-.	     		{'accept (s)' translated.		#accept}.		     		{'cancel (l)' translated.		#cancel}.		     		#-.	     		{'show bytecodes' translated.		#showBytecodes}.	     		#-.	     		{'more...' translated.			#shiftedTextPaneMenuRequest}.	}! !!ParagraphEditor class methodsFor: 'class initialization' stamp: 'dgd 9/5/2003 18:52'!shiftedYellowButtonMenu	"Answer the menu to be presented when the yellow button is pressed while the shift key is down"	^ SelectionMenu fromArray: {		{'set font... (k)' translated.					#offerFontMenu}.		{'set style... (K)' translated.					#changeStyle}.		{'set alignment...' translated.				#chooseAlignment}.		#-.		{'explain' translated.						#explain}.		{'pretty print' translated.					#prettyPrint}.		{'pretty print with color' translated.		#prettyPrintWithColor}.		{'file it in (G)' translated.					#fileItIn}.		{'tiles from it' translated.					#selectionAsTiles}.		{'recognizer (r)' translated.					#recognizeCharacters}.		{'spawn (o)' translated.						#spawn}.		#-.		{'definition of word' translated.				#wordDefinition}.		{'verify spelling of word' translated.		#verifyWordSpelling}.		{'translate it' translated.						#translateIt}.		{'choose language' translated.				#languagePrefs}.		#-.		{'browse it (b)' translated.					#browseIt}.		{'senders of it (n)' translated.				#sendersOfIt}.		{'implementors of it (m)' translated.		#implementorsOfIt}.		{'references to it (N)' translated.			#referencesToIt}.		#-.		{'selectors containing it (W)' translated.	#methodNamesContainingIt}.		{'method strings with it (E)' translated.	#methodStringsContainingit}.		{'method source with it' translated.		#methodSourceContainingIt}.		{'class names containing it' translated.	#classNamesContainingIt}.		{'class comments with it' translated.		#classCommentsContainingIt}.		{'change sets with it' translated.			#browseChangeSetsWithSelector}.		#-.		{'save contents to file...' translated.		#saveContentsInFile}.		{'send contents to printer' translated.		#sendContentsToPrinter}.		{'printer setup' translated.					#printerSetup}.		#-.		{'special menu...' translated.				#presentSpecialMenu}.		{'more...' translated.							#yellowButtonActivity}.	}! !!PasteUpMorph methodsFor: 'gridding' stamp: 'dgd 9/6/2003 18:09'!setGridSpec	"Gridding rectangle provides origin and modulus"	| response result mx |	mx _ 36.  "... because it was that way before ..."	response _ FillInTheBlank			request: 'New grid origin (usually 0@0):' translated			initialAnswer: self gridOrigin printString.	response isEmpty ifTrue: [^ self].	result _ [Compiler evaluate: response] ifError: [^ self].	(result isPoint and: [(result >= (0@0)) & (result < (mx @ mx))])		ifTrue: [self gridOrigin: result]		ifFalse: [self inform: ('Must be a Point with coordinates between 0 & {1}' translated format: {mx-1})].	response _ FillInTheBlank			request: 'New grid spacing:' translated			initialAnswer: self gridModulus printString.	response isEmpty ifTrue: [^ self].	result _ [Compiler evaluate: response] ifError: [^ self].	(result isPoint and: [(result > (0@0)) & (result <= (mx @ mx))])		ifTrue: [self gridModulus: result]		ifFalse: [self inform: ('Must be a Point with coordinates between 1 & {1}' translated format: {mx})].! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 8/30/2003 21:56'!addCustomMenuItems: menu hand: aHandMorph	"Add morph-specific menu itemns to the menu for the hand"	super addCustomMenuItems: menu hand: aHandMorph.	self addStackMenuItems: menu hand: aHandMorph.	self addPenMenuItems: menu hand: aHandMorph.	self addPlayfieldMenuItems: menu hand: aHandMorph.	self isWorldMorph ifTrue:		[(owner isKindOf: BOBTransformationMorph) ifTrue:			[self addScalingMenuItems: menu hand: aHandMorph].		Flaps sharedFlapsAllowed ifTrue:			[menu addUpdating: #suppressFlapsString				target: CurrentProjectRefactoring 				action: #currentToggleFlapsSuppressed].		menu add: 'desktop menu...' translated target: self action: #putUpDesktopMenu:].	menu addLine! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 17:53'!addPenMenuItems: menu hand: aHandMorph	"Add a pen-trails-within submenu to the given menu"	| subMenu |	subMenu _ MenuMorph new defaultTarget: self.	self addPenTrailsMenuItemsTo: subMenu.	menu add: 'pens trails within...' translated subMenu: subMenu! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 17:54'!addPenTrailsMenuItemsTo: aMenu	| oldTarget |	"Add items relating to pen trails to aMenu"	oldTarget _ aMenu defaultTarget.	aMenu defaultTarget: self.	aMenu add: 'clear pen trails' translated action: #clearTurtleTrails.	aMenu add: 'all pens up' translated action: #liftAllPens.	aMenu add: 'all pens down' translated action: #lowerAllPens.	aMenu defaultTarget: oldTarget! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/5/2003 19:31'!addPlayfieldMenuItems: menu hand: aHandMorph 	menu		add: 'playfield options...' translated		target: self		action: #presentPlayfieldMenu! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 8/30/2003 21:18'!addScalingMenuItems: menu hand: aHandMorph	| subMenu |	(subMenu _ MenuMorph new)		defaultTarget: self;		add: 'show application view' translated action: #showApplicationView;		add: 'show factory view' translated action: #showFactoryView;		add: 'show whole world view' translated action: #showFullView;		add: 'expand' translated action: #showExpandedView;		add: 'reduce' translated action: #showReducedView;		addLine;		add: 'define application view' translated action: #defineApplicationView;		add: 'define factory view' translated action: #defineFactoryView.	menu		add: 'world scale and clip...' translated		subMenu: subMenu! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 17:59'!autoExpansionString	"Answer the string to be shown in a menu to represent the  	auto-phrase-expansion status"	^ ((self hasProperty: #automaticPhraseExpansion)		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'auto-phrase-expansion' translated! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 17:54'!autoLineLayoutString	"Answer the string to be shown in a menu to represent the  	auto-line-layout status"	^ (self autoLineLayout		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'auto-line-layout' translated! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 18:02'!autoViewingString	"Answer the string to be shown in a menu to represent the  	automatic-viewing status"	^ (self automaticViewing		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'automatic viewing' translated! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 18:01'!batchPenTrailsString	"Answer the string to be shown in a menu to represent the 	batch-pen-trails enabled status"	^ (self batchPenTrails		ifTrue: ['<on>']		ifFalse: ['<off>']), 'batch pen trails' translated! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 8/30/2003 20:42'!buildDebugMenu: aHandMorph	| aMenu |	aMenu _ super buildDebugMenu: aHandMorph.	aMenu add:  'abandon costume history' translated target: self action: #abandonCostumeHistory.	^ aMenu! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 18:01'!fenceEnabledString	"Answer the string to be shown in a menu to represent the  	fence enabled status"	^ (self fenceEnabled		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'fence enabled' translated! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 17:56'!indicateCursorString	"Answer the string to be shown in a menu to represent the  	whether-to-indicate-cursor status"	^ (self indicateCursor		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'indicate cursor' translated! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 17:58'!isOpenForDragNDropString	"Answer the string to be shown in a menu to represent the  	open-to-drag-n-drop status"	^ (self dragNDropEnabled		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'open to drag & drop' translated! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 17:57'!isPartsBinString	"Answer the string to be shown in a menu to represent the 	parts-bin status"	^ (self isPartsBin		ifTrue: ['<on>']		ifFalse: ['<off>']), 'parts bin' translated! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 17:58'!mouseOverHalosString	"Answer the string to be shown in a menu to represent the  	mouse-over-halos status"	^ (self wantsMouseOverHalos		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'mouse-over halos' translated! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 18:00'!originAtCenterString	"Answer the string to be shown in a menu to represent the 	origin-at-center status"	^ ((self hasProperty: #originAtCenter)		ifTrue: ['<on>']		ifFalse: ['<off>']), 'origin-at-center' translated! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/5/2003 19:33'!playfieldOptionsMenu	"Answer an auxiliary menu with options specific to playfields -- too many to be housed in the main menu"	| aMenu isWorld |	isWorld _ self isWorldMorph.	aMenu _ MenuMorph new defaultTarget: self.	aMenu addStayUpItem.	aMenu add: 'save on file...' translated action: #saveOnFile.	aMenu add: 'save as SqueakPage at url...' translated action: #saveOnURL.	aMenu add: 'update all from resources' translated action: #updateAllFromResources.	(self valueOfProperty: #classAndMethod) ifNotNil:		[aMenu add: 'broadcast as documentation' translated action: #saveDocPane].	aMenu add: 'round up strays' translated action: #roundUpStrays.	aMenu balloonTextForLastItem:  'Bring back all objects whose current coordinates keep them from being visible, so that at least a portion of each of my interior objects can be seen.' translated.	aMenu add: 'show all players' translated action: #showAllPlayers.	aMenu balloonTextForLastItem:  'Make visible the viewers for all players which have user-written scripts in this playfield.' translated.	aMenu add: 'hide all players' translated action: #hideAllPlayers.	aMenu balloonTextForLastItem:  'Make invisible the viewers for all players in this playfield. This will save space before you publish this project' translated.	aMenu addLine.	aMenu add: 'shuffle contents' translated action: #shuffleSubmorphs.	aMenu balloonTextForLastItem: 'Rearranges my contents in random order' translated.	self griddingOn		ifTrue: [aMenu add: 'turn gridding off' translated action: #griddingOnOff.				aMenu add: (self gridVisible ifTrue: ['hide'] ifFalse: ['show']) translated, ' grid' translated						action: #gridVisibleOnOff.				aMenu add: 'set grid spacing...' translated action: #setGridSpec]		ifFalse: [aMenu add: 'turn gridding on' translated action: #griddingOnOff].	aMenu addLine.	#(	(autoLineLayoutString	toggleAutoLineLayout			'whether submorphs should automatically be laid out in lines' translated)		(indicateCursorString	toggleIndicateCursor			'whether the "current" submorph should be indicated with a dark black border' translated)		(isPartsBinString		toggleIsPartsBin			'whether dragging an object from the interior should produce a COPY of the object' translated)		(isOpenForDragNDropString	toggleDragNDrop			'whether objects can be dropped into and dragged out of me' translated)		(mouseOverHalosString	toggleMouseOverHalos			'whether objects should put up halos when the mouse is over them' translated)		(autoExpansionString	toggleAutomaticPhraseExpansion			'whether tile phrases, dropped on me, should automatically sprout Scriptors around them' translated)		(originAtCenterString	toggleOriginAtCenter			'whether the cartesian origin of the playfield should be at its lower-left corner or at the center of the playfield' translated)		(showThumbnailString	toggleAlwaysShowThumbnail			'whether large objects should be represented by thumbnail miniatures of themselves' translated)		(fenceEnabledString	toggleFenceEnabled			'whether moving objects should stop at the edge of their container' translated)		(batchPenTrailsString	toggleBatchPenTrails 			'if true, detailed movement of pens between display updates is ignored.  Thus multiple line segments drawn within a script may not be seen individually.' translated)	) do:			[:triplet |				(isWorld and: [#(toggleAutoLineLayout toggleIndicateCursor toggleIsPartsBin toggleAlwaysShowThumbnail) includes: triplet second]) ifFalse:					[aMenu addUpdating: triplet first action: triplet second.					aMenu balloonTextForLastItem: triplet third]]. 	aMenu addUpdating: #autoViewingString action: #toggleAutomaticViewing.	aMenu balloonTextForLastItem:  'governs whether, when an object is touched inside me, a viewer should automatically be launched for it.' translated.	((isWorld not or: [self backgroundSketch notNil]) or: [presenter isNil])		ifTrue:			[aMenu addLine].	isWorld ifFalse:		[aMenu add: 'set thumbnail height...' translated action: #setThumbnailHeight.		aMenu balloonTextForLastItem: 'if currently showing thumbnails governs the standard height for them' translated.		aMenu add: 'behave like a Holder' translated action: #becomeLikeAHolder.		aMenu balloonTextForLastItem: 'Set properties to make this object nicely set up to hold frames of a scripted animation.' translated].	self backgroundSketch ifNotNil:		[aMenu add: 'delete background painting' translated action: #deleteBackgroundPainting.		aMenu balloonTextForLastItem: 'delete the graphic that forms the background for this me.' translated].	presenter ifNil:		[aMenu add: 'make detachable' translated action: #makeDetachable.		aMenu balloonTextForLastItem: 'Allow this area to be separately governed by its own controls.' translated].	aMenu addLine.	aMenu add: 'use standard texture' translated action: #setStandardTexture.	aMenu balloonTextForLastItem: 'use a pale yellow-and-blue background texture here.' translated.	aMenu add: 'make graph paper...' translated action: #makeGraphPaper.	aMenu balloonTextForLastItem: 'Design your own graph paper and use it as the background texture here.' translated.	aMenu addTitle: 'playfield options...' translated.	^ aMenu! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 18:04'!presentViewMenu	"Answer an auxiliary menu with options specific to viewing playfields -- this is put up from the provisional 'view' halo handle, on pasteup morphs only."	| aMenu isWorld |	isWorld _ self isWorldMorph.	aMenu _ MenuMorph new defaultTarget: self.	aMenu addStayUpItem.	self addViewingItemsTo: aMenu.	#(	"(autoLineLayoutString	toggleAutoLineLayout			'whether submorphs should automatically be laid out in lines')"		(indicateCursorString	toggleIndicateCursor			'whether the "current" submorph should be indicated with a dark black border')		(resizeToFitString		toggleResizeToFit			'whether I should automatically strive exactly to fit my contents')		(behaveLikeAHolderString	toggleBehaveLikeAHolder			'whether auto-line-layout, resize-to-fit, and indicate-cursor should be set to true; useful for animation control, etc.')		(isPartsBinString		toggleIsPartsBin			'whether dragging an object from the interior should produce a COPY of the object')		(isOpenForDragNDropString	toggleDragNDrop			'whether objects can be dropped into and dragged out of me')		(mouseOverHalosString	toggleMouseOverHalos			'whether objects should put up halos when the mouse is over them')		(autoExpansionString	toggleAutomaticPhraseExpansion			'whether tile phrases, dropped on me, should automatically sprout Scriptors around them')		(originAtCenterString	toggleOriginAtCenter			'whether the cartesian origin of the playfield should be at its lower-left corner or at the center of the playfield')		(showThumbnailString	toggleAlwaysShowThumbnail			'whether large objects should be represented by thumbnail miniatures of themselves')		(fenceEnabledString	toggleFenceEnabled			'whether moving objects should stop at the edge of their container')		(autoViewingString		toggleAutomaticViewing			'governs whether, when an object is touched inside me, a viewer should automatically be launched for it.')		(griddingString			griddingOnOff			'whether gridding should be used in my interior')		(gridVisibleString		gridVisibleOnOff			'whether the grid should be shown when gridding is on')	) do:			[:triplet |				(isWorld and: [#(toggleAutoLineLayout toggleIndicateCursor toggleIsPartsBin toggleAlwaysShowThumbnail toggleAutomaticViewing ) includes: triplet second]) ifFalse:					[aMenu addUpdating: triplet first action: triplet second.					aMenu balloonTextForLastItem: triplet third translated]]. 	aMenu addLine.	aMenu add: 'round up strays' translated action: #roundUpStrays.	aMenu balloonTextForLastItem:  'Bring back all objects whose current coordinates keep them from being visible, so that at least a portion of each of my interior objects can be seen.' translated.	aMenu add: 'shuffle contents' translated action: #shuffleSubmorphs.	aMenu balloonTextForLastItem: 'Rearranges my contents in random order' translated.	aMenu add: 'set grid spacing...' translated action: #setGridSpec.	aMenu balloonTextForLastItem: 'Set the spacing to be used when gridding is on' translated.	isWorld ifFalse:		[aMenu add: 'set thumbnail height...' translated action: #setThumbnailHeight.		aMenu balloonTextForLastItem: 'if currently showing thumbnails governs the standard height for them' translated].	self backgroundSketch ifNotNil:		[aMenu add: 'delete background painting' translated action: #deleteBackgroundPainting.		aMenu balloonTextForLastItem: 'delete the graphic that forms the background for this me.' translated].	aMenu addLine.	self addPenTrailsMenuItemsTo: aMenu.	aMenu addLine.	aMenu add: 'use standard texture' translated action: #setStandardTexture.	aMenu balloonTextForLastItem: 'use a pale yellow-and-blue background texture here.' translated.	aMenu add: 'make graph paper...' translated action: #makeGraphPaper.	aMenu balloonTextForLastItem: 'Design your own graph paper and use it as the background texture here.' translated.	aMenu addTitle: ('viewing options for "{1}"' translated format: {self externalName}).	aMenu popUpForHand: self activeHand in: self world! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'sd 11/13/2003 21:26'!saveOnFile	"Ask the user for a filename and save myself on a SmartReferenceStream file.  Writes out the version and class structure.  The file is fileIn-able.  UniClasses will be filed out."	| aFileName fileStream ok |	self flag: #bob0302.	self isWorldMorph ifTrue: [^self project saveAs].	aFileName _ ('my {1}' translated format: {self class name}) asFileName.	"do better?"	aFileName _ FillInTheBlank request: 'File name? (".project" will be added to end)' translated 			initialAnswer: aFileName.	aFileName isEmpty ifTrue: [^ Beeper beep].	self allMorphsDo: [:m | m prepareToBeSaved].	ok _ aFileName endsWith: '.project'.	"don't double them"	ok _ ok | (aFileName endsWith: '.sp').	ok ifFalse: [aFileName _ aFileName,'.project'].	fileStream _ FileStream newFileNamed: aFileName.	fileStream fileOutClass: nil andObject: self.	"Puts UniClass definitions out anyway"! !!PasteUpMorph methodsFor: 'menu & halo' stamp: 'dgd 9/6/2003 18:00'!showThumbnailString	"Answer the string to be shown in a menu to represent the 	show-thumbnails status"	^ ((self hasProperty: #alwaysShowThumbnail)		ifTrue: ['<on>']		ifFalse: ['<off>']), 'show thumbnails' translated! !!PasteUpMorph methodsFor: 'misc' stamp: 'dgd 8/30/2003 15:52'!innocuousName	^ (self isFlap)		ifTrue:			['flap' translated]		ifFalse:			[super innocuousName]! !!PasteUpMorph methodsFor: 'options' stamp: 'dgd 9/6/2003 17:55'!becomeLikeAHolder	(self autoLineLayout			and: [self indicateCursor])		ifTrue: [^ self inform: 'This view is ALREADYbehaving like a holder, whichis to say, it is set to indicate thecursor and to have auto-line-layout.' translated].	self behaveLikeHolder! !!PasteUpMorph methodsFor: 'options' stamp: 'dgd 9/6/2003 18:05'!setThumbnailHeight	|  reply |	(self hasProperty: #alwaysShowThumbnail) ifFalse:		[^ self inform: 'setting the thumbnail height is onlyapplicable when you are currentlyshowing thumbnails.' translated].	reply _ FillInTheBlank		request: 'New height for thumbnails? ' translated		initialAnswer: self heightForThumbnails printString.	reply isEmpty ifTrue: [^ self].	reply _ reply asNumber.	(reply > 0 and: [reply <= 150]) ifFalse:		[^ self inform: 'Please be reasonable!!' translated].	self setProperty: #heightForThumbnails toValue: reply.	self updateSubmorphThumbnails! !!PasteUpMorph methodsFor: 'scripting' stamp: 'dgd 8/31/2003 19:39'!modernizeBJProject	"Prepare a kids' project from the BJ fork of September 2000 -- a once-off thing for converting such projects forward to a modern 3.1a image, in July 2001.  Except for the #enableOnlyGlobalFlapsWithIDs: call, this could conceivably be called upon reloading *any* project, just for safety."	"ActiveWorld modernizeBJProject"	ScriptEditorMorph allInstancesDo:		[:m | m userScriptObject].	Flaps enableOnlyGlobalFlapsWithIDs: {'Supplies' translated}.	ActiveWorld abandonOldReferenceScheme.	ActiveWorld relaunchAllViewers.! !!PasteUpMorph methodsFor: 'viewing' stamp: 'dgd 9/6/2003 17:50'!viewingByIconString	"Answer a string to show in a menu representing whether the 	receiver is currently viewing its subparts by icon or not"	^ ((self showingListView			or: [self autoLineLayout == true])		ifTrue: ['<no>']		ifFalse: ['<yes>']), 'view by icon' translated! !!PasteUpMorph methodsFor: 'viewing' stamp: 'dgd 9/6/2003 17:50'!viewingByNameString	"Answer a string to show in a menu representing whether the 	receiver is currently viewing its subparts by name or not"	^ ((self showingListView			and: [(self					valueOfProperty: #sortOrder					ifAbsent: [])					== #downshiftedNameOfObjectRepresented])		ifTrue: ['<yes>']		ifFalse: ['<no>']), 'view by name' translated! !!PasteUpMorph methodsFor: 'viewing' stamp: 'dgd 9/6/2003 17:50'!viewingBySizeString	"Answer a string to show in a menu representing whether the 	receiver is currently viewing its subparts by size or not"	^ ((self showingListView			and: [(self					valueOfProperty: #sortOrder					ifAbsent: [])					== #reportableSize])		ifTrue: ['<yes>']		ifFalse: ['<no>']), 'view by size' translated! !!PasteUpMorph methodsFor: 'viewing' stamp: 'dgd 9/6/2003 17:51'!viewingNonOverlappingString	"Answer a string to show in a menu representing whether the 	receiver is currently viewing its subparts by 	non-overlapping-icon (aka auto-line-layout)"	^ ((self showingListView			or: [self autoLineLayout ~~ true])		ifTrue: ['<no>']		ifFalse: ['<yes>']), 'view with line layout' translated! !!PasteUpMorph methodsFor: 'world menu' stamp: 'dgd 9/21/2003 17:39'!closeUnchangedWindows	"Present a menu of window titles for all windows with changes,	and activate the one that gets chosen."	(SelectionMenu confirm:'Do you really want to close all windowsexcept those with unaccepted edits?' translated)		ifFalse: [^ self].	(SystemWindow windowsIn: self satisfying: [:w | w model canDiscardEdits])		do: [:w | w delete]! !!PasteUpMorph methodsFor: 'world menu' stamp: 'dgd 9/21/2003 17:40'!deleteNonWindows	(SelectionMenu confirm:'Do you really want to discard all objectsthat are not in windows?' translated)		ifFalse: [^ self].	self allNonFlapRelatedSubmorphs do:		[:m | m delete]! !!PasteUpMorph methodsFor: 'world menu' stamp: 'sd 11/13/2003 21:25'!findWindow: evt	"Present a menu names of windows and naked morphs, and activate the one that gets chosen.  Collapsed windows appear below line, expand if chosen; naked morphs appear below second line; if any of them has been given an explicit name, that is what's shown, else the class-name of the morph shows; if a naked morph is chosen, bring it to front and have it don a halo."	| menu expanded collapsed nakedMorphs |	menu _ MenuMorph new.	expanded _ SystemWindow windowsIn: self satisfying: [:w | w isCollapsed not].	collapsed _ SystemWindow windowsIn: self satisfying: [:w | w isCollapsed].	nakedMorphs _ self submorphsSatisfying:		[:m | (m isSystemWindow not and: [(m isKindOf: StickySketchMorph) not]) and:			[(m isFlapTab) not]].	(expanded isEmpty & (collapsed isEmpty & nakedMorphs isEmpty)) ifTrue: [^ Beeper beep].	(expanded asSortedCollection: [:w1 :w2 | w1 label caseInsensitiveLessOrEqual: w2 label]) do:		[:w | menu add: w label target: w action: #activateAndForceLabelToShow.			w model canDiscardEdits ifFalse: [menu lastItem color: Color red]].	(expanded isEmpty | (collapsed isEmpty & nakedMorphs isEmpty)) ifFalse: [menu addLine].	(collapsed asSortedCollection: [:w1 :w2 | w1 label caseInsensitiveLessOrEqual: w2 label]) do: 		[:w | menu add: w label target: w action: #collapseOrExpand.		w model canDiscardEdits ifFalse: [menu lastItem color: Color red]].	nakedMorphs isEmpty ifFalse: [menu addLine].	(nakedMorphs asSortedCollection: [:w1 :w2 | w1 nameForFindWindowFeature caseInsensitiveLessOrEqual: w2 nameForFindWindowFeature]) do:		[:w | menu add: w nameForFindWindowFeature target: w action: #comeToFrontAndAddHalo].	menu addTitle: 'find window' translated.		menu popUpEvent: evt in: self.! !!PasteUpMorph methodsFor: 'world menu' stamp: 'dgd 8/26/2003 21:10'!putUpDesktopMenu: evt	"Put up the desktop menu"	^ ((self buildWorldMenu: evt) addTitle: Preferences desktopMenuTitle translated) popUpAt: evt position forHand: evt hand in: self! !!PasteUpMorph methodsFor: 'world menu' stamp: 'dgd 8/26/2003 21:10'!putUpWorldMenu: evt	"Put up a menu in response to a click on the desktop, triggered by evt."	| menu |	self bringFlapTabsToFront.	evt isMouse ifTrue:		[evt yellowButtonPressed			ifTrue: [^ self yellowButtonClickOnDesktopWithEvent: evt].		evt shiftPressed ifTrue:[^ self findWindow: evt]].	"put up screen menu"	menu _ self buildWorldMenu: evt.	menu addTitle: Preferences desktopMenuTitle translated.	menu popUpEvent: evt in: self.	^ menu! !!PasteUpMorph methodsFor: 'world menu' stamp: 'dgd 9/19/2003 11:22'!yellowButtonClickOnDesktopWithEvent: evt 	"Put up either the personalized menu or the world menu when 	the user clicks on the morphic desktop with the yellow button. 	The preference 'personalizedWorldMenu' governs which one 	is used"	| aMenu |	Preferences personalizedWorldMenu		ifTrue: [aMenu := MenuMorph new defaultTarget: self.			Preferences personalizeUserMenu: aMenu.			aMenu addLine.			aMenu				add: 'personalize...' translated				target: Preferences				action: #letUserPersonalizeMenu]		ifFalse: [aMenu := self buildWorldMenu: evt.			aMenu addTitle: 'World' translated].	aMenu popUpEvent: evt in: self! !!ComponentLayout methodsFor: 'menus' stamp: 'dgd 8/30/2003 21:17'!addCustomMenuItems: menu hand: aHandMorph	super addCustomMenuItems: menu hand: aHandMorph.	menu addLine.	menu add: 'inspect model in morphic' translated action: #inspectModelInMorphic! !!PartsBin methodsFor: 'initialization' stamp: 'dgd 8/31/2003 18:46'!listDirection: aListDirection quadList: quadList	"Initialize the receiver to run horizontally or vertically, obtaining its elements from the list of tuples of the form:		(<receiver> <selector> <label> <balloonHelp>)"	| aButton aClass |	self layoutPolicy: TableLayout new.	self listDirection: aListDirection.	self wrapCentering: #topLeft.	self layoutInset: 2.	self cellPositioning: #bottomCenter.	aListDirection == #leftToRight		ifTrue:			[self vResizing: #rigid.			self hResizing: #spaceFill.			self wrapDirection: #topToBottom]		ifFalse:			[self hResizing: #rigid.			self vResizing: #spaceFill.			self wrapDirection: #leftToRight].	quadList do:		[:tuple |			aClass _ Smalltalk at: tuple first.			aButton _ IconicButton new initializeWithThumbnail: (self class thumbnailForQuad: tuple) withLabel: tuple third translated andSend: tuple second to: aClass.			(tuple size > 3 and: [tuple fourth isEmptyOrNil not]) ifTrue:				[aButton setBalloonText: tuple fourth translated]. 			self addMorphBack: aButton]! !!PartsBin methodsFor: 'properties' stamp: 'dgd 8/30/2003 15:52'!innocuousName	"Answer a harmless name for an unnamed instance"	^ 'parts bin' translated! !!PhraseTileMorph methodsFor: 'miscellaneous' stamp: 'dgd 8/30/2003 21:56'!addCustomMenuItems:  aMenu hand: aHand	"Add additional items to the halo manu"	super addCustomMenuItems: aMenu hand: aHand.	aMenu add: 'Sprout a new scriptor around this phrase' translated target: self action: #sproutNewScriptor! !!PianoRollScoreMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:56'!addCustomMenuItems: aMenu hand: aHandMorph	super addCustomMenuItems: aMenu hand: aHandMorph.	aMenu add: 'expand time' translated action: #expandTime.	aMenu add: 'contract time' translated action: #contractTime.	aMenu addLine.	aMenu add: 'add movie clip player' translated action: #addMovieClipPlayer.	(self valueOfProperty: #dragNDropEnabled) == true		ifTrue: [aMenu add: 'close drag and drop' translated action: #disableDragNDrop]		ifFalse: [aMenu add: 'open drag and drop' translated action: #enableDragNDrop].! !!Player methodsFor: 'misc' stamp: 'dgd 9/6/2003 17:22'!offerAlternateViewerMenuFor: aViewer event: evt	"Put up an alternate Viewer menu on behalf of the receiver."	| aMenu aWorld  |	aWorld _ aViewer world.	aMenu _ MenuMorph new defaultTarget: self.	costumes ifNotNil:		[(costumes size > 1 or: [costumes size == 1 and: [costumes first ~~ costume renderedMorph]])			ifTrue:				[aMenu add: 'forget other costumes' translated target: self selector: #forgetOtherCostumes]].	aMenu add: 'expunge empty scripts' translated target: self action: #expungeEmptyScripts.	aMenu addLine.	aMenu add: 'choose vocabulary...' translated target: aViewer action: #chooseVocabulary.	aMenu balloonTextForLastItem: 'Choose a different vocabulary for this Viewer.' translated.	aMenu add: 'choose limit class...' translated target: aViewer action: #chooseLimitClass.	aMenu balloonTextForLastItem: 'Specify what the limitClass should be for this Viewer -- i.e., the most generic class whose methods and categories should be considered here.' translated.	aMenu add: 'open standard lexicon' translated target: aViewer action: #openLexicon.	aMenu balloonTextForLastItem: 'open a window that shows the code for this object in traditional programmer format' translated.	aMenu add: 'open lexicon with search pane' translated target: aViewer action: #openSearchingProtocolBrowser.	aMenu balloonTextForLastItem: 'open a lexicon that has a type-in pane for search (not recommended!!)' translated.	aMenu addLine.	aMenu add: 'inspect morph' translated target: costume selector: #inspect.	aMenu add: 'inspect player' translated target: self selector: #inspect.	self belongsToUniClass ifTrue:		[aMenu add: 'browse class' translated target: self action: #browsePlayerClass.		aMenu add: 'inspect class' translated target: self class action: #inspect].	aMenu add: 'inspect this Viewer' translated target: aViewer selector: #inspect.	aMenu add: 'inspect this Vocabulary' translated target: aViewer currentVocabulary selector: #inspect.	aMenu addLine.	aMenu add: 'relaunch this Viewer' translated target: aViewer action: #relaunchViewer.	aMenu add: 'view morph directly' translated target: aViewer action: #viewMorphDirectly.	aMenu balloonTextForLastItem: 'opens a Viewer directly on the rendered morph.' translated.	(costume renderedMorph isKindOf: SketchMorph) ifTrue:		[aMenu addLine.		aMenu add: 'impart scripts to...' translated target: self action: #impartSketchScripts].	aMenu popUpEvent: evt in: aWorld! !!Player methodsFor: 'misc' stamp: 'dgd 9/6/2003 17:21'!offerViewerMenuFor: aViewer event: evt	"Put up the Viewer menu on behalf of the receiver.  If the shift key is held down, put up the alternate menu."	| aMenu aWorld  |	(evt notNil and: [evt shiftPressed]) ifTrue:		[^ self offerAlternateViewerMenuFor: aViewer event: evt].	aWorld _ aViewer world.	aMenu _ MenuMorph new defaultTarget: self.	aMenu add: 'add a new instance variable' translated target: self action: #addInstanceVariable.	aMenu balloonTextForLastItem: 'Add a new instance variable to this object and all of its siblings.  You will be asked to supply a name for it.' translated.	aMenu add: 'add a new script' translated target: aViewer action: #newPermanentScript.	aMenu balloonTextForLastItem: 'Add a new script that will work for this object and all of its siblings' translated.	aMenu addLine.	aMenu add: 'grab me' translated target: self selector: #grabPlayerIn: argument: aWorld.	aMenu balloonTextForLastItem: 'This will actually pick up the object this Viewer is looking at, and hand it to you.  Click the (left) button to drop it' translated.	aMenu add: 'reveal me' translated target: self selector: #revealPlayerIn: argument: aWorld.	aMenu balloonTextForLastItem: 'If you have misplaced the object that this Viewer is looking at, use this item to (try to) make it visible' translated.	aMenu addLine.	aMenu add: 'tile representing me' translated action: #tearOffTileForSelf.	aMenu add: 'add search pane' translated target: aViewer action: #addSearchPane.	aMenu addLine.	aMenu add: 'more...' translated target: self selector: #offerAlternateViewerMenuFor:event: argumentList: {aViewer. evt}.	aMenu popUpEvent: evt in: aWorld! !!Player methodsFor: 'misc' stamp: 'dgd 9/1/2003 14:17'!unusedScriptName	"answer a name of the form 'scriptN', where N is one higher than the highest-numbered similarly-named script"	| highestThus aPair |	highestThus _ 0.	self class tileScriptNames do:		[:aName |			aPair _ (aName copyWithout: $:) stemAndNumericSuffix.			aPair first = 'script' translated ifTrue: [highestThus _ highestThus max: aPair last]].	^ ('script' translated, (highestThus + 1) printString) asSymbol! !!Player methodsFor: 'scripts-kernel' stamp: 'dgd 9/1/2003 14:17'!isExpendableScript: aScriptName	^ (self isEmptyTileScript: aScriptName) and:		[aScriptName beginsWith: 'script' translated]! !!Player methodsFor: 'scripts-kernel' stamp: 'dgd 10/8/2003 19:41'!slotInfoButtonHitFor: aGetterSymbol inViewer: aViewer	"The user made a gesture asking for slot menu for the given getter symbol in a viewer; put up the menu."	| aMenu slotSym aType typeVocab |	slotSym _ Utilities inherentSelectorForGetter: aGetterSymbol.	aType _ self typeForSlotWithGetter: aGetterSymbol asSymbol.	aMenu _ MenuMorph new defaultTarget: self.	aMenu addTitle: (slotSym asString, ' (', aType, ')').	(typeVocab _ Vocabulary vocabularyForType: aType) addWatcherItemsToMenu: aMenu forGetter: aGetterSymbol.	(self slotInfo includesKey: slotSym)		ifTrue:			[aMenu add: 'change data type' translated selector: #chooseSlotTypeFor: argument: aGetterSymbol.			typeVocab addUserSlotItemsTo: aMenu slotSymbol: slotSym.			aMenu add: ('remove "{1}"' translated format: {slotSym}) selector: #removeSlotNamed: argument: slotSym.			aMenu add: ('rename "{1}"' translated format: {slotSym}) selector: #renameSlot: argument: slotSym.			aMenu addLine].	typeVocab addExtraItemsToMenu: aMenu forSlotSymbol: slotSym.  "e.g. Player type adds hand-me-tiles"	aMenu add: 'show categories....' translated target: aViewer selector: #showCategoriesFor: argument: aGetterSymbol.	self addIdiosyncraticMenuItemsTo: aMenu forSlotSymol: slotSym.	aMenu items isEmpty ifTrue:		[aMenu add: 'ok' translated action: #yourself].	aMenu popUpForHand: aViewer primaryHand in: aViewer world! !!MouseDownMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:54'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph."template..."	aCustomMenu addLine.	aCustomMenu add: 'set variable name...' translated action: #renameMe.	aCustomMenu addLine.	aCustomMenu add: 'plug mouseDown to model slot' translated action: #plugMouseDownToSlot.	aCustomMenu add: 'plug mouseMove to model slot' translated action: #plugMouseMoveToSlot.	aCustomMenu add: 'plug all to model slots' translated action: #plugAllToSlots.	aCustomMenu addLine.	aCustomMenu add: 'plug mouseDown to model' translated action: #plugMouseDownToModel.	aCustomMenu add: 'plug mouseMove to model' translated action: #plugMouseMoveToModel.	aCustomMenu add: 'plug all to model' translated action: #plugAllToModel.	aCustomMenu addLine.	aCustomMenu add: 'set target...' translated action: #setTarget.	aCustomMenu add: 'set mouseDown selector...' translated action: #setMouseDownSelector.	aCustomMenu add: 'set mouseMove selector...' translated action: #setMouseMoveSelector.	aCustomMenu add: 'set mouseUp selector...' translated action: #setMouseUpSelector.! !!PlayerType methodsFor: 'tiles' stamp: 'dgd 9/6/2003 20:30'!addExtraItemsToMenu: aMenu forSlotSymbol: slotSym	"If the receiver has extra menu items to add to the slot menu, here is its chance to do it"	aMenu add: 'tiles to get...' translated selector: #offerGetterTiles: argument: slotSym! !!PluggableTextController methodsFor: 'as yet unclassified' stamp: 'dgd 9/21/2003 17:47'!accept 	view hasUnacceptedEdits ifFalse: [^ view flash].	view hasEditingConflicts ifTrue:		[(self confirm: 'Caution!! This method may have beenchanged elsewhere since you startedediting it here.  Accept anyway?' translated) ifFalse: [^ self flash]].	(view setText: paragraph text from: self) ifTrue:		[initialText _ paragraph text copy.		view ifNotNil: [view hasUnacceptedEdits: false]]    .! !!PolygonMorph methodsFor: 'access' stamp: 'dgd 8/30/2003 21:57'!openOrClosePhrase	| curveName |	curveName := (self isCurve				ifTrue: ['curve']				ifFalse: ['polygon']) translated.	^ closed		ifTrue: ['make open ' translated , curveName]		ifFalse: ['make closed ' translated, curveName]! !!PolygonMorph methodsFor: 'menu' stamp: 'dgd 9/5/2003 19:29'!addCustomMenuItems: aMenu hand: aHandMorph	| lineName |	super addCustomMenuItems: aMenu hand: aHandMorph.	aMenu addUpdating: #handlesShowingPhrase target: self action: #showOrHideHandles.	vertices size > 2 ifTrue:		[aMenu addUpdating: #openOrClosePhrase target: self action: #makeOpenOrClosed.		lineName _ (closed ifTrue: ['outline'] ifFalse: ['line']) translated.		self isCurve			ifTrue: [aMenu add: 'make segmented ' translated, lineName action: #toggleSmoothing]			ifFalse: [aMenu add: 'make smooth ' translated, lineName action: #toggleSmoothing]]. 	aMenu add: 'specify dashed line' translated action:  #specifyDashedLine.	self isOpen ifTrue:		[aMenu addLine.		aMenu addWithLabel: '---' enablement: [self isOpen and: [arrows ~~ #none]] action:  #makeNoArrows.		aMenu addWithLabel: '-->' enablement: [self isOpen and: [arrows ~~ #forward]] action:  #makeForwardArrow.		aMenu addWithLabel: '<--' enablement: [self isOpen and: [arrows ~~ #back]] action:  #makeBackArrow.		aMenu addWithLabel: '<->' enablement: [self isOpen and: [arrows ~~ #both]] action:  #makeBothArrows.		aMenu add: 'customize arrows' translated action: #customizeArrows:.		(self hasProperty: #arrowSpec)			ifTrue: [aMenu add: 'standard arrows' translated action: #standardArrows]].! !!PolygonMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:57'!handlesShowingPhrase	^ (self showingHandles		ifTrue: ['hide handles']		ifFalse: ['show handles']) translated! !!PopUpMenu class methodsFor: 'dialogs' stamp: 'dgd 9/5/2003 18:24'!confirm: queryString	"Put up a yes/no menu with caption queryString. Answer true if the 	response is yes, false if no. This is a modal question--the user must 	respond yes or no."	"PopUpMenu confirm: 'Are you hungry?'"	^ self confirm: queryString trueChoice: 'Yes' translated falseChoice: 'No' translated! !!PopUpMenu class methodsFor: 'dialogs' stamp: 'dgd 9/5/2003 18:23'!confirm: queryString orCancel: cancelBlock	"Put up a yes/no/cancel menu with caption aString. Answer true if  	the response is yes, false if no. If cancel is chosen, evaluate  	cancelBlock. This is a modal question--the user must respond yes or no."	"PopUpMenu confirm: 'Reboot universe' orCancel: [^'Nevermind']"	| menu choice |	menu _ PopUpMenu labelArray: {'Yes' translated. 'No' translated. 'Cancel' translated}.	choice _ menu startUpWithCaption: queryString.	choice = 1 ifTrue: [^ true].	choice = 2 ifTrue: [^ false].	^ cancelBlock value! !!PopUpMenu class methodsFor: 'dialogs' stamp: 'dgd 9/5/2003 18:34'!inform: aString	"PopUpMenu inform: 'I like Squeak'"	(PopUpMenu labels: ' OK ' translated) startUpWithCaption: aString! !!Preferences class methodsFor: 'get/set' stamp: 'dgd 8/31/2003 18:07'!automaticFlapLayoutString	"Answer a string for the automaticFlapLayout menu item"	^ (self automaticFlapLayout		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'automatic flap layout' translated! !!Preferences class methodsFor: 'get/set' stamp: 'dgd 8/31/2003 18:03'!navigatorShowingString	"Answer a string for the show-project-navigator menu item"	^ (self showProjectNavigator		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'show navigator (N)' translated! !!Preferences class methodsFor: 'misc' stamp: 'dgd 9/21/2003 13:51'!menuColorString	^ ((self valueOfFlag: #menuColorFromWorld)		ifTrue: ['stop menu-color-from-world']		ifFalse: ['start menu-color-from-world']) translated! !!Preferences class methodsFor: 'misc' stamp: 'dgd 8/30/2003 20:23'!roundedCornersString	^ ((self valueOfFlag: #roundedWindowCorners)		ifTrue: ['stop']		ifFalse: ['start']) translated , ' rounding window corners'translated! !!Preferences class methodsFor: 'misc' stamp: 'dgd 9/21/2003 13:46'!staggerPolicyString	"Answer the string to be shown in a menu to represent the 	stagger-policy status"	^ ((self valueOfFlag: #reverseWindowStagger)		ifTrue: ['<yes>']		ifFalse: ['<no>']), 'stagger windows' translated! !!Preferences class methodsFor: 'misc' stamp: 'dgd 9/1/2003 11:43'!themeChoiceButtonOfColor: aColor font: aFont	"Answer a button inviting the user to choose a theme"	| aButton |	aButton _ SimpleButtonMorph new target: self; actionSelector: #offerThemesMenu.	aButton label: 'change theme...' translated font: aFont.	aButton color: aColor.	aButton setBalloonText: 'Numerous "Preferences" govern many things about the way Squeak looks and behaves.  Set individual preferences using a "Preferences" panel.  Set an entire "theme" of many Preferences all at the same time by pressing this "change theme" button and choosing a theme to install.  Look in category "themes" in Preferences class to see what each theme does; add your own methods to the "themes" category and they will show up in the list of theme choices.' translated.	^ aButton! !!Preferences class methodsFor: 'personalization' stamp: 'dgd 8/26/2003 21:31'!personalizeUserMenu: aMenu	"The user has clicked on the morphic desktop with the yellow mouse button (option+click on the Mac); a menu is being constructed to present to the user in response; its default target is the current world.  In this method, you are invited to add items to the menu as per personal preferences.	The default implementation, for illustrative purposes, sets the menu title to 'personal', and adds items for go-to-previous-project, show/hide flaps, and load code updates"		aMenu addTitle: 'personal' translated.  "Remove or modify this as per personal choice"	aMenu addStayUpItem.	aMenu add: 'previous project' translated action: #goBack.	aMenu add: 'load latest code updates' translated target: Utilities action: #updateFromServer.	aMenu add: 'about this system...' translated target: Smalltalk action: #aboutThisSystem.	Preferences isFlagship ifTrue:		"For benefit of Alan"		[aMenu addLine.		aMenu add: 'start using vectors' translated target: ActiveWorld action: #installVectorVocabulary.		aMenu add: 'stop using vectors' translated target: ActiveWorld action: #abandonVocabularyPreference].	aMenu addLine.					aMenu addUpdating: #suppressFlapsString target: CurrentProjectRefactoring action: #currentToggleFlapsSuppressed.	aMenu balloonTextForLastItem: 'Whether prevailing flaps should be shown in the project right now or not.' translated! !!ProgressBarMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:43'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addList: {		{'progress color...' translated. #changeProgressColor:}.		{'progress value...' translated. #changeProgressValue:}.		}! !!Project methodsFor: 'menu messages' stamp: 'dgd 8/31/2003 19:37'!navigatorFlapVisible	"Answer whether a Navigator flap is visible"	^ (Flaps sharedFlapsAllowed and: 		[self flapsSuppressed not]) and:			[self isFlapIDEnabled: 'Navigator' translated]! !!Project methodsFor: 'release' stamp: 'dgd 9/21/2003 17:49'!okToChange	"Answer whether the window in which the project is housed can be dismissed -- which is destructive. We never clobber a project without confirmation"	| ok is list |	self subProjects size  >0 ifTrue:		[self inform: ('The project {1}contains sub-projects.  You must remove theseexplicitly before removing their parent.' translated format:{self name}).		^ false].	ok _ world isMorph not and: [world scheduledControllers size <= 1].	ok ifFalse: [self isMorphic ifTrue:		[self parent == CurrentProject 			ifFalse: [^ true]]].  "view from elsewhere.  just delete it."	ok _ (self confirm:('Really delete the project{1}and all its windows?' translated format:{self name})).			ok ifFalse: [^ false].	world isMorph ifTrue:		[Smalltalk at: #WonderlandCameraMorph ifPresent:[:aClass |			world submorphs do:   "special release for wonderlands"						[:m | (m isKindOf: aClass)								and: [m getWonderland release]]].			"Remove Player classes and metaclasses owned by project"			is _ ImageSegment new arrayOfRoots: (Array with: self).			(list _ is rootsIncludingPlayers) ifNotNil:				[list do: [:playerCls | 					(playerCls respondsTo: #isMeta) ifTrue:						[playerCls isMeta ifFalse:							[playerCls removeFromSystemUnlogged]]]]].	self removeChangeSetIfPossible.	"do this last since it will render project inaccessible to #allProjects and their ilk"	ProjectHistory forget: self.	Project deletingProject: self.	^ true! !!Project methodsFor: 'file in/out' stamp: 'dgd 9/21/2003 17:41'!exportSegmentFileName: aFileName directory: aDirectory	| exportChangeSet |	"An experimental version to fileout a changeSet first so that a project can contain its own classes"	"Store my project out on the disk as an *exported* ImageSegment.  Put all outPointers in a form that can be resolved in the target image.  Name it <project name>.extSeg.	Player classes are included automatically."	exportChangeSet _ nil.	(changeSet notNil and: [changeSet isEmpty not]) ifTrue: [		(self confirm: 'Would you like to include all the changes in the change setas part of this publishing operation?' translated) ifTrue: [			exportChangeSet _ changeSet		].	].	^ self 		exportSegmentWithChangeSet: exportChangeSet		fileName: aFileName 		directory: aDirectory! !!Project methodsFor: 'flaps support' stamp: 'dgd 8/31/2003 19:42'!assureFlapIntegrity	"Make certain that the items on the disabled-global-flap list are actually global flaps, and if not, get rid of them.  Also, old (and damaging) parameters that held references to actual disabled flaps are cleansed"	| disabledFlapIDs currentGlobalIDs oldList |	Smalltalk isMorphic ifTrue:		[disabledFlapIDs _ self parameterAt: #disabledGlobalFlapIDs ifAbsent: [Set new].		currentGlobalIDs _ Flaps globalFlapTabsIfAny collect: [:f | f flapID].		oldList _ Project current projectParameterAt: #disabledGlobalFlaps ifAbsent: [nil].		oldList ifNotNil:			[disabledFlapIDs _ oldList collect: [:aFlap | aFlap flapID].			disabledFlapIDs addAll: {'Scripting' translated. 'Stack Tools' translated. 'Painting' translated}].		disabledFlapIDs _ disabledFlapIDs select: [:anID | currentGlobalIDs includes: anID].		self projectParameterAt: #disabledGlobalFlapIDs put: disabledFlapIDs asSet.		self assureNavigatorPresenceMatchesPreference].	projectParameters ifNotNil:		[projectParameters removeKey: #disabledGlobalFlaps ifAbsent: []]! !!ProjectNavigationMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/19/2003 15:23'!makeButton: aString balloonText: anotherString for: aSymbol 	^ SimpleButtonDelayedMenuMorph new target: self;		 borderColor: #raised;		 color: self colorForButtons;		 label: aString translated font: self fontForButtons;		 setBalloonText: anotherString translated;		 actionSelector: aSymbol! !!ProjectNavigationMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/30/2003 21:59'!orientationString	^ (self orientedVertically		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'vertical orientation' translated! !!ProjectNavigationMorph methodsFor: 'the actions' stamp: 'dgd 9/21/2003 17:34'!quitSqueak	(self confirm: 'REALLY quit Squeak?' translated)		ifFalse: [^ self].	Smalltalk snapshot: false andQuit: true! !!ProjectNavigationMorph methodsFor: 'the buttons' stamp: 'dgd 9/1/2003 11:36'!buttonSound	| myButton m |	myButton _ RectangleMorph new 		borderWidth: 1;		cornerStyle: #rounded;		borderColor: #raised;		color: self colorForButtons;		setBalloonText: 'Change sound volume' translated;		on: #mouseDown send: #soundDownEvt:morph: to: self;		on: #mouseStillDown send: #soundStillDownEvt:morph: to: self;		on: #mouseUp send: #soundUpEvt:morph: to: self;		yourself.	myButton addMorph: (m _ self speakerIcon lock).	myButton extent: m extent + (myButton borderWidth + 6).	m position: myButton center - (m extent // 2).	^myButton! !!KidNavigationMorph methodsFor: 'accessing' stamp: 'dgd 8/31/2003 18:39'!balloonText	^ ((mouseInside			ifNil: [false])		ifTrue: ['Click here to see FEWER buttons.']		ifFalse: ['Click here to see MORE buttons.'])  translated! !!ProjectSorterMorph methodsFor: 'as yet unclassified' stamp: 'dgd 10/8/2003 19:44'!addControls	| b r partsBinButton newButton |	newButton _ ImageMorph new image: (World project makeThumbnail scaledToSize: 24@18).	newButton on: #mouseDown send: #insertNewProject: to: self.	newButton setBalloonText: 'Make a new Project' translated.	(partsBinButton _ UpdatingThreePhaseButtonMorph checkBox)		target: self;		actionSelector: #togglePartsBinStatus;		arguments: #();		getSelector: #getPartsBinStatus.	(r _ AlignmentMorph newRow)		color: Color transparent;		borderWidth: 0;		layoutInset: 0;		wrapCentering: #center;		cellPositioning: #topCenter;		hResizing: #shrinkWrap;		vResizing: #shrinkWrap;		extent: 5@5.	b _ SimpleButtonMorph new target: self; color: self defaultColor darker;			borderColor: Color black.	r addMorphBack: (self wrapperFor: (b label: 'Okay' translated;	actionSelector: #acceptSort)).	b _ SimpleButtonMorph new target: self; color: self defaultColor darker;			borderColor: Color black.	r addMorphBack: (self wrapperFor: (b label: 'Cancel' translated;	actionSelector: #delete));		addMorphBack: (self wrapperFor: (newButton));		addTransparentSpacerOfSize: 8 @ 0;		addMorphBack: (self wrapperFor: partsBinButton);		addMorphBack: (self wrapperFor: (StringMorph contents: 'Parts bin' translated) lock).	self addMorphFront: r.! !!ProjectViewMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/21/2003 17:49'!expungeProject	(self confirm: ('Do you really want to delete {1}and all its content?' translated format:{project name})) ifFalse: [^ self].	ProjectHistory forget: project.	Project deletingProject: project.! !!ProjectViewMorph methodsFor: 'events' stamp: 'dgd 8/31/2003 18:40'!balloonText	^ 'Click here to enter theproject named"{1}"' translated format: {project name}! !!RealEstateAgent class methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 19:52'!reduceByFlaps: aScreenRect 	"Return a rectangle that won't interfere with default shared flaps"	Flaps sharedFlapsAllowed ifFalse: [^ aScreenRect copy].	(Flaps globalFlapTabsIfAny allSatisfy:			[:ft | ft flapID = 'Painting' translated or: [ft edgeToAdhereTo == #bottom]])		ifTrue: [^ aScreenRect withHeight: aScreenRect height - 18]		ifFalse: [^ aScreenRect insetBy: 18]! !!RecordingControlsMorph methodsFor: 'button commands' stamp: 'dgd 9/19/2003 12:22'!makeTile	"Make a tile representing my sound.  Get a sound-name from the user by which the sound is to be known"	| newStyleTile sndName tile |	recorder pause.	newStyleTile _ true.	newStyleTile		ifTrue:			[sndName _ FillInTheBlank				request: 'Please enter a name this sound' translated				initialAnswer: 'sound' translated.			sndName isEmpty ifTrue: [^ self].			sndName _ SampledSound unusedSoundNameLike: sndName.			SampledSound				addLibrarySoundNamed: sndName				samples: recorder condensedSamples				samplingRate: recorder samplingRate.			tile _ SoundTile new literal: sndName]		ifFalse:			[tile _ InterimSoundMorph new sound: 				(SampledSound					samples: recorder condensedSamples					samplingRate: recorder samplingRate)].	tile bounds: tile fullBounds.	tile openInHand! !!RecordingControlsMorph methodsFor: 'initialization' stamp: 'dgd 9/19/2003 12:21'!addButtonRows	| r |	r _ AlignmentMorph newRow vResizing: #shrinkWrap.	r addMorphBack: (self buttonName: 'Morph' translated action: #makeSoundMorph).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Tile' translated action: #makeTile).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Trim' translated action: #trim).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Show' translated action: #show).	self addMorphBack: r.	r _ AlignmentMorph newRow vResizing: #shrinkWrap.	r addMorphBack: (self buttonName: 'Record' translated action: #record).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Stop' translated action: #stop).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Play' translated action: #playback).	r addMorphBack: self makeStatusLight.	self addMorphBack: r.! !!ReferenceMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:59'!addCustomMenuItems: aCustomMenu hand: aHandMorph	"Add morph-specific items to the menu for the hand"	| sketch |	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addLine.	self isCurrentlyTextual		ifTrue:			[aCustomMenu add: 'change label wording...' translated action: #changeTabText.			aCustomMenu add: 'use graphical label' translated action: #useGraphicalTab]		ifFalse:			[aCustomMenu add: 'use textual label' translated action: #useTextualTab.			aCustomMenu add: 'choose graphic...' translated action: #changeTabGraphic.			(sketch _ self findA: SketchMorph) ifNotNil:				[aCustomMenu add: 'repaint' translated target: sketch action: #editDrawing]]! !!FlapTab methodsFor: 'access' stamp: 'dgd 8/31/2003 18:58'!acquirePlausibleFlapID	"Give the receiver a flapID that is globally unique; try to hit the mark vis a vis the standard system flap id's, for the case when this method is invoked as part of the one-time transition"	| wording |	wording _ self wording.	(wording isEmpty or: [wording = '---']) ifTrue: [wording _ 'Flap' translated].		^ self provideDefaultFlapIDBasedOn: wording! !!FlapTab methodsFor: 'edge' stamp: 'dgd 8/30/2003 21:24'!edgeString	^ 'cling to edge... (current: {1})' translated format: edgeToAdhereTo! !!FlapTab methodsFor: 'globalness' stamp: 'dgd 8/30/2003 21:36'!isGlobalFlapString	"Answer a string to construct a menu item representing control 	over whether the receiver is or is not a shared flap"	^ (self isGlobalFlap		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'shared by all projects' translated! !!FlapTab methodsFor: 'graphical tabs' stamp: 'dgd 8/30/2003 21:29'!graphicalTabString	^ (self isCurrentlyGraphical		ifTrue: ['choose new graphic...']		ifFalse: ['use graphical tab']) translated! !!FlapTab methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:21'!addCustomMenuItems: aMenu hand: aHandMorph	"Add further items to the menu as appropriate"	aMenu add: 'tab color...' translated target: self action: #changeColor.	aMenu add: 'flap color...' translated target: self action: #changeFlapColor.	aMenu addLine.	aMenu addUpdating: #edgeString action: #setEdgeToAdhereTo.	aMenu addLine.	aMenu addUpdating: #textualTabString action: #textualTab.	aMenu addUpdating: #graphicalTabString action: #graphicalTab.	aMenu addUpdating: #solidTabString enablement: #notSolid action: #solidTab.	aMenu addLine.	(referent isKindOf: PasteUpMorph) ifTrue: 		[aMenu addUpdating: #partsBinString action: #togglePartsBinMode].	aMenu addUpdating: #dragoverString action: #toggleDragOverBehavior.	aMenu addUpdating: #mouseoverString action: #toggleMouseOverBehavior.	aMenu addLine.	aMenu addUpdating: #isGlobalFlapString enablement: #sharedFlapsAllowed action: #toggleIsGlobalFlap.	aMenu balloonTextForLastItem: 'If checked, this flap will be available in all morphic projects; if not, it will be private to this project.,' translated.	aMenu addLine.	aMenu add: 'destroy this flap' translated action: #destroyFlap.	"aMenu addUpdating: #slideString action: #toggleSlideBehavior.	aMenu addUpdating: #inboardString action: #toggleInboardness.	aMenu addUpdating: #thicknessString ('thickness... (current: ', self thickness printString, ')') action: #setThickness."! !!FlapTab methodsFor: 'menu' stamp: 'dgd 9/21/2003 17:55'!changeColor	self isCurrentlyGraphical		ifTrue:			[^ self inform: 'Color only pertains to a flap tab when the tab is textual or "solid".  This tab iscurrently graphical, so color-choicedoes not apply.' translated].	super changeColor	! !!FlapTab methodsFor: 'menu' stamp: 'dgd 9/21/2003 17:55'!changeFlapColor	(self flapShowing)		ifTrue:			[referent changeColor]		ifFalse:			[self inform: 'The flap itself needs to be openbefore you can change itscolor.' translated]! !!FlapTab methodsFor: 'menu' stamp: 'dgd 9/5/2003 18:25'!destroyFlap	"Destroy the receiver"	| reply request |	request _ self isGlobalFlap		ifTrue:			['Caution -- this would permanentlyremove this flap, so it would no longer beavailable in this or any other project.Do you really want to this? ']		ifFalse:			['Caution -- this is permanent!!  Doyou really want to do this? '].	reply _ self confirm: request translated orCancel: [^ self].	reply ifTrue:		[self isGlobalFlap			ifTrue:				[Flaps removeFlapTab: self keepInList: false.				self currentWorld reformulateUpdatingMenus]			ifFalse:				[referent isInWorld ifTrue: [referent delete].				self delete]]! !!FlapTab methodsFor: 'miscellaneous' stamp: 'dgd 8/31/2003 18:43'!balloonTextForFlapsMenu	"Answer the balloon text to show on a menu item in the flaps menu that governs the visibility of the receiver in the current project"	| id |	id _ self flapID.	#(	('Squeak'		'Has a few generally-useful controls; it is also a place where you can "park" objects')	('Tools'			'A quick way to get browsers, change sorters, file lists, etc.')	('Widgets'		'A variety of controls and media tools')	('Supplies' 		'A source for many basic types of objects')	('Stack Tools' 	'Tools for building stacks.  Caution!!  Powerful but young and underdocumented')	('Scripting'		'Tools useful when doing tile scripting')	('Navigator'		'Project navigator:  includes controls for navigating through linked projects.  Also supports finding, loading and publishing projects in a shared environment')	('Painting'		'A flap housing the paint palette.  Click on the closed tab to make make a new painting')) do:		[:pair | (FlapTab givenID: id matches: pair first translated) ifTrue: [^ pair second translated]].	^ self balloonText! !!FlapTab methodsFor: 'mouseover & dragover' stamp: 'dgd 8/30/2003 21:32'!dragoverString	"Answer the string to be shown in a menu to represent the 	dragover status"	^ (popOutOnDragOver		ifTrue: ['<yes>']		ifFalse: ['<no>']), 'pop out on dragover' translated! !!FlapTab methodsFor: 'mouseover & dragover' stamp: 'dgd 8/30/2003 21:36'!mouseoverString	"Answer the string to be shown in a menu to represent the  	mouseover status"	^ (popOutOnMouseOver		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'pop out on mouseover' translated ! !!FlapTab methodsFor: 'parts bin' stamp: 'dgd 8/30/2003 21:31'!partsBinString	"Answer the string to be shown in a menu to represent the 	parts-bin status"	^ (referent isPartsBin		ifTrue: ['<yes>']		ifFalse: ['<no>']), 'parts-bin' translated! !!FlapTab methodsFor: 'solid tabs' stamp: 'dgd 8/30/2003 21:31'!solidTabString	^ (self isCurrentlySolid		ifTrue: ['currently using solid tab']		ifFalse: ['use solid tab']) translated! !!FlapTab methodsFor: 'textual tabs' stamp: 'dgd 8/30/2003 21:27'!textualTabString	^ (self isCurrentlyTextual		ifTrue: ['change tab wording...']		ifFalse: ['use textual tab']) translated! !!FlapTab methodsFor: 'textual tabs' stamp: 'dgd 10/8/2003 19:03'!useTextualTab	| stringToUse colorToUse |	self preserveDetails.	colorToUse _ self valueOfProperty: #priorColor ifAbsent: [Color green muchLighter].	submorphs notEmpty ifTrue: [self removeAllMorphs].	stringToUse _ self valueOfProperty: #priorWording ifAbsent: ['Unnamed Flap' translated].	self assumeString: stringToUse font:  Preferences standardFlapFont orientation: self orientation color: colorToUse! !!ScorePlayerMorph methodsFor: 'initialization' stamp: 'dgd 9/19/2003 12:51'!openMIDIFile	"Open a MIDI score and re-init controls..."	| score fileName f player |	fileName _ Utilities chooseFileWithSuffixFromList: #('.mid' '.midi')					withCaption: 'Choose a MIDI file to open' translated.	(fileName isNil or: [ fileName == #none ])		ifTrue: [^ self inform: 'No .mid/.midi files found in the Squeak directory' translated].	f _ FileStream readOnlyFileNamed: fileName.	score _ (MIDIFileReader new readMIDIFrom: f binary) asScore.	f close.	player _ ScorePlayer onScore: score.	self onScorePlayer: player title: fileName! !!ScorePlayerMorph methodsFor: 'layout' stamp: 'dgd 9/19/2003 12:50'!makeControls	| bb r reverbSwitch repeatSwitch |	r _ AlignmentMorph newRow.	r color: color; borderWidth: 0; layoutInset: 0.	r hResizing: #shrinkWrap; vResizing: #shrinkWrap; extent: 5@5.	bb _ SimpleButtonMorph new target: self; borderColor: #raised;			borderWidth: 2; color: color.	r addMorphBack: (bb label: '<>'; actWhen: #buttonDown;												actionSelector: #invokeMenu).	bb _ SimpleButtonMorph new target: self; borderColor: #raised;			borderWidth: 2; color: color.	r addMorphBack: (bb label: 'Piano Roll' translated;		actionSelector: #makePianoRoll).	bb _ SimpleButtonMorph new target: self; borderColor: #raised;			borderWidth: 2; color: color.	r addMorphBack: (bb label: 'Rewind' translated;		actionSelector: #rewind).	bb _ SimpleButtonMorph new target: scorePlayer; borderColor: #raised;			borderWidth: 2; color: color.	r addMorphBack: (bb label: 'Play' translated;			actionSelector: #resumePlaying).	bb _ SimpleButtonMorph new target: scorePlayer; borderColor: #raised;			borderWidth: 2; color: color.	r addMorphBack: (bb label: 'Pause' translated;			actionSelector: #pause).	reverbSwitch _ SimpleSwitchMorph new		offColor: color;		onColor: (Color r: 1.0 g: 0.6 b: 0.6);		borderWidth: 2;		label: 'Reverb Disable' translated;		actionSelector: #disableReverb:;		target: scorePlayer;		setSwitchState: SoundPlayer isReverbOn not.	r addMorphBack: reverbSwitch.	scorePlayer ifNotNil:		[repeatSwitch _ SimpleSwitchMorph new			offColor: color;			onColor: (Color r: 1.0 g: 0.6 b: 0.6);			borderWidth: 2;			label: 'Repeat' translated;			actionSelector: #repeat:;			target: scorePlayer;			setSwitchState: scorePlayer repeat.		r addMorphBack: repeatSwitch].	^ r! !!ScorePlayerMorph methodsFor: 'layout' stamp: 'dgd 9/19/2003 12:53'!panAndVolControlsFor: trackIndex	| volSlider panSlider c r middleLine pianoRollColor |	pianoRollColor _ (Color wheel: scorePlayer score tracks size) at: trackIndex.	volSlider _ SimpleSliderMorph new		color: color;		sliderColor: pianoRollColor;		extent: 101@2;		target: scorePlayer;		arguments: (Array with: trackIndex);		actionSelector: #volumeForTrack:put:;		minVal: 0.0;		maxVal: 1.0;		adjustToValue: (scorePlayer volumeForTrack: trackIndex).	panSlider _ SimpleSliderMorph new		color: color;		sliderColor: pianoRollColor;		extent: 101@2;		target: scorePlayer;		arguments: (Array with: trackIndex);		actionSelector: #panForTrack:put:;		minVal: 0.0;		maxVal: 1.0;				adjustToValue: (scorePlayer panForTrack: trackIndex).	c _ AlignmentMorph newColumn		color: color;		layoutInset: 0;		wrapCentering: #center; cellPositioning: #topCenter;		hResizing: #spaceFill;		vResizing: #shrinkWrap.	middleLine _ Morph new  "center indicator for pan slider"		color: (Color r: 0.4 g: 0.4 b: 0.4);		extent: 1@(panSlider height - 4);		position: panSlider center x@(panSlider top + 2).	panSlider addMorphBack: middleLine.	r _ self makeRow.	r addMorphBack: (StringMorph contents: '0').	r addMorphBack: volSlider.	r addMorphBack: (StringMorph contents: '10').	c addMorphBack: r.	r _ self makeRow.	r addMorphBack: (StringMorph contents: 'L' translated).	r addMorphBack: panSlider.	r addMorphBack: (StringMorph contents: 'R' translated).	c addMorphBack: r.	^ c! !!ScorePlayerMorph methodsFor: 'layout' stamp: 'dgd 9/19/2003 12:53'!rateControl	| rateSlider middleLine r |	rateSlider _ SimpleSliderMorph new		color: color;		sliderColor: Color gray;		extent: 180@2;		target: self;		actionSelector: #setLogRate:;		minVal: -1.0;		maxVal: 1.0;		adjustToValue: 0.0.	middleLine _ Morph new  "center indicator for pan slider"		color: (Color r: 0.4 g: 0.4 b: 0.4);		extent: 1@(rateSlider height - 4);		position: rateSlider center x@(rateSlider top + 2).	rateSlider addMorphBack: middleLine.	r _ self makeRow		hResizing: #shrinkWrap;		vResizing: #rigid;		height: 24.	r addMorphBack: (StringMorph contents: 'slow ' translated).	r addMorphBack: rateSlider.	r addMorphBack: (StringMorph contents: ' fast' translated).	^ r! !!ScorePlayerMorph methodsFor: 'layout' stamp: 'dgd 9/19/2003 12:53'!scrollControl	| r |	scrollSlider _ SimpleSliderMorph new		color: color;		sliderColor: Color gray;		extent: 360@2;		target: scorePlayer;		actionSelector: #positionInScore:;		adjustToValue: scorePlayer positionInScore.	r _ self makeRow		hResizing: #shrinkWrap;		vResizing: #rigid;		height: 24.	r addMorphBack: (StringMorph contents: 'start ' translated).	r addMorphBack: scrollSlider.	r addMorphBack: (StringMorph contents: ' end' translated).	^ r! !!ScorePlayerMorph methodsFor: 'layout' stamp: 'dgd 9/19/2003 12:53'!standaloneResumeButton	| r |	r _ AlignmentMorph newRow.	r color: Color red; borderWidth: 0; layoutInset: 6; useRoundedCorners.	r hResizing: #shrinkWrap; vResizing: #shrinkWrap; extent: 5@5.	r addMorphBack: (		SimpleButtonMorph new			target: [				scorePlayer resumePlaying.				r delete			];			borderColor: #raised;			borderWidth: 2;			color: Color green;			label: 'Continue' translated;			actionSelector: #value	).	r setBalloonText: 'Continue playing a paused presentation' translated.	^r! !!ScorePlayerMorph methodsFor: 'layout' stamp: 'dgd 9/19/2003 12:54'!trackNumAndMuteButtonFor: trackIndex	| muteButton instSelector pianoRollColor r |	muteButton _ SimpleSwitchMorph new		onColor: (Color r: 1.0 g: 0.6 b: 0.6);		offColor: color;		color: color;		label: 'Mute' translated;		target: scorePlayer;		actionSelector: #mutedForTrack:put:;		arguments: (Array with: trackIndex).	instSelector _ PopUpChoiceMorph new		extent: 95@14;		contentsClipped: 'oboe1';		target: self;		actionSelector: #atTrack:from:selectInstrument:;		getItemsSelector: #instrumentChoicesForTrack:;		getItemsArgs: (Array with: trackIndex).	instSelector arguments:		(Array with: trackIndex with: instSelector).	instrumentSelector at: trackIndex put: instSelector.	"select track color using same color list as PianoRollScoreMorph"	pianoRollColor _ (Color wheel: scorePlayer score tracks size) at: trackIndex.	r _ self makeRow		hResizing: #rigid;		vResizing: #spaceFill;		extent: 70@10.	r addMorphBack:		((StringMorph			contents: trackIndex printString			font: (TextStyle default fontOfSize: 24)) color: pianoRollColor).	trackIndex < 10		ifTrue: [r addMorphBack: (Morph new color: color; extent: 19@8)]  "spacer"		ifFalse: [r addMorphBack: (Morph new color: color; extent: 8@8)].  "spacer"	r addMorphBack:		(StringMorph new			extent: 140@14;			contentsClipped: (scorePlayer infoForTrack: trackIndex)).	r addMorphBack: (Morph new color: color; extent: 8@8).  "spacer"	r addMorphBack: instSelector.	r addMorphBack: (AlignmentMorph newRow color: color).  "spacer"	r addMorphBack: muteButton.	^ r! !!ScorePlayerMorph methodsFor: 'layout' stamp: 'dgd 9/19/2003 12:54'!volumeControl	| volumeSlider r |	volumeSlider _ SimpleSliderMorph new		color: color;		sliderColor: Color gray;		extent: 80@2;		target: scorePlayer;		actionSelector: #overallVolume:;		adjustToValue: scorePlayer overallVolume.	r _ self makeRow		hResizing: #shrinkWrap;		vResizing: #rigid;		height: 24.	r addMorphBack: (StringMorph contents: 'soft  ' translated).	r addMorphBack: volumeSlider.	r addMorphBack: (StringMorph contents: ' loud' translated).	^ r! !!ScorePlayerMorph methodsFor: 'menu' stamp: 'dgd 9/21/2003 14:58'!invokeMenu	"Invoke a menu of additonal functions for this ScorePlayer."	| aMenu |	aMenu _ MenuMorph new defaultTarget: self.	aMenu add: 'open a MIDI file' translated action: #openMIDIFile.	aMenu addList: {		#-.		{'save as AIFF file' translated.	#saveAsAIFF}.		{'save as WAV file' translated.		#saveAsWAV}.		{'save as Sun AU file' translated.	#saveAsSunAudio}.		#-}.	aMenu add: 'reload instruments' translated target: AbstractSound selector: #updateScorePlayers.	aMenu addLine.	scorePlayer midiPort		ifNil: [			aMenu add: 'play via MIDI' translated action: #openMIDIPort]		ifNotNil: [			aMenu add: 'play via built in synth' translated action: #closeMIDIPort.			aMenu add: 'new MIDI controller' translated action: #makeMIDIController:].	aMenu addLine.	aMenu add: 'make a pause marker' translated action: #makeAPauseEvent:.	aMenu popUpInWorld: self world.! !!ScorePlayerMorph methodsFor: 'menu' stamp: 'dgd 9/21/2003 17:20'!makeAPauseEvent: evt	| newWidget |	newWidget _ AlignmentMorph newRow.	newWidget 		color: Color orange; 		borderWidth: 0; 		layoutInset: 0;		hResizing: #shrinkWrap; 		vResizing: #shrinkWrap; 		extent: 5@5;		addMorph: (StringMorph contents: '[pause]' translated) lock;		addMouseUpActionWith: (			MessageSend receiver: self selector: #showResumeButtonInTheWorld		).	evt hand attachMorph: newWidget.! !!ScorePlayerMorph methodsFor: 'menu' stamp: 'dgd 10/8/2003 19:49'!saveAsAIFF	"Create a stereo AIFF audio file with the result of performing my score."	| fileName |	fileName _ FillInTheBlank request: 'New file name?' translated.	fileName isEmpty ifTrue: [^ self].	(fileName asLowercase endsWith: '.aif') ifFalse: [		fileName _ fileName, '.aif'].	scorePlayer storeAIFFOnFileNamed: fileName.! !!ScorePlayerMorph methodsFor: 'menu' stamp: 'dgd 10/8/2003 19:49'!saveAsSunAudio	"Create a stereo Sun audio file with the result of performing my score."	| fileName |	fileName _ FillInTheBlank request: 'New file name?' translated.	fileName isEmpty ifTrue: [^ self].	(fileName asLowercase endsWith: '.au') ifFalse: [		fileName _ fileName, '.au'].	scorePlayer storeSunAudioOnFileNamed: fileName.! !!ScorePlayerMorph methodsFor: 'menu' stamp: 'dgd 10/8/2003 19:49'!saveAsWAV	"Create a stereo WAV audio file with the result of performing my score."	| fileName |	fileName _ FillInTheBlank request: 'New file name?' translated.	fileName isEmpty ifTrue: [^ self].	(fileName asLowercase endsWith: '.wav') ifFalse: [		fileName _ fileName, '.wav'].	scorePlayer storeWAVOnFileNamed: fileName.! !!ScreenController methodsFor: 'menu messages' stamp: 'dgd 9/5/2003 18:25'!quit	Smalltalk		snapshot:			(self confirm: 'Save changes before quitting?' translated				orCancel: [^ self])		andQuit: true! !!ScreeningMorph methodsFor: 'menu' stamp: 'dgd 10/8/2003 19:51'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	submorphs isEmpty ifTrue:		[^ aCustomMenu add: '*Please add a source morph*' translated action: #itself].	submorphs size = 1 ifTrue:		[^ aCustomMenu add: '*Please add a screen morph*' translated action: #itself].	submorphs size > 2 ifTrue:		[^ aCustomMenu add: '*I have too many submorphs*' translated action: #itself].	aCustomMenu add: 'show screen only' translated action: #showScreenOnly.	aCustomMenu add: 'show source only' translated action: #showSourceOnly.	aCustomMenu add: 'show screen over source' translated action: #showScreenOverSource.	aCustomMenu add: 'show source screened' translated action: #showScreened.	aCustomMenu add: 'exchange source and screen' translated action: #exchange.	displayMode == #showScreenOnly ifTrue:		[aCustomMenu add: 'choose passing color' translated action: #choosePassingColor.		aCustomMenu add: 'choose blocking color' translated action: #chooseBlockingColor].! !!ScriptEditorMorph methodsFor: 'buttons' stamp: 'dgd 9/1/2003 14:58'!addDestroyButtonTo: aRowMorph 	aRowMorph addMorphBack: ((SimpleButtonMorph new label: 'X' font: Preferences standardButtonFont) target: self;			 color: Color lightRed;			 actionSelector: #destroyScript;			 setBalloonText: 'Destroy this script(CAUTION!!!!)' translated).	^ aRowMorph! !!ScriptEditorMorph methodsFor: 'buttons' stamp: 'dgd 9/1/2003 15:00'!addDismissButtonTo: aRowMorph	aRowMorph addMorphBack:		((SimpleButtonMorph new label: 'O' font: Preferences standardButtonFont)			target: self;			color:  Color tan;			actionSelector: #dismiss;			setBalloonText: 'Remove this scriptfrom the screen(you can open itagain from a Viewer)' translated).	^ aRowMorph! !!ScriptEditorMorph methodsFor: 'buttons' stamp: 'dgd 9/1/2003 14:00'!chooseFrequency	| currentFrequency aMenu |	currentFrequency _ self scriptInstantiation frequency.	currentFrequency = 0 ifTrue: [currentFrequency _ 1].	aMenu _ MenuMorph new defaultTarget: self.	#(1 2 5 10 25 50 100 1000 5000 10000) do:		[:i | aMenu add: i printString selector: #setFrequencyTo: argument: i].		aMenu add: 'other...' translated action: #typeInFrequency.	aMenu addTitle: ('Choose frequency (current: {1})' translated format: {currentFrequency}).	aMenu  popUpEvent: self currentEvent in: self world! !!ScriptEditorMorph methodsFor: 'buttons' stamp: 'dgd 9/1/2003 14:59'!destroyScript	"At user request, and only after confirmation, destroy the script, thus removing it from the uniclass's method dictionary and removing its instantiations from all instances of uniclass, etc."	(self confirm: 'Caution -- this destroys this scriptpermanently; are you sure you want to do this?' translated) ifFalse: [^ self].	true ifTrue: [^ playerScripted removeScript: scriptName fromWorld: self world].	self flag: #deferred.  "revisit"	(playerScripted okayToDestroyScriptNamed: scriptName)		ifFalse:			[^ self inform: 'Sorry, this script is being calledfrom another script.' translated].	self actuallyDestroyScript! !!ScriptEditorMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:06'!autoFitString	"Answer the string to put in a menu that will invite the user to 	switch autoFit mode"	^ ((self hasProperty: #autoFitContents)		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'auto fit' translated! !!ScriptEditorMorph methodsFor: 'other' stamp: 'dgd 9/1/2003 14:56'!explainStatusAlternatives	(StringHolder new contents: ScriptingSystem statusHelpString translated)		openLabel: 'Script Status' translated! !!ScriptEditorMorph methodsFor: 'other' stamp: 'dgd 9/1/2003 14:47'!extent: x	| newExtent tw menu |	newExtent _ x max: self minWidth@self minHeight.	(tw _ self findA: TwoWayScrollPane) ifNil:		["This was the old behavior"		^ super extent: newExtent].	(self hasProperty: #autoFitContents) ifTrue: [		menu _ MenuMorph new defaultTarget: self.		menu addUpdating: #autoFitString target: self action: #autoFitOnOff.		menu addTitle: 'To resize the script, uncheck the box below' translated.		menu popUpEvent: nil in: self world	.		^ self].	"Allow the user to resize to any size"	tw extent: ((newExtent x max: self firstSubmorph width)				@ (newExtent y - self firstSubmorph height)) - (borderWidth*2) + (-4@-4).  "inset?"	^ super extent: newExtent! !!ScriptEditorMorph methodsFor: 'other' stamp: 'dgd 9/1/2003 14:48'!handUserButtonDownTile	"Hand the user a button-down tile, presumably to drop in the script"			self currentHand attachMorph:		(self presenter systemQueryPhraseWithActionString: '(Sensor anyButtonPressed)' labelled: 'button down?' translated)	! !!ScriptEditorMorph methodsFor: 'other' stamp: 'dgd 9/1/2003 14:54'!offerScriptorMenu	"Put up a menu in response to the user's clicking in the menu-request area of the scriptor's heaer"	| aMenu  count |	self modernize.	ActiveHand showTemporaryCursor: nil.	aMenu _ MenuMorph new defaultTarget: self.	aMenu addTitle: scriptName asString.	Preferences universalTiles ifFalse:		[count _ self savedTileVersionsCount.		self showingMethodPane			ifFalse:				"currently showing tiles"				[aMenu add: 'show code textually' translated action: #showSourceInScriptor.				count > 0 ifTrue: 					[aMenu add: 'revert to tile version...' translated action:	 #revertScriptVersion].				aMenu add: 'save this version' translated	action: #saveScriptVersion]			ifTrue:				"current showing textual source"				[count >= 1 ifTrue:					[aMenu add: 'revert to tile version' translated action: #revertToTileVersion]]].	aMenu addList: {		#-.		{'destroy this script' translated.					#destroyScript}.		{'rename this script' translated.					#renameScript}.		}.	self hasParameter ifFalse:		[aMenu addList: {{'button to fire this script' translated.			#tearOfButtonToFireScript}}].	aMenu addList: {		{'edit balloon help for this script' translated.		#editMethodDescription}.		#-.		{'explain status alternatives' translated. 			#explainStatusAlternatives}.		#-.		{'hand me a tile for self' translated.					#handUserTileForSelf}.		{'hand me a "random number" tile' translated.		#handUserRandomTile}.		{'hand me a "button down?" tile' translated.		#handUserButtonDownTile}.		{'hand me a "button up?" tile' translated.			#handUserButtonUpTile}.		}.	aMenu addList: (self hasParameter		ifTrue: [{			#-.			{'remove parameter' translated.					#ceaseHavingAParameter}}]		ifFalse: [{			{'fires per tick...' translated.						#chooseFrequency}.			#-.			{'add parameter' translated.						#addParameter}}]).	aMenu popUpInWorld: self currentWorld.! !!ScriptInstantiation methodsFor: 'status control' stamp: 'dgd 9/1/2003 14:57'!explainStatusAlternatives	"Open a little window that explains the various status 	alternatives "	(StringHolder new contents: ScriptingSystem statusHelpString translated)		openLabel: 'Script Status' translated! !!ScriptInstantiation methodsFor: 'status control' stamp: 'dgd 9/1/2003 14:56'!presentScriptStatusPopUp	"Put up a menu of status alternatives and carry out the request"	| aMenu reply standardStati  m |	"NB; the keyStroke branch commented out temporarily until keystrokes can actually be passed along to the user's scripting code"	standardStati _ #(normal paused ticking mouseDown mouseStillDown mouseUp mouseEnter mouseLeave mouseEnterDragging mouseLeaveDragging opening closing "keyStroke").	aMenu _ SelectionMenu labelList:  (#(		'normal'		" -- run when called"				'paused' 		"ready to run all the time"		'ticking'		"run all the time"		'mouseDown'	"run when mouse goes down on me"		'mouseStillDown'	"while mouse still down"		'mouseUp'		"when mouse comes back up"		'mouseEnter'	"when mouse enters my bounds, button up"		'mouseLeave'	"when mouse exits my bounds, button up"		'mouseEnterDragging'	"when mouse enters my bounds, button down"		'mouseLeaveDragging'	"when mouse exits my bounds, button down"		'opening'	"when I am being opened"		'closing'	"when I am being closed"	"	'keyStroke'	run when user hits a key"		'what do these mean?'		'apply my status to all siblings'		) collect:[:each | each translated])		lines: #(1 3 6 10 12 13)		selections: (standardStati, #(explainStatusAlternatives assignStatusToAllSiblings)).	reply _ aMenu startUpWithCaption: 'When should this script run?' translated.	(reply == #keyStroke) ifTrue: [^ self inform: 'user-scripted fieldingof keystrokes is notyet available.' translated].	reply == #explainStatusAlternatives ifTrue: [^ self explainStatusAlternatives].	reply == #assignStatusToAllSiblings ifTrue: [^ self assignStatusToAllSiblings].	reply ifNotNil: 		[self status: reply.  "Gets event handlers fixed up"		reply == #paused ifTrue:			[m _ player costume.			(m isKindOf: SpeakerMorph) ifTrue: [m stopSound]].		self updateAllStatusMorphs]! !!ScriptInstantiation methodsFor: 'status control' stamp: 'dgd 9/6/2003 18:15'!presentTickingMenu	"Put up a menu of status alternatives and carry out the request"	| aMenu ticks item any |	ticks _ self tickingRate.	ticks = ticks asInteger ifTrue:[ticks _ ticks asInteger].	aMenu _ MenuMorph new defaultTarget: self.	any _ false.	#(1 2 5 8 10 25 50 100) do:[:i | 		item _ aMenu addUpdating: nil target: self selector: #tickingRate: argumentList: {i}.		item contents:			((ticks = i) ifTrue:[ any _ true. '<on>', i printString]					ifFalse:['<off>', i printString])].	item _ aMenu addUpdating: nil target: self selector: #typeInTickingRate argumentList: #().	item contents: (any ifTrue:['<off>'] ifFalse:['<on>']), 'other...' translated.	aMenu addTitle: ('Ticks (now: {1}/sec)' translated format:{ticks}).	aMenu  popUpEvent: self currentEvent in: self currentWorld! !!ScriptInstantiation methodsFor: 'status control' stamp: 'dgd 9/21/2003 15:59'!translatedStatus	^ self status translated! !!ScriptInstantiation methodsFor: 'status control' stamp: 'dgd 9/21/2003 16:04'!updateStatusMorph: statusControlMorph	"the status control may need to reflect an externally-induced change in status"	| colorSelector statusReadoutButton |	statusControlMorph ifNil: [^ self].	self pausedOrTicking		ifTrue:			[statusControlMorph assurePauseTickControlsShow]		ifFalse:			[statusControlMorph maybeRemovePauseTickControls].	statusReadoutButton _ statusControlMorph submorphs last.	colorSelector _ ScriptingSystem statusColorSymbolFor: self status.	statusReadoutButton color: (Color perform: colorSelector) muchLighter.	statusReadoutButton label: self translatedStatus asString font: Preferences standardButtonFont! !!ScriptStatusControl methodsFor: 'initialization' stamp: 'dgd 9/21/2003 15:54'!assurePauseTickControlsShow	"Add two little buttons that allow the user quickly to toggle between paused and ticking state"	| colorSelector status |	self beTransparent.	(tickPauseWrapper isKindOf: TickIndicatorMorph) ifFalse:[		"this was an old guy"		tickPauseWrapper ifNotNil:[tickPauseWrapper delete].		tickPauseWrapper _ TickIndicatorMorph new.		tickPauseWrapper on: #mouseDown send: #mouseDownTick:onItem: to: self.		tickPauseWrapper on: #mouseUp send: #mouseUpTick:onItem: to: self.		tickPauseWrapper setBalloonText:'Press to toggle ticking state. Hold down to set tick rate.' translated.		self addMorphFront: tickPauseWrapper.	].	status _ scriptInstantiation status.	colorSelector _ ScriptingSystem statusColorSymbolFor: status.	tickPauseWrapper color: (Color perform: colorSelector) muchLighter.	tickPauseWrapper stepTime: (1000 // scriptInstantiation tickingRate max: 0).	tickPauseWrapper isTicking: status == #ticking.	tickPauseButtonsShowing _ true.! !!ScriptStatusControl methodsFor: 'initialization' stamp: 'dgd 9/21/2003 16:00'!initializeFor: aScriptInstantiation	"Answer a control that will serve to reflect and allow the user to change the status of the receiver"	|  statusReadout |	self hResizing: #shrinkWrap.	self cellInset: 2@0.	scriptInstantiation _ aScriptInstantiation.	tickPauseButtonsShowing _ false.	self addMorphBack: (statusReadout _ UpdatingSimpleButtonMorph new).	statusReadout label: aScriptInstantiation status asString font: Preferences standardButtonFont.	statusReadout setNameTo: 'trigger'.	statusReadout target: aScriptInstantiation; wordingSelector: #translatedStatus; actionSelector: #presentScriptStatusPopUp.	statusReadout setBalloonText: 'when this script should run' translated.	statusReadout actWhen: #buttonDown.	self assurePauseTickControlsShow.	aScriptInstantiation updateStatusMorph: self! !!ScriptingDomain methodsFor: 'user interface' stamp: 'dgd 8/30/2003 21:54'!addModelMenuItemsTo: aCustomMenu forMorph: aMorph hand: aHandMorph 	super addModelMenuItemsTo: aCustomMenu forMorph: self hand: aHandMorph.  "nominally nothing"	aCustomMenu add: 'take out of window' translated action: #takeOutOfWindow	! !!ScrollPane methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:06'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	retractableScrollBar		ifTrue: [aCustomMenu add: 'make scrollbar inboard' translated action: #retractableOrNot]		ifFalse: [aCustomMenu add: 'make scrollbar retractable' translated action: #retractableOrNot].	scrollBarOnLeft		ifTrue: [aCustomMenu add: 'scroll bar on right' translated action: #leftOrRight]		ifFalse: [aCustomMenu add: 'scroll bar on left' translated action: #leftOrRight]! !!AlansTextPlusMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/30/2003 20:50'!addGeeMailMenuItemsTo: menu	self flag: #convertToBook.	"<-- no longer used"	menu 		addUpdating: #showPageBreaksString action: #togglePageBreaks;		addUpdating: #keepScrollbarString action: #toggleKeepScrollbar;		addLine;		add: 'Print...' translated action: #printPSToFile;		addLine.	thePasteUp allTextPlusMorphs size = 1 ifTrue: [		menu add: 'make 1-column book' translated selector: #makeBookStyle: argument: 1.		menu add: 'make 2-column book' translated selector: #makeBookStyle: argument: 2.		menu add: 'make 3-column book' translated selector: #makeBookStyle: argument: 3.		menu add: 'make 4-column book' translated selector: #makeBookStyle: argument: 4.	] ifFalse: [		menu add: 'make a galley of me' translated action: #makeGalleyStyle.	].	^menu! !!PluggableListMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 21:56'!addCustomMenuItems:  aMenu hand: aHandMorph	"Add halo menu items to be handled by the invoking hand. The halo menu is invoked by clicking on the menu-handle of the receiver's halo."	super addCustomMenuItems: aMenu hand: aHandMorph.	aMenu addLine.	aMenu add: 'list font...' translated target: self action: #setListFont.	aMenu add: 'copy list to clipboard' translated target: self action: #copyListToClipboard.	aMenu add: 'copy selection to clipboard' translated target: self action: #copySelectionToClipboard! !!PluggableTextMorph methodsFor: 'menu commands' stamp: 'dgd 10/8/2003 19:42'!accept 	"Inform the model of text to be accepted, and return true if OK."	| textToAccept ok saveSelection saveScrollerOffset |"sps 8/13/2001 22:41: save selection and scroll info"	saveSelection _ self selectionInterval copy.	saveScrollerOffset _ scroller offset copy.	(self canDiscardEdits and: [(self hasProperty: #alwaysAccept) not])		ifTrue: [^ self flash].	self hasEditingConflicts ifTrue:		[(self confirm: 'Caution!! This method may have beenchanged elsewhere since you startedediting it here.  Accept anyway?' translated) ifFalse: [^ self flash]].	textToAccept _ textMorph asText.	ok _ setTextSelector isNil or:		[setTextSelector numArgs = 2			ifTrue: [model perform: setTextSelector with: textToAccept with: self]			ifFalse: [model perform: setTextSelector with: textToAccept]].	ok==true ifTrue:		[self setText: self getText.		self hasUnacceptedEdits: false.		(model dependents detect: [:dep | (dep isKindOf: PluggableTextMorph) and: [dep getTextSelector == #annotation]] ifNone: [nil]) doIfNotNil:			[:aPane | model changed: #annotation]].	"sps 8/13/2001 22:41: restore selection and scroll info"	["During the step for the browser, updateCodePaneIfNeeded is called, and 		invariably resets the contents of the codeholding PluggableTextMorph		at that time, resetting the cursor position and scroller in the process.		The following line forces that update without waiting for the step, 		then restores the cursor and scrollbar"	ok ifTrue: "(don't bother if there was an error during compile)"		[(model isKindOf: CodeHolder) 			ifTrue: [model updateCodePaneIfNeeded].		WorldState addDeferredUIMessage:			[self currentHand newKeyboardFocus: textMorph.			scroller offset: saveScrollerOffset.			self setScrollDeltas.			self selectFrom: saveSelection first to: saveSelection last]]]			on: Error do: []! !!PluggableTextMorph methodsFor: 'unaccepted edits' stamp: 'dgd 9/21/2003 17:40'!promptForCancel	"Ask if it is OK to cancel changes to text"	(self confirm:'Changes have not been saved.Is it OK to cancel those changes?' translated)		ifTrue: [model clearUserEditFlag].! !!FunctionComponent methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:45'!addCustomMenuItems: aMenu hand: aHandMorph	"Add custom menu items"	super addCustomMenuItems: aMenu hand: aHandMorph.	aMenu add: 'add pin' translated target: self selector: #addPin.! !!SearchingViewer methodsFor: 'initialization' stamp: 'dgd 9/1/2003 13:38'!addNamePaneTo: header	"Add the namePane, which may be a popup or a type-in depending on the type of CategoryViewer"	| plugTextMor searchButton |	namePane _ AlignmentMorph newRow vResizing: #spaceFill; height: 14.	namePane hResizing: #spaceFill.	namePane listDirection: #leftToRight.	plugTextMor _ PluggableTextMorph on: self					text: #searchString accept: #searchString:notifying:					readSelection: nil menu: nil.	plugTextMor setProperty: #alwaysAccept toValue: true.	plugTextMor askBeforeDiscardingEdits: false.	plugTextMor acceptOnCR: true.	plugTextMor setTextColor: Color brown.	plugTextMor setNameTo: 'Search' translated.	plugTextMor vResizing: #spaceFill; hResizing: #spaceFill.	plugTextMor hideScrollBarIndefinitely.	plugTextMor setTextMorphToSelectAllOnMouseEnter.	searchButton _ SimpleButtonMorph new 		target: self;		beTransparent;		label: 'Search' translated;		actionSelector: #doSearchFrom:;		arguments: {plugTextMor}.	searchButton setBalloonText: 'Type some letters into the pane at right, and then press this Search button (or hit RETURN) and all method selectors that match what you typed will appear in the list below.' translated.	namePane addMorphFront: searchButton.	namePane addTransparentSpacerOfSize: 6@0.	namePane addMorphBack: plugTextMor.	header addMorphBack: namePane! !!SelectionMorph methodsFor: 'halo commands' stamp: 'dgd 8/30/2003 22:08'!addCustomMenuItems: aMenu hand: aHandMorph	"Add custom menu items to the menu"	super addCustomMenuItems: aMenu hand: aHandMorph.	aMenu addLine.	aMenu add: 'add or remove items' translated target: self selector: #addOrRemoveItems: argument: aHandMorph.	aMenu addList: {		#-.		{'place into a row' translated. #organizeIntoRow}.		{'place into a column' translated. #organizeIntoColumn}.		#-.		{'align left edges' translated. #alignLeftEdges}.		{'align top edges' translated. #alignTopEdges}.		{'align right edges' translated. #alignRightEdges}.		{'align bottom edges' translated. #alignBottomEdges}.		#-.		{'align centers vertically' translated. #alignCentersVertically}.		{'align centers horizontally' translated. #alignCentersHorizontally}.		}! !!SimpleButtonMorph methodsFor: 'menu' stamp: 'sd 11/13/2003 21:06'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	self addLabelItemsTo: aCustomMenu hand: aHandMorph.	(target isKindOf: BookMorph)		ifTrue:			[aCustomMenu add: 'set page sound' translated action: #setPageSound:.			aCustomMenu add: 'set page visual' translated action: #setPageVisual:]		ifFalse:			[aCustomMenu add: 'change action selector' translated action: #setActionSelector.			aCustomMenu add: 'change arguments' translated action: #setArguments.			aCustomMenu add: 'change when to act' translated action: #setActWhen.			aCustomMenu add: 'change target' action: #setTarget.			((self world rootMorphsAt: aHandMorph targetOffset) size > 1) ifTrue:				[aCustomMenu add: 'set target' translated action: #setTarget:]].! !!SimpleButtonMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:06'!addLabelItemsTo: aCustomMenu hand: aHandMorph 	aCustomMenu add: 'change label' translated action: #setLabel! !!ScriptActivationButton methodsFor: 'menus' stamp: 'dgd 8/30/2003 22:05'!addCustomMenuItems: aCustomMenu hand: aHandMorph	"Add morph-specific items to the given menu which was invoked by the given hand.  To avoid a nasty inheritance problem, this method does NOT call super"	aCustomMenu addUpdating: #hasDragAndDropEnabledString action: #changeDragAndDrop.	aCustomMenu add: 'put in a window' translated action: #embedInWindow.	aCustomMenu addUpdating: #stickinessString target: self action: #toggleStickiness.	aCustomMenu add: 'adhere to edge...' translated action: #adhereToEdge.	aCustomMenu addList: {			{'border color...' translated. #changeBorderColor:}.			{'border width...' translated. #changeBorderWidth:}			}.	aCustomMenu addUpdating: #roundedCornersString target: self action: #toggleCornerRounding.	borderColor == #raised ifFalse: [aCustomMenu add: 'raised bevel' translated action: #borderRaised].	borderColor == #inset ifFalse: [aCustomMenu add: 'inset bevel' translated action: #borderInset].	self addLabelItemsTo: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'open underlying scriptor' translated target: target selector: #openUnderlyingScriptorFor: argument: arguments first! !!ScriptableButton methodsFor: 'miscellaneous' stamp: 'dgd 9/6/2003 17:37'!initializeToStandAlone	super initializeToStandAlone.	self borderWidth: 1;		borderColor: Color black;		useRoundedCorners;		color: Color yellow;		label: 'Press me' translated! !!ScriptableButton class methodsFor: 'authoring prototype' stamp: 'dgd 9/6/2003 17:38'!authoringPrototype	"Answer a scriptable button that can serve as a prototype for a parts bin"	^ super authoringPrototype		borderWidth: 1;		borderColor: Color black;		useRoundedCorners;		color: Color yellow;		label: 'Press me' translated;		setNameTo: ('script{1}' translated format: {'1'});		yourself"ScriptableButton authoringPrototype openInHand"! !!SimpleMIDIPort class methodsFor: 'utilities' stamp: 'dgd 9/21/2003 17:12'!outputPortNumFromUser	"Prompt the user for a MIDI output port. Answer a port number, or nil if the user does not select a port or if MIDI is not supported on this platform."	"SimpleMIDIPort outputPortNumFromUser"	| portCount aMenu dir |	portCount _ self primPortCount.	portCount = 0 ifTrue: [^ nil].	aMenu _ CustomMenu new title: 'MIDI port for output:' translated.	0 to: portCount - 1 do:[:i |		dir _ self primPortDirectionalityOf: i.		(dir = 2) | (dir = 3) ifTrue:[			aMenu add: (self portDescription: i) action: i]].	 ^ aMenu startUp! !!SimpleServiceEntry methodsFor: 'accessing' stamp: 'dgd 9/1/2003 12:16'!buttonLabel: aString 	"Set the receiver's buttonLabel, to be used on a button in a 	tool-pane; this is split out so that a more abbreviated wording 	can be deployed if desired"	buttonLabel := aString translated! !!SimpleServiceEntry methodsFor: 'accessing' stamp: 'dgd 9/1/2003 12:12'!provider: anObject label: aString selector: aSymbol 	"basic initialization message"	provider := anObject.	label := aString translated.	selector := aSymbol.	stateSelector := #none.	description := ''! !!SimpleServiceEntry methodsFor: 'performing service' stamp: 'dgd 9/1/2003 12:13'!provider: anObject label: aString selector: aSymbol description: anotherString 	"basic initialization message"	self		provider: anObject		label: aString		selector: aSymbol.	stateSelector := #none.	description := anotherString translated! !!SimpleSliderMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:13'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addLine.	aCustomMenu add: 'set action selector' translated action: #setActionSelector.	aCustomMenu add: 'change arguments' translated action: #setArguments.	aCustomMenu add: 'set minimum value' translated action: #setMinVal.	aCustomMenu add: 'set maximum value' translated action: #setMaxVal.	aCustomMenu addUpdating: #descendingString action: #toggleDescending.	aCustomMenu addUpdating: #truncateString action: #toggleTruncate.	((self world rootMorphsAt: aHandMorph targetOffset) size > 1) ifTrue: [		aCustomMenu add: 'set target' translated action: #setTarget:].	target ifNotNil: [		aCustomMenu add: 'clear target' translated action: #clearTarget].! !!SimpleSliderMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:13'!descendingString	^ (self descending		ifTrue: ['switch to ascending']		ifFalse: ['switch to descending']) translated! !!SimpleSliderMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:13'!truncateString	^ (truncate		ifTrue: ['turn off truncation']		ifFalse: ['turn on truncation'])  translated! !!SketchEditorMorph methodsFor: 'start & finish' stamp: 'dgd 9/19/2003 14:50'!addRotationScaleHandles	"Rotation and scaling handles"	rotationButton _ SketchMorph withForm: (palette rotationTabForm).	rotationButton position: bounds topCenter - (6@0).	rotationButton on: #mouseDown send: #rotateScalePrep: to: self.	rotationButton on: #mouseMove send: #rotateBy: to: self.	rotationButton on: #mouseUp send: #rotateDone: to: self.	rotationButton on: #mouseEnter send: #mouseLeave: to: self.	"Put cursor back"	rotationButton on: #mouseLeave send: #mouseEnter: to: self.	self addMorph: rotationButton.	rotationButton setBalloonText: 'Drag me sideways torotate yourpicture.' translated.	scaleButton _ SketchMorph withForm: (palette scaleTabForm).	scaleButton position: bounds rightCenter - ((scaleButton width)@6).	scaleButton on: #mouseDown send: #rotateScalePrep: to: self.	scaleButton on: #mouseMove send: #scaleBy: to: self.	scaleButton on: #mouseEnter send: #mouseLeave: to: self.	"Put cursor back"	scaleButton on: #mouseLeave send: #mouseEnter: to: self.	self addMorph: scaleButton.	scaleButton setBalloonText: 'Drag me up and down to changethe sizeof your picture.' translated."REMOVED:	fwdButton _ PolygonMorph new.	pt _ bounds topCenter.	fwdButton borderWidth: 2; makeOpen; makeBackArrow; borderColor:(Color r: 0 g: 0.8 b: 0).	fwdButton removeHandles; setVertices: (Array with: pt+(0@7) with:pt+(0@22)).	fwdButton on: #mouseMove send: #forward:direction: to: self.	fwdButton on: #mouseEnter send: #mouseLeave: to: self.		fwdButton on: #mouseLeave send: #mouseEnter: to: self.	self setProperty: #fwdButton toValue: fwdButton.	self addMorph: fwdButton.	fwdButton setBalloonText: 'Drag me around to pointin the directionI go forward.' translated.	toggle _ EllipseMorph		newBounds: (Rectangle center: fwdButton vertices last +(-4@4) extent: 8@8)		color: Color gray.	toggle on: #mouseUp send: #toggleDirType:in: to: self.	toggle on: #mouseEnter send: #mouseLeave: to: self.	toggle on: #mouseLeave send: #mouseEnter: to: self.	self setProperty: #fwdToggle toValue: toggle.	fwdButton addMorph: toggle.	toggle setBalloonText: 'When your object turns,how should itspicture change?It can rotate, face left or right,face up or down, or notchange.' translated.	"	self setProperty: #rotationStyle toValue: hostView rotationStyle."	self forward: hostView setupAngle direction: fwdButton.	"	"Set to its current value"! !!SketchEditorMorph methodsFor: 'start & finish' stamp: 'dgd 9/19/2003 14:51'!deliverPainting: result evt: evt	"Done painting.  May come from resume, or from original call.  Execute user's post painting instructions in the block.  Always use this standard one.  4/21/97 tk"	| newBox newForm ans |	palette ifNotNil: "nil happens" [palette setAction: #paint: evt: evt].	"Get out of odd modes"	"rot _ palette getRotations."	"rotate with heading, or turn to and fro"	"palette setRotation: #normal."	result == #cancel ifTrue: [		ans _ PopUpMenu withCaption: 'Do you really want to throw away what you just painted?' translated 				chooseFrom: 'throw it away\keep painting it' translated.		^ ans = 1 ifTrue: [self cancelOutOfPainting]				ifFalse: [nil]].	"for Morphic"	"hostView rotationStyle: rot."		"rotate with heading, or turn to and fro"	newBox _ paintingForm rectangleEnclosingPixelsNotOfColor: Color transparent.	registrationPoint ifNotNil:		[registrationPoint _ registrationPoint - newBox origin]. "relative to newForm origin"	newForm _ 	Form extent: newBox extent depth: paintingForm depth.	newForm copyBits: newBox from: paintingForm at: 0@0 		clippingBox: newForm boundingBox rule: Form over fillColor: nil.	newForm isAllWhite ifTrue: [		(self valueOfProperty: #background) == true 			ifFalse: [^ self cancelOutOfPainting]].	self delete.	"so won't find me again"	dimForm ifNotNil: [dimForm delete].	newPicBlock value: newForm value: (newBox copy translateBy: bounds origin).! !!SketchMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:16'!addCustomMenuItems: aCustomMenu hand: aHandMorph	"Add custom menu items"	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'restore base graphic' translated target: self action: #restoreBaseGraphicFromMenu.	aCustomMenu add: 'call this my base graphic' translated target: self action: #callThisBaseGraphic.	aCustomMenu add: 'choose new graphic...' translated target: self action: #chooseNewGraphic.	aCustomMenu addLine.	aCustomMenu add: 'set as background' translated target: rotatedForm action: #setAsBackground.	self addPaintingItemsTo: aCustomMenu hand: aHandMorph! !!SketchMorph methodsFor: 'menu' stamp: 'dgd 9/6/2003 18:27'!useInterpolationString	^ (self useInterpolation		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'smooth image' translated! !!BookPageThumbnailMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 20:57'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addLine.	aCustomMenu add: 'make a flex morph' translated selector: #makeFlexMorphFor: argument: aHandMorph.	flipOnClick		ifTrue: [aCustomMenu add: 'disable bookmark action' translated action: #toggleBookmark]		ifFalse: [aCustomMenu add: 'enable bookmark action' translated action: #toggleBookmark].	(bookMorph isKindOf: BookMorph)		ifTrue:			[aCustomMenu add: 'set page sound' translated action: #setPageSound:.			aCustomMenu add: 'set page visual' translated action: #setPageVisual:]! !!ColorPickerMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:17'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	deleteOnMouseUp		ifTrue: [aCustomMenu add: 'stay up' translated action: #toggleDeleteOnMouseUp]		ifFalse: [aCustomMenu add: 'do not stay up' translated action: #toggleDeleteOnMouseUp].	updateContinuously		ifTrue: [aCustomMenu add: 'update only at end' translated action: #toggleUpdateContinuously]		ifFalse: [aCustomMenu add: 'update continuously' translated action: #toggleUpdateContinuously].! !!ColorPickerMorph methodsFor: 'other' stamp: 'dgd 8/26/2003 21:44'!delete	"The moment of departure has come.  If the receiver has an affiliated command, finalize it and have the system remember it.  In any case, delete the receiver"	self rememberCommand: 		(Command new			cmdWording: 'color change' translated;			undoTarget: target selector: selector arguments: (self argumentsWith: originalColor);			redoTarget: target selector: selector arguments: (self argumentsWith: selectedColor)).	super delete! !!FatBitsPaint methodsFor: 'menu' stamp: 'dgd 10/8/2003 18:59'!addCustomMenuItems: aCustomMenu hand: aHandMorph        super addCustomMenuItems: aCustomMenu hand: aHandMorph.        aCustomMenu                 add: 'background color' translated action: #setBackgroundColor:;                add: 'pen color' translated action: #setPenColor:;                add: 'pen size' translated action: #setPenSize:;                add: 'fill' translated action: #fill;                add: 'magnification' translated action: #setMagnification:;                add: 'accept' translated action: #accept;                add: 'revert' translated action: #revert;                add: 'inspect' translated action: #inspectForm;                add: 'file out' translated action: #fileOut;                add: 'selection...' translated action: #selectionMenu:;                add: 'tools...' translated action: #toolMenu:! !!FlexMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 21:44'!addCustomMenuItems: aCustomMenu hand: aHandMorph	"super addCustomMenuItems: aCustomMenu hand: aHandMorph."	aCustomMenu addLine.	aCustomMenu add: 'update from original' translated action: #updateFromOriginal.	aCustomMenu addList: {						{'border color...' translated. #changeBorderColor:}.						{'border width...' translated. #changeBorderWidth:}.						}.	aCustomMenu addLine.! !!JoystickMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:50'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'set X range' translated action: #setXRange.	aCustomMenu add: 'set Y range' translated action: #setYRange.	autoCenter		ifTrue: [aCustomMenu add: 'turn auto-center off' translated action: #toggleAutoCenter]		ifFalse: [aCustomMenu add: 'turn auto-center on' translated action: #toggleAutoCenter].	realJoystickIndex		ifNil: [aCustomMenu add: 'track real joystick' translated action: #trackRealJoystick]		ifNotNil: [aCustomMenu add: 'stop tracking joystick' translated action: #stopTrackingJoystick].! !!MorphThumbnail methodsFor: 'menus' stamp: 'dgd 8/30/2003 21:53'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'reveal original morph' translated action: #revealOriginal.	aCustomMenu add: 'grab original morph' translated action: #grabOriginal.! !!MultiuserTinyPaint methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:55'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'clear' translated action: #clear.	aCustomMenu add: 'pen color' translated action: #setPenColor:.	aCustomMenu add: 'pen size' translated action: #setPenSize:."	aCustomMenu add: 'fill' translated action: #fill:."! !!SpectrumAnalyzerMorph methodsFor: 'menu and buttons' stamp: 'dgd 9/19/2003 13:25'!invokeMenu	"Invoke the settings menu."	| aMenu |	aMenu _ CustomMenu new.	aMenu addList:	{		{'set sampling rate' translated.		#setSamplingRate}.		{'set FFT size' translated.			#setFFTSize}.		{'set display type' translated.		#setDisplayType}}.	aMenu invokeOn: self defaultSelection: nil.! !!SpectrumAnalyzerMorph methodsFor: 'menu and buttons' stamp: 'dgd 9/19/2003 13:29'!setDisplayType	"Set the display type."	| aMenu choice on |	aMenu _ CustomMenu new title: ('display type (currently {1})' translated format:{displayType}).	aMenu addList:	{		{'signal' translated.	'signal'}.		{'spectrum' translated.	'spectrum'}.		{'sonogram' translated.	'sonogram'}}.	choice _ aMenu startUp.	choice ifNil: [^ self].	on _ soundInput isRecording.	self stop.	displayType _ choice.	self resetDisplay.	on ifTrue: [self start].! !!SpectrumAnalyzerMorph methodsFor: 'menu and buttons' stamp: 'dgd 9/19/2003 13:27'!setFFTSize	"Set the size of the FFT used for frequency analysis."	| aMenu sz on |	aMenu _ CustomMenu new title: ('FFT size (currently {1})' translated format:{fft n}).	((7 to: 10) collect: [:n | 2 raisedTo: n]) do:[:r | aMenu add: r printString action: r].	sz _ aMenu startUp.	sz ifNil: [^ self].	on _ soundInput isRecording.	self stop.	fft _ FFT new: sz.	self resetDisplay.	on ifTrue: [self start].! !!SpectrumAnalyzerMorph methodsFor: 'menu and buttons' stamp: 'dgd 9/19/2003 13:26'!setSamplingRate	"Set the sampling rate to be used for incoming sound data."	| aMenu rate on |	aMenu _ CustomMenu new title:		('Sampling rate (currently {1})' translated format:{soundInput samplingRate}).	#(11025 22050 44100) do:[:r | aMenu add: r printString action: r].	rate _ aMenu startUp.	rate ifNil: [^ self].	on _ soundInput isRecording.	self stop.	soundInput samplingRate: rate.	self resetDisplay.	on ifTrue: [self start].! !!SpectrumAnalyzerMorph methodsFor: 'private' stamp: 'dgd 9/19/2003 13:30'!addButtonRow	| r |	r _ AlignmentMorph newRow vResizing: #shrinkWrap.	r addMorphBack: (self buttonName: 'Menu' translated action: #invokeMenu).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Start' translated action: #start).	r addMorphBack: (Morph new extent: 4@1; color: Color transparent).	r addMorphBack: (self buttonName: 'Stop' translated action: #stop).	r addMorphBack: (Morph new extent: 12@1; color: Color transparent).	r addMorphBack: self makeStatusLight.	self addMorphBack: r.! !!SpectrumAnalyzerMorph methodsFor: 'private' stamp: 'dgd 9/19/2003 13:31'!makeStatusLight	| s |	statusLight _ RectangleMorph new extent: 24@19.	statusLight color: Color gray.	s _ StringMorph contents: 'On' translated.	s position: statusLight center - (s extent // 2).	statusLight addMorph: s.	^ statusLight! !!StackMorph methodsFor: 'card access' stamp: 'sd 11/13/2003 21:03'!deleteCard	"Delete the current card from the stack"	| aCard |	aCard _ self currentCard.	self privateCards size = 1 ifTrue: [^ Beeper beep].	(self confirm: 'Really delete this card and all of its data?' translated) ifTrue:		[self goToNextCardInStack.		self privateCards remove: aCard].! !!StackMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:14'!addBookMenuItemsTo: aMenu hand: aHandMorph	"Add book-related items to the given menu"	| controlsShowing subMenu |	subMenu _ MenuMorph new defaultTarget: self.	subMenu add: 'previous card' translated action: #goToPreviousCardInStack.	subMenu add: 'next card' translated action: #goToNextCardInStack.	subMenu add: 'go to card...' translated action: #goToCard.	subMenu add: 'insert a card' translated action: #insertCard.	subMenu add: 'delete this card' translated action: #deleteCard.	controlsShowing _ self hasSubmorphWithProperty: #pageControl.	controlsShowing		ifTrue:			[subMenu add: 'hide card controls' translated action: #hidePageControls.			subMenu add: 'fewer card controls' translated action: #fewerPageControls]		ifFalse:			[subMenu add: 'show card controls' translated action: #showPageControls].	subMenu addLine.	subMenu add: 'sound effect for all backgrounds' translated action: #menuPageSoundForAll:.	subMenu add: 'sound effect this background only' translated action: #menuPageSoundForThisPage:.	subMenu add: 'visual effect for all backgrounds' translated action: #menuPageVisualForAll:.	subMenu add: 'visual effect this background only' translated action: #menuPageVisualForThisPage:.	subMenu addLine.	subMenu add: 'sort pages' translated action: #sortPages:.	subMenu add: 'uncache page sorter' translated action: #uncachePageSorter.	(self hasProperty: #dontWrapAtEnd)		ifTrue: [subMenu add: 'wrap after last page' translated selector: #setWrapPages: argument: true]		ifFalse: [subMenu add: 'stop at last page' translated selector: #setWrapPages: argument: false].	subMenu  addUpdating: #showingFullScreenString action: #toggleFullScreen.	subMenu addLine.	subMenu add: 'search for text' translated action: #textSearch.	(self primaryHand pasteBuffer class isKindOf: PasteUpMorph class) ifTrue:		[subMenu add: 'paste book page' translated action: #pasteBookPage].	subMenu add: 'send all pages to server' translated action: #savePagesOnURL.	subMenu add: 'send this page to server' translated action: #saveOneOnURL.	subMenu add: 'reload all from server' translated action: #reload.	subMenu add: 'copy page url to clipboard' translated action: #copyUrl.	subMenu add: 'keep in one file' translated action: #keepTogether.	subMenu add: 'save as new-page prototype' translated action: #setNewPagePrototype.	newPagePrototype ifNotNil:		[subMenu add: 'clear new-page prototype' translated action: #clearNewPagePrototype].	aMenu add: 'book...' translated subMenu: subMenu! !!StackMorph methodsFor: 'menu' stamp: 'dgd 9/19/2003 11:14'!invokeBookMenu	"Invoke the book's control panel menu."	| aMenu |	aMenu _ MenuMorph new defaultTarget: self.	aMenu addTitle: 'Stack' translated.	aMenu addStayUpItem.	aMenu addList: {		{'find...' translated.					#textSearch}.		{'find via this template' translated.			#findViaTemplate}.		{'show designations' translated. 			#showDesignationsOfObjects}.		{'explain designations' translated.			#explainDesignations}.		#-.		{'previous card' translated. 				#goToPreviousCardInStack}.		{'next card' translated. 				#goToNextCardInStack}.		{'first card' translated. 				#goToFirstCardOfStack}.		{'last card' translated. 				#goToLastCardOfStack}.		{'go to card...' translated. 				#goToCard}.		#-.		{'add a card of this background' translated. 		#insertCard}.		{'add a card of background...' translated.		#insertCardOfBackground}.		{'make a new background...' translated. 		#makeNewBackground}.		#-.		{'insert cards from clipboard data' translated.		#addCardsFromClipboardData.	'Create new cards from a formatted string on the clipboard' translated}.		{'insert cards from a file...' translated.		#addCardsFromAFile.		'Create new cards from data in a file' translated}.		#-.		{'instance variable order...' translated.		#changeInstVarOrder.		'Caution -- DANGER. Change the order of the variables on the cards' translated}.		{'be defaults for new cards' translated. 		#beDefaultsForNewCards.		'Make these current field values be the defaults for their respective fields on new cards' translated}.		    {'sort cards by...' translated.			#sortCards.			'Sort all the cards of the current background using some field as the sort key' translated}.		#-.		{'delete this card' translated. 			#deleteCard}.		{'delete all cards *except* this one' translated.	#deleteAllCardsExceptThisOne}.		#-.		{'move card to front of stack' translated.		#makeCurrentCardFirstInStack}.		{'move card to back of stack' translated.		#makeCurrentCardLastInStack}.		{'move card one position earlier' translated.		#moveCardOnePositionEarlier}.		{'move card one position later' translated.		#moveCardOnePositionLater}.		#-.		{'scripts for this background' translated.		#browseCardClass}.		#-.		{'debug...' translated.					#offerStackDebugMenu}.		{'bookish items...' translated. 			#offerBookishMenu}}.	aMenu addUpdating: #showingPageControlsString action: #toggleShowingOfPageControls.	aMenu addUpdating: #showingFullScreenString action: #toggleFullScreen.	aMenu popUpEvent: self world activeHand lastEvent in: self world! !!StandardFileMenu methodsFor: 'basic control sequences' stamp: 'dgd 9/21/2003 13:17'!getTypedFileName: aResult	| name |	name _ FillInTheBlank 		request: 'Enter a new file name' 		initialAnswer: ''.	name = '' ifTrue: [^self startUpWithCaption: 'Select a File:' translated].	name _ aResult directory fullNameFor: name.	^ StandardFileMenuResult			directory: (FileDirectory forFileName: name)			name: (FileDirectory localNameFor: name)! !!StandardFileMenu class methodsFor: 'standard file operations' stamp: 'dgd 9/21/2003 13:17'!newFileFrom: aDirectory	^(self newFileMenu: aDirectory)		startUpWithCaption: 'Select a File:' translated! !!StandardFileMenu class methodsFor: 'standard file operations' stamp: 'dgd 9/21/2003 13:17'!oldFileFrom: aDirectory	^(self oldFileMenu: aDirectory)		startUpWithCaption: 'Select a File:' translated! !!StandardScriptingSystem methodsFor: 'help dictionary' stamp: 'dgd 9/1/2003 14:25'!helpStringOrNilFor: aSymbol 	"If my HelpStrings dictionary has an entry at the given symbol, 	answer that entry's value, else answer nil"	HelpStrings		at: aSymbol		ifPresent:[:string | ^ string translated].^ nil! !!StandardScriptingSystem methodsFor: 'parts bin' stamp: 'dgd 9/1/2003 14:48'!anyButtonPressedTiles	"Answer tiles representing the query 'is any button pressed?'"	^ self tilesForQuery: '(Sensor anyButtonPressed)' label: 'button down?' translated! !!StandardScriptingSystem methodsFor: 'script-control' stamp: 'dgd 9/19/2003 14:40'!goButton	| aButton |	aButton _  ThreePhaseButtonMorph new.	aButton image:  (ScriptingSystem formAtKey: 'GoPicOn');			offImage: (ScriptingSystem formAtKey: 'GoPic');			pressedImage: (ScriptingSystem formAtKey: 'GoPicOn');			actionSelector: #goUp:with:; 			arguments: (Array with: nil with: aButton);			actWhen: #buttonUp;			target: self;			setNameTo: 'Go Button';			setBalloonText:'Resume running all paused scripts' translated.	^ aButton! !!StandardScriptingSystem methodsFor: 'script-control' stamp: 'dgd 9/19/2003 14:41'!stepButton	| aButton |	self flag: #deferred.  "ambiguity about recipients"	aButton _ ThreePhaseButtonMorph new.		aButton			image:  (ScriptingSystem formAtKey: 'StepPicOn');			offImage: (ScriptingSystem formAtKey: 'StepPic');			pressedImage:  (ScriptingSystem formAtKey: 'StepPicOn');			arguments: (Array with: nil with: aButton);		 	actionSelector: #stepStillDown:with:; 			target: self;			setNameTo: 'Step Button'; 			actWhen: #whilePressed;			on: #mouseDown send: #stepDown:with: to: self;			on: #mouseStillDown send: #stepStillDown:with: to: self;			on: #mouseUp send: #stepUp:with: to: self;			setBalloonText:'Run every paused script exactly once.  Keep the mouse button down over "Step" and everything will keep running until you release it' translated.	^ aButton! !!StandardScriptingSystem methodsFor: 'script-control' stamp: 'dgd 9/19/2003 14:41'!stopButton	"Answer a new button that can serve as a stop button"	| aButton |	aButton _ ThreePhaseButtonMorph new.	aButton		image:  (ScriptingSystem formAtKey: 'StopPic');		offImage: (ScriptingSystem formAtKey: 'StopPic');		pressedImage:  (ScriptingSystem formAtKey: 'StopPicOn').		aButton actionSelector: #stopUp:with:; 		arguments: (Array with: nil with: aButton);		actWhen: #buttonUp;		target: self;		setNameTo: 'Stop Button'; 		setBalloonText: 'Pause all ticking scripts.' translated.	^ aButton! !!StandardScriptingSystem methodsFor: 'utilities' stamp: 'dgd 9/20/2003 16:08'!helpStringForOperator: anOperator	"Answer the help string associated with the given operator"	| anIndex opsAndHelp |	(anIndex _ (opsAndHelp _ self arithmeticalOperatorsAndHelpStrings) first indexOf: anOperator) > 0		ifTrue:	[^ (opsAndHelp second at: anIndex) translated].	(anIndex _ (opsAndHelp _ self numericComparitorsAndHelpStrings) first indexOf: anOperator) > 0		ifTrue:	[^ (opsAndHelp second at: anIndex) translated].	^ 'And I called my cow, no help now' translated	"This should never be seen, but if it is, we should hear the moo eventually"! !!StandardViewer methodsFor: 'initialization' stamp: 'dgd 10/8/2003 20:02'!addHeaderMorphWithBarHeight: anInteger includeDismissButton: aBoolean	"Add the header morph to the receiver, using anInteger as a guide for its height, and if aBoolean is true, include a dismiss buton for it"	| header aFont aButton aTextMorph nail wrpr costs headWrapper |	header _ AlignmentMorph newRow color: self color muchLighter; wrapCentering: #center; cellPositioning: #leftCenter.	aFont _ Preferences standardButtonFont.	aBoolean ifTrue:		[header addMorph: (aButton _ SimpleButtonMorph new label: 'O' font: aFont).		aButton target: self;				color:  Color tan;				actionSelector: #dismiss;				setBalloonText: 'remove this entire Viewer from the screendon''t worry -- nothing will be lost!!.' translated.		header addTransparentSpacerOfSize: 4@1].	aButton _ IconicButton new borderWidth: 0;			labelGraphic: (ScriptingSystem formAtKey: #AddCategoryViewer); color: Color transparent; 			actWhen: #buttonDown;			target: self;			actionSelector: #addCategoryViewer;			setBalloonText: 'click here to addanother category pane' translated;			shedSelvedge.	header addMorphBack: aButton.	header addTransparentSpacerOfSize: 4@1.	costs _ scriptedPlayer costumes.	costs ifNotNil:	[(costs size > 1 or: [costs size = 1 and: [costs first ~~ scriptedPlayer costume]]) ifTrue:		[header addUpDownArrowsFor: self.		(wrpr _ header submorphs last) submorphs second setBalloonText: 'switch to previous costume' translated.			wrpr submorphs first  setBalloonText: 'switch to next costume' translated]].		nail _ (self hasProperty: #noInteriorThumbnail)		ifFalse:			[ThumbnailMorph new objectToView: scriptedPlayer viewSelector: #costume]		ifTrue:			[ImageMorph new image: Cursor menu].	nail on: #mouseDown send: #offerViewerMenuForEvt:morph: to: scriptedPlayer.	header addMorphBack: nail.	nail setBalloonText: 'click here to get a menuthat will allow you toadd an instance variable,,tear off a tile, etc..' translated.	(self hasProperty: #noInteriorThumbnail)		ifFalse:			[nail borderWidth: 3; borderColor: #raised].	header addTransparentSpacerOfSize: 5@5."	aButton _ SimpleButtonMorph new target: self; actionSelector: #newEmptyScript; label: 'S' translated font: (aFont _ StrikeFont familyName: #ComicBold size: 16);  color: Color transparent; borderWidth: 0; actWhen: #buttonDown.	aButton setBalloonText: 'drag from here tocreate a new scriptfor this object' translated.		header addMorphBack: aButton.	header addTransparentSpacerOfSize: 8@5.	aButton _ SimpleButtonMorph new target: scriptedPlayer; actionSelector: #addInstanceVariable; label: 'I' translated font: aFont;  color: Color transparent; borderWidth: 0; actWhen: #buttonUp.	aButton setBalloonText: 'click here to addan instance variableto this object.' translated.	header addMorphBack: aButton.	header addTransparentSpacerOfSize: 5@5."	self viewsMorph ifTrue: [scriptedPlayer costume assureExternalName].	aTextMorph _ UpdatingStringMorph new		useStringFormat;		target:  scriptedPlayer;		getSelector: #nameForViewer;		setNameTo: 'name';		font: ScriptingSystem fontForNameEditingInScriptor.	self viewsMorph ifTrue:		[aTextMorph putSelector: #setName:.		aTextMorph setProperty: #okToTextEdit toValue: true].	aTextMorph step.	header  addMorphBack: aTextMorph.	aTextMorph setBalloonText: 'Click here to edit the player''s name.' translated.		header beSticky.	anInteger > 0		ifTrue:			[headWrapper _ AlignmentMorph newColumn color: self color.			headWrapper addTransparentSpacerOfSize: (0 @ anInteger).			headWrapper addMorphBack: header.			self addMorph: headWrapper]		ifFalse:			[self addMorph: header]! !!StarSqueakMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:17'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addLine.	aCustomMenu add: 'start' translated action: #startRunning.	aCustomMenu add: 'stop' translated action: #stopRunning.	aCustomMenu add: 'step' translated action: #singleStep.	aCustomMenu add: 'start over' translated action: #startOver.	aCustomMenu addLine.	aCustomMenu add: 'full speed' translated action: #fullSpeed.	aCustomMenu add: 'slow speed' translated action: #slowSpeed.	aCustomMenu addLine.	aCustomMenu add: 'set scale' translated action: #setScale.	aCustomMenu add: 'make parameter slider' translated action: #makeParameterSlider.! !!StarSqueakTrees methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:17'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addLine.	aCustomMenu add: 'set tree depth' translated action: #setTreeDepth.	aCustomMenu add: 'set tree type' translated action: #setTreeType.! !!StringHolderView methodsFor: 'updating' stamp: 'dgd 9/21/2003 17:42'!promptForCancel	"Ask if it is OK to cancel changes to text"	| okToCancel stripes |	self topView isCollapsed ifTrue:		[(self confirm: 'Changes have not been saved.Is it OK to cancel those changes?' translated) ifTrue: [model clearUserEditFlag].		^ self].	stripes _ (Form extent: 16@16 fromStipple: 16r36C9) bits.	Display border: self insetDisplayBox width: 4			rule: Form reverse fillColor: stripes.	okToCancel _ self confirm: 'Changes have not been saved.Is it OK to cancel those changes?' translated.	Display border: self insetDisplayBox width: 4			rule: Form reverse fillColor: stripes.	okToCancel ifTrue:		[self updateDisplayContents.		model clearUserEditFlag].! !!StringMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:17'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'change font' translated action: #changeFont.	aCustomMenu add: 'change emphasis' translated action: #changeEmphasis.! !!ClockMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:17'!addCustomMenuItems: aCustomMenu hand: aHandMorph	"Note minor loose end here -- if the menu is persistent, then the wording will be wrong half the time"	| item |	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	item _ showSeconds == true		ifTrue:	['stop showing seconds']		ifFalse: ['start showing seconds'].	aCustomMenu add: item translated target: self action: #toggleShowingSeconds! !!StringButtonMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:17'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'change label' translated action: #setLabel.	aCustomMenu add: 'change action selector' translated action: #setActionSelector.	aCustomMenu add: 'change arguments' translated action: #setArguments.	aCustomMenu add: 'change when to act' translated action: #setActWhen.	((self world rootMorphsAt: aHandMorph targetOffset) size > 1) ifTrue: [		aCustomMenu add: 'set target' translated action: #setTarget:].! !!SystemDictionary methodsFor: 'snapshot and quit' stamp: 'sd 11/13/2003 21:25'!getFileNameFromUser	| newName |	newName _ FillInTheBlank		request: 'New File Name?' translated		initialAnswer: (FileDirectory localNameFor: SmalltalkImage current imageName).	newName = '' ifTrue: [^nil].	((FileDirectory default includesKey: (self fullNameForImageNamed: newName)) or:	 [FileDirectory default includesKey: (self fullNameForChangesNamed: newName)]) ifTrue: [		(self confirm: ('{1} already exists. Overwrite?' translated format: {newName})) ifFalse: [^nil]].	^newName! !!SystemWindow methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:17'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph."template..."	aCustomMenu addLine.	aCustomMenu add: 'edit label...' translated action: #relabel..! !!SystemWindow methodsFor: 'menu' stamp: 'dgd 8/30/2003 16:40'!buildWindowMenu	| aMenu |	aMenu _ MenuMorph new defaultTarget: self.	aMenu add: 'change title...' translated action: #relabel.	aMenu addLine.	aMenu add: 'send to back' translated action: #sendToBack.	aMenu add: 'make next-to-topmost' translated action: #makeSecondTopmost.	aMenu addLine.	self mustNotClose		ifFalse:			[aMenu add: 'make unclosable' translated action: #makeUnclosable]		ifTrue:			[aMenu add: 'make closable' translated action: #makeClosable].	aMenu		add: (self isSticky ifTrue: ['make draggable'] ifFalse: ['make undraggable']) translated 		action: #toggleStickiness.	aMenu addLine.	aMenu add: 'full screen' translated action: #fullScreen.	self isCollapsed ifFalse: [aMenu add: 'window color...' translated action: #setWindowColor].	^aMenu! !!CollapsedMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 16:41'!buildWindowMenu	"Answer the menu to be put up in response to the user's clicking on the window-menu control in the window title.  Specialized for CollapsedMorphs."	| aMenu |	aMenu _ MenuMorph new defaultTarget: self.	aMenu add: 'change name...' translated action: #relabel.	aMenu addLine.	aMenu add: 'send to back' translated action: #sendToBack.	aMenu add: 'make next-to-topmost' translated action: #makeSecondTopmost.	aMenu addLine.	self mustNotClose		ifFalse:			[aMenu add: 'make unclosable' translated action: #makeUnclosable]		ifTrue:			[aMenu add: 'make closable' translated action: #makeClosable].	aMenu		add: (self isSticky ifTrue: ['make draggable'] ifFalse: ['make undraggable']) translated 		action: #toggleStickiness.	^aMenu! !!FlashPlayerWindow methodsFor: 'initialization' stamp: 'dgd 9/20/2003 16:43'!initialize	| aFont |	super initialize.	aFont _  Preferences standardButtonFont.	self addMorph: (startButton _ SimpleButtonMorph new borderWidth: 0;			label: 'play' translated font: aFont; color: Color transparent;			actionSelector: #startPlaying; target: self).	startButton setBalloonText: 'continue playing' translated.	self addMorph: (stopButton _ SimpleButtonMorph new borderWidth: 0;			label: 'stop' translated font: aFont; color: Color transparent;			actionSelector: #stopPlaying; target: self).	stopButton setBalloonText: 'stop playing' translated.	startButton submorphs first color: Color blue.	stopButton submorphs first color: Color red.	self adjustBookControls! !!IRCMorph methodsFor: 'interface' stamp: 'dgd 8/30/2003 21:45'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu  hand: aHandMorph.	aCustomMenu addLine.	aCustomMenu add: 'connect to server' translated action: #makeConnection.	aCustomMenu addLine.	aCustomMenu add: 'view MOTD' translated action: #openMotd.	aCustomMenu add: 'view channel list' translated action: #openChannelList.! !!PartsWindow methodsFor: 'menus' stamp: 'dgd 8/30/2003 21:56'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'parts window controls...' translated action: #invokePartsWindowMenu! !!TTSampleFontMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 21:42'!getSmoothingLevel	"Menu support"	smoothing = 1		ifTrue: [^ 'turn on smoothing' translated].	smoothing = 2		ifTrue: [^ 'more smoothing' translated].	smoothing = 4		ifTrue: [^ 'turn off smoothing' translated]! !!TTSampleStringMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 22:17'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'edit contents...' translated action: #edit.	aCustomMenu add: 'how to find more fonts...' translated action: #howTo.	aCustomMenu add: 'load font from web...' translated action: #loadFromURL.! !!TabbedPalette methodsFor: 'palette menu' stamp: 'dgd 8/30/2003 21:14'!addBookMenuItemsTo: aCustomMenu hand: aHandMorph 	aCustomMenu add: 'add palette menu' translated action: #addMenuTab.	aCustomMenu add: 'become the Standard palette' translated action: #becomeStandardPalette! !!TabbedPalette methodsFor: 'palette menu' stamp: 'dgd 9/20/2003 19:08'!addMenuTab	"Add the menu tab.  This is ancient code, not much in the spirit of anything current"	| aMenu aTab aGraphic sk |	aMenu _ MenuMorph new defaultTarget: self.	aMenu stayUp: true.	"aMenu add:  'clear' translated action: #showNoPalette."	aMenu add:  'sort tabs' translated action: #sortTabs:.	aMenu add:  'choose new colors for tabs' translated action: #recolorTabs.	aMenu setProperty: #paletteMenu toValue: true.	"aMenu add:  'make me the Standard palette' translated action: #becomeStandardPalette."	aTab _ self addTabForBook: aMenu  withBalloonText: 'a menu of palette-related controls' translated.	aTab highlightColor: tabsMorph highlightColor; regularColor: tabsMorph regularColor.	tabsMorph laySubpartsOutInOneRow; layoutChanged.	aGraphic _ ScriptingSystem formAtKey: 'TinyMenu'.	aGraphic ifNotNil:		[aTab removeAllMorphs.		aTab addMorph: (sk _ SketchMorph withForm: aGraphic).		sk position: aTab position.		sk lock.		aTab fitContents].	self layoutChanged! !!TextMorph methodsFor: 'menu' stamp: 'dgd 10/8/2003 20:08'!addCustomMenuItems: aCustomMenu hand: aHandMorph	| outer |	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'text color...' translated action: #changeTextColor.	aCustomMenu addUpdating: #autoFitString target: self action: #autoFitOnOff.	aCustomMenu addUpdating: #wrapString target: self action: #wrapOnOff.	aCustomMenu add: 'text margins...' translated action: #changeMargins:.	aCustomMenu add: 'add predecessor' translated action: #addPredecessor:.	aCustomMenu add: 'add successor' translated action: #addSuccessor:.	(Preferences valueOfFlag: #noviceMode) not & 		(Preferences valueOfFlag: #simpleMenus) not ifTrue: [			aCustomMenu add: 'code pane menu...' translated action: #yellowButtonActivity.			aCustomMenu add: 'code pane shift menu....' translated action: #shiftedYellowButtonActivity].	outer _ self owner.	((outer isKindOf: PolygonMorph) and: [outer isOpen]) ifTrue:		[container isNil			ifTrue: [aCustomMenu add: 'follow owner''s curve' translated action: #followCurve]			ifFalse: [aCustomMenu add: 'reverse direction' translated action: #reverseCurveDirection.					aCustomMenu add: 'set baseline' translated action: #setCurveBaseline:]]		ifFalse:		[(container isNil or: [container fillsOwner not])			ifTrue: [aCustomMenu add: 'fill owner''s shape' translated action: #fillingOnOff]			ifFalse: [aCustomMenu add: 'rectangluar bounds' translated action: #fillingOnOff].		(container isNil or: [container avoidsOcclusions not])			ifTrue: [aCustomMenu add: 'avoid occlusions' translated action: #occlusionsOnOff]			ifFalse: [aCustomMenu add: 'ignore occlusions' translated action: #occlusionsOnOff]].! !!TextMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:06'!autoFitString	"Answer the string to put in a menu that will invite the user to 	switch autoFit mode"	^ (self isAutoFit		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'text auto fit' translated! !!TextMorph methodsFor: 'menu' stamp: 'dgd 8/26/2003 21:44'!changeMargins: evt	| handle origin aHand oldMargin newMargin |	aHand _ evt ifNil: [self primaryHand] ifNotNil: [evt hand].	origin _ aHand position.	oldMargin _ margins.	handle _ HandleMorph new		forEachPointDo:			[:newPoint | handle removeAllMorphs.			handle addMorph:				(LineMorph from: origin to: newPoint color: Color black width: 1).			newMargin _ (newPoint - origin max: 0@0) // 5.			self margins: newMargin]		lastPointDo:			[:newPoint | handle deleteBalloon.			self halo doIfNotNil: [:halo | halo addHandles].			self rememberCommand:				(Command new cmdWording: 'margin change' translated;					undoTarget: self selector: #margins: argument: oldMargin;					redoTarget: self selector: #margins: argument: newMargin)].	aHand attachMorph: handle.	handle setProperty: #helpAtCenter toValue: true.	handle showBalloon:'Move cursor down and to the rightto increase margin inset.Click when done.' hand: evt hand.	handle startStepping! !!TextMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:18'!wrapString	"Answer the string to put in a menu that will invite the user to 	switch autoFit mode"	^ (wrapFlag		ifTrue: ['<yes>']		ifFalse: ['<no>'])		, 'text wrap to bounds' translated! !!TextPlusPasteUpMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/30/2003 22:19'!showPageBreaksString	^ (showPageBreaks		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'show page breaks' translated! !!TextPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 21:54'!paneForApplyToWholeText	^self inARow: {		self			directToggleButtonFor: self 			getter: #applyToWholeText			setter: #toggleApplyToWholeText			help: 'Whether to apply style changes to entire text or just selection' translated.		self lockedString: ' Apply changes to entire text ' translated.	}! !!TextPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 21:54'!paneForAutoFitToggle	^self inARow: {		self			directToggleButtonFor: self 			getter: #targetHasAutoFit			setter: #toggleTargetAutoFit			help: 'Turn auto-fit on or off' translated.		self lockedString: ' Auto-Fit' translated.	}! !!TextPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 21:54'!paneForMargins	^(self inARow: {		self			buildFakeSlider: 'Margins' translated 			selector: #adjustTargetMargin:			help: 'Drag in here to change the margins of the text' translated	}) hResizing: #shrinkWrap! !!TextPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 21:54'!paneForTextColorPicker	^self 		inAColumn: {			self 				colorPickerFor: self				getter: #targetTextColor				setter: #changeTargetColorTo:.			self lockedString: 'Text Color' translated.		} 		named: #pickerForTextColor.! !!TextPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 21:54'!paneForWrappingToggle	^self inARow: {		self			directToggleButtonFor: self 			getter: #targetHasWrapping			setter: #toggleTargetWrapping			help: 'Turn line wrapping on or off' translated.		self lockedString: ' Wrapping' translated.	}! !!TextPropertiesMorph methodsFor: 'as yet unclassified' stamp: 'dgd 8/31/2003 21:56'!rebuild	| buttonColor c |	self removeAllMorphs.	self addAColumn: {		self lockedString: ('Text Properties for {1}' translated format:{myTarget name}).	}.	self addAColumn: {		self paneForApplyToWholeText.	}.	c _ self addAColumn: {		self activeTextMorph.	}.	c 		wrapCentering: #topLeft;		color: Color white;		borderWidth: 2;		borderColor: color darker.	self addAColumn: {		self paneForTextColorPicker.	}.	self addARow: {		self paneForAutoFitToggle.	}.	self addARow: {		self paneForWrappingToggle.	}.	self addARow: {		self paneForMargins.	}.	buttonColor _ color lighter.	self addARow: {		self inAColumn: {			self addARow: {				self 					buttonNamed: 'Size' translated action: #offerFontMenu color: buttonColor					help: 'font changing' translated.				self 					buttonNamed: 'Style' translated action: #changeStyle color: buttonColor					help: 'font changing' translated.				self 					buttonNamed: 'N' translated action: #changeToNormalText color: buttonColor					help: 'normal text' translated.				self 					buttonNamed: 'B' translated action: #toggleBold color: buttonColor					help: 'bold text' translated.				self 					buttonNamed: 'I' translated action: #toggleItalic color: buttonColor					help: 'italic text' translated.				self 					buttonNamed: 'n' translated action: #toggleNarrow color: buttonColor					help: 'narrow text' translated.				self 					buttonNamed: 'U' translated action: #toggleUnderlined color: buttonColor					help: 'underlined text' translated.				self 					buttonNamed: 'S' translated action: #toggleStruckOut color: buttonColor					help: 'struck out text' translated.				self 					buttonNamed: 'Kern-' translated action: #kernMinus color: buttonColor					help: 'decrease kern' translated.				self 					buttonNamed: 'Kern+' translated action: #kernPlus color: buttonColor					help: 'increase kern' translated.			}.		}.	}.	self addARow: {		self inAColumn: {			self addARow: {				self 					buttonNamed: 'Accept' translated action: #doAccept color: buttonColor					help: 'keep changes made and close panel' translated.				self 					buttonNamed: 'Cancel' translated action: #doCancel color: buttonColor					help: 'cancel changes made and close panel' translated.			}.		}.	}.! !!TextStyle class methodsFor: 'user interface' stamp: 'dgd 10/8/2003 18:38'!fontSizeSummary	"Open a text window with a simple summary of the available sizes in each of the fonts in the system."	"TextStyle fontSizeSummary"	| aString aList |	aList _ self knownTextStyles.	aString _ String streamContents:		[:aStream |			aList do: [:aStyleName |				aStream nextPutAll:					aStyleName, '  ',					(self fontPointSizesFor: aStyleName) asArray storeString.				aStream cr]].	(StringHolder new contents: aString)		openLabel: 'Font styles and sizes' translated! !!TextURL methodsFor: 'as yet unclassified' stamp: 'dgd 10/8/2003 18:31'!actOnClickFor: anObject	"Do what you can with this URL.  Later a web browser."	| response m |	(url beginsWith: 'sqPr://') ifTrue: [		ProjectLoading thumbnailFromUrl: (url copyFrom: 8 to: url size).		^self		"should not get here, but what the heck"	].	"if it's a web browser, tell it to jump"	anObject isWebBrowser		ifTrue: [anObject jumpToUrl: url. ^ true]		ifFalse: [((anObject respondsTo: #model) and: [anObject model isWebBrowser])				ifTrue: [anObject model jumpToUrl: url. ^ true]].		"if it's a morph, see if it is contained in a web browser"		(anObject isKindOf: Morph) ifTrue: [			m _ anObject.			[ m ~= nil ] whileTrue: [				(m isWebBrowser) ifTrue: [					m  jumpToUrl: url.					^true ].				(m hasProperty: #webBrowserView) ifTrue: [					m model jumpToUrl: url.					^true ].				m _ m owner. ]		].	"no browser in sight.  ask if we should start a new browser"	((self confirm: 'open a browser to view this URL?' translated) and: [WebBrowser default notNil]) ifTrue: [		WebBrowser default openOnUrl: url.		^ true ].	"couldn't display in a browser.  Offer to put up just the source"	response _ (PopUpMenu labels: 'View web page as sourceCancel' translated)		startUpWithCaption: 'Couldn''t find a web browser.  Viewpage as source?' translated.	response = 1 ifTrue: [HTTPSocket httpShowPage: url].	^ true! !!TheWorldMenu methodsFor: 'action' stamp: 'dgd 9/1/2003 15:05'!uniTilesClassicString	^ ((myProject			parameterAt: #uniTilesClassic			ifAbsent: [false])		ifTrue: ['<yes>']		ifFalse: ['<no>']), 'classic tiles' translated! !!TheWorldMenu methodsFor: 'commands' stamp: 'dgd 9/21/2003 17:43'!cleanUpWorld	(SelectionMenu confirm:'This will remove all windows except thosecontaining unsubmitted text edits, and willalso remove all non-window morphs (otherthan flaps) found on the desktop.  Are yousure you want to do this?' translated)		ifFalse: [^ self].	myWorld allNonFlapRelatedSubmorphs do:		[:m | m delete].	(SystemWindow windowsIn: myWorld satisfying: [:w | w model canDiscardEdits])		do: [:w | w delete]! !!TheWorldMenu methodsFor: 'commands' stamp: 'dgd 9/21/2003 13:17'!loadProject	| stdFileMenuResult |	"Put up a Menu and let the user choose a '.project' file to load.  Create a thumbnail and jump into the project."	Project canWeLoadAProjectNow ifFalse: [^ self].	stdFileMenuResult _ ((StandardFileMenu new) pattern: '*.pr'; 		oldFileFrom: FileDirectory default ) 			startUpWithCaption: 'Select a File:' translated.	stdFileMenuResult ifNil: [^ nil].	ProjectLoading 		openFromDirectory: stdFileMenuResult directory 		andFileName: stdFileMenuResult name! !!TheWorldMenu methodsFor: 'commands' stamp: 'dgd 9/5/2003 18:25'!quitSession	Smalltalk		snapshot: (self confirm: 'Save changes before quitting?' translated orCancel: [^ self])		andQuit: true! !!TheWorldMenu methodsFor: 'commands' stamp: 'dgd 9/21/2003 13:20'!readMorphFromAFile	"Produce a morph from a file -- either a saved .morph file or a graphics file"	| morphOrList ff aName f m |	aName _ Utilities chooseFileWithSuffixFromList:(#('.morph'), Utilities graphicsFileSuffixes) withCaption: 'Choose a fileto load' translated.	aName ifNil: [^ self].  "User made no choice"	aName == #none ifTrue: [^ self inform: 'Sorry, no suitable files found(names should end with .morph, .gif,.bmp, .jpeg, .jpe, .jp, or .form)' translated].	(aName asLowercase endsWith: '.morph')		ifTrue:			[ff _ FileStream readOnlyFileNamed: aName.			morphOrList _ ff fileInObjectAndCode.		"code filed in is the Model class"			"the file may contain either a single morph or an array of morphs"			myWorld addMorphsAndModel: morphOrList]		ifFalse:			[f _ Form fromFileNamed: aName.			f ifNil: [^ self error: 'unrecognized image file format' translated].			m _ myWorld drawingClass new form: f.			myHand attachMorph: m]! !!TheWorldMenu methodsFor: 'commands' stamp: 'dgd 9/6/2003 18:17'!setDisplayDepth	"Let the user choose a new depth for the display. "	| result oldDepth allDepths allLabels menu hasBoth |	oldDepth _ Display nativeDepth.	allDepths _ #(1 -1 2 -2 4 -4 8 -8 16 -16 32 -32) select: [:d | Display supportsDisplayDepth: d].	hasBoth _ (allDepths anySatisfy:[:d| d > 0]) and:[allDepths anySatisfy:[:d| d < 0]].	allLabels _ allDepths collect:[:d|		String streamContents:[:s|			s nextPutAll: (d = oldDepth ifTrue:['<on>'] ifFalse:['<off>']).			s print: d abs.			hasBoth ifTrue:[s nextPutAll: (d > 0 ifTrue:['  (big endian)'] ifFalse:['  (little endian)'])].		]].	menu _ SelectionMenu labels: allLabels selections: allDepths.	result _ menu startUpWithCaption: 'Choose a display depth' translated.	result ifNotNil: [Display newDepth: result].	oldDepth _ oldDepth abs.	(Smalltalk isMorphic and: [(Display depth < 4) ~= (oldDepth < 4)])		ifTrue:			["Repaint windows since they look better all white in depth < 4"			(SystemWindow windowsIn: myWorld satisfying: [:w | true]) do:				[:w |				oldDepth < 4					ifTrue: [w restoreDefaultPaneColor]					ifFalse: [w updatePaneColors]]]! !!TheWorldMenu methodsFor: 'commands' stamp: 'dgd 10/8/2003 20:11'!worldMenuHelp	| aList aMenu cnts explanation |	"self currentWorld primaryHand worldMenuHelp"	aList _ OrderedCollection new.	#(helpMenu changesMenu openMenu debugMenu projectMenu scriptingMenu windowsMenu playfieldMenu appearanceMenu flapsMenu) 		with:	#('help' 'changes' 'open' 'debug' 'projects' 'authoring tools' 'windows' 'playfield options' 'appearance' 'flaps') do:		[:sel :title | aMenu _ self perform: sel.			aMenu items do:				[:it | (((cnts _ it contents) = 'keep this menu up') or: [cnts isEmpty])					ifFalse: [aList add: (cnts, ' - ', title translated)]]].	aList _ aList asSortedCollection: [:a :b | a asLowercase < b asLowercase].	explanation _ String streamContents: [:aStream | aList do:		[:anItem | aStream nextPutAll: anItem; cr]].	(StringHolder new contents: explanation)		openLabel: 'Where in the world menu is...' translated! !!TheWorldMenu methodsFor: 'construction' stamp: 'dgd 8/26/2003 21:23'!fillIn: aMenu from: dataForMenu	"A menu constructor utility by RAA.  dataForMenu is a list of items which mean:			nil							Indicates to add a line			first element is symbol		Add updating item with the symbol as the wording selector			second element is a list		second element has the receiver and selector			first element is a string		Add menu item with the string as its wording			second element is a list		second element has the receiver and selector			a third element exists		Use it as the balloon text			a fourth element exists		Use it as the enablement selector (updating case only)"	| item |	dataForMenu do: [ :itemData |		itemData ifNil: [aMenu addLine] ifNotNil:			[item _ (itemData first isKindOf: Symbol)				ifTrue: 					[aMenu 						addUpdating: itemData first 						target: self 						selector: #doMenuItem:with: 						argumentList: {itemData second}]				 ifFalse:					[aMenu 						add: itemData first translated						target: self 						selector: #doMenuItem:with: 						argumentList: {itemData second}].			itemData size >= 3 ifTrue:				[aMenu balloonTextForLastItem: itemData third translated.			itemData size >= 4 ifTrue:				[item enablementSelector: itemData fourth]]]].	^ aMenu! !!TheWorldMenu methodsFor: 'construction' stamp: 'dgd 9/19/2003 13:21'!newMorph	"The user requested 'new morph' from the world menu.  Put up a menu that allows many ways of obtaining new morphs.  If the preference #classicNewMorphMenu is true, the full form of yore is used; otherwise, a much shortened form is used."	| menu subMenu catDict shortCat class |	menu _ self menu: 'Add a new morph'.	menu 		add: 'from paste buffer' translated target: myHand action: #pasteMorph;		add: 'from alphabetical list' translated subMenu: self alphabeticalMorphMenu;		add: 'from a file...' translated target: self action: #readMorphFromAFile.	menu addLine.	menu add: 'grab rectangle from screen' translated target: myWorld action: #grabDrawingFromScreen:;		add: 'grab with lasso from screen' translated target: myWorld action: #grabLassoFromScreen:;		add: 'grab rubber band from screen' translated target: myWorld action: #grabRubberBandFromScreen:;		add: 'grab flood area from screen' translated target: myWorld action: #grabFloodFromScreen:.	menu addLine.	menu add: 'make new drawing' translated target: myWorld action: #newDrawingFromMenu:;		add: 'make link to project...' translated target: self action: #projectThumbnail.	Preferences classicNewMorphMenu ifTrue:		[menu addLine.		catDict _ Dictionary new.		SystemOrganization categories do:			[:cat |			((cat beginsWith: 'Morphic-')					and: [(#('Morphic-Menus' 'Morphic-Support') includes: cat) not])			ifTrue:				[shortCat _ (cat copyFrom: 'Morphic-' size+1 to: cat size) translated.				(SystemOrganization listAtCategoryNamed: cat) do:					[:cName | class _ Smalltalk at: cName.					((class inheritsFrom: Morph)						and: [class includeInNewMorphMenu])						ifTrue:						[(catDict includesKey: shortCat) 						ifTrue: [(catDict at: shortCat) addLast: class]						ifFalse: [catDict at: shortCat put: (OrderedCollection with: class)]]]]].		catDict keys asSortedCollection do:			[:categ |			subMenu _ MenuMorph new.			((catDict at: categ) asSortedCollection: [:c1 :c2 | c1 name < c2 name]) do:				[:cl | subMenu add: cl name						target: self						selector: #newMorphOfClass:event:						argument: cl].			menu add: categ subMenu: subMenu]].	self doPopUp: menu.! !!TheWorldMenu methodsFor: 'mechanics' stamp: 'dgd 8/26/2003 21:05'!menu: titleString	"Create a menu with the given title, ready for filling"	| menu |	(menu _ MenuMorph entitled: titleString translated) 		defaultTarget: self; 		addStayUpItem;		commandKeyHandler: self.	self colorForDebugging: menu.	^ menu! !!TheWorldMenu methodsFor: 'windows & flaps menu' stamp: 'dgd 8/31/2003 19:15'!formulateFlapsMenu: aMenu	"Fill aMenu with appropriate content"	aMenu addTitle: 'flaps' translated.	aMenu addStayUpItem.	Preferences classicNavigatorEnabled ifTrue:		[aMenu			addUpdating: #navigatorShowingString			enablementSelector: #enableProjectNavigator			target: Preferences			selector: #togglePreference: 			argumentList: #(showProjectNavigator).		aMenu balloonTextForLastItem: (Preferences preferenceAt: #showProjectNavigator) helpString translated].	Flaps sharedFlapsAllowed		ifTrue:			[self fillIn: aMenu from:				{{#suppressFlapsString.					{CurrentProjectRefactoring. #currentToggleFlapsSuppressed}.				'Whether prevailing flaps should be shown in the project right now or not.' translated}}.			aMenu addUpdating: #automaticFlapLayoutString  target: Preferences selector: #togglePreference: argumentList: #(automaticFlapLayout).			aMenu balloonTextForLastItem: (Preferences preferenceAt: #automaticFlapLayout) helpString translated.			aMenu addLine.			Flaps addIndividualGlobalFlapItemsTo: aMenu].     self fillIn: aMenu from: {			nil.               {'make a new flap' translated.			{Flaps. #addLocalFlap}.			'Create a new flap.  You can later make it into a shared flap is you wish.' translated}.			nil.}.	Flaps sharedFlapsAllowed		ifTrue:			[aMenu addWithLabel: 'put shared flaps on bottom' translated enablementSelector: #showSharedFlaps				target: Flaps selector: #sharedFlapsAlongBottom argumentList: #().			aMenu balloonTextForLastItem: 'Group all the standard shared flaps along the bottom edge of the screen' translated.			self fillIn: aMenu from: {				{'destroy all shared flaps' translated.				{Flaps. #disableGlobalFlaps}.				'Destroy all the shared flaps and disable their use in all projects.' translated}}]		ifFalse:			[aMenu add: 'install default shared flaps' translated target: Flaps action: #enableGlobalFlaps.			aMenu balloonTextForLastItem: 'Create the default set of shared flaps' translated.			aMenu add: 'install etoy flaps' translated target: Flaps action: #enableEToyFlaps.			aMenu balloonTextForLastItem: 'Put up the default etoy flaps: a custom Suplies flap and the Navigator flap' translated.			aMenu addLine].	self fillIn: aMenu from: {			nil.			{'about flaps...' translated.			{Flaps . #explainFlaps}.			'Gives a window full of details about how to use flaps.' translated}}! !!ThreadNavigationMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/19/2003 15:23'!makeButton: aString balloonText: anotherString for: aSymbol 	^ SimpleButtonDelayedMenuMorph new target: self;		 borderColor: #raised;		 color: self colorForButtons;		 label: aString translated font: self fontForButtons;		 setBalloonText: anotherString translated;		 actionSelector: aSymbol! !!InternalThreadNavigationMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/19/2003 15:27'!acceptSortedContentsFrom: aHolder	"Update my page list from the given page sorter."	| nameOfThisProject cachedData proj |	threadName isEmpty ifTrue: [threadName _ 'I need a name' translated].	threadName _ FillInTheBlank 		request: 'Name this thread.' translated 		initialAnswer: threadName.	threadName isEmptyOrNil ifTrue: [^self].	listOfPages _ OrderedCollection new.	aHolder submorphs doWithIndex: [:m :i |		(nameOfThisProject _ m valueOfProperty: #nameOfThisProject) ifNotNil: [			cachedData _ {nameOfThisProject}.			proj _ Project named: nameOfThisProject.			(proj isNil or: [proj thumbnail isNil]) ifFalse: [				cachedData _ cachedData, {proj thumbnail scaledToSize: self myThumbnailSize}.			].			listOfPages add: cachedData.		].	].	self class know: listOfPages as: threadName.	self removeAllMorphs; addButtons.	self world ifNil: [		self openInWorld; positionAppropriately.	].! !!InternalThreadNavigationMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/19/2003 15:41'!addButtons	| marginPt i sz data images pageNumber f m b1 b2 dot arrowWidth arrowCenter vertices arrowHeight nameMorph |	self changeNoLayout.	self hResizing: #rigid.	self vResizing: #rigid.	marginPt _ 4@4.	i _ self currentIndex.	sz _ self myThumbnailSize.	arrowWidth _ 14.	arrowHeight _ 17.	data _ {		{i - 1. 'Previous:'. #previousPage. #rightCenter. arrowWidth negated. 'Prev'}.		{i + 1. 'Next:'. #nextPage. #leftCenter. arrowWidth. 'Next'}	}.	images _ data collect: [ :tuple |		pageNumber _ tuple first.		(pageNumber between: 1 and: listOfPages size) ifTrue: [			f _ self 				makeThumbnailForPageNumber: pageNumber 				scaledToSize: sz 				default: tuple sixth.			f _ f deepCopy.		"we're going to mess it up"			arrowCenter _ f boundingBox perform: tuple fourth.			vertices _ {				arrowCenter - (0@arrowHeight).				arrowCenter + (0@arrowHeight).				arrowCenter + (tuple fifth @ 0).			}.			f getCanvas				drawPolygon: vertices 				color: Color orange 				borderWidth: 0 				borderColor: Color transparent.			m _ ImageMorph new image: f.			m setBalloonText: tuple second translated,' ',(listOfPages at: pageNumber) first.			m addMouseUpActionWith: (				MessageSend receiver: self selector: tuple third			).		] ifFalse: [			f _ (Form extent: sz depth: 16) fillColor: Color lightGray.			m _ ImageMorph new image: f.		].		m	].	b1 _ images first.	b2 _ images second.	dot _ EllipseMorph new extent: 16@16; color: Color orange lighter; borderWidth: 0.	self addMorph: (b1 position: self position + marginPt).	self addMorph: (b2 position: b1 topRight + (marginPt x @ 0)).	self extent: (b1 bottomRight max: b2 bottomRight) - self position + marginPt.	self addMorph: dot.	dot align: dot center with: b1 bounds rightCenter + ((marginPt x @ 0) // 2).	dot setBalloonText: threadName,'more commands'.	dot on: #mouseDown send: #moreCommands to: self.	self fullBounds.	self addMorph: (nameMorph _ SquishedNameMorph new).	nameMorph		target: self getSelector: #threadName setSelector: nil;		color: Color transparent;		width: self width;		height: 15;		align: nameMorph bottomLeft with: self bottomLeft.! !!InternalThreadNavigationMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/19/2003 15:30'!destroyThread	(self confirm: ('Destroy thread <{1}> ?' translated format:{threadName})) ifFalse: [^self].	self class knownThreads removeKey: threadName ifAbsent: [].	self delete! !!InternalThreadNavigationMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/19/2003 15:30'!ensureSuitableDefaults	listOfPages ifNil: [		listOfPages _ Project allMorphicProjects collect: [ :each | {each name}].		threadName _ 'all (default)' translated.		self class know: listOfPages as: threadName.	].	currentIndex ifNil: [currentIndex _ 0].! !!InternalThreadNavigationMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/19/2003 15:33'!jumpWithinThread	| aMenu me weHaveOthers myIndex |	me _ CurrentProjectRefactoring currentProjectName.	aMenu _ MenuMorph new defaultTarget: self.	weHaveOthers _ false.	myIndex _ self currentIndex.	listOfPages withIndexDo: [ :each :index |		index = myIndex ifTrue: [			aMenu add: 'you are here' translated action: #yourself.			aMenu lastSubmorph color: Color red.		] ifFalse: [			weHaveOthers _ true.			aMenu add: ('jump to <{1}>' translated format:{each first}) selector: #jumpToIndex: argument: index.			myIndex = (index - 1) ifTrue: [				aMenu lastSubmorph color: Color blue			].			myIndex = (index + 1) ifTrue: [				aMenu lastSubmorph color: Color orange			].		].	].	weHaveOthers ifFalse: [^self inform: 'This is the only project in this thread' translated].	aMenu popUpEvent: self world primaryHand lastEvent in: self world! !!InternalThreadNavigationMorph methodsFor: 'as yet unclassified' stamp: 'dgd 10/8/2003 19:09'!loadPageWithProgress	| projectInfo projectName |	projectInfo _ listOfPages at: currentIndex.	projectName _ projectInfo first.	loadedProject _ Project named: projectName.	self class know: listOfPages as: threadName.	WorldState addDeferredUIMessage: [		InternalThreadNavigationMorph openThreadNamed: threadName atIndex: currentIndex	] fixTemps.	loadedProject ifNil: [		ComplexProgressIndicator new 			targetMorph: self;			historyCategory: 'project loading' translated;			withProgressDo: [				[					loadedProject _ CurrentProjectRefactoring 							currentFromMyServerLoad: projectName				] 					on: ProjectViewOpenNotification					do: [ :ex | ex resume: false]								"we probably don't want a project view morph in this case"			].	].	loadedProject ifNil: [		^self inform: 'I cannot find that project' translated	].	self delete.	loadedProject enter.! !!InternalThreadNavigationMorph methodsFor: 'as yet unclassified' stamp: 'dgd 9/19/2003 15:36'!moreCommands	| allThreads aMenu others target |	allThreads _ self class knownThreads.	aMenu _ MenuMorph new defaultTarget: self.	others _ (allThreads keys reject: [ :each | each = threadName]) asSortedCollection.	others do: [ :each |		aMenu add: ('switch to <{1}>' translated format:{each}) selector: #switchToThread: argument: each.	].	aMenu 		add: 'switch to recent projects' translated action: #getRecentThread;		addLine;		add: 'create a new thread' translated action: #threadOfNoProjects;		add: 'edit this thread' translated action: #editThisThread;		add: 'create thread of all projects' translated action: #threadOfAllProjects;		addLine;		add: 'First project in thread' translated action: #firstPage;		add: 'Last project in thread' translated action: #lastPage.	(target _ self currentIndex + 2) > listOfPages size ifFalse: [		aMenu 			add: ('skip over next project ({1})' translated format:{(listOfPages at: target - 1) first})			action: #skipOverNext	].	aMenu		add: 'jump within this thread' translated action: #jumpWithinThread;		add: 'insert new project' translated action: #insertNewProject;		addLine;		add: 'simply close this navigator' translated action: #delete;		add: 'destroy this thread' translated action: #destroyThread.	aMenu popUpEvent: self world primaryHand lastEvent in: self world! !!TileMorph methodsFor: 'initialization' stamp: 'dgd 9/1/2003 13:34'!bePossessive	possessive := true.	self line1: actualObject externalName , '''s' translated! !!TileMorph methodsFor: 'initialization' stamp: 'dgd 9/1/2003 13:35'!bringUpToDate	"Make certain, if the receiver is an object-reference tile, that it shows the current external name of the object, which may just have changed.  This only applies to the Player regime." 	| newLabel |		(type == #objRef and: [actualObject isPlayerLike]) ifTrue:		[newLabel _ actualObject externalName.		self isPossessive ifTrue:			[newLabel _ newLabel, '''s' translated].		self line1: newLabel]! !!TileMorph methodsFor: 'initialization' stamp: 'dgd 9/1/2003 13:35'!retargetFrom: oldPlayer to: newPlayer	"Change the receiver so that if formerly it referred to oldPlayer, it refers to newPlayer instead"	| newLabel |	(type == #objRef  and: [actualObject == oldPlayer]) ifTrue:		[actualObject _ newPlayer.		[newLabel _ actualObject externalName.		self isPossessive ifTrue:			[newLabel _ newLabel, '''s' translated].		self line1: newLabel]]! !!TileMorph methodsFor: 'misc' stamp: 'dgd 8/30/2003 22:19'!addCustomMenuItems:  aMenu hand: aHandMorph	"Add custom halo menu items to a menu"	| aPlayer |	super addCustomMenuItems: aMenu hand: aHandMorph.	((aPlayer _ self associatedPlayer) notNil and:		[aPlayer costume isMorph]) ifTrue:			[aMenu addLine.			aMenu add: 'hand me this object' translated target: self action: #handReferentMorph.			aMenu balloonTextForLastItem: 'This tile refers to an actual graphical object; use this menu item to grab that object.  Caution!!  This may remove the object from a place it really ought to stay.' translated.			aMenu addLine ]! !!MenuTile methodsFor: 'initialization' stamp: 'dgd 9/6/2003 17:36'!initialize	"Initialize the menu tile"	super initialize.	self addArrows; setLiteral: 'send to back' translated.	self labelMorph useStringFormat; putSelector: nil! !!RandomNumberTile methodsFor: 'initialization' stamp: 'dgd 9/20/2003 19:11'!initialize	"Initialize the receiver fully, including adding all its relevant submorphs"	| m1 m2 |	super initialize.	self vResizing: #shrinkWrap.	self typeColor: (ScriptingSystem colorForType: #Number).	self addArrows.	m1 _ StringMorph contents: 'random' translated font: ScriptingSystem fontForTiles.	self addMorph: m1.	m2 _ UpdatingStringMorph contents: '180' font: ScriptingSystem fontForTiles.	m2 target: self; getSelector: #literal; putSelector: #literal:.	m2 position: m1 topRight.	self addMorphBack: m2.	literal _ 180.	self updateLiteralLabel.	self makeAllTilesGreen! !!TilePadMorph methodsFor: 'miscellaneous' stamp: 'dgd 8/30/2003 22:19'!addCustomMenuItems: aCustomMenu hand: aHandMorph	"Add custom menu items to the menu"	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'restore default tile' translated action: #restoreDefaultTile.! !!TinyPaint methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:20'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'clear' translated action: #clear.	aCustomMenu add: 'pen color' translated action: #setPenColor:.	aCustomMenu add: 'pen size' translated action: #setPenSize.	aCustomMenu add: 'fill' translated action: #fill.! !!TransformMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:20'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	smoothing = 1		ifTrue: [aCustomMenu add: 'turn on smoothing' translated action: #smoothingOn]		ifFalse: [aCustomMenu add: 'turn off smoothing' translated action: #smoothingOff]! !!TrashCanMorph methodsFor: 'initialization' stamp: 'dgd 9/19/2003 10:51'!initialize	"Initialize the receiver's graphics, name, and balloon-help"	super initialize.	self image: TrashPicOn;		offImage: TrashPic;		pressedImage: TrashPicOn.	self setNameTo: 'Trash' translated.	self setBalloonText:'To remove an object, drop it on any trash can. To view, and maybe retrieve, items that have been thrown away, double-click on any trash-can.  Things are retained in the trash-can if the "preserveTrash" preference is set, otherwise they are purged immediately' translated.! !!TypeListTile methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:20'!addCustomMenuItems: aCustomMenu hand: aHandMorph	"Add morph-specific items to the given menu"	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu add: 'choose type...' translated action: #offerAllChoicesInAPopUp! !!UpdatingStringMorph methodsFor: 'editing' stamp: 'dgd 8/30/2003 22:21'!addCustomMenuItems: menu hand: aHandMorph 	| prefix |	super addCustomMenuItems: menu hand: aHandMorph.	prefix := (self growable				ifTrue: ['stop being growable']				ifFalse: ['start being growable']) translated.	menu add: prefix action: #toggleGrowability.	menu add: 'decimal places...' translated action: #setPrecision.	menu add: 'font size...' translated action: #setFontSize.	menu add: 'font style...' translated action: #setFontStyle! !!Utilities class methodsFor: 'common requests' stamp: 'dgd 9/21/2003 13:52'!offerCommonRequestsInMorphic	"Offer up the common-requests menu.  If the user chooses one, then evaluate it, and -- provided the value is a number or string -- show it in the Transcript."	"Utilities offerCommonRequests"	| aMenu  strings |	(CommonRequestStrings == nil or: [CommonRequestStrings isKindOf: Array])		ifTrue:			[self initializeCommonRequestStrings].	strings _ CommonRequestStrings contents.	aMenu _ MenuMorph new.	aMenu title: 'Common Requests' translated.	aMenu addStayUpItem.	strings asString linesDo:		[:aString |			aString = '-'				ifTrue:					[aMenu addLine]				ifFalse:					[aString size == 0 ifTrue: [aString _ ' '].					aMenu add: aString target: self selector: #eval: argument: aString]].	aMenu addLine.	aMenu add: 'edit this list' translated target: self action: #editCommonRequestStrings.	aMenu popUpInWorld: self currentWorld! !!Utilities class methodsFor: 'scraps' stamp: 'dgd 9/19/2003 11:29'!maybeEmptyTrash	(self confirm: 'Do you really want to empty the trash?' translated)		ifTrue: [self emptyScrapsBook]! !!Utilities class methodsFor: 'scraps' stamp: 'dgd 9/19/2003 10:45'!scrapsBook	| header aButton label |	ScrapsBook ifNil:		[ScrapsBook _ BookMorph new pageSize: 200@300; setNameTo: 'scraps'.		ScrapsBook color: Color yellow muchLighter.		ScrapsBook borderColor: Color darkGray; borderWidth: 2.		ScrapsBook removeEverything; showPageControls; insertPage.		header _ AlignmentMorph newRow wrapCentering: #center; cellPositioning: #leftCenter.		header setProperty: #header toValue: true.		header addMorph: (aButton _ SimpleButtonMorph new label: 'O' font: Preferences standardButtonFont).		aButton target: ScrapsBook; color:  Color tan; actionSelector: #delete;				setBalloonText: 'Close the trashcan.(to view again later, click on any trashcan).' translated.		header addMorphBack: AlignmentMorph newVariableTransparentSpacer beSticky.		header addMorphBack: 	(label _ UpdatingStringMorph new target: self) beSticky.		label getSelector: #trashTitle; useStringFormat; step.		header addMorphBack: AlignmentMorph newVariableTransparentSpacer beSticky.		header addMorphBack: (aButton _ SimpleButtonMorph new label: 'E' translated font: Preferences standardButtonFont).		aButton target: Utilities; color:  Color veryLightGray; actionSelector: #maybeEmptyTrash;				setBalloonText: 'Click here to empty the trash.' translated.		ScrapsBook currentPage addMorph: (TextMorph new contents: 'Objects you drag into the trash will automatically be saved here, one object per page, in case you need them later.  To disable this feature set the "preserveTrash" Preference to false.You can individually expunge objects by hitting the - control, and you can empty out all the objects in the trash can by hitting the "E" button at top right.' translated			wrappedTo: 190).		ScrapsBook addMorphFront: header.		ScrapsBook setProperty: #scraps toValue: true].	^ ScrapsBook	"Utilities emptyScrapsBook"! !!Utilities class methodsFor: 'scraps' stamp: 'dgd 9/19/2003 10:49'!trashTitle	| label pgs |	label _ 'T R A S H' translated.	^ (pgs _ ScrapsBook pages size) < 2		ifTrue:			[label]		ifFalse:			[label, ('  ({1} pages)' translated format:{pgs})]! !!Utilities class methodsFor: 'support windows' stamp: 'dgd 9/21/2003 15:12'!commandKeyMappings	^ (self class firstCommentAt: #commandKeyMappings) translated"Lower-case command keys(use with Cmd key on Mac and Alt key on other platforms)a	Select allb	Browse it (selection is a class name or cursor is over a class-list or message-list)c	Copy selectiond	Do it (selection is a valid expression)e	Exchange selection with prior selectionf	Findg	Find againh	Set selection as search string for find againi	Inspect it (selection is a valid expression, or selection is over an inspect-ilst)j	Again once (do the last text-related operation again)k	Set fontl	Cancelm	Implementors of it (selection is a message selector or cursor is over a class-list or message-list)n	Senders of it (selection is a message selector or cursor is over a class-list or message-list)o	Spawn current methodp	Print it (selection is a valid expression)q	Query symbol (toggle all possible completion for a given prefix)r	Recognizers	Save (i.e. accept)t	Finds a Transcript (when cursor is over the desktop)u	Toggle alignmentv	Pastew	Delete preceding word (over text);  Close-window (over morphic desktop)x	Cut selectiony	Swap charactersz	UndoNote: for Do it, Senders of it, etc., a null selection will be expanded to a word or to the current line in an attempt to do what you want.  Also note that Senders/Implementors of it will find the outermost keyword selector in a large selection, as when you have selected a bracketed expression or an entire line.  Finally note that the same cmd-m and cmd-n (and cmd-v for versions) work in the message pane of most browsers.Upper-case command keys	(use with Shift-Cmd, or Ctrl on Mac	or Shift-Alt on other platforms; sometimes Ctrl works too)A	Advance argumentB	Browse it in this same browser (in System browsers only)C	Compare argument to clipboardD	DuplicateE	Method strings containing itF	Insert 'ifFalse:'G	fileIn from it (a file name)H	cursor TopHome:I	Inspect via Object ExplorerJ	Again many (apply the previous text command repeatedly until the end of the text)K	Set styleL	Outdent (move selection one tab-stop left)M	Select current type-inN	References to it (selection is a class name, or cursor is over a class-list or message-list)O	Open single-message browser (in message lists)P	Make project linkR	Indent (move selection one tab-stap right)S	SearchT	Insert 'ifTrue:'U	Convert linefeeds to carriage returns in selectionV	Paste author's initialsW	Selectors containing it (in text); show-world-menu (when issued with cursor over desktop)X	Force selection to lowercaseY	Force selection to uppercaseZ	Capitalize all words in selectionOther special keysBackspace	Backward delete characterDel			Forward delete characterShift-Bksp	Backward delete wordShift-Del	Forward delete wordEsc			Pop up the Desktop Menu\			Send top window to backCursor keysleft, right,up, down	Move cursor left, right, up or downCtrl-left		Move cursor left one wordCtrl-right	Move cursor right one wordHome		Move cursor to begin of line or begin of textEnd			Move cursor to end of line or end of textPgUp, Ctrl-up	Move cursor up one pagePgDown, Ctrl-Dn	Move cursor down one pageNote all these keys can be used together with Shift to define or enlarge the selection. You cannot however shrink that selection again, as in some other systems.Other Cmd-key combinations (not available on all platforms)Return		Insert return followed by as many tabs as the previous line			(with a further adjustment for additional brackets in that line)Space		Select the current word as with double clickingEnclose the selection in a kind of bracket.  Each is a toggle.	(not available on all platforms)Ctrl-(	Enclose within ( and ), or remove enclosing ( and )Ctrl-[	Enclose within [ and ], or remove enclosing [ and ]Crtl-{	Enclose within { and }, or remove enclosing { and }Ctrl-<	Enclose within < and >, or remove enclosing < and >Ctrl-'	Enclose within ' and ', or remove enclosing ' and 'Ctrl-""	Enclose within "" and "", or remove enclosing "" and ""Note also that you can double-click just inside any of the above delimiters,or at the beginning or end of a line, to select the text enclosed.Text Emphasis	(not available on all platforms)Cmd-1	10 point fontCmd-2	12 point fontCmd-3	18 point fontCmd-4	24 point fontCmd-5	36 point fontCmd-6	color, action-on-click, link to class comment, link to method, url		Brings up a menu.  To remove these properties, select		more than the active part and then use command-0.Cmd-7	boldCmd-8	italicCmd-9	narrow (same as negative kern)Cmd-0	plain text (resets all emphasis)Cmd--	underlined (toggles it)Cmd-=	struck out (toggles it)Shift-Cmd--	(aka _) negative kern (letters 1 pixel closer)Shift-Cmd-+	positive kern (letters 1 pixel larger spread)"! !!Utilities class methodsFor: 'support windows' stamp: 'dgd 9/21/2003 15:12'!openCommandKeyHelp	"Open a window giving command key help."	"Utilities openCommandKeyHelp"	(StringHolder new contents: self commandKeyMappings)		openLabel: 'Command Key Actions' translated! !!ViewerFlapTab methodsFor: 'compact' stamp: 'dgd 8/30/2003 22:23'!compactFlapString	^ (self isFlapCompact		ifTrue: ['<on>compact flap']		ifFalse: ['<off>']), 'compact flap' translated! !!ViewerFlapTab methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:21'!addCustomMenuItems: aMenu hand: aHandMorph	"Add further items to the menu as appropriate.  NB: Cannot call super here."	aMenu add: 'flap color...' translated target: self action: #changeFlapColor.	aMenu addLine.	aMenu addUpdating: #edgeString action: #setEdgeToAdhereTo.	aMenu addUpdating: #dragoverString action: #toggleDragOverBehavior.	aMenu addUpdating: #mouseoverString action: #toggleMouseOverBehavior.	aMenu addLine.	aMenu addUpdating: #compactFlapString target: self action: #changeCompactFlap.	aMenu add: 'destroy this flap' translated action: #destroyFlap! !!ViewerFlapTab class methodsFor: 'printing' stamp: 'dgd 8/31/2003 19:03'!defaultNameStemForInstances	^ 'viewerFlapTab' translated! !!WatchMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 22:24'!addCustomMenuItems: aMenu hand: aHandMorph	"Add morph-specific items to the given menu which was invoked by the given hand."	super addCustomMenuItems: aMenu hand: aHandMorph.	aMenu addLine.	aMenu addUpdating: #romanNumeralString action: #toggleRoman.	aMenu addUpdating: #antiAliasString action: #toggleAntialias.	aMenu addLine.	aMenu add: 'change font...' translated action: #changeFont.	aMenu balloonTextForLastItem: 'Allows you to change the font used to display the numbers.' translated.	aMenu add: 'change hands color...' translated action: #changeHandsColor.	aMenu balloonTextForLastItem: 'Allows you to specify a new color for the hands of the watch.  Note that actual *watch* color can be changed simply by using the halo''s recoloring handle.' translated.	aMenu add: 'change center color...' translated action: #changeCenterColor.	aMenu balloonTextForLastItem: 'Allows you to specify a new color to be used during PM hours for the center portion of the watch; during AM hours, a lighter shade of the same color will be used.' translated.! !!WatchMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 22:25'!antiAliasString	^ (antialias		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'anti-aliasing' translated! !!WatchMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 22:24'!romanNumeralString	"Answer a string governing the roman-numerals checkbox"	^ (romanNumerals		ifTrue: ['<on>']		ifFalse: ['<off>'])		, 'roman numerals' translated! !!WaveEditor methodsFor: 'initialization' stamp: 'dgd 9/19/2003 12:23'!addControls	| slider bb r m |	r _ AlignmentMorph newRow.	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r color: bb color; borderWidth: 0; layoutInset: 0.	r hResizing: #shrinkWrap; vResizing: #shrinkWrap; extent: 5@5.	r wrapCentering: #topLeft.	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: 'X';					actionSelector: #delete).	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: '<>'; actWhen: #buttonDown;															actionSelector: #invokeMenu).	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: 'Play' translated;				actionSelector: #play).	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: 'Play Before' translated;		actionSelector: #playBeforeCursor).	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: 'Play After' translated;			actionSelector: #playAfterCursor).	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: 'Play Loop' translated;			actionSelector: #playLoop).	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: 'Test' translated;				actionSelector: #playTestNote).	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: 'Save' translated;				actionSelector: #saveInstrument).	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: 'Set Loop End' translated;		actionSelector: #setLoopEnd).	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: 'One Cycle' translated;			actionSelector: #setOneCycle).	bb _ SimpleButtonMorph new target: self; borderColor: Color black.	r addMorphBack: (bb label: 'Set Loop Start' translated;		actionSelector: #setLoopStart).	self addMorphBack: r.	r _ AlignmentMorph newRow.	r color: self color; borderWidth: 0; layoutInset: 0.	r hResizing: #spaceFill; vResizing: #rigid; extent: 5@20; wrapCentering: #center; cellPositioning: #leftCenter.	m _ StringMorph new contents: 'Index: ' translated.	r addMorphBack: m.	m _ UpdatingStringMorph new		target: graph; getSelector: #cursor; putSelector: #cursor:;		growable: false; width: 71; step.	r addMorphBack: m.	m _ StringMorph new contents: 'Value: ' translated.	r addMorphBack: m.	m _ UpdatingStringMorph new		target: graph; getSelector: #valueAtCursor; putSelector: #valueAtCursor:;		growable: false; width: 50; step.	r addMorphBack: m.	slider _ SimpleSliderMorph new		color: color;		extent: 200@2;		target: self;		actionSelector: #scrollTime:.	r addMorphBack: slider.	m _ Morph new color: r color; extent: 10@5.  "spacer"	r addMorphBack: m.	m _ UpdatingStringMorph new		target: graph; getSelector: #startIndex; putSelector: #startIndex:;		width: 40; step.	r addMorphBack: m.	self addMorphBack: r.! !!WaveEditor methodsFor: 'initialization' stamp: 'dgd 9/19/2003 12:23'!addLoopPointControls	| r m |	r _ AlignmentMorph newRow.	r color: self color; borderWidth: 0; layoutInset: 0.	r hResizing: #spaceFill; vResizing: #rigid; extent: 5@20; wrapCentering: #center; cellPositioning: #leftCenter.	m _ StringMorph new contents: 'Loop end: ' translated.	r addMorphBack: m.	m _ UpdatingStringMorph new		target: self; getSelector: #loopEnd; putSelector: #loopEnd:;		growable: false; width: 50; step.	r addMorphBack: m.	m _ StringMorph new contents: 'Loop length: ' translated.	r addMorphBack: m.	m _ UpdatingStringMorph new		target: self; getSelector: #loopLength; putSelector: #loopLength:;		floatPrecision: 0.001;		growable: false; width: 50; step.	r addMorphBack: m.	m _ StringMorph new contents: 'Loop cycles: ' translated.	r addMorphBack: m.	m _ UpdatingStringMorph new		target: self; getSelector: #loopCycles; putSelector: #loopCycles:;		floatPrecision: 0.001;		growable: false; width: 50; step.	r addMorphBack: m.	m _ StringMorph new contents: 'Frequency: ' translated.	r addMorphBack: m.	m _ UpdatingStringMorph new		target: self; getSelector: #perceivedFrequency; putSelector: #perceivedFrequency:;		floatPrecision: 0.001;		growable: false; width: 50; step.	r addMorphBack: m.	self addMorphBack: r.! !!WaveEditor methodsFor: 'menu' stamp: 'dgd 10/8/2003 20:12'!chooseLoopStart 	| bestLoops menu secs choice start |	possibleLoopStarts ifNil: [		Utilities			informUser: 'Finding possible loop points...' translated			during: [possibleLoopStarts _ self findPossibleLoopStartsFrom: graph cursor]].	bestLoops _ possibleLoopStarts copyFrom: 1 to: (100 min: possibleLoopStarts size).	menu _ CustomMenu new.	bestLoops do: [:entry |		secs _ ((loopEnd - entry first) asFloat / self samplingRate) roundTo: 0.01.		menu add: ('{1} cycles; {2} secs' translated format:{entry third. secs}) action: entry].	choice _ menu startUp.	choice ifNil: [^ self].	loopCycles _ choice third.	start _ self fractionalLoopStartAt: choice first.	self loopLength: (loopEnd asFloat - start) + 1.0.! !!WaveEditor methodsFor: 'menu' stamp: 'dgd 9/19/2003 12:47'!invokeMenu	"Invoke a menu of additonal functions for this WaveEditor."	| aMenu |	aMenu _ CustomMenu new.	aMenu addList:	{		{'play straight through' translated.	#play}.		{'play before cursor' translated.	#playBeforeCursor}.		{'play after cursor' translated.		#playAfterCursor}.		{'play test note' translated.			#playTestNote}.		{'play loop' translated.				#playLoop}.		{'trim before cursor' translated.	#trimBeforeCursor}.		{'trim after cursor' translated.		#trimAfterCursor}.		{'choose loop start' translated.		#chooseLoopStart}.		{'jump to loop start' translated.		#jumpToLoopStart}.		{'jump to loop end' translated.		#jumpToLoopEnd}.		{'make unlooped' translated.		#setUnlooped}.		{'make unpitched' translated.		#setUnpitched}.		{'show envelope' translated.		#showEnvelope}.		{'show FFT' translated.				#showFFTAtCursor}}.	aMenu invokeOn: self defaultSelection: nil.! !!WaveEditor methodsFor: 'menu' stamp: 'dgd 9/19/2003 12:47'!saveInstrument	| name |	name _ FillInTheBlank request: 'Instrument name?' translated.	name isEmpty ifTrue: [^ self].	AbstractSound soundNamed: name put: self makeLoopedSampledSound.! !!WaveEditor methodsFor: 'menu' stamp: 'dgd 9/19/2003 12:48'!setLoopStart	"Assuming that the loop end and approximate frequency have been set, this method uses the current cursor position to determine the loop length and the number of cycles."	| start len |	start _ graph cursor.	((start >= loopEnd) or: [perceivedFrequency = 0]) ifTrue: [		^ self inform:'Please set the loop end and the approximate frequencyfirst, then position the cursor one or more cyclesbefore the loop end and try this again.' translated].	len _ (loopEnd - start) + 1.	loopCycles _ (len / (samplingRate / perceivedFrequency)) rounded.	self loopLength: len.! !!WaveEditor methodsFor: 'menu' stamp: 'dgd 9/19/2003 12:48'!showFFTAtCursor	| data start availableSamples nu n fft r |	data _ graph data.	start _ graph cursor max: 1.	availableSamples _ (data size - start) + 1.	nu _ 12.	nu > (availableSamples highBit - 1) ifTrue:		[^ self inform: 'Too few samples after the cursor to take an FFT.' translated].	n _ 2 raisedTo: nu.	fft _ FFT new nu: nu.	fft realData: ((start to: start + n - 1) collect: [:i | data at: i]).	fft transformForward: true.	r _ (1 to: n // 2) collect:		[:i | ((fft realData at: i) squared + (fft imagData at: i) squared) sqrt].	WaveEditor openOn: r.! !!ZASMCameraMarkMorph methodsFor: 'menu' stamp: 'dgd 8/30/2003 22:32'!addCustomMenuItems: aMenu hand: aHandMorph	"Add custom halo menu items"	aMenu add: 'Go to this mark' translated target: self action: #gotoMark.	aMenu add: 'Set transition' translated target: self action: #setTransition.	super addCustomMenuItems: aMenu hand: aHandMorph! !!ZASMScriptMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 22:32'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addLine.	aCustomMenu add: 'save script' translated action: #saveScript.! !!ZoomAndScrollControllerMorph methodsFor: 'menus' stamp: 'dgd 8/30/2003 22:32'!addCustomMenuItems: aCustomMenu hand: aHandMorph	super addCustomMenuItems: aCustomMenu hand: aHandMorph.	aCustomMenu addLine.	aCustomMenu add: 'change tilt and zoom keys' translated action: #changeKeys.	aCustomMenu add: 'run an existing camera script' translated action: #runAScript.	aCustomMenu add: 'edit an existing camera script' translated action: #editAScript.! !