'From Squeak3.3alpha of 18 January 2002 [latest update: #4955] on 17 August 2002 at 12:10:55 am'!"Change Set:		changeSetTweaks-swDate:			12 August 2002Author:			Scott WallacePublished as 4957changeSetTweaks-sw.cs to 3.3aSeveral improvements regarding change-sets:¥ Adds a stay-up control to the category submenu in the change sorter.¥ Adds a new Change-set-category function, 'show categories of this change set', which presents you with a list of all the change-set-categories that the currently-selected change-set belongs to, and installs the category you choose from that list -- if any -- as the current category in the sorter.¥ Reforumulates the 'category functions' submenu to use the much more compact and tractable #addList: protocol.¥ Makes ChangeSet>>containsMethodAtPosition: robust in the face of class changes for which the selector is for some reason nil, which certainly happens."!!ChangeSet methodsFor: 'testing' stamp: 'sw 8/10/2002 22:21'!containsMethodAtPosition: aFilePosition	"Answer whether the receiver contains the method logged at the given file position"	"class: aClassSymbol" "(need class parameter to speed up?)"  "<- dew 9/6/2001"	changeRecords values do:		[:classChangeRecord |		classChangeRecord methodChanges values do:			[:methodChangeRecord | | changeType |			changeType _ methodChangeRecord changeType.			((changeType == #add or: [changeType == #change]) and:				[methodChangeRecord currentMethod notNil and: [methodChangeRecord currentMethod filePosition = aFilePosition]])					ifTrue: [^ true]]].	^ false! !!ChangeSorter methodsFor: 'changeSet menu' stamp: 'sw 8/12/2002 17:29'!categorySubmenu: aMenu  shifted: shiftedIgnored	"Fill aMenu with less-frequently-needed category items"		aMenu title: 'Change set category'.	aMenu addStayUpItem.	aMenu addList: #(		('make a new category...' makeNewCategory 'Creates a new change-set-category (you will be asked to supply a name) which will start out its life with this change set in it')		('make a new category with class...' makeNewCategoryShowingClassChanges 'Creates a new change-set-category that includes change sets that change a particular class (you will be asked to supply a name)')		('rename this category' renameCategory 'Rename this change-set category.   Only applies when the current category being shown is a manually-maintained, user-defined category, such as you can create for yourself by choosing "make a new category..." from this same menu.')		('remove this category' removeCategory 'Remove this change-set category.   Only applies when the current category being shown is a manually-maintained, user-defined category, such as you can create for yourself by choosing "make a new category..." from this same menu.')		('show categories of this changeset' showCategoriesOfChangeSet 'Show a list of all the change-set categories that contain this change-set; if the you choose one of the categories from this pop-up, that category will be installed in this change sorter')	-).	parent ifNotNil:		[aMenu addList: #(			('add change set to category opposite' addToCategoryOpposite 'Adds this change set to the category on the other side of the change sorter.  Only applies if the category shown on the opposite side is a manually-maintained, user-defined category, such as you can create for yourself by choosing "make a new category..." from this same menu.'))].	aMenu addList: #(		('remove change set from this category' removeFromCategory 'Removes this change set from the current category.  Only applies when the current category being shown is a manually-maintained, user-defined category, such as you can create for yourself by choosing "make a new category..." from this same menu.')		-		('file out category''s change sets' fileOutAllChangeSets 'File out every change set in this category that has anything in it.  The usual checks for slips are suppressed when this command is done.')		('set recent-updates marker' setRecentUpdatesMarker 'Allows you to specify a number that will demarcate which updates are considered "recent" and which are not.  This will govern which updates are included in the RecentUpdates category in a change sorter')		('fill aggregate change set' fillAggregateChangeSet 'Creates a change-set named Aggregate into which all the changes in all the change sets in this category will be copied.')		-		('back to main menu' offerUnshiftedChangeSetMenu 'Takes you back to the shifted change-set menu.')		('back to shifted menu' offerShiftedChangeSetMenu 'Takes you back to the primary change-set menu.')).	^ aMenu! !!ChangeSorter methodsFor: 'changeSet menu' stamp: 'sw 8/11/2002 01:11'!showCategoriesOfChangeSet	"Show a list of all the categories in which the selected change-set occurs at the moment.  Install the one the user chooses, if any."	| aMenu |	Smalltalk isMorphic		ifFalse:			[self inform:'Only available in morphic, right now, sorry.It would not take much to make thisalso work in mvc, so if you areinclined to do that, thanks in advance...']		ifTrue:			[aMenu _ MenuMorph new defaultTarget: self.	aMenu title: 'Categories whichcontain change set"', myChangeSet name, '"'.			ChangeSetCategories elementsInOrder do:				[:aCategory |					(aCategory includesChangeSet: myChangeSet)						ifTrue:							[aMenu add: aCategory categoryName target: self selector: #showChangeSetCategory: argument: aCategory.						aCategory == changeSetCategory ifTrue:							[aMenu lastItem color: Color red]].						aMenu balloonTextForLastItem: aCategory documentation].				aMenu popUpInWorld]! !!CustomMenu methodsFor: 'construction' stamp: 'sw 8/12/2002 17:14'!addStayUpItem	"For compatibility with MenuMorph.  Here it is a no-op"! !