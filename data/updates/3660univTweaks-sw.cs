'From Squeak3.1alpha of 7 February 2001 [latest update: #3657] on 19 February 2001 at 3:43:56 pm'!"Change Set:		univTweaks-swDate:			19 February 2001Author:			Scott Wallace(1)  Fixes bug in code that does the conversion of universal-tiles grandfathered from before the abandonment of UserScripts.(2)  Moves the temporary #fullCheck flag used in #cacheSpecs: into the project parameters"!!Player class methodsFor: 'scripts' stamp: 'sw 2/19/2001 15:21'!userScriptForPlayer: aPlayer selector: aSelector	"Answer the user script for the player (one copy for all instances of the uniclass) and selector"	|  newEntry existingEntry |	scripts ifNil: [scripts _ IdentityDictionary new].	existingEntry _ scripts at: aSelector ifAbsent: [nil].	"Sorry for all the distasteful isKindOf: and isMemberOf: stuff here, folks; it arises out of concern for	preexisting content saved on disk from earlier stages of this architecture.  Someday much of it	could be cut loose"	Preferences universalTiles		ifTrue:			[(existingEntry isMemberOf: MethodWithInterface) ifTrue: [^ existingEntry].			newEntry _ (existingEntry isKindOf: UniclassScript)				ifTrue:					[existingEntry as: MethodWithInterface] "let go of extra stuff if it was UniclassScript"				ifFalse:					[MethodWithInterface new playerClass: aPlayer selector: aSelector].			scripts at: aSelector put: newEntry.			^ newEntry]		ifFalse:			[(existingEntry isKindOf: UniclassScript)				ifTrue:					[^ existingEntry]				ifFalse:					[newEntry _ UniclassScript new playerClass: aPlayer class selector: aSelector.					scripts at: aSelector put: newEntry.					existingEntry ifNotNil: "means it is a grandfathered UserScript that needs conversion"						[newEntry convertFromUserScript: existingEntry].					^ newEntry]]! !!Presenter methodsFor: 'viewer' stamp: 'sw 2/19/2001 15:41'!cacheSpecs: aMorph	"For SyntaxMorph's type checking, cache the list of all viewer command specifications."	aMorph world ifNil: [^ true].	Preferences universalTiles ifFalse: [^ true].	Preferences eToyFriendly ifFalse: [^ true].	"not checking"	(Project current projectParameterAt: #fullCheck ifAbsent: [false]) 		ifFalse: [^ true].	"not checking"	SyntaxMorph initialize.! !