'From Squeak3.2alpha of 2 October 2001 [latest update: #4437] on 16 October 2001 at 11:14:30 pm'!"Change Set:		AttrTextStreamDate:			16 October 2001Author:			Andreas RaabA 10% speedup for generating HTML documents."!Stream subclass: #AttributedTextStream	instanceVariableNames: 'characters attributeRuns currentAttributes attributesChanged attributeValues currentRun '	classVariableNames: ''	poolDictionaries: ''	category: 'Collections-Streams'!!AttributedTextStream methodsFor: 'retrieving the text' stamp: 'ar 10/16/2001 22:39'!contents	| ans |	currentRun > 0 ifTrue:[		attributeValues nextPut: currentAttributes.		attributeRuns nextPut: currentRun.		currentRun _ 0].	ans _ Text new: characters size.	"this is declared private, but it's exactly what I need, and it's declared as exactly what I want it to do...."	ans setString: characters contents  setRuns: 		(RunArray runs: attributeRuns contents values: attributeValues contents).	^ans! !!AttributedTextStream methodsFor: 'stream protocol' stamp: 'ar 10/16/2001 22:38'!nextPut: aChar	currentRun _ currentRun + 1.	characters nextPut: aChar! !!AttributedTextStream methodsFor: 'stream protocol' stamp: 'ar 10/16/2001 22:38'!nextPutAll: aString	"add an entire string with the same attributes"	currentRun _ currentRun + aString size.	characters nextPutAll: aString.! !!AttributedTextStream methodsFor: 'access' stamp: 'ar 10/16/2001 22:57'!currentAttributes: newAttributes	"set the current attributes"	(currentRun > 0 and:[currentAttributes ~= newAttributes]) ifTrue:[		attributeRuns nextPut: currentRun.		attributeValues nextPut: currentAttributes.		currentRun _ 0.	].	currentAttributes _ newAttributes.! !!AttributedTextStream methodsFor: 'private-initialization' stamp: 'ar 10/16/2001 22:40'!initialize	characters _ WriteStream on: String new.	currentAttributes _ OrderedCollection new.	currentRun _ 0.	attributeValues _ WriteStream on: (Array new: 50).	attributeRuns _ WriteStream on: (Array new: 50).	! !Stream subclass: #AttributedTextStream	instanceVariableNames: 'characters attributeRuns attributeValues currentAttributes currentRun '	classVariableNames: ''	poolDictionaries: ''	category: 'Collections-Streams'!