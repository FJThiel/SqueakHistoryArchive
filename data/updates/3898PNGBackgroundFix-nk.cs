"Change Set:		PNGBackgroundFix-nkDate:			4 April 2001Author:			Ned KonzThis fixes a crash when reading a 8-bit deep PNGwith a background color."!!PNGReadWriter methodsFor: 'chunks' stamp: 'nk 3/30/2001 14:13'!processBackgroundChunk	| val red green blue max |	"Transcript show: '  BACKGROUND: ',chunk printString."	colorType = 3 ifTrue: [		form fillColor: (palette at: chunk first + 1).		^self	].	max _ (2 raisedTo: bitsPerChannel) - 1.	(colorType = 0 or: [colorType = 4]) ifTrue: [		val _ chunk unsignedShortAt: 1 bigEndian: true.		form fillColor: (Color gray: val / max).		^self	].	(colorType = 2 or: [colorType = 6]) ifTrue: [		red _ chunk unsignedShortAt: 1 bigEndian: true.		green _ chunk unsignedShortAt: 3 bigEndian: true.		blue _ chunk unsignedShortAt: 5 bigEndian: true.		form fillColor: (Color r: red/max g: green/max b: blue/max).		^self	]."self halt.""====The bKGD chunk specifies a default background color to present the image against. Note that viewers are not bound to honor this chunk; a viewer can choose to use a different background. For color type 3 (indexed color), the bKGD chunk contains:    Palette index:  1 byteThe value is the palette index of the color to be used as background. For color types 0 and 4 (grayscale, with or without alpha), bKGD contains:    Gray:  2 bytes, range 0 .. (2^bitdepth)-1(For consistency, 2 bytes are used regardless of the image bit depth.) The value is the gray level to be used as background. For color types 2 and 6 (truecolor, with or without alpha), bKGD contains:    Red:   2 bytes, range 0 .. (2^bitdepth)-1   Green: 2 bytes, range 0 .. (2^bitdepth)-1   Blue:  2 bytes, range 0 .. (2^bitdepth)-1(For consistency, 2 bytes per sample are used regardless of the image bit depth.) This is the RGB color to be used as background. When present, the bKGD chunk must precede the first IDAT chunk, and must follow the PLTE chunk, if any. ==="! !