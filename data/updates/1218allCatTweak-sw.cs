'From Squeak 2.4b of April 23, 1999 on 26 May 1999 at 11:51:13 pm'!"Change Set:		allCatTweak-swDate:			26 May 1999Author:			Scott WallaceA further tweak to Chris and Carl's allCatFix.  Now the right things happen when you submit a new method while --all-- is the chosen category but no method is chosen in the method-list pane: not only does the new method go into 'as yet unclassified', but that category is now selected and the appropriate method is also selected."!!Browser methodsFor: 'initialize-release' stamp: 'sw 5/26/1999 23:46'!setSelector: aSymbol	"Make the receiver point at the given selector, in the currently chosen class"	| aClass messageCatIndex |	aSymbol ifNil: [^ self].	(aClass _ self selectedClassOrMetaClass) ifNil: [^ self].	messageCatIndex _ aClass organization numberOfCategoryOfElement: aSymbol.	self messageCategoryListIndex: messageCatIndex + 1.	messageCatIndex = 0 ifTrue: [^ self].	self messageListIndex:			((aClass organization listAtCategoryNumber: messageCatIndex)					indexOf: aSymbol)! !!Browser methodsFor: 'message functions' stamp: 'sw 5/26/1999 23:49'!defineMessageFrom: aString notifying: aController	"Compile the expressions in aString. Notify aController if a syntax error occurs. Install the compiled method in the selected class classified under  the currently selected message category name. Answer the selector obtained if compilation succeeds, nil otherwise."	| selectedMessageName selector category oldMessageList |	selectedMessageName _ self selectedMessageName.	oldMessageList _ self messageList.	contents _ nil.	selector _ self selectedClassOrMetaClass				compile: aString				classified: (category _ self selectedMessageCategoryName)				notifying: aController.	selector == nil ifTrue: [^ nil].	contents _ aString copy.	selector ~~ selectedMessageName		ifTrue: 			[category = ClassOrganizer nullCategory				ifTrue: [self changed: #classSelectionChanged.						self changed: #classList.						self messageCategoryListIndex: 1].			self setClassOrganizer.  "In case organization not cached"			(oldMessageList includes: selector)				ifFalse: [self changed: #messageList].			self messageListIndex: (self messageList indexOf: selector)].	^ selector! !!Browser methodsFor: 'code pane' stamp: 'sw 5/26/1999 23:43'!compileMessage: aText notifying: aController	"Compile the code that was accepted by the user, placing the compiled method into an appropriate message category.  Return true if the compilation succeeded, else false."	| fallBackCategoryIndex fallBackMethodIndex originalSelectorName result |	self selectedMessageCategoryName asSymbol = ClassOrganizer allCategory		ifTrue:			[ "User tried to save a method while the ALL category was selected"			fallBackCategoryIndex _ messageCategoryListIndex.			fallBackMethodIndex _ messageListIndex.			editSelection == #newMessage				ifTrue:					[ "Select the 'as yet unclassified' category"					messageCategoryListIndex _ 0.					(result _ self defineMessageFrom: aText notifying: aController)						ifNil:							["Compilation failure:  reselect the original category & method"							messageCategoryListIndex _ fallBackCategoryIndex.							messageListIndex _ fallBackMethodIndex]						ifNotNil:							[self setSelector: result]]				ifFalse:					[originalSelectorName _ self selectedMessageName.					self setOriginalCategoryIndexForCurrentMethod.					messageListIndex _ fallBackMethodIndex _ self messageList indexOf: originalSelectorName.								(result _ self defineMessageFrom: aText notifying: aController)						ifNotNil:							[self setSelector: result]						ifNil:							[ "Compilation failure:  reselect the original category & method"							messageCategoryListIndex _ fallBackCategoryIndex.							messageListIndex _ fallBackMethodIndex.							^ result notNil]].			self changed: #messageCategoryList.			^ result notNil]		ifFalse:			[ "User tried to save a method while the ALL category was NOT selected"			^ (self defineMessageFrom: aText notifying: aController) notNil]! !