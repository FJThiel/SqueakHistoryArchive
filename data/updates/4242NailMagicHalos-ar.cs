'From Squeak3.1alpha of 28 February 2001 [latest update: #4241] on 8 August 2001 at 5:34:59 pm'!"Change Set:		NailMagicHalos-arDate:			8 August 2001Author:			Andreas RaabAllow users to 'nail' magic halos by cmd-clicking. Once a halo has been nailed down onto an object it will not be lost when moving over some other guy."!!Morph methodsFor: 'halos and balloon help' stamp: 'ar 8/8/2001 17:31'!addMagicHaloFor: aHand	| halo prospectiveHaloClass |	aHand halo ifNotNil:[		aHand halo target == self ifTrue:[^self].		aHand halo isMagicHalo ifFalse:[^self]].	prospectiveHaloClass _ Smalltalk at: self haloClass ifAbsent: [HaloMorph].	halo _ prospectiveHaloClass new bounds: self worldBoundsForHalo.	halo popUpMagicallyFor: self hand: aHand.! !!HaloMorph methodsFor: 'events' stamp: 'ar 8/8/2001 17:32'!blueButtonDown: event	"Transfer the halo to the next likely recipient"	target ifNil:[^self delete].	event hand obtainHalo: self.	positionOffset _ event position - (target point: target position in: owner).	self isMagicHalo ifTrue:[		self isMagicHalo: false.		^self magicAlpha: 1.0].	"wait for drags or transfer"	event hand 		waitForClicksOrDrag: self 		event: event		selectors: { #transferHalo:. nil. #dragTarget:. }		threshold: 5.! !!HaloMorph methodsFor: 'events' stamp: 'ar 8/8/2001 17:33'!popUpFor: aMorph event: evt	"This message is sent by morphs that explicitly request the halo on a button click. Note: anEvent is in aMorphs coordinate frame."	| hand anEvent |	self flag: #workAround. "We should really have some event/hand here..."	evt isNil		ifTrue:[	hand _ aMorph world activeHand.				hand ifNil:[hand _ aMorph world primaryHand].				anEvent _ hand lastEvent transformedBy: (aMorph transformedFrom: nil)]		 ifFalse:[hand _ evt hand.				anEvent _ evt].	self target: aMorph.	hand halo: self.	hand world addMorphFront: self.	positionOffset _ anEvent position - (aMorph point: aMorph position in: owner).	self startStepping.	(Preferences haloTransitions or:[self isMagicHalo]) ifTrue:[		self magicAlpha: 0.0.		self startSteppingSelector: #fadeInInitially.	].! !