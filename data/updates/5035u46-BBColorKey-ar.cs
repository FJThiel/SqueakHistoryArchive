'From Squeak3.3alpha of 24 January 2002 [latest update: #4889] on 16 June 2002 at 9:37:52 pm'!"Change Set:		BBColorKeySupport-arDate:			16 June 2002Author:			Andreas RaabPublished to 3.3a as 4890BBColorKeySupport-ar.cs.Introduces a new BitBlt rule for clearing out a specific pixel value. Used for supporting forms with arbitrary color keys."!!BitBltSimulation methodsFor: 'combination rules' stamp: 'ar 6/16/2002 19:53'!pixClear: sourceWord with: destinationWord	"Clear all pixels in destinationWord for which the pixels of sourceWord have the same values. Used to clear areas of some constant color to zero."	| mask result nBits pv |	self inline: false.	destDepth = 32 ifTrue:[		sourceWord = destinationWord ifTrue:[^0] ifFalse:[^destinationWord].	].	nBits := destDepth.	mask _ maskTable at: nBits.  "partition mask starts at the right"	result _ 0.	1 to: destPPW do:[:i |		pv := destinationWord bitAnd: mask.		(sourceWord bitAnd: mask) = pv ifTrue:[pv := 0].		result := result bitOr: pv.		mask := mask << nBits "slide left to next partition"].	^ result! !!BitBltSimulation methodsFor: 'initialize-release' stamp: 'ar 6/16/2002 20:08'!initBBOpTable	self cCode: 'opTable[0+1] = (int)clearWordwith'.	self cCode: 'opTable[1+1] = (int)bitAndwith'.	self cCode: 'opTable[2+1] = (int)bitAndInvertwith'.	self cCode: 'opTable[3+1] = (int)sourceWordwith'.	self cCode: 'opTable[4+1] = (int)bitInvertAndwith'.	self cCode: 'opTable[5+1] = (int)destinationWordwith'.	self cCode: 'opTable[6+1] = (int)bitXorwith'.	self cCode: 'opTable[7+1] = (int)bitOrwith'.	self cCode: 'opTable[8+1] = (int)bitInvertAndInvertwith'.	self cCode: 'opTable[9+1] = (int)bitInvertXorwith'.	self cCode: 'opTable[10+1] = (int)bitInvertDestinationwith'.	self cCode: 'opTable[11+1] = (int)bitOrInvertwith'.	self cCode: 'opTable[12+1] = (int)bitInvertSourcewith'.	self cCode: 'opTable[13+1] = (int)bitInvertOrwith'.	self cCode: 'opTable[14+1] = (int)bitInvertOrInvertwith'.	self cCode: 'opTable[15+1] = (int)destinationWordwith'.	self cCode: 'opTable[16+1] = (int)destinationWordwith'.	self cCode: 'opTable[17+1] = (int)destinationWordwith'.	self cCode: 'opTable[18+1] = (int)addWordwith'.	self cCode: 'opTable[19+1] = (int)subWordwith'.	self cCode: 'opTable[20+1] = (int)rgbAddwith'.	self cCode: 'opTable[21+1] = (int)rgbSubwith'.	self cCode: 'opTable[22+1] = (int)OLDrgbDiffwith'.	self cCode: 'opTable[23+1] = (int)OLDtallyIntoMapwith'.	self cCode: 'opTable[24+1] = (int)alphaBlendwith'.	self cCode: 'opTable[25+1] = (int)pixPaintwith'.	self cCode: 'opTable[26+1] = (int)pixMaskwith'.	self cCode: 'opTable[27+1] = (int)rgbMaxwith'.	self cCode: 'opTable[28+1] = (int)rgbMinwith'.	self cCode: 'opTable[29+1] = (int)rgbMinInvertwith'.	self cCode: 'opTable[30+1] = (int)alphaBlendConstwith'.	self cCode: 'opTable[31+1] = (int)alphaPaintConstwith'.	self cCode: 'opTable[32+1] = (int)rgbDiffwith'.	self cCode: 'opTable[33+1] = (int)tallyIntoMapwith'.	self cCode: 'opTable[34+1] = (int)alphaBlendScaledwith'.	self cCode: 'opTable[35+1] = (int)alphaBlendScaledwith'.	self cCode: 'opTable[36+1] = (int)alphaBlendScaledwith'.		self cCode: 'opTable[37+1] = (int)rgbMulwith'.	self cCode: 'opTable[38+1] = (int)pixSwapwith'.	self cCode: 'opTable[39+1] = (int)pixClearwith'.! !!BitBltSimulation class methodsFor: 'initialization' stamp: 'ar 6/16/2002 19:49'!initializeRuleTable	"BitBltSimulation initializeRuleTable"	"**WARNING** You MUST change initBBOpTable if you change this"	OpTable _ #(		"0" clearWord:with:		"1" bitAnd:with:		"2" bitAndInvert:with:		"3" sourceWord:with:		"4" bitInvertAnd:with:		"5" destinationWord:with:		"6" bitXor:with:		"7" bitOr:with:		"8" bitInvertAndInvert:with:		"9" bitInvertXor:with:		"10" bitInvertDestination:with:		"11" bitOrInvert:with:		"12" bitInvertSource:with:		"13" bitInvertOr:with:		"14" bitInvertOrInvert:with:		"15" destinationWord:with:		"16" destinationWord:with: "unused - was old paint"		"17" destinationWord:with: "unused - was old mask"		"18" addWord:with:		"19" subWord:with:		"20" rgbAdd:with:		"21" rgbSub:with:		"22" OLDrgbDiff:with:		"23" OLDtallyIntoMap:with:		"24" alphaBlend:with:		"25" pixPaint:with:		"26" pixMask:with:		"27" rgbMax:with:		"28" rgbMin:with:		"29" rgbMinInvert:with:		"30" alphaBlendConst:with:		"31" alphaPaintConst:with:		"32" rgbDiff:with:		"33" tallyIntoMap:with:		"34" alphaBlendScaled:with:		"35" alphaBlendScaled:with:	"unused here - only used by FXBlt"		"36" alphaBlendScaled:with:	"unused here - only used by FXBlt"		"37" rgbMul:with:		"38" pixSwap:with:		"39" pixClear:with:	).	OpTableSize _ OpTable size + 1.  "0-origin indexing"! !