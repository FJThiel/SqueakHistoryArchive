'From Squeak3.4 of 1 March 2003 [latest update: #5170] on 12 March 2003 at 7:57:20 am'!"Change Set:		LateSqueaklandFixes-nkDate:			12 March 2003Author:			Ned KonzThis contains two important fixes from the Squeakland update stream that fix project saving and loading problems in the released 3.4 image. Both fixes are by Andreas Raab.These fixes are the contents of these change sets:0143fixFormAlpha-ar.cs (23 Sept. 2002)0144gifFix.cs (9 December 2002)Fixes a problem with certain gifs in external resources."!!Form methodsFor: 'resources' stamp: 'ar 12/9/2002 16:04'!readNativeResourceFrom: byteStream	| img aStream |	(byteStream isKindOf: FileStream) ifTrue:[		"Ugly, but ImageReadWriter will send #reset which is implemented as #reopen and we may not be able to do so."		aStream _ RWBinaryOrTextStream with: byteStream contents.	] ifFalse:[		aStream _ byteStream.	].	img _ [ImageReadWriter formFromStream: aStream] on: Error do:[:ex| nil].	img ifNil:[^nil].	(img isColorForm and:[self isColorForm]) ifTrue:[		| cc |		cc := img colors.		img colors: nil.		img displayOn: self.		img colors: cc.	] ifFalse:[		img displayOn: self.	].	img _ nil.! !!ResourceCollector methodsFor: 'resource writing' stamp: 'ar 9/23/2002 03:34'!writeResourceForm: aForm locator: aLocator	"Store the given form on a file. Return an array with the name and the size of the file"	| fName fStream fullSize result writerClass |	aLocator ifNotNil:[		result _ self writeResourceForm: aForm fromLocator: aLocator.		result ifNotNil:[^result]		"else fall through"	].	fName _ localDirectory nextNameFor:'resource' extension:'form'.	fStream _ localDirectory newFileNamed: fName.	fStream binary.	aForm storeResourceOn: fStream.false ifTrue:[	"What follows is a Really, REALLY bad idea. I leave it in as a reminder of what you should NOT do. 	PART I: Using JPEG or GIF compression on forms where we don't have the original data means loosing both quality and alpha information if present..."	writerClass _ ((Smalltalk includesKey: #JPEGReaderWriter2)		and: [(Smalltalk at: #JPEGReaderWriter2) new isPluginPresent])		ifTrue: [(Smalltalk at: #JPEGReaderWriter2)]		ifFalse: [GIFReadWriter].	writerClass putForm: aForm onStream: fStream.	fStream open.	fullSize _ fStream size.	fStream close.].	"Compress contents here"true ifTrue:[	"...PART II: Using the builtin compression which combines RLE+ZIP is AT LEAST AS GOOD as PNG and how much more would you want???"	fStream position: 0.	fStream compressFile.	localDirectory deleteFileNamed: fName.	localDirectory rename: fName, FileDirectory dot, 'gz' toBe: fName.	fStream _ localDirectory readOnlyFileNamed: fName.	fullSize _ fStream size.	fStream close.].	^{fName. fullSize}! !