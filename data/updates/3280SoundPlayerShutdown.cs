'From Squeak2.9alpha of 13 June 2000 [latest update: #3335] on 31 January 2001 at 1:34:38 am'!"Change Set:		SoundPlayerShutdownDate:			31 January 2001Author:			Andreas RaabShut down the sound player if there's nothing at all to play."!!SoundPlayer class methodsFor: 'player process' stamp: 'ar 1/31/2001 01:31'!playLoop	"The sound player process loop."	| bytesPerSlice count willStop |	bytesPerSlice _ Stereo ifTrue: [4] ifFalse: [2].	[true] whileTrue: [		[(count _ self primSoundAvailableBytes // bytesPerSlice) > 100]			whileFalse: [ReadyForBuffer wait].		count _ count min: Buffer stereoSampleCount.		PlayerSemaphore critical: [			ActiveSounds _ ActiveSounds select: [:snd | snd samplesRemaining > 0].			ActiveSounds do: [:snd |				snd ~~ SoundJustStarted ifTrue: [					snd playSampleCount: count into: Buffer startingAt: 1]].			ReverbState == nil ifFalse: [				ReverbState applyReverbTo: Buffer startingAt: 1 count: count].			self primSoundPlaySamples: count from: Buffer startingAt: 1.			willStop _ (ActiveSounds size = 0) and:[self isAllSilence: Buffer size: count].			willStop				ifTrue:[self shutDown. PlayerProcess _ nil]				ifFalse:[Buffer primFill: 0].			SoundJustStarted _ nil].		willStop ifTrue:[^self].	].! !!SoundPlayer class methodsFor: 'player process' stamp: 'ar 1/31/2001 01:13'!stopPlayerProcess	"Stop the sound player process."	"SoundPlayer stopPlayerProcess"	(PlayerProcess == nil or:[PlayerProcess == Processor activeProcess]) 		ifFalse:[PlayerProcess terminate].	PlayerProcess _ nil.	self primSoundStop.	ActiveSounds _ OrderedCollection new.	Buffer _ nil.	PlayerSemaphore _ Semaphore forMutualExclusion.	ReadyForBuffer ifNotNil:		[Smalltalk unregisterExternalObject: ReadyForBuffer].	ReadyForBuffer _ nil.! !!SoundPlayer class methodsFor: 'private' stamp: 'ar 1/31/2001 01:32'!isAllSilence: buffer size: count	"return true if the buffer is all silence after reverb has ended"	| value |	value _ buffer at: 1.	2 to: count do:[:i| (buffer at: i) = value ifFalse:[^false]].	^true! !