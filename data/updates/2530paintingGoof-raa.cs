'From Squeak2.9alpha of 17 July 2000 [latest update: #2529] on 29 August 2000 at 10:23:25 am'!"Change Set:		paintingGoofDate:			29 August 2000Author:			Bob Arning- fixed a few problems occurring after use of scale or rotate buttons"!!SketchEditorMorph methodsFor: 'morphic' stamp: 'RAA 8/29/2000 10:18'!mouseEnter: evt	"Set the cursor.  Reread colors if embedded editable polygon needs it."	| poly top cColor |	super mouseEnter: evt.	top _ evt hand recipientForMouseDown: evt.	top == self ifFalse: [^self].		"one of my buttons in the way"	(self get: #action for: evt) == #scaleOrRotate ifTrue: [		self set: #action for: evt to: (self get: #priorAction for: evt).	].	evt hand showTemporaryCursor: (self getCursorFor: evt).	palette getSpecial == #polygon: ifFalse: [^self].	(poly _ self valueOfProperty: #polygon) ifNil: [^ self].	cColor _ self getColorFor: evt.	poly color: cColor; borderWidth: 1.	poly changed.! !!SketchEditorMorph methodsFor: 'start & finish' stamp: 'RAA 8/29/2000 09:16'!addRotationScaleHandles	"Rotation and scaling handles"	rotationButton _ SketchMorph withForm: (palette rotationTabForm).	rotationButton position: bounds topCenter - (6@0).	rotationButton on: #mouseDown send: #rotateScalePrep: to: self.	rotationButton on: #mouseStillDown send: #rotateBy: to: self.	rotationButton on: #mouseUp send: #rotateDone: to: self.	rotationButton on: #mouseEnter send: #mouseLeave: to: self.	"Put cursor back"	rotationButton on: #mouseLeave send: #mouseEnter: to: self.	self addMorph: rotationButton.	rotationButton setBalloonText: 'Drag me sideways to\rotate yourpicture.' withCRs.	scaleButton _ SketchMorph withForm: (palette scaleTabForm).	scaleButton position: bounds rightCenter - ((scaleButton width)@6).	scaleButton on: #mouseDown send: #rotateScalePrep: to: self.	scaleButton on: #mouseStillDown send: #scaleBy: to: self.	scaleButton on: #mouseEnter send: #mouseLeave: to: self.	"Put cursor back"	scaleButton on: #mouseLeave send: #mouseEnter: to: self.	self addMorph: scaleButton.	scaleButton setBalloonText: 'Drag me up and down to change\the sizeof your picture.' withCRs."REMOVED:	fwdButton _ PolygonMorph new.	pt _ bounds topCenter.	fwdButton borderWidth: 2; makeOpen; makeBackArrow; borderColor:(Color r: 0 g: 0.8 b: 0).	fwdButton removeHandles; setVertices: (Array with: pt+(0@7) with:pt+(0@22)).	fwdButton on: #mouseStillDown send: #forward:direction: to: self.	fwdButton on: #mouseEnter send: #mouseLeave: to: self.		fwdButton on: #mouseLeave send: #mouseEnter: to: self.	self setProperty: #fwdButton toValue: fwdButton.	self addMorph: fwdButton.	fwdButton setBalloonText: 'Drag me around to point\in the directionI go forward.' withCRs.	toggle _ EllipseMorph		newBounds: (Rectangle center: fwdButton vertices last +(-4@4) extent: 8@8)		color: Color gray.	toggle on: #mouseUp send: #toggleDirType:in: to: self.	toggle on: #mouseEnter send: #mouseLeave: to: self.	toggle on: #mouseLeave send: #mouseEnter: to: self.	self setProperty: #fwdToggle toValue: toggle.	fwdButton addMorph: toggle.	toggle setBalloonText: 'When your object turns,\how should itspicture change?\It can rotate, face left or right,\face up or down, or notchange.' withCRs.	"	self setProperty: #rotationStyle toValue: hostView rotationStyle."	self forward: hostView setupAngle direction: fwdButton.	"	"Set to its current value"! !!SketchEditorMorph methodsFor: 'actions & preps' stamp: 'RAA 8/29/2000 10:01'!rotateScalePrep: evt	"Make a source that is the paintingForm.  Work from that.  3/26/97 tk"	| newBox myBuff |	(self getActionFor: evt) == #scaleOrRotate ifTrue: [^ self].	"Already doing it"	paintingForm width > 120 		ifTrue: [newBox _ paintingForm rectangleEnclosingPixelsNotOfColor: Color transparent.			"minimum size"			newBox _ newBox insetBy: 				((18 - newBox width max: 0)//2) @ ((18 - newBox height max: 0)//2) * -1]		ifFalse: [newBox _ paintingForm boundingBox].	newBox _ newBox expandBy: 1.	self set: #buff for: evt to: (myBuff _ Form extent: newBox extent depth: paintingForm depth).	myBuff offset: newBox center - paintingForm center.	myBuff copyBits: newBox from: paintingForm at: 0@0 		clippingBox: myBuff boundingBox rule: Form over fillColor: nil.	"Could just run up owner chain asking colorUsed, but may not be embedded"	cumRot _ 0.0.  cumMag _ 1.0.	"start over"	self set: #changed for: evt to: true.	self set: #action for: evt to: #scaleOrRotate.		"Only changed by mouseDown with tool in paint area"! !!SketchEditorMorph methodsFor: 'Nebraska support' stamp: 'RAA 8/29/2000 10:17'!set: aSymbol for: anEventOrHand to: anObject	| valuesForHand |	valuesForHand _ self valuesForHand: anEventOrHand.	aSymbol == #action ifTrue: [		valuesForHand at: #priorAction put: (valuesForHand at: #action ifAbsent: [#paint:]).	].	valuesForHand at: aSymbol put: anObject.	^anObject! !