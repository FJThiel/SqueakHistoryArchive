'From Squeak2.8alpha of 19 January 2000 [latest update: #2005] on 26 April 2000 at 9:44:26 pm'!"Change Set:		NewSources-2-hmmDate:			26 April 2000Author:			Hans-Martin Mosner <hmm@heeg.de>Second part of the modification of the SourceFiles mechanism. In this change set, all methods that think they know about the structure of sourcePointers are replaced by versions that delegate to SourceFiles."!!CompiledMethod methodsFor: 'source code management' stamp: 'hmm 4/26/2000 20:44'!sourcePointer	"Answer the integer which can be used to find the source file and position for this method.	The returned value is either 0 (if no source is stored) or a number between 16r1000000 and 16r4FFFFFF.	The actual interpretation of this number is up to the SourceFileArray stored in the global variable SourceFiles."	| pos |	self last < 252 ifTrue: [^ 0  "no source"].	pos _ self last - 251.	self size - 1 to: self size - 3 by: -1 do: [:i | pos _ pos * 256 + (self at: i)].	^pos! !!CompiledMethod methodsFor: 'source code management' stamp: 'hmm 4/26/2000 20:44'!fileIndex	^SourceFiles fileIndexFromSourcePointer: self sourcePointer! !!CompiledMethod methodsFor: 'source code management' stamp: 'hmm 4/26/2000 20:45'!filePosition	^SourceFiles filePositionFromSourcePointer: self sourcePointer! !!CompiledMethod methodsFor: 'source code management' stamp: 'hmm 4/26/2000 21:00'!setSourcePointer: srcPointer	srcPointer = 0 ifTrue: [		self at: self size put: 0.		^self].	(srcPointer between: 16r1000000 and: 16r4FFFFFF) ifFalse: [self error: 'Source pointer out of range'].	self at: self size put: (srcPointer bitShift: -24) + 251.	1 to: 3 do: [:i |		self at: self size-i put: ((srcPointer bitShift: (i-3)*8) bitAnd: 16rFF)]! !!CompiledMethod methodsFor: 'source code management' stamp: 'hmm 4/26/2000 21:02'!setSourcePosition: position inFile: fileIndex 	self setSourcePointer: (SourceFiles sourcePointerFromFileIndex: fileIndex andPosition: position)! !!RemoteString methodsFor: 'accessing' stamp: 'hmm 4/26/2000 21:28'!setSourcePointer: aSourcePointer	sourceFileNumber _ SourceFiles fileIndexFromSourcePointer: aSourcePointer.	filePositionHi _ SourceFiles filePositionFromSourcePointer: aSourcePointer! !!RemoteString methodsFor: 'accessing' stamp: 'hmm 4/26/2000 20:47'!sourcePointer	sourceFileNumber ifNil: [^ 0].	^SourceFiles sourcePointerFromFileIndex: sourceFileNumber andPosition: filePositionHi! !!SystemDictionary methodsFor: 'sources, change log' stamp: 'di 4/28/2000 13:01'!openSourceFiles	self imageName = LastImageName ifFalse:		["Reset the author initials to blank when the image gets moved"		LastImageName _ self imageName.		Utilities setAuthorInitials: ''].	FileDirectory		openSources: self sourcesName		andChanges: self changesName		forImage: LastImageName.	StandardSourceFileArray install! !