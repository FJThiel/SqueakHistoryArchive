'From Squeak3.1alpha of 28 February 2001 [latest update: #4068] on 24 May 2001 at 4:52:33 pm'!"Change Set:		FlashInvalidations-arDate:			24 May 2001Author:			Andreas RaabFixes a wrongly fixed issue with invalidations in Flash players."!!MatrixTransformMorph methodsFor: 'drawing' stamp: 'ar 11/12/2000 18:44'!invalidRect: rect from: aMorph	aMorph == self		ifTrue:[super invalidRect: rect from: self]		ifFalse:[super invalidRect: (self transform localBoundsToGlobal: rect) from: aMorph].! !!FlashSpriteMorph methodsFor: 'stepping' stamp: 'ar 5/24/2001 16:50'!stepToFrame: frame	"Step to the given frame"	| fullRect postDamage lastVisible resortNeeded |	frame = frameNumber ifTrue:[^self].	frame > loadedFrames ifTrue:[^self].	postDamage _ damageRecorder isNil.	postDamage ifTrue:[damageRecorder _ FlashDamageRecorder new].	lastVisible _ nil.	resortNeeded _ false.	submorphs do:[:m|		(m isFlashMorph and:[m isFlashCharacter]) ifTrue:[			m stepToFrame: frame.			m visible ifTrue:[				(lastVisible notNil and:[lastVisible depth < m depth])					ifTrue:[resortNeeded _ true].				lastVisible _ m.				(bounds containsRect: m bounds) ifFalse:[bounds _ bounds merge: m bounds].			].		].	].	resortNeeded ifTrue:[submorphs _ submorphs sortBy:[:m1 :m2| m1 depth > m2 depth]].	frameNumber _ frame.	playing ifTrue:[		self playSoundsAt: frame.		self executeActionsAt: frame.	].	(postDamage and:[owner notNil]) ifTrue:[		damageRecorder updateIsNeeded ifTrue:[			"fullRect _ damageRecorder fullDamageRect.			fullRect _ (self transform localBoundsToGlobal: fullRect)."			fullRect _ bounds.			owner invalidRect: (fullRect insetBy: -1) from: self.		].	].	postDamage ifTrue:[		damageRecorder _ nil].! !!FlashPlayerMorph methodsFor: 'stepping' stamp: 'ar 5/24/2001 16:50'!stepToFrame: frame	| fullRect postDamage |	frame = frameNumber ifTrue:[^self].	frame > loadedFrames ifTrue:[^self].	postDamage _ damageRecorder isNil.	postDamage ifTrue:[damageRecorder _ FlashDamageRecorder new].	frame = (frameNumber+1) ifTrue:[		self stepToFrameForward: frame.	] ifFalse:[		activeMorphs _ activeMorphs select:[:any| false].		submorphs do:[:m|			(m isFlashMorph and:[m isFlashCharacter]) ifTrue:[				m stepToFrame: frame.				m visible ifTrue:[activeMorphs add: m].			]].	].	frameNumber _ frame.	playing ifTrue:[		self playSoundsAt: frame.		self executeActionsAt: frame.	].	(postDamage and:[owner notNil]) ifTrue:[		damageRecorder updateIsNeeded ifTrue:[			fullRect _ damageRecorder fullDamageRect: self localBounds.			fullRect _ (self transform localBoundsToGlobal: fullRect).			owner invalidRect: (fullRect insetBy: -1) from: self.		].	].	postDamage ifTrue:[damageRecorder _ nil].! !FlashPlayerMorph removeSelector: #invalidRect:from:!