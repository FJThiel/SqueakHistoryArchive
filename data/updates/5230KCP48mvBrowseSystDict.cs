'From Squeak3.5 of ''11 April 2003'' [latest update: #5180] on 16 April 2003 at 9:04:38 pm'!"Change Set:		KCP-0048-mvBrowseSystDictDate:			16 April 2003Author:			stephane ducasseMove all the method browse* from systemDictionary to SystemNavigation and fix all the senders.Fix also some small errors introduced when moving method from Behavior hierarhcy to SystemNavigationPrereq other KCP changeset related to moving browse* method from Behavior hierarchy to SystemNavigation.(Fixed conflict with more recent change to ChangeSet>>mailOut in 5194. -dew)"!!SystemNavigation commentStamp: 'sd 4/15/2003 22:30' prior: 0!I support the navigation of the system. I act as a facade but as I could require some stateor different way of navigating the system all my behavior are on the instance side!!ChangeSet methodsFor: 'system navigation' stamp: 'sd 4/16/2003 09:15'!systemNavigation	^ SystemNavigation new! !!ChangeSet methodsFor: 'method changes' stamp: 'sd 4/16/2003 09:15'!browseMessagesWithPriorVersions	"Open a message list browser on the new and changed methods in the receiver which have at least one prior version.  6/28/96 sw"	| aList |	aList _ self 		messageListForChangesWhich: [ :aClass :aSelector |			(VersionsBrowser versionCountForSelector: aSelector class: aClass) > 1		]		ifNone: [^self inform: 'None!!'].	self systemNavigation 		browseMessageList: aList 		name: self name, ' methods that have prior versions'! !!ChangeSet methodsFor: 'fileIn/Out' stamp: 'sd 4/16/2003 09:15'!checkForAlienAuthorship	"Check to see if there are any methods in the receiver that have author initials other than that of the current author, and open a browser on all found"	| aList initials |	(initials _ Utilities authorInitialsPerSe) ifNil: [^ self inform: 'No author initials set in this image'].	(aList _ self methodsWithInitialsOtherThan: initials) size > 0		ifFalse:			[^ self inform: 'All methods in "', self name, '"have authoring stamps which start with "', initials, '"']		ifTrue:			[self systemNavigation  browseMessageList: aList name: 'methods in "', self name, '" whose authoring stamps do not start with "', initials, '"']! !!ChangeSet methodsFor: 'fileIn/Out' stamp: 'sd 4/16/2003 09:16'!checkForAnyAlienAuthorship	"Check to see if there are any versions of any methods in the receiver that have author initials other than that of the current author, and open a browser on all found"	| aList initials |	(initials _ Utilities authorInitialsPerSe) ifNil: [^ self inform: 'No author initials set in this image'].	(aList _ self methodsWithAnyInitialsOtherThan: initials) size > 0		ifFalse: [^ self inform: 'All versions of all methods in "', self name, '"have authoring stamps which start with "', initials, '"']		ifTrue:			[self systemNavigation  browseMessageList: aList name: 'methods in "', self name, '" with any authoring stamps not starting with "', initials, '"']! !!ChangeSet methodsFor: 'fileIn/Out' stamp: 'sd 4/16/2003 09:16'!checkForUnclassifiedMethods	"Open a message list browser on all methods in the current change set that have not been categorized,"	| aList |	(aList _ self methodsWithoutClassifications) size > 0		ifFalse:			[^ self inform: 'All methods in "', self name, '"are categorized.']		ifTrue:			[self systemNavigation  browseMessageList: aList name: 'methods in "', self name, '" which have not been categorized']! !!ChangeSet methodsFor: 'fileIn/Out' stamp: 'sd 4/16/2003 09:16'!checkForUncommentedMethods	| aList |	"Check to see if there are any methods in the receiver that have no comments, and open a browser on all found"	(aList _ self methodsWithoutComments) size > 0		ifFalse:			[^ self inform: 'All methods in "', self name, '" have comments']		ifTrue:			[self systemNavigation  browseMessageList: aList name: 'methods in "', self name, '" that lack comments']! !!ChangeSet methodsFor: 'fileIn/Out' stamp: 'sd 4/16/2003 09:16'!checkForUnsentMessages	"Check the change set for unsent messages, and if any are found, open up a message-list browser on them"	| nameLine allChangedSelectors augList unsent |	nameLine _ '"', self name, '"'.	allChangedSelectors _ Set new.	(augList _ self changedMessageListAugmented) do: [ :each |		each isValid ifTrue: [allChangedSelectors add: each methodSymbol]	].	unsent _ Smalltalk allUnSentMessagesIn: allChangedSelectors.	unsent size = 0 ifTrue: [		^self inform: 'There are no unsent messages in change set', nameLine	].	self systemNavigation  		browseMessageList: (augList select: [ :each | unsent includes: each methodSymbol]) 		name: 'Unsent messages in ', nameLine! !!ChangeSet methodsFor: 'fileIn/Out' stamp: 'sd 4/16/2003 09:16'!fileOut	"File out the receiver, to a file whose name is a function of the change-set name and either of the date & time or chosen to have a unique numeric tag, depending on the preference 'changeSetVersionNumbers'"	| file slips nameToUse |	self checkForConversionMethods.	nameToUse _ Preferences changeSetVersionNumbers		ifTrue:			[FileDirectory default nextNameFor: self name extension: 'cs']		ifFalse:			[(self name, FileDirectory dot, Utilities dateTimeSuffix, 				FileDirectory dot, 'cs') asFileName].	(Preferences warningForMacOSFileNameLength and: [nameToUse size > 31])		ifTrue: [			nameToUse _ FillInTheBlank request:  (nameToUse , '\has ' , nameToUse size asString , ' letters - too long for Mac OS.\Suggested replacement is:') withCRs initialAnswer: (nameToUse contractTo:30).			nameToUse = '' ifTrue:[^self]].	Cursor write showWhile:		[[file _ FileStream newFileNamed: nameToUse.		file header; timeStamp.		self fileOutPreambleOn: file.		self fileOutOn: file.		self fileOutPostscriptOn: file.		file trailer] ensure: [file close]].	Preferences checkForSlips ifFalse: [^ self].	slips _ self checkForSlips.	(slips size > 0 and: [(PopUpMenu withCaption: 'Methods in this fileOut have haltsor references to the Transcriptor other ''slips'' in them.Would you like to browse them?' chooseFrom: 'Ignore\Browse slips') = 2])		ifTrue: [self systemNavigation  browseMessageList: slips							name: 'Possible slips in ', name]! !!ChangeSet methodsFor: 'fileIn/Out' stamp: 'sd 4/16/2003 09:16'!lookForSlips	"Scan the receiver for changes that the user may regard as slips to be remedied"	| slips nameLine msg |	nameLine _ '"', self name, '"'.	(slips _ self checkForSlips) size == 0 ifTrue:		[^ self inform: 'No slips detected in change set', nameLine].	msg _ slips size == 1		ifTrue:			[ 'One method in change set', nameLine, 'has a halt, reference to the Transcript,and/or some other ''slip'' in it.Would you like to browse it? ?']		ifFalse:			[ slips size printString,' methods in change set', nameLine, 'have halts or references to theTranscript or other ''slips'' in them.Would you like to browse them?'].	(PopUpMenu withCaption: msg chooseFrom: 'Ignore\Browse slips') = 2		ifTrue: [self systemNavigation  browseMessageList: slips							name: 'Possible slips in ', name]! !!ChangeSet methodsFor: 'fileIn/Out' stamp: 'sd 4/16/2003 09:16'!mailOut	"Email a compressed version of this changeset to the squeak-dev list, so that it can be shared with everyone.  (You will be able to edit the email before it is sent.)"	| userName message slips |	userName _ MailSender userName.	self checkForConversionMethods.	Cursor write showWhile: [message _ self buildMessageForMailOutWithUser: userName].	MailSender sendMessage: message.	Preferences suppressCheckForSlips ifTrue: [^ self].	slips _ self checkForSlips.	(slips size > 0 and: [self confirm: 'Methods in this fileOut have haltsor references to the Transcriptor other ''slips'' in them.Would you like to browse them?'])		ifTrue: [self systemNavigation browseMessageList: slips name: 'Possible slips in ' , name]! !!ClassDescription methodsFor: 'deprecated' stamp: 'sd 4/16/2003 19:40'!browseInstVarDefs 		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseInstVarDefs: instead'! !!DialectParser class methodsFor: 'as yet unclassified' stamp: 'sd 4/16/2003 09:19'!test    "DialectParser test""PrettyPrints the source for every method in the system in the alternative syntax, and then compiles that source and verifies that it generates identical code.  No changes are actually made to the system.  At the time of this writing, only two methods caused complaints (reported in Transcript and displayed in browse window after running):	BalloonEngineSimulation circleCosTable and	BalloonEngineSimulation circleSinTable.These are not errors, but merely a case of Floats embedded in literal arrays, and thus not specially checked for roundoff errors.Note that if an error or interruption occurs during execution of this method, the alternativeSyntax preference will be left on.NOTE:  Some methods may not compare properly until the system has been recompiled once.  Do this by executing...		Smalltalk recompileAllFrom: 'AARDVAARK'."	 | newCodeString methodNode oldMethod newMethod badOnes n heading |	Preferences enable: #printAlternateSyntax.	badOnes _ OrderedCollection new.	Transcript clear.	Smalltalk forgetDoIts.'Formatting and recompiling all classes...'displayProgressAt: Sensor cursorPointfrom: 0 to: CompiledMethod instanceCountduring: [:bar | n _ 0.	Smalltalk allClassesDo:  "{MethodNode} do:"  "<- to check one class"		[:nonMeta |  "Transcript cr; show: nonMeta name."		{nonMeta. nonMeta class} do:		[:cls |		cls selectors do:			[:selector | (n _ n+1) \\ 100 = 0 ifTrue: [bar value: n].			newCodeString _ (cls compilerClass new)				format: (cls sourceCodeAt: selector)				in: cls notifying: nil decorated: Preferences colorWhenPrettyPrinting.			heading _ cls organization categoryOfElement: selector.			methodNode _ cls compilerClass new						compile: newCodeString						in: cls notifying: (SyntaxError new category: heading)						ifFail: [].			newMethod _ methodNode generate: #(0 0 0 0).			oldMethod _ cls compiledMethodAt: selector.			"Transcript cr; show: cls name , ' ' , selector."			oldMethod = newMethod ifFalse:				[Transcript cr; show: '***' , cls name , ' ' , selector.				oldMethod size = newMethod size ifFalse:					[Transcript show: ' difft size'].				oldMethod header = newMethod header ifFalse:					[Transcript show: ' difft header'].				oldMethod literals = newMethod literals ifFalse:					[Transcript show: ' difft literals'].				Transcript endEntry.				badOnes add: cls name , ' ' , selector]]]].].	SystemNavigation new browseMessageList: badOnes asSortedCollection name: 'Formatter Discrepancies'.	Preferences disable: #printAlternateSyntax.! !!ObjectExplorer methodsFor: 'system navigation' stamp: 'sd 4/16/2003 09:34'!systemNavigation	^ SystemNavigation new! !!ObjectExplorer methodsFor: 'as yet unclassified' stamp: 'sd 4/16/2003 11:41'!genericMenu: aMenu	| insideObject menu |	currentSelection ifNil:		[menu _ aMenu.		menu add: '*nothing selected*' target: self selector: #yourself]	 ifNotNil:		[menu _ DumberMenuMorph new defaultTarget: self.		insideObject _ currentSelection withoutListWrapper.		menu 			add: 'explore' target: insideObject  selector: #explore;			add: 'inspect' target: insideObject  selector: #inspect;			addLine;			add: 'objects pointing to this value' target: self systemNavigation  selector:  #browseAllObjectReferencesTo:except:ifNone:  argumentList: (Array with: insideObject with: #() with: nil);			addLine;			add: 'browse full' target: Browser  selector: #fullOnClass:  argument: insideObject class;			add: 'browse class' target: self  selector: #openBrowser: argument: insideObject class;			add: 'browse hierarchy' target: Utilities  selector:  #spawnHierarchyForClass:selector: argumentList: (Array with: insideObject class with: nil).		insideObject class == Symbol ifTrue: [			menu 				addLine;				add: ('senders of ', insideObject printString) target:  self systemNavigation  selector: #browseAllCallsOn:  argument: insideObject;				add: ('implementors of ', insideObject printString) target: self systemNavigation  selector: #browseAllImplementorsOf:  argument: insideObject]].	^ menu! !!ParagraphEditor methodsFor: 'menu messages' stamp: 'sd 4/16/2003 09:42'!browseIt	"Launch a browser for the current selection, if appropriate"	| aSymbol anEntry brow |	Preferences alternativeBrowseIt ifTrue: [^ self browseClassFromIt].	self lineSelectAndEmptyCheck: [^ self].	(aSymbol _ self selectedSymbol) isNil ifTrue: [^ view flash].	self terminateAndInitializeAround:		[aSymbol first isUppercase			ifTrue:				[anEntry _ (Smalltalk					at: aSymbol					ifAbsent:						[ self systemNavigation browseAllImplementorsOf: aSymbol.						^ nil]).				anEntry isNil ifTrue: [^ view flash].				(anEntry isKindOf: Class)					ifFalse:	[anEntry _ anEntry class].				brow _ Preferences browseToolClass new.				brow setClass: anEntry selector: nil.				brow class					openBrowserView: (brow openEditString: nil)					label: 'System Browser']			ifFalse:				[ self systemNavigation browseAllImplementorsOf: aSymbol]]! !!ParagraphEditor methodsFor: 'menu messages' stamp: 'sd 4/15/2003 22:40'!classCommentsContainingIt	"Open a browser class comments which contain the current selection somewhere in them."	self lineSelectAndEmptyCheck: [^ self].	self terminateAndInitializeAround: [		self systemNavigation browseClassCommentsWithString: self selection string]! !!ParagraphEditor methodsFor: 'menu messages' stamp: 'sd 4/16/2003 09:42'!implementorsOfIt	"Open an implementors browser on the selected selector"	| aSelector |	self lineSelectAndEmptyCheck: [^ self].	(aSelector _ self selectedSelector) == nil ifTrue: [^ view flash].	self terminateAndInitializeAround: [ self systemNavigation browseAllImplementorsOf: aSelector]! !!ParagraphEditor methodsFor: 'menu messages' stamp: 'sd 4/16/2003 19:31'!methodNamesContainingIt	"Open a browser on methods names containing the selected string"	self lineSelectAndEmptyCheck: [^ self].	Cursor wait showWhile:		[self terminateAndInitializeAround: [self systemNavigation browseMethodsWhoseNamesContain: self selection string withBlanksTrimmed]].	Cursor normal show! !!ParagraphEditor methodsFor: 'menu messages' stamp: 'sd 4/15/2003 22:35'!methodSourceContainingIt	"Open a browser on methods which contain the current selection in their source (case-sensitive full-text search of source).   EXTREMELY slow!!"	self lineSelectAndEmptyCheck: [^ self].	(self confirm: 'This will take a few minutes.Shall I proceed?') ifFalse: [^ self].	self systemNavigation browseMethodsWithSourceString: self selection string! !!ParagraphEditor methodsFor: 'menu messages' stamp: 'sd 4/16/2003 19:28'!methodStringsContainingit	"Open a browser on methods which contain the current selection as part of a string constant."	self lineSelectAndEmptyCheck: [^ self].	self terminateAndInitializeAround: [self systemNavigation browseMethodsWithString: self selection string]! !!ParagraphEditor methodsFor: 'menu messages' stamp: 'sd 4/16/2003 11:47'!referencesToIt	"Open a references browser on the selected symbol"	| aSymbol |	self selectLine.	((aSymbol _ self selectedSymbol) == nil or:		[(Smalltalk includesKey: aSymbol) not])			ifTrue: [^ view flash].	self terminateAndInitializeAround: [self systemNavigation browseAllCallsOn: (Smalltalk associationAt: self selectedSymbol)]! !!ParagraphEditor methodsFor: 'menu messages' stamp: 'sd 4/16/2003 19:30'!sendersOfIt	"Open a senders browser on the selected selector"	| aSelector |	self lineSelectAndEmptyCheck: [^ self].	(aSelector _ self selectedSelector) == nil ifTrue: [^ view flash].	self terminateAndInitializeAround: [self systemNavigation browseAllCallsOn: aSelector]! !!ParagraphEditor methodsFor: 'do-its' stamp: 'sd 4/16/2003 11:41'!objectsReferencingIt	"Open a list inspector on all objects that reference the object that results when the current selection is evaluated.  "	| result |	self terminateAndInitializeAround: [	result _ self evaluateSelection.	((result isKindOf: FakeClassPool) or: [result == #failedDoit])		ifTrue: [view flash]		ifFalse: [self systemNavigation					browseAllObjectReferencesTo: result					except: #()					ifNone: [:obj | view topView flash]].	]! !!ParagraphEditor methodsFor: 'system navigation' stamp: 'sd 4/15/2003 22:35'!systemNavigation	^ SystemNavigation new! !!Project methodsFor: 'file in/out' stamp: 'sd 4/16/2003 11:43'!storeSegmentNoFile	"For testing.  Make an ImageSegment.  Keep the outPointers in memory.  Also useful if you want to enumerate the objects in the segment afterwards (allObjectsDo:)"| is str |(World == world) ifTrue: [^ self].		" inform: 'Can''t send the current world out'."world isInMemory ifFalse: [^ self].  "already done"world isMorph ifFalse: [	self projectParameters at: #isMVC put: true.	^ self].	"Only Morphic projects for now"world ifNil: [^ self].  world presenter ifNil: [^ self]."Do this on project enter"World flapTabs do: [:ft | ft referent adaptToWorld: World].	"Hack to keep the Menu flap from pointing at my project""Preferences setPreference: #useGlobalFlaps toValue: false.""Utilities globalFlapTabsIfAny do:	[:aFlapTab | Utilities removeFlapTab: aFlapTab keepInList: false].Utilities clobberFlapTabList.	""project world deleteAllFlapArtifacts.""self currentWorld deleteAllFlapArtifacts.	"Utilities emptyScrapsBook.World checkCurrentHandForObjectToPaste2.is _ ImageSegment new copyFromRootsLocalFileFor: 		(Array with: world presenter with: world)	"world, and all Players"	sizeHint: 0.is segment size < 800 ifTrue: ["debugging" 	Transcript show: self name, ' did not get enough objects'; cr.  ^ self beep].false ifTrue: [	str _ String streamContents: [:strm |		strm nextPutAll: 'Only a tiny part of the project got into the segment'.		strm nextPutAll: '\These are pointed to from the outside:' withCRs.		is outPointers do: [:out |			(out class == Presenter) | (out class == ScriptEditorMorph) ifTrue: [				strm cr. out printOn: strm.				self systemNavigation					browseAllObjectReferencesTo: out					except: (Array with: is outPointers)					ifNone: [:obj | ]].			(is arrayOfRoots includes: out class) ifTrue: [strm cr. out printOn: strm.				self systemNavigation					browseAllObjectReferencesTo: out					except: (Array with: is outPointers)					ifNone: [:obj | ]]]].	self inform: str.	^ is inspect].is extract."is instVarAt: 2 put: is segment clone."		"different memory"! !!Project methodsFor: 'system navigation' stamp: 'sd 4/16/2003 11:42'!systemNavigation	^ SystemNavigation new! !!SmartRefStream methodsFor: 'class changed shape' stamp: 'sd 4/16/2003 08:47'!writeClassRenameMethod: sel was: oldName fromInstVars: oldList	"The class coming is unknown.  Ask the user for the existing class it maps to.  If got one, write a method, and restart the obj fileIn.  If none, write a dummy method and get the user to complete it later.  "| tell choice  newName answ code oldVer newList newVer instSel |	self flag: #bobconv.	tell _ 'Reading an instance of ', oldName, '.Which modern class should it translate to?'.answ _ (PopUpMenu labels: 'Let me type the name nowLet me think about itLet me find a conversion file on the disk') startUpWithCaption: tell. answ = 1 ifTrue: [	tell _ 'Name of the modern class that ', oldName, 's should it translate to:'.	choice _ FillInTheBlank request: tell.		"class name"	(choice size = 0) 		ifTrue: [answ _ 'conversion method needed']		ifFalse: [newName _ choice.			answ _ Smalltalk at: newName asSymbol 				ifAbsent: ['conversion method needed'].			answ class == String ifFalse: [renamed at: oldName asSymbol put: answ name]]].(answ = 3) | (answ = 0) ifTrue: [self close.		^ 'conversion method needed'].answ = 2 ifTrue: [answ _ 'conversion method needed'].answ = 'conversion method needed' ifTrue: [		self close.  		newName _ 'PutNewClassHere'].answ class == String ifFalse: [	oldVer _ self versionSymbol: (structures at: oldName).	newList _ (Array with: answ classVersion), (answ allInstVarNames).	newVer _ self versionSymbol: newList.	instSel _ 'convert',oldVer,':',newVer, ':'. 	].code _ WriteStream on: (String new: 500).code nextPutAll: sel; cr.answ class == String ifFalse: [	code cr; tab; nextPutAll: 'reshaped at: #', oldName, ' put: #', instSel, '.'.	code cr; tab; tab; nextPutAll: '"Be sure to define that conversion method in class ', answ name, '"'].code cr; tab; nextPutAll: '^ ', newName.	"Return new class"self class compile: code contents classified: 'conversion'.newName = 'PutNewClassHere' ifTrue: [	self inform: 'Please complete the following method and then read-in the object file again.'.	SystemNavigation new browseAllImplementorsOf: sel asSymbol]. 	self flag: #violateBasicLayerPrinciples. 	"SmartRefStream should not refer to UI!!!!!!!!!! (sd)"	"The class version number only needs to change under one specific circumstance.  That is when the first letters of the instance variables have stayed the same, but their meaning has changed.  A conversion method is needed, but this system does not know it.  	If this is true for class Foo, define classVersion in Foo class.  	Beware of previous object fileouts already written after the change in meaning, but before bumping the version number.  They have the old (wrong) version number, say 2.  If this is true, your method must be able to test the data and successfully read files that say version 2 but are really 3."	^ answ! !!StringHolder methodsFor: 'message list menu' stamp: 'sd 4/15/2003 22:46'!browseAllMessages	"Create and schedule a message set browser on all implementors of all the messages sent by the current method."	| aClass aName method filteredList |	(aName _ self selectedMessageName) ifNotNil: [		method _ (aClass _ self selectedClassOrMetaClass) compiledMethodAt: aName.		filteredList _ method messages reject: 			[:each | #(new initialize = ) includes: each].		self systemNavigation browseAllImplementorsOfList: filteredList asSortedCollection			 title: 'All messages sent in ', aClass name, '.', aName]! !!StringHolder methodsFor: 'message list menu' stamp: 'sd 4/16/2003 19:39'!browseClassRefs	| cls |	(cls _ self selectedClass) ifNotNil: [		self systemNavigation browseAllCallsOn: (Smalltalk associationAt: cls theNonMetaClass name)]! !!StringHolder methodsFor: 'message list menu' stamp: 'sd 4/16/2003 19:42'!browseInstVarDefs 	| cls |	(cls _ self selectedClassOrMetaClass) ifNotNil: [self systemNavigation browseInstVarDefs: cls]! !!StringHolder methodsFor: 'message list menu' stamp: 'sd 4/16/2003 08:42'!browseLocalImplementors	"Present a menu of all messages sent by the currently selected message. 	Open a message set browser of all implementors of the message chosen in or below	the selected class.	Do nothing if no message is chosen."	self getSelectorAndSendQuery: #browseAllImplementorsOf:localTo:		to: self systemNavigation		with: { self selectedClass }! !!StringHolder methodsFor: 'message list menu' stamp: 'sd 4/16/2003 20:41'!browseLocalSendersOfMessages	"Present a menu of the currently selected message, as well as all	messages sent by it.  Open a message set browser of all implementors	of the message chosen in or below the selected class"	self getSelectorAndSendQuery: #browseAllCallsOn:localTo:		to: self systemNavigation		with: { self selectedClass }! !!StringHolder methodsFor: 'message list menu' stamp: 'sd 4/16/2003 08:45'!browseMessages	"Present a menu of all messages sent by the currently selected message. 	Open a message set browser of all implementors of the message chosen."	self getSelectorAndSendQuery: #browseAllImplementorsOf: to: self systemNavigation! !!StringHolder methodsFor: 'message list menu' stamp: 'sd 4/16/2003 20:40'!browseSendersOfMessages	"Present a menu of the currently selected message, as well as all messages sent by it.  Open a message set browser of all senders of the selector chosen."	self getSelectorAndSendQuery: #browseAllCallsOn: to: self systemNavigation! !!StringHolder methodsFor: 'message list menu' stamp: 'sd 4/16/2003 09:18'!browseUnusedMethods	| classes unsent messageList cls |	(cls _ self selectedClass) ifNil: [^ self].	classes _ Array with: cls with: cls class.	unsent _ Set new.	classes do: [:c | unsent addAll: c selectors].	unsent _ Smalltalk allUnSentMessagesIn: unsent.	messageList _ OrderedCollection new.	classes do: [:c | (c selectors select: [:s | unsent includes: s]) asSortedCollection					do: [:sel | messageList add: c name , ' ' , sel]].	self systemNavigation browseMessageList: messageList name: 'Unsent Methods in ', cls name! !!StringHolder methodsFor: 'message list menu' stamp: 'sd 4/16/2003 08:45'!messageListKey: aChar from: view	"Respond to a Command key.  I am a model with a code pane, and I also	have a listView that has a list of methods.  The view knows how to get	the list and selection."	| sel class |	aChar == $D ifTrue: [^ self toggleDiffing].	sel _ self selectedMessageName.	aChar == $m ifTrue:  "These next two put up a type in if no message selected"		[^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllImplementorsOf: to: self systemNavigation].	aChar == $n ifTrue: 		[^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllCallsOn: to: self systemNavigation].	"The following require a class selection"	(class _ self selectedClassOrMetaClass) ifNil: [^ self arrowKey: aChar from: view].	aChar == $b ifTrue: [^ Browser fullOnClass: class selector: sel].	aChar == $N ifTrue: [^ self browseClassRefs].	aChar == $i ifTrue: [^ self methodHierarchy].	aChar == $h ifTrue: [^ self classHierarchy].	aChar == $p ifTrue: [^ self browseFullProtocol].	"The following require a method selection"	sel ifNotNil: 		[aChar == $o ifTrue: [^ self fileOutMessage].		aChar == $c ifTrue: [^ self copySelector].		aChar == $v ifTrue: [^ self browseVersions].		aChar == $O ifTrue: [^ self openSingleMessageBrowser].		aChar == $x ifTrue: [^ self removeMessage]].	^ self arrowKey: aChar from: view! !!StringHolder methodsFor: 'message list menu' stamp: 'sd 4/16/2003 08:52'!openSingleMessageBrowser	| msgName mr |	"Create and schedule a message list browser populated only by the currently selected message"	(msgName _ self selectedMessageName) ifNil: [^ self].	mr _ MethodReference new		setStandardClass: self selectedClassOrMetaClass		methodSymbol: msgName.	self systemNavigation 		browseMessageList: (Array with: mr)		name: mr asStringOrText		autoSelect: nil! !!CodeHolder methodsFor: 'commands' stamp: 'sd 4/16/2003 09:33'!browseImplementors	"Create and schedule a message set browser on all implementors of the currently selected message selector. Do nothing if no message is selected."	| aMessageName |	(aMessageName _ self selectedMessageName) ifNotNil: 		[self systemNavigation browseAllImplementorsOf: aMessageName]! !!CodeHolder methodsFor: 'message list menu' stamp: 'sd 4/16/2003 09:33'!messageListKey: aChar from: view	"Respond to a Command key.  I am a model with a code pane, and I also	have a listView that has a list of methods.  The view knows how to get	the list and selection."	| sel class |	aChar == $D ifTrue: [^ self toggleDiffing].	sel _ self selectedMessageName.	aChar == $m ifTrue:  "These next two put up a type in if no message selected"		[^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllImplementorsOf: to: self systemNavigation].	aChar == $n ifTrue: 		[^ self useSelector: sel orGetSelectorAndSendQuery: #browseAllCallsOn: to: self systemNavigation].	"The following require a class selection"	(class _ self selectedClassOrMetaClass) ifNil: [^ self arrowKey: aChar from: view].	aChar == $b ifTrue: [^ Browser fullOnClass: class selector: sel].	aChar == $N ifTrue: [^ self browseClassRefs].	aChar == $i ifTrue: [^ self methodHierarchy].	aChar == $h ifTrue: [^ self classHierarchy].	aChar == $p ifTrue: [^ self browseFullProtocol].	"The following require a method selection"	sel ifNotNil: 		[aChar == $o ifTrue: [^ self fileOutMessage].		aChar == $c ifTrue: [^ self copySelector].		aChar == $v ifTrue: [^ self browseVersions].		aChar == $O ifTrue: [^ self openSingleMessageBrowser].		aChar == $x ifTrue: [^ self removeMessage].		(aChar == $C and: [self canShowMultipleMessageCategories])			ifTrue: [^ self showHomeCategory]].	^ self arrowKey: aChar from: view! !!Browser methodsFor: 'class functions' stamp: 'sd 4/16/2003 08:51'!renameClass	| oldName newName obs |	classListIndex = 0 ifTrue: [^ self].	self okToChange ifFalse: [^ self].	oldName _ self selectedClass name.	newName _ self request: 'Please type new class name' initialAnswer: oldName.	newName = '' ifTrue: [^ self].  " Cancel returns '' "	newName _ newName asSymbol.	newName = oldName ifTrue: [^ self].	(Smalltalk includesKey: newName)		ifTrue: [^ self error: newName , ' already exists'].	self selectedClass rename: newName.	self changed: #classList.	self classListIndex: ((systemOrganizer listAtCategoryNamed: self selectedSystemCategoryName) indexOf: newName).	obs _ Smalltalk allCallsOn: (Smalltalk associationAt: newName).	obs isEmpty ifFalse: [		self systemNavigation 			browseMessageList: obs			name: 'Obsolete References to ' , oldName			autoSelect: oldName	].! !!ClassCommentVersionsBrowser methodsFor: 'menu' stamp: 'sd 4/16/2003 08:52'!openSingleMessageBrowser	| mr |	"Create and schedule a message list browser populated only by the currently selected message"	mr _ MethodReference new				setStandardClass: self selectedClass				methodSymbol: #Comment.	self systemNavigation 		browseMessageList: (Array with: mr)		name: mr asStringOrText		autoSelect: nil! !!Inspector methodsFor: 'menu commands' stamp: 'sd 4/16/2003 11:41'!objectReferencesToSelection	"Open a list inspector on all the objects that point to the value of the selected instance variable, if any.  "	self selectionIndex == 0 ifTrue: [^ self changed: #flash].	self systemNavigation		browseAllObjectReferencesTo: self selection		except: (Array with: self object)		ifNone: [:obj | self changed: #flash].! !!Lexicon methodsFor: 'new-window queries' stamp: 'sd 4/16/2003 19:43'!browseInstVarDefs	"Let the search pertain to the target class regardless of selection"	 self systemNavigation browseInstVarDefs: targetClass! !!SelectorBrowser methodsFor: 'as yet unclassified' stamp: 'sd 4/16/2003 09:45'!implementors	| aSelector |	(aSelector _ self selectedMessageName) ifNotNil:		[self systemNavigation browseAllImplementorsOf: aSelector]! !!SystemDictionary methodsFor: 'accessing' stamp: 'sd 4/16/2003 07:48'!systemNavigation	^ SystemNavigation new! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/16/2003 09:48'!browseAllCallsOn: aLiteral 		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllCallsOn:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/16/2003 10:19'!browseAllCallsOn: literal1 and: literal2 	self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllCallsOn:and:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/16/2003 11:44'!browseAllCallsOn: aLiteral localTo: aClass			self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllCallsOn:localTo:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/16/2003 09:32'!browseAllImplementorsOf: selector	self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllImplementorsOf:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/16/2003 08:41'!browseAllImplementorsOf: selector localTo: aClass		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllImplementorsOf:localTo:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 21:43'!browseAllImplementorsOfList: selectorList	self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllImplementorsOfList:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 22:45'!browseAllImplementorsOfList: selectorList title: aTitle		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllImplementorsOfList:title:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 22:42'!browseAllMethodsInCategory: category 		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllMethodsInCategory:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/16/2003 11:39'!browseAllObjectReferencesTo: anObject except: objectsToExclude ifNone: aBlock		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllObjectReferencesTo:except:ifNone:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 22:37'!browseAllSelect: aBlock		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllSelect:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/16/2003 07:49'!browseAllSelect: aBlock name: aName autoSelect: autoSelectString	self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllSelect:name:autoSelect:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 21:26'!browseAllUnSentMessages	self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllUnSentMessages'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 22:41'!browseAllUnimplementedCalls		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseAllUnimplementedCalls'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 22:39'!browseClassCommentsWithString: aString		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseClassCommentsWithString:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 22:25'!browseClassesWithNamesContaining: aString caseSensitive: caseSensitive 	self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseClassesWithNamesContaining:caseSensitive:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/16/2003 08:57'!browseMessageList: messageList name: label 			self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseMessageList:name:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/16/2003 08:49'!browseMessageList: messageList name: labelString autoSelect: autoSelectString			self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseMessageList:name:autoSelect:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 21:32'!browseMethodsWhoseNamesContain: aString		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseMethodsWhoseNamesContain:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 22:31'!browseMethodsWithSourceString: aString	self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseMethodsWithSourceString:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 22:29'!browseMethodsWithString: aString		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseMethodsWithString:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 22:27'!browseMethodsWithString: aString matchCase: caseSensitive		self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseMethodsWithString:matchCase:'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 20:32'!browseObsoleteReferences  	self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>browseObsoleteReferences'! !!SystemDictionary methodsFor: 'deprecated' stamp: 'sd 4/15/2003 21:22'!unimplemented	self flag: #deprecated.	self error: 'Method Deprecated: Use SystemNavigation>>unimplemented'! !!SystemDictionary methodsFor: 'housekeeping' stamp: 'sd 4/16/2003 08:53'!browseObsoleteMethodReferences	"Open a browser on all referenced behaviors that are obsolete"	"Smalltalk browseObsoleteMethodReferences"	| list |	list _ self obsoleteMethodReferences.	self systemNavigation  browseMessageList: list name:'Method referencing obsoletes' autoSelect: nil! !!SystemDictionary methodsFor: 'housekeeping' stamp: 'sd 4/16/2003 09:20'!testDecompiler    "Smalltalk testDecompiler"	"Decompiles the source for every method in the system, and then compiles that source and verifies that it generates (and decompiles to) identical code.  This currently fails in a number of places because some different patterns (esp involving conditionals where the first branch returns) decompile the same."	 | methodNode oldMethod newMethod badOnes oldCodeString n |	badOnes _ OrderedCollection new.	Smalltalk forgetDoIts.'Decompiling all classes...'displayProgressAt: Sensor cursorPointfrom: 0 to: CompiledMethod instanceCountduring: [:bar | n _ 0.	self allBehaviorsDo:		[:cls | 		"Transcript cr; show: cls name."		cls selectors do:			[:selector | (n _ n+1) \\ 100 = 0 ifTrue: [bar value: n].			oldMethod _ cls compiledMethodAt: selector.			oldCodeString _ (cls decompilerClass new								decompile: selector in: cls method: oldMethod)							decompileString.			methodNode _ cls compilerClass new						compile: oldCodeString						in: cls notifying: nil ifFail: [].			newMethod _ methodNode generate: #(0 0 0 0).			oldCodeString = (cls decompilerClass new								decompile: selector in: cls method: newMethod)							decompileString ifFalse: [Transcript cr; show: '***' , cls name , ' ' , selector.											badOnes add: cls name , ' ' , selector]]].].	self systemNavigation browseMessageList: badOnes asSortedCollection name: 'Decompiler Discrepancies'! !!SystemDictionary methodsFor: 'housekeeping' stamp: 'sd 4/16/2003 09:17'!testFormatter    "Smalltalk testFormatter"	"Reformats the source for every method in the system, and then compiles that source and verifies that it generates identical code.   The formatting used will be either classic monochrome or fancy polychrome, depending on the setting of the preference #colorWhenPrettyPrinting."	 | newCodeString methodNode oldMethod newMethod badOnes n |	badOnes _ OrderedCollection new.	Smalltalk forgetDoIts.'Formatting all classes...'displayProgressAt: Sensor cursorPointfrom: 0 to: CompiledMethod instanceCountduring: [:bar | n _ 0.	self allBehaviorsDo:		[:cls | 		"Transcript cr; show: cls name."		cls selectors do:			[:selector | (n _ n+1) \\ 100 = 0 ifTrue: [bar value: n].			newCodeString _ (cls compilerClass new)				format: (cls sourceCodeAt: selector)				in: cls notifying: nil decorated: Preferences colorWhenPrettyPrinting.			methodNode _ cls compilerClass new						compile: newCodeString						in: cls notifying: nil ifFail: [].			newMethod _ methodNode generate: #(0 0 0 0).			oldMethod _ cls compiledMethodAt: selector.			oldMethod = newMethod ifFalse: [Transcript cr; show: '***' , cls name , ' ' , selector.											badOnes add: cls name , ' ' , selector]]].].	self systemNavigation browseMessageList: badOnes asSortedCollection name: 'Formatter Discrepancies'! !!SystemDictionary methodsFor: 'housekeeping' stamp: 'sd 4/16/2003 09:17'!testFormatter2    "Smalltalk testFormatter2"	"Reformats the source for every method in the system, and then verifies that the order of source tokens is unchanged.  The formatting used will be either classic monochrome or fancy polychrome, depending on the setting of the preference #colorWhenPrettyPrinting."	 | newCodeString badOnes n oldCodeString oldTokens newTokens |	badOnes _ OrderedCollection new.	Smalltalk forgetDoIts.'Formatting all classes...'displayProgressAt: Sensor cursorPointfrom: 0 to: CompiledMethod instanceCountduring: [:bar | n _ 0.	Smalltalk allBehaviorsDo:		[:cls | 		"Transcript cr; show: cls name."		cls selectors do:			[:selector | (n _ n+1) \\ 100 = 0 ifTrue: [bar value: n].			oldCodeString _ (cls sourceCodeAt: selector) asString.			newCodeString _ (cls compilerClass new)				format: oldCodeString				in: cls notifying: nil decorated: Preferences colorWhenPrettyPrinting.			oldTokens _ oldCodeString findTokens: Character separators.			newTokens _ newCodeString findTokens: Character separators.			oldTokens = newTokens ifFalse:					[Transcript cr; show: '***' , cls name , ' ' , selector.					badOnes add: cls name , ' ' , selector]]].].	self systemNavigation browseMessageList: badOnes asSortedCollection name: 'Formatter Discrepancies'! !!Environment methodsFor: 'system conversion' stamp: 'sd 4/16/2003 08:52'!browseIndirectRefs  "Smalltalk browseIndirectRefs"	| cm lits browseList foundOne allClasses n |	self flag: #mref.		"no senders at the moment. also no Environments at the moment"	browseList _ OrderedCollection new.	allClasses _ OrderedCollection new.	Smalltalk allClassesAnywhereDo: [:cls | allClasses addLast: cls].	'Locating methods with indirect global references...'		displayProgressAt: Sensor cursorPoint		from: 0 to: allClasses size		during:		[:bar | n _ 0.		allClasses do:			[:cls | bar value: (n_ n+1).			{ cls. cls class } do:				[:cl | cl selectors do:					[:sel | cm _ cl compiledMethodAt: sel.					lits _ cm literals.					foundOne _ false.					lits do:						[:lit | lit isVariableBinding ifTrue:							[(lit value == cl or: [cl scopeHas: lit key ifTrue: [:ignored]])								ifFalse: [foundOne _ true]]].					foundOne ifTrue: [						browseList add: (							MethodReference new								setStandardClass: cl 								methodSymbol: sel						)					]]]]].	self systemNavigation 		browseMessageList: browseList asSortedCollection		name: 'Indirect Global References'		autoSelect: nil! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 08:53'!browseAllAccessesTo: instVarName from: aClass	"Create and schedule a Message Set browser for all the receiver's methods 	or any methods of a subclass/superclass that refer to the instance variable name."	"self new browseAllAccessesTo: 'contents' from: Collection."		| coll |	coll _ OrderedCollection new.	Cursor wait showWhile: [		aClass withAllSubAndSuperclassesDo: [:class | 			(class whichSelectorsAccess: instVarName) do: [:sel |				sel == #DoIt ifFalse: [					coll add: (						MethodReference new							setStandardClass: class 							methodSymbol: sel					)				]			]		].	].	^ self 		browseMessageList: coll 		name: 'Accesses to ' , instVarName 		autoSelect: instVarName! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 09:47'!browseAllCallsOn: aLiteral 	"Create and schedule a message browser on each method that refers to	aLiteral. For example, Smalltalk browseAllCallsOn: #open:label:."	(aLiteral isKindOf: LookupKey) ifTrue: [		^self  			browseMessageList: (self allCallsOn: aLiteral) asSortedCollection			name: 'Users of ' , aLiteral key			autoSelect: aLiteral key	].	self  		browseMessageList: (self allCallsOn: aLiteral) asSortedCollection		name: 'Senders of ' , aLiteral		autoSelect: aLiteral keywords first! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 10:19'!browseAllCallsOn: literal1 and: literal2 	"Create and schedule a message browser on each method that calls on the 	two Symbols, literal1 and literal2. For example, Smalltalk 	browseAllCallsOn: #at: and: #at:put:."	^self 		browseMessageList: (Smalltalk allCallsOn: literal1 and: literal2)		name: literal1 printString , ' -and- ' , literal2 printString! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 08:53'!browseAllCallsOn: aSymbol from: aClass	"Create and schedule a Message Set browser for all the methods that call 	on aSymbol."	"self new browseAllCallsOn: #/. from: Number"	| key label |	label _ (aSymbol isKindOf: LookupKey)			ifTrue: ['Users of ' , (key _ aSymbol key)]			ifFalse: ['Senders of ' , (key _ aSymbol)].	^ self 		browseMessageList: (self  allCallsOn: aSymbol from: aClass)		name: label		autoSelect: key	! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 11:44'!browseAllCallsOn: aLiteral localTo: aClass	"Create and schedule a message browser on each method in or below the given class that refers to	aLiteral. For example, Smalltalk browseAllCallsOn: #open:label:."	aClass ifNil: [ ^self inform: 'no selected class' ].	(aLiteral isKindOf: LookupKey)		ifTrue: [self browseMessageList: (aClass allLocalCallsOn: aLiteral) asSortedCollection					name: 'Users of ' , aLiteral key, ' local to ', aClass name					autoSelect: aLiteral key]		ifFalse: [self browseMessageList: (aClass allLocalCallsOn: aLiteral) asSortedCollection					name: 'Senders of ' , aLiteral, ' local to ', aClass name					autoSelect: aLiteral keywords first]! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 09:21'!browseAllImplementorsOf: selector	"Create and schedule a message browser on each method that implements 	the message whose selector is the argument, selector. For example, 	Smalltalk browseAllImplementorsOf: #at:put:."	^self 		browseMessageList: (Smalltalk allImplementorsOf: selector) 		name: 'Implementors of ' , selector! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 09:17'!browseAllImplementorsOf: selector localTo: aClass	"Create and schedule a message browser on each method in or below the given class	that implements the message whose selector is the argument, selector. For example, 	Smalltalk browseAllImplementorsOf: #at:put: localTo: Dictionary."	aClass ifNil: [ ^self inform: 'no class selected' ].	^self browseMessageList: (Smalltalk allImplementorsOf: selector localTo: aClass)		name: 'Implementors of ' , selector, ' local to ', aClass name! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/15/2003 21:43'!browseAllImplementorsOfList: selectorList	"Create and schedule a message browser on each method that implements 	the message whose selector is in the argument selectorList. For example, 	Smalltalk browseAllImplementorsOf: #(at:put: size).	1/16/96 sw: defer to the titled version"	self browseAllImplementorsOfList: selectorList title: 'Implementors of all'! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 09:17'!browseAllImplementorsOfList: selectorList title: aTitle	"Create and schedule a message browser on each method that implements the message whose selector is in the argument selectorList. For example,  Smalltalk browseAllImplementorsOf: #(at:put: size).	1/16/96 sw: this variant adds the title argument.	1/24/96 sw: use a SortedCollection	2/1/96 sw: show normal cursor"	| implementorLists flattenedList |	implementorLists _ selectorList collect: [:each | self allImplementorsOf: each].	flattenedList _ SortedCollection new.	implementorLists do: [:each | flattenedList addAll: each].	Cursor normal show.	^ self browseMessageList: flattenedList name: aTitle! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 09:17'!browseAllMethodsInCategory: category 	^self browseMessageList: (self allMethodsInCategory: category)		name: category! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 11:39'!browseAllObjectReferencesTo: anObject except: objectsToExclude ifNone: aBlock	"Bring up a list inspector on the objects that point to anObject.	If there are none, then evaluate aBlock on anObject.  "	| aList shortName |	aList _ Smalltalk pointersTo: anObject except: objectsToExclude.	aList size > 0 ifFalse: [^ aBlock value: anObject].	shortName _ (anObject name ifNil: [anObject printString]) contractTo: 20.	OrderedCollectionInspector openOn: aList withEvalPane: false		withLabel: 'Objects pointing to ', shortName.! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 09:16'!browseAllSelect: aBlock	"Create and schedule a message browser on each method that, when used 	as the block argument to aBlock gives a true result. For example, 	Smalltalk browseAllSelect: [:method | method numLiterals > 10]."	^self browseMessageList: (self allSelect: aBlock) name: 'selected messages'! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 19:28'!browseAllSelect: aBlock name: aName autoSelect: autoSelectString	"Create and schedule a message browser on each method that, when used 	as the block argument to aBlock gives a true result.   Do not return an #DoIt traces."	"self new browseAllSelect: [:method | method numLiterals > 10] name: 'Methods with more than 10 literals' autoSelect: 'isDigit'"	^ self   		browseMessageList: (Smalltalk allSelectNoDoits: aBlock)		name: aName		autoSelect: autoSelectString! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 08:53'!browseAllStoresInto: instVarName from: aClass	"Create and schedule a Message Set browser for all the receiver's methods 	or any methods of a subclass/superclass that refer to the instance variable name."		"self new browseAllStoresInto: 'contents' from: Collection."	| coll |	coll _ OrderedCollection new.	Cursor wait showWhile: [		aClass withAllSubAndSuperclassesDo: [:class | 			(class whichSelectorsStoreInto: instVarName) do: [:sel |				sel == #DoIt ifFalse: [					coll add: (						MethodReference new							setStandardClass: class 							methodSymbol: sel					)				]			]		].	].	^ self		browseMessageList: coll 		name: 'Stores into ' , instVarName 		autoSelect: instVarName! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/15/2003 21:26'!browseAllUnSentMessages	"Create and schedule a message browser on each method whose message is  not sent in any method in the system."	"self new browseAllUnSentMessages"	self browseAllImplementorsOfList: self allUnSentMessages title: 'Messages implemented but not sent'! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 09:16'!browseAllUnimplementedCalls	"Create and schedule a message browser on each method that includes a 	message that is not implemented in any object in the system."	^self   browseMessageList: self allUnimplementedCalls name: 'Unimplemented calls'! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 08:53'!browseClassCommentsWithString: aString	"Smalltalk browseClassCommentsWithString: 'my instances' "	"Launch a message list browser on all class comments containing aString as a substring."	| caseSensitive suffix list |	suffix _ (caseSensitive _ Sensor shiftPressed)		ifTrue: [' (case-sensitive)']		ifFalse: [' (use shift for case-sensitive)'].	list _ Set new.	Cursor wait showWhile: [		Smalltalk allClassesDo: [:class | 			(class organization classComment asString findString: aString 							startingAt: 1 caseSensitive: caseSensitive) > 0 ifTrue: [								list add: (									MethodReference new										setStandardClass: class										methodSymbol: #Comment								)							]		]	].	^ self 		browseMessageList: list asSortedCollection		name: 'Class comments containing ' , aString printString , suffix		autoSelect: aString! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 19:38'!browseClassVarRefs: aClass	"Put up a menu offering all class variable names; if the user chooses one, open up a message-list browser on all methods 	that refer to the selected class variable"	| lines labelStream vars allVars index owningClasses |	lines _ OrderedCollection new.	allVars _ OrderedCollection new.	owningClasses _ OrderedCollection new.	labelStream _ WriteStream on: (String new: 200).	aClass withAllSuperclasses reverseDo:		[:class |		vars _ class classVarNames asSortedCollection.		vars do:			[:var |			labelStream nextPutAll: var; cr.			allVars add: var.			owningClasses add: class].		vars isEmpty ifFalse: [lines add: allVars size]].	labelStream contents isEmpty ifTrue: [^1 beep]. "handle nil superclass better"	labelStream skip: -1 "cut last CR".	index _ (PopUpMenu labels: labelStream contents lines: lines) startUp.	index = 0 ifTrue: [^ self].	self  browseAllCallsOn:		((owningClasses at: index) classPool associationAt: (allVars at: index))! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/15/2003 22:24'!browseClassesWithNamesContaining: aString caseSensitive: caseSensitive 	"Smalltalk browseClassesWithNamesContaining: 'eMorph' caseSensitive: true "	"Launch a class-list list browser on all classes whose names containg aString as a substring."	| suffix aList |	suffix _ caseSensitive				ifTrue: [' (case-sensitive)']				ifFalse: [' (use shift for case-sensitive)'].	aList _ OrderedCollection new.	Cursor wait		showWhile: [Smalltalk				allClassesDo: [:class | (class name includesSubstring: aString caseSensitive: caseSensitive)						ifTrue: [aList add: class name]]].	aList size > 0		ifTrue: [ClassListBrowser new initForClassesNamed: aList asSet asSortedArray title: 'Classes whose names contain ' , aString , suffix]! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 09:18'!browseMessageList: messageList name: label 	"Create and schedule a MessageSet browser on messageList."	^ self   		browseMessageList: messageList 		name: label 		autoSelect: nil! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 08:48'!browseMessageList: messageList name: labelString autoSelect: autoSelectString	| title aSize |	"Create and schedule a MessageSet browser on the message list."	messageList size = 0 ifTrue: 		[^ (PopUpMenu labels: ' OK ')				startUpWithCaption: 'There are no' , labelString].	title _ (aSize _ messageList size) > 1		ifFalse:	[labelString]		ifTrue:	[ labelString, ' [', aSize printString, ']'].	MessageSet 		openMessageList: messageList 		name: title 		autoSelect: autoSelectString! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/15/2003 22:46'!browseMethodsWhoseNamesContain: aString	"Launch a tool which shows all methods whose names contain the given string; case-insensitive.	1/16/1996 sw, at the dawn of Squeak: this was the classic implementation that provided the underpinning for the 'method names containing it' (cmd-shift-W) feature that has always been in Squeak -- the feature that later inspired the MethodFinder (aka SelectorBrowser).	sw 7/27/2001:	Switched to showing a MessageNames tool rather than a message-list browser, if in Morphic."	| aList |	Smalltalk isMorphic		ifFalse:			[aList _ Symbol selectorsContaining: aString.			aList size > 0 ifTrue:				[self browseAllImplementorsOfList: aList asSortedCollection title: 'Methods whose names contain ''', aString, '''']]		ifTrue:			[(MessageNames methodBrowserSearchingFor: aString) openInWorld]	! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 08:54'!browseMethodsWithSourceString: aString	"SystemNavigation new browseMethodsWithSourceString: 'SourceString' "	"Launch a browser on all methods whose source code contains aString as a substring."	| caseSensitive suffix |	suffix _ (caseSensitive _ Sensor shiftPressed)		ifTrue: [' (case-sensitive)']		ifFalse: [' (use shift for case-sensitive)'].	^ self 		browseMessageList: (Smalltalk allMethodsWithSourceString: aString matchCase: caseSensitive)		name: 'Methods containing ' , aString printString , suffix		autoSelect: aString! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/15/2003 22:28'!browseMethodsWithString: aString	"Launch a browser on all methods that contain string literals with aString as a substring. The search is case-insensitive, unless the shift key is pressed, in which case the search is case-sensitive."	'string for testing'.	^ self browseMethodsWithString: aString matchCase: Sensor shiftPressed	"SystemNavigation new browseMethodsWithString: 'Testing' matchCase: false"	"SystemNavigation new browseMethodsWithString: 'Testing' matchCase: true"! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/16/2003 07:51'!browseMethodsWithString: aString matchCase: caseSensitive	"Launch a browser on all methods that contain string literals with aString as a substring. Make the search case-sensitive or insensitive as dictated by the caseSensitive boolean parameter"	self browseAllSelect:			[:method |				method  hasLiteralSuchThat: [:lit |					lit class == String and:					[lit includesSubstring: aString caseSensitive: caseSensitive]]]		name:  'Methods with string ', aString printString, (caseSensitive ifTrue: [' (case-sensitive)'] ifFalse: [' (case-insensitive)'])		autoSelect: aString.! !!SystemNavigation methodsFor: 'browse' stamp: 'sd 4/15/2003 20:32'!browseObsoleteReferences  	"self new browseObsoleteReferences"	| references |	references _ OrderedCollection new.	(LookupKey allSubInstances select:		[:x | ((x value isKindOf: Behavior) and: ['AnOb*' match: x value name]) or:		['AnOb*' match: x value class name]]) 		do: [:x | references addAll: (self allCallsOn: x)].	self  		browseMessageList: references 		name: 'References to Obsolete Classes'! !!SystemNavigation methodsFor: 'query' stamp: 'sd 4/16/2003 09:48'!allCallsOn: aLiteral   	"Answer a Collection of all the methods that call on aLiteral."	"self new browseAllCallsOn: #open:label:."		| aCollection special thorough aList byte |	aCollection _ OrderedCollection new.	"Example above should find #open:label:, though it is deeply embedded here."	special _ Smalltalk hasSpecialSelector: aLiteral ifTrueSetByte: [:b | byte _ b ].	thorough _ (aLiteral isMemberOf: Symbol)				and: ["Possibly search for symbols imbedded in literal arrays"					Preferences thoroughSenders].	Cursor wait showWhile: [		Smalltalk allBehaviorsDo: [:class |			aList _ thorough ifTrue: [				class thoroughWhichSelectorsReferTo: aLiteral special: special byte: byte			] ifFalse: [				class whichSelectorsReferTo: aLiteral special: special byte: byte			].			aList do: [ :sel |				sel == #DoIt ifFalse: [					aCollection add: (						MethodReference new							setStandardClass: class 							methodSymbol: sel					)				]			]		]	].	^ aCollection! !!SystemNavigation methodsFor: 'query' stamp: 'sd 4/15/2003 21:21'!unimplemented	"Answer an Array of each message that is sent by an expression in a method but is not implemented by any object in the system."	| all unimplemented entry |	all _ IdentitySet new: Symbol instanceCount * 2.	Cursor wait showWhile: 		[self allBehaviorsDo: [:cl | cl selectorsDo: [:aSelector | all add: aSelector]]].	unimplemented _ IdentityDictionary new.	Cursor execute showWhile: [		self allBehaviorsDo: [:cl |			 cl selectorsDo: [:sel |				(cl compiledMethodAt: sel) messages do: [:m |					(all includes: m) ifFalse: [						entry _ unimplemented at: m ifAbsent: [Array new].						entry _ entry copyWith: (cl name, '>', sel).						unimplemented at: m put: entry]]]]].	"remove some clutter from the result:"	#(DoItIn: primitiveFail diffedVersionContents uniformWindowColors macOptionKeyAllowed)		do: [:sel | unimplemented removeKey: sel ifAbsent: []].	"these messages are not sent when running on the Zaurus:"	#(channelData defaultAALevel: from:title: fromWaveFileNamed: imageFormOfSize:forFrame:invokeAt:in: loadedFrames originalSamplingRate printInstructionsOn: processFilereadFrom:mergeIfStereo:skipDataChunk: samples samples:samplingRate: samplesRemainingstoreAIFFSamples:samplingRate:on: windowMenuWithLabels:colorPattern:targets:selections:title:)		do: [:sel | unimplemented removeKey: sel ifAbsent: []].	^ unimplemented! !!SystemNavigation methodsFor: 'ui' stamp: 'sd 4/16/2003 08:54'!confirmRemovalOf: aSelector on: aClass	"Determine if it is okay to remove the given selector. Answer 1 if it 	should be removed, 2 if it should be removed followed by a senders 	browse, and 3 if it should not be removed."	| count aMenu answer caption allCalls |	allCalls _ aClass environment allCallsOn: aSelector.	(count _ allCalls size) == 0		ifTrue: [^ 1].	"no senders -- let the removal happen without warning"	count == 1		ifTrue: [(allCalls first actualClass == aClass					and: [allCalls first methodSymbol == aSelector])				ifTrue: [^ 1]].	"only sender is itself"	aMenu _ PopUpMenu labels: 'Remove itRemove, then browse sendersDon''t remove, but show me those sendersForget it -- do nothing -- sorry I asked'.	caption _ 'This message has ' , count printString , ' sender'.	count > 1		ifTrue: [caption _ caption copyWith: $s].	answer _ aMenu startUpWithCaption: caption.	answer == 3		ifTrue: [self				browseMessageList: allCalls				name: 'Senders of ' , aSelector				autoSelect: aSelector keywords first].	answer == 0		ifTrue: [answer _ 3].	"If user didn't answer, treat it as cancel"	^ answer min: 3! !!Utilities class methodsFor: 'identification' stamp: 'sd 4/16/2003 07:51'!methodsWithInitials: targetInitials	"Based on a do-it contributed to the Squeak mailing list by Gran Hultgen: Browse methods whose initials (in the time-stamp, as logged to disk) match the given initials. Print out the complete time-stamp table to the Transcript. Answer a list of (initials -> count) associations.CAUTION: It may take several minutes for this to complete."	"Time millisecondsToRun: [Utilities methodsWithInitials: 'bf']"	| initials timeStamp  allSubmitters |	initials _ ''.	timeStamp _ ''.	allSubmitters _ Bag new.	self systemNavigation		browseAllSelect:			[:cm |				timeStamp _ Utilities timeStampForMethod: cm.				initials _ timeStamp isEmpty					ifTrue:						['']					ifFalse:						[timeStamp substrings first].				initials _ initials isEmpty					ifTrue:						['<no time stamp>']					ifFalse:						[initials first isDigit							ifTrue:								['<date>']							ifFalse:								[initials]].				allSubmitters add: initials.				(initials = targetInitials)]		name: ('Methods with initials ', targetInitials)		autoSelect: nil.	allSubmitters sortedCounts do: [:elem | Transcript cr; show: elem asString].	^ allSubmitters! !!Utilities class methodsFor: 'summer97 additions' stamp: 'sd 4/16/2003 09:16'!methodHierarchyBrowserForClass: aClass selector: sel	"Create and schedule a message set browser on all implementors of the 	currently selected message selector. Do nothing if no message is selected."	| list tab stab aClassNonMeta isMeta theClassOrMeta |	aClass ifNil: [^ self].	sel ifNil: [^ self].	aClassNonMeta _ aClass theNonMetaClass.	isMeta _ aClassNonMeta ~~ aClass.	list _ OrderedCollection new.	tab _ ''.	aClass allSuperclasses reverseDo:		[:cl |		(cl includesSelector: sel) ifTrue:			[list addLast: tab , cl name, ' ', sel].		tab _ tab , '  '].	aClassNonMeta allSubclassesWithLevelDo:		[:cl :level |		theClassOrMeta _ isMeta ifTrue: [cl class] ifFalse: [cl].		(theClassOrMeta includesSelector: sel) ifTrue:			[stab _ ''.  1 to: level do: [:i | stab _ stab , '  '].			list addLast: tab , stab , theClassOrMeta name, ' ', sel]]	 	startingLevel: 0.	self systemNavigation  browseMessageList: list		name: 'Inheritance of ' , sel"Utilities methodHierarchyBrowserForClass: ParagraphEditor selector: #isControlActive"! !!Utilities class methodsFor: 'system navigation' stamp: 'sd 4/16/2003 07:51'!systemNavigation	^ SystemNavigation new! !!Viewer methodsFor: 'queries' stamp: 'sd 4/16/2003 08:44'!browseImplementorsOf: aSelector	"Open a browser on implementors of aSelector"	self systemNavigation browseAllImplementorsOf: aSelector! !!Viewer methodsFor: 'queries' stamp: 'sd 4/16/2003 08:44'!systemNavigation	^ SystemNavigation new! !!Vocabulary class methodsFor: 'eToy vocabularies' stamp: 'sd 4/16/2003 08:43'!newSystemVocabulary	"Answer a Vocabulary object representing significant requests one can make to the Smalltalk object"	| aVocabulary |	aVocabulary _ self new.	aVocabulary vocabularyName: #System.	aVocabulary documentation: 'Useful messages you might want to send to Smallalk'.	aVocabulary initializeFromTable:  #((aboutThisSystem none () none (basic queries) 'put up a message describing the system' unused)(saveAsNewVersion none () none (services) 'advance to the next available image-version number and save the image under that new name' unused znak)(datedVersion none () String (queries) 'the version of the Squeak system')(endianness none () String (queries) 'big or little - the byte-ordering of the hardware Squeak is currently running on')(exitToDebugger none () none (dangerous) 'exits to the host debugger.  Do not use this -- I guarantee you will be sorry.')(bytesLeft none () Number (basic services) 'perform a garbage collection and answer the number of bytes of free space remaining in the system')"(browseAllCallsOn: none ((aSelector String)) none (#'queries') 'browse all calls on a selector')(browseAllImplementorsOf: none ((aSelector String)) none (#'queries') 'browse all implementors of a selector')""(allMethodsWithSourceString:matchCase: none ((aString String) (caseSensitive Boolean)) none (queries) 'browse all methods that have the given source string, making the search case-sensitive or not depending on the argument provided.')(browseMethodsWithString:matchCase: none ((aString String) (caseSensitive Boolean)) none (queries) 'browse all methods that contain the given string in any string literal, making the search case-sensitive or not depending on the argument provided.')(browseAllImplementorsOf:localTo: none ((aSelector String) (aClass Class)) none (#'queries') 'browse all implementors of a selector that are local to a class')")."(isKindOf: none 	((aClass Class)) Boolean (#'class membership') 'answer whether the receiver''s superclass chain includes aClass')"	^ aVocabulary"Vocabulary initialize""Vocabulary addStandardVocabulary: Vocabulary newSystemVocabulary""Smalltalk basicInspect""Smalltalk beViewed"! !