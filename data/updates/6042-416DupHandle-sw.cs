'From Squeakland 3.2.4913 of 10 July 2002 [latest update: #222] on 28 July 2004 at 11:03:02 pm'!"Change Set:		e16DupHandle-swDate:			28 July 2004Author:			Scott WallaceGreen halo handle now shows as olive green and makes a sibling instance instead of a veryDeepCopy when used on morph whose player is a member of a uniclass.  Both make-sibling and make-duplicate are now always available in the halo-actions section of the morph halo menuOriginally published as update 0225 to Squeakland."!!Morph methodsFor: 'menus' stamp: 'sw 7/28/2004 16:23'!addHaloActionsTo: aMenu	"Add items to aMenu representing actions requestable via halo"	| subMenu |	subMenu _ MenuMorph new defaultTarget: self.	subMenu addTitle: self externalName.	subMenu addStayUpItemSpecial.	subMenu addLine.	subMenu add: 'delete' translated action: #dismissViaHalo.	subMenu balloonTextForLastItem: 'Delete this object -- warning -- can be destructive!!' translated.	self maybeAddCollapseItemTo: subMenu.	subMenu add: 'grab' translated action: #openInHand.	subMenu balloonTextForLastItem: 'Pick this object up -- warning, since this removes it from its container, it can have adverse effects.' translated.	subMenu addLine.	subMenu add: 'resize' translated action: #resizeFromMenu.	subMenu balloonTextForLastItem: 'Change the size of this object' translated.	subMenu add: 'duplicate' translated action: #maybeDuplicateMorph.	subMenu balloonTextForLastItem: 'Hand me a copy of this object' translated.	"Note that this allows access to the non-instancing duplicate even when this is a uniclass instance"	subMenu add: 'make a sibling' translated action: #handUserASibling.	subMenu balloonTextForLastItem: 'Make a new sibling of this object and hand it to me' translated.	subMenu addLine.	subMenu add: 'property sheet' translated target: self renderedMorph action: #openAPropertySheet.	subMenu balloonTextForLastItem: 'Open a property sheet for me. Allows changing lots of stuff at once.' translated.	subMenu add: 'set color' translated target: self renderedMorph action: #changeColor.	subMenu balloonTextForLastItem: 'Change the color of this object' translated.	subMenu add: 'viewer' translated target: self action: #beViewed.	subMenu balloonTextForLastItem: 'Open a Viewer that will allow everything about this object to be seen and controlled.' translated.	subMenu add: 'tile browser' translated target: self action: #openInstanceBrowserWithTiles.	subMenu balloonTextForLastItem: 'Open a tool that will facilitate tile scripting of this object.' translated.	subMenu add: 'hand me a tile' translated target: self action: #tearOffTile.	subMenu balloonTextForLastItem: 'Hand me a tile represting this object' translated.	subMenu addLine.	subMenu add: 'inspect' translated target: self action: #inspect.	subMenu balloonTextForLastItem: 'Open an Inspector on this object' translated.	aMenu add: 'halo actions...' translated subMenu: subMenu! !!Morph methodsFor: 'halos and balloon help' stamp: 'sw 7/28/2004 15:31'!addHandlesTo: aHaloMorph box: box	"Add halo handles to the halo.  Apply the halo filter if appropriate"	| isUniClass wantsIt aSelector |	aHaloMorph haloBox: box.	Preferences haloSpecifications  do:		[:aSpec | 			aSelector _  aSpec addHandleSelector.			wantsIt _ Preferences selectiveHalos				ifTrue:					[self wantsHaloHandleWithSelector: aSelector inHalo: aHaloMorph]				ifFalse:					[true].			wantsIt ifTrue:				[(#(addMakeSiblingHandle: addDupHandle:) includes: aSelector) ifTrue:					[isUniClass _ self renderedMorph player "<- may well be nil" class isUniClass.					wantsIt _ isUniClass = (aSelector = #addMakeSiblingHandle:)].			wantsIt ifTrue:				[aHaloMorph perform: aSelector with: aSpec]]].	aHaloMorph innerTarget addOptionalHandlesTo: aHaloMorph box: box! !!Morph methodsFor: 'halos and balloon help' stamp: 'sw 7/28/2004 15:40'!balloonHelpTextForHandle: aHandle	"Answer a string providing balloon help for the given halo handle"	|  itsSelector |	itsSelector _ aHandle eventHandler firstMouseSelector.	#(	(addFullHandles							'More halo handles')		(addSimpleHandles						'Fewer halo handles')		(chooseEmphasisOrAlignment				'Emphasis & alignment')		(chooseFont								'Change font')		(chooseNewGraphicFromHalo				'Choose a new graphic')		(chooseStyle								'Change style')		(dismiss									'Remove')		(doDebug:with:							'Debug')		(doDirection:with:						'Choose forward direction')		(doDup:with:							'Duplicate')		(doMakeSibling:with: 					'Make a sibling')		(doMenu:with:							'Menu')		(doGrab:with:							'Pick up')		(doRecolor:with:							'Change color')		(editButtonsScript						'See the script for this button')		(editDrawing							'Repaint')		(maybeDoDup:with:						'Duplicate')		(makeNascentScript						'Make a scratch script')		(makeNewDrawingWithin				'Paint new object')		(mouseDownInCollapseHandle:with:		'Collapse')		(mouseDownOnHelpHandle:				'Help')		(openViewerForArgument				'Open a Viewer for me')		(openViewerForTarget:with:				'Open a Viewer for me')		(paintBackground						'Paint background')		(prepareToTrackCenterOfRotation:with:	'Move object or set center of rotation')		(presentViewMenu						'Present the Viewing menu')		(startDrag:with:							'Move')		(startGrow:with:							'Change size') 		(startRot:with:							'Rotate')		(startScale:with:							'Change scale') 		(tearOffTile								'Make a tile representing this object')		(tearOffTileForTarget:with:				'Make a tile representing this object')		(trackCenterOfRotation:with:				'Set center of rotation')) 	do:		[:pair | itsSelector == pair first ifTrue: [^ pair last]].	(itsSelector == #mouseDownInDimissHandle:with:) ifTrue:		[^ Preferences preserveTrash			ifTrue:				['Move to trash']			ifFalse:				['Remove from screen']].	^ 'unknown halo handle'! !!Morph methodsFor: 'e-toy support' stamp: 'sw 7/28/2004 16:05'!handUserASibling	"Make and hand the user a sibling instance.  Force the creation of a uniclass at this point if one does not already exist for the receiver."	| topRend |	topRend _ self topRendererOrSelf.	topRend assuredPlayer assureUniClass.	(topRend makeSiblings: 1) first openInHand! !!HaloMorph methodsFor: 'private' stamp: 'sw 7/28/2004 15:58'!doMakeSibling: evt with: dupHandle	"Ask hand to make a sibling of my target.  Only reachable if target is of a uniclass"	target assuredPlayer assureUniClass.	self obtainHaloForEvent: evt andRemoveAllHandlesBut: dupHandle.	self setTarget: (target makeSiblings: 1) first.	evt hand grabMorph: target.	self step. "update position if necessary"	evt hand addMouseListener: self. "Listen for the drop"! !!HaloMorph methodsFor: 'handles' stamp: 'sw 7/28/2004 15:58'!addMakeSiblingHandle: haloSpec	"Add the handle that allows a sibling instance to be torn off"	self addHandle: haloSpec on: #mouseDown send: #doMakeSibling:with: to: self! !!Preferences class methodsFor: 'halos' stamp: 'sw 7/28/2004 16:26'!classicHaloSpecs	"Non-iconic halos with traditional placements"	"Preferences installClassicHaloSpecs"	"Preferences resetHaloSpecifications"  "  <-  will result in the standard default halos being reinstalled"	"NB: listed below in clockwise order"		^ #(	"  	selector				horiz		vert			color info						icon key		---------				------		-----------		-------------------------------		---------------"	(addMenuHandle:		left			top				(red)							none)	(addDismissHandle:		leftCenter	top				(red		muchLighter)			'Halo-Dismiss')	(addGrabHandle:			center		top				(black)							none)	(addDragHandle:			rightCenter	top				(brown)							none)	(addDupHandle:			right		top				(green)							none)		(addMakeSiblingHandle:	right		top				(green muchDarker)				'Halo-Dup')		(addDebugHandle:		right		topCenter		(blue	veryMuchLighter)		none)	(addPoohHandle:			right		center			(white)							none)	(addPaintBgdHandle:		right		center			(lightGray)						none)	(addRepaintHandle:		right		center			(lightGray)						none)	(addGrowHandle:		right		bottom			(yellow)						none)	(addScaleHandle:		right		bottom			(lightOrange)					none)	(addFontEmphHandle:	rightCenter	bottom			(lightBrown darker)				none)	(addFontStyleHandle:		center		bottom			(lightRed)						none)	(addFontSizeHandle:		leftCenter	bottom			(lightGreen)						none)	(addRecolorHandle:		right		bottomCenter	(magenta darker)				none)	(addRotateHandle:		left			bottom			(blue)							none))! !!Preferences class methodsFor: 'halos' stamp: 'sw 7/28/2004 15:41'!iconicHaloSpecifications	"Answer an array that characterizes the locations, colors, icons, and selectors of the halo handles that may be used in the iconic halo scheme"	"Preferences resetHaloSpecifications"	^ #(	"  	selector				horiz		vert			color info						icon key		---------				------		-----------		-------------------------------		---------------"	(addCollapseHandle:		left			topCenter		(tan)							'Halo-Collapse')	(addPoohHandle:			right		center			(white)							'Halo-Pooh')	(addDebugHandle:		right		topCenter		(blue	veryMuchLighter)		'Halo-Debug')	(addDismissHandle:		left			top				(red		muchLighter)			'Halo-Dismiss')	(addRotateHandle:		left			bottom			(blue)							'Halo-Rot')	(addMenuHandle:		leftCenter	top				(red)							'Halo-Menu')	(addTileHandle:			left			bottomCenter	(lightBrown)					'Halo-Tile')	(addViewHandle:			left			center			(cyan)							'Halo-View')	(addGrabHandle:			center		top				(black)							'Halo-Grab')	(addDragHandle:			rightCenter	top				(brown)							'Halo-Drag')	(addDupHandle:			right		top				(green)							'Halo-Dup')		(addMakeSiblingHandle:	right		top				(green muchDarker)				'Halo-Dup')		(addHelpHandle:			center		bottom			(lightBlue)						'Halo-Help')	(addGrowHandle:		right		bottom			(yellow)						'Halo-Scale')	(addScaleHandle:		right		bottom			(lightOrange)					'Halo-Scale')	(addScriptHandle:		rightCenter	bottom			(green muchLighter)			'Halo-Script')	(addPaintBgdHandle:		right		center			(lightGray)						'Halo-Paint')	(addViewingHandle:		leftCenter	bottom			(lightGreen lighter)				'Halo-View')	(addRepaintHandle:		right		center			(lightGray)						'Halo-Paint')	(addFontSizeHandle:		leftCenter	bottom			(lightGreen)						'Halo-FontSize')	(addFontStyleHandle:		center		bottom			(lightRed)						'Halo-FontStyle')	(addFontEmphHandle:	rightCenter	bottom			(lightBrown darker)				'Halo-FontEmph')	(addRecolorHandle:		right		bottomCenter	(magenta darker)				'Halo-Recolor')	(addChooseGraphicHandle:	right	bottomCenter	(green muchLighter)			'Halo-ChooseGraphic')		) ! !!Preferences class methodsFor: 'halos' stamp: 'sw 7/28/2004 16:26'!simpleFullHaloSpecifications	"This method gives the specs for the 'full' handles variant when simple halos are in effect"	"Preferences resetHaloSpecifications"	^ #(	"  	selector				horiz		vert			color info						icon key		---------				------		-----------		-------------------------------		---------------"	(addDebugHandle:		right		topCenter		(blue	veryMuchLighter)		'Halo-Debug')	(addPoohHandle:			right		center			(white)							'Halo-Pooh')	(addDismissHandle:		left			top				(red		muchLighter)			'Halo-Dismiss')	(addRotateHandle:		left			bottom			(blue)							'Halo-Rot')	(addMenuHandle:		leftCenter	top				(red)							'Halo-Menu')	(addTileHandle:			left			bottomCenter	(lightBrown)					'Halo-Tile')	(addViewHandle:			left			center			(cyan)							'Halo-View')	(addGrabHandle:			center		top				(black)							'Halo-Grab')	(addDragHandle:			rightCenter	top				(brown)							'Halo-Drag')	(addDupHandle:			right		top				(green)							'Halo-Dup')		(addMakeSiblingHandle:	right		top				(green muchDarker)				'Halo-Dup')		(addHelpHandle:			center		bottom			(lightBlue)						'Halo-Help')	(addGrowHandle:		right		bottom			(yellow)						'Halo-Scale')	(addScaleHandle:		right		bottom			(lightOrange)					'Halo-Scale')	(addFewerHandlesHandle:	left		topCenter		(paleBuff)						'Halo-FewerHandles')	(addScriptHandle:		right		bottomCenter	(green muchLighter)			'Halo-Script')	(addPaintBgdHandle:		right		center			(lightGray)						'Halo-Paint')	(addRepaintHandle:		right		center			(lightGray)						'Halo-Paint')	(addFontSizeHandle:		leftCenter	bottom			(lightGreen)						'Halo-FontSize')	(addFontStyleHandle:		center		bottom			(lightRed)						'Halo-FontStyle')	(addFontEmphHandle:	rightCenter	bottom			(lightBrown darker)		  'Halo-FontEmph')	(addRecolorHandle:		right		bottomCenter	(magenta darker)				'Halo-Recolor')		) ! !"Postscript:"Preferences resetHaloSpecifications.!