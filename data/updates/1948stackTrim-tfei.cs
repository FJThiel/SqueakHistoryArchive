'From Squeak2.8alpha of 11 February 2000 [latest update: #1919] on 20 March 2000 at 12:52:03 am'!"Change Set:		stacktrim-tfei.csDate:			20 March 2000Author:			Paul McDonoughContext ensure: is implemented with some tricky coding that goes through several extra calls before executing the user's block.  This change hides those stack frames in the debugger.  (valueUninterruptably and its callees)"!!ContextPart methodsFor: 'debugger access' stamp: 'tfei 3/20/2000 00:51'!stackOfSize: limit 	"Answer an OrderedCollection of the top 'limit' contexts		on the receiver's sender chain."	| a stack cachedStackTop newLimit |	stack _ OrderedCollection new.	stack addLast: (a _ self).	[(a _ a sender) ~~ nil and: [stack size < limit]]		whileTrue:			[a hideFromDebugger ifFalse: [stack addLast: a].			a cachesStack ifTrue: [cachedStackTop := a cachedStackTop]].	^cachedStackTop == nil 		ifTrue: [stack]		ifFalse:			[newLimit := limit - stack size.			newLimit > 0				ifTrue: [stack addAllLast: (cachedStackTop stackOfSize: newLimit); yourself]				ifFalse: [stack]]! !!BlockContext methodsFor: 'private-debugger' stamp: 'tfei 3/20/2000 00:24'!hideFromDebugger	^home ~~ nil and: [home hideFromDebugger]! !!MethodContext methodsFor: 'private-debugger' stamp: 'tfei 3/20/2000 00:24'!hideFromDebugger	| sndr sndrHome |	^self cachesStack		or: [(sndr := self sender) ~~ nil			and: [(sndrHome := sndr home) ~~ nil				and: [sndrHome cachesStack]]]! !