'From Squeak2.9alpha of 13 June 2000 [latest update: #3358] on 1 February 2001 at 3:22:07 pm'!"Change Set:		SndRecActive-arDate:			1 February 2001Author:			Andreas RaabFix use of #allInstances for determining active sound recorders."!Object subclass: #SoundRecorder	instanceVariableNames: 'stereo samplingRate recordLevel recordedBuffers recordedSound recordProcess bufferAvailableSema paused meteringBuffer meterLevel soundPlaying currentBuffer nextIndex codec desiredSampleRate '	classVariableNames: 'CanRecordWhilePlaying RecorderActive '	poolDictionaries: ''	category: 'Sound-Synthesis'!!SoundPlayer class methodsFor: 'playing' stamp: 'ar 2/1/2001 15:20'!canStartPlayer	"Some platforms do no support simultaneous record and play. If this is one of those platforms, return false if there is a running SoundRecorder."	Preferences canRecordWhilePlaying ifTrue: [^ true].	SoundRecorder anyActive ifTrue:[^false].	^ true! !!SoundRecorder methodsFor: 'recording controls' stamp: 'ar 2/1/2001 15:19'!startRecording	"Turn of the sound input driver and start the recording process. Initially, recording is paused."	| semaIndex |	recordLevel ifNil: [recordLevel _ 0.5].  "lazy initialization"	Preferences canRecordWhilePlaying ifFalse: [SoundPlayer shutDown].	recordProcess ifNotNil: [self stopRecording].	paused _ true.	meteringBuffer _ SoundBuffer newMonoSampleCount: 1024.	meterLevel _ 0.	self allocateBuffer.	bufferAvailableSema _ Semaphore new.	semaIndex _ Smalltalk registerExternalObject: bufferAvailableSema.	self primStartRecordingDesiredSampleRate: samplingRate asInteger		stereo: stereo		semaIndex: semaIndex.	RecorderActive _ true.	samplingRate _ self primGetActualRecordingSampleRate.	self primSetRecordLevel: (1000.0 * recordLevel) asInteger.	recordProcess _ [self recordLoop] newProcess.	recordProcess priority: Processor userInterruptPriority.	recordProcess resume.! !!SoundRecorder methodsFor: 'recording controls' stamp: 'ar 2/1/2001 15:19'!stopRecording	"Stop the recording process and turn of the sound input driver."	recordProcess ifNotNil: [recordProcess terminate].	recordProcess _ nil.	self primStopRecording.	RecorderActive _ false.	Smalltalk unregisterExternalObject: bufferAvailableSema.	((currentBuffer ~~ nil) and: [nextIndex > 1])		ifTrue: [self emitPartialBuffer].	self initializeRecordingState.! !!SoundRecorder class methodsFor: 'accessing' stamp: 'ar 2/1/2001 15:20'!anyActive	"Return true if any sound recorder is actively recording"	^RecorderActive == true! !