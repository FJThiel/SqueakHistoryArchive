'From Squeak2.9alpha of 17 July 2000 [latest update: #3328] on 30 January 2001 at 2:36:55 pm'!"Change Set:		stackIndexDate:			29 January 2001Author:			Robert Hirschfeld, Bob ArningKeeps the selection of the stack context selected in the notifier's stack list when opening the debugger window."!!Debugger methodsFor: 'initialize' stamp: 'RAA 1/30/2001 13:05'!buildMVCDebuggerViewLabel: aString minSize: aPoint	"Build an MVC debugger view around the receiver, and return the StandardSystemView thus created."	| topView stackListView stackCodeView rcvrVarView rcvrValView ctxtVarView ctxtValView deltaY underPane annotationPane buttonsView oldContextStackIndex |	oldContextStackIndex _ contextStackIndex.	self expandStack. "Sets contextStackIndex to zero."	contextStackIndex _ oldContextStackIndex.	topView _ StandardSystemView new model: self.	topView borderWidth: 1.	stackListView _ PluggableListView on: self			list: #contextStackList			selected: #contextStackIndex			changeSelected: #toggleContextStackIndex:			menu: #contextStackMenu:shifted:			keystroke: #contextStackKey:from:.		stackListView menuTitleSelector: #messageListSelectorTitle.		stackListView window: (0 @ 0 extent: 150 @ 50).		topView addSubView: stackListView.	deltaY _ 0.	 self wantsAnnotationPane		ifTrue:			[annotationPane _ PluggableTextView on: self				text: #annotation accept: nil readSelection: nil menu: nil.			annotationPane window: (0@0 extent: 150@self optionalAnnotationHeight).			topView addSubView: annotationPane below: stackListView.			deltaY _ deltaY + self optionalAnnotationHeight.			underPane _ annotationPane]		ifFalse:			[underPane _ stackListView].	self wantsOptionalButtons		ifTrue:			[buttonsView _ self buildMVCOptionalButtonsButtonsView.			buttonsView borderWidth: 1.			topView addSubView: buttonsView below: underPane.			underPane _ buttonsView.			deltaY _ deltaY + self optionalButtonHeight].	stackCodeView _ PluggableTextView on: self			text: #contents accept: #contents:notifying:			readSelection: #contentsSelection menu: #codePaneMenu:shifted:.		stackCodeView window: (0 @ 0 extent: 150 @ (75 - deltaY)).		topView addSubView: stackCodeView below: underPane.	rcvrVarView _ PluggableListView on: self receiverInspector			list: #fieldList			selected: #selectionIndex			changeSelected: #toggleIndex:			menu: #fieldListMenu:			keystroke: #inspectorKey:from:.		rcvrVarView window: (0 @ 0 extent: 25 @ (50 - deltaY)).		topView addSubView: rcvrVarView below: stackCodeView.	rcvrValView _ PluggableTextView on: self receiverInspector			text: #contents accept: #accept:			readSelection: #contentsSelection menu: #codePaneMenu:shifted:.		rcvrValView window: (0 @ 0 extent: 50 @ (50 - deltaY)).		topView addSubView: rcvrValView toRightOf: rcvrVarView.	ctxtVarView _ PluggableListView on: self contextVariablesInspector			list: #fieldList			selected: #selectionIndex			changeSelected: #toggleIndex:			menu: #fieldListMenu:			keystroke: #inspectorKey:from:.		ctxtVarView window: (0 @ 0 extent: 25 @ (50 - deltaY)).		topView addSubView: ctxtVarView toRightOf: rcvrValView.	ctxtValView _ PluggableTextView on: self contextVariablesInspector			text: #contents accept: #accept:			readSelection: #contentsSelection menu: #codePaneMenu:shifted:.		ctxtValView window: (0 @ 0 extent: 50 @ (50 - deltaY)).		topView addSubView: ctxtValView toRightOf: ctxtVarView.	topView label: aString.	topView minimumSize: aPoint.	^ topView! !!Debugger methodsFor: 'initialize' stamp: 'rhi 12/20/2000 16:50'!buildMVCNotifierViewLabel: aString message: messageString minSize: aPoint	| topView notifyView buttonView x y bHeight |	self expandStack.	topView _ StandardSystemView new model: self.	topView borderWidth: 1.	buttonView _ self buildMVCNotifierButtonView.	topView addSubView: buttonView.	notifyView _ PluggableListView on: self		list: #contextStackList		selected: #contextStackIndex		changeSelected: #debugAt:		menu: nil		keystroke: nil.	x _ 350 max: (aPoint x).	y _ ((4 * 15) + 16) max: (aPoint y - 16 - self optionalButtonHeight).	bHeight _ self optionalButtonHeight.	y _ y - bHeight.	notifyView window: (0@0 extent: x@y).	topView		addSubView: notifyView below: buttonView;		label: aString;		minimumSize: aPoint.	^ topView! !!Debugger methodsFor: 'initialize' stamp: 'RAA 1/30/2001 13:20'!openFullMorphicLabel: labelString	| window aListMorph oldContextStackIndex |	oldContextStackIndex _ contextStackIndex.	self expandStack. "Sets contextStackIndex to zero."	window _ (SystemWindow labelled: labelString) model: self.	aListMorph _ PluggableListMorph on: self list: #contextStackList			selected: #contextStackIndex changeSelected: #toggleContextStackIndex:			menu: #contextStackMenu:shifted: keystroke: #contextStackKey:from:.	aListMorph menuTitleSelector: #messageListSelectorTitle.	window addMorph: aListMorph		frame: (0@0 corner: 1@0.3).	self addLowerPanesTo: window at: (0@0.3 corner: 1@0.7) with: nil.	window addMorph: (		PluggableListMorph new			doubleClickSelector: #inspectSelection;			on: self receiverInspector list: #fieldList			selected: #selectionIndex changeSelected: #toggleIndex:			menu: #fieldListMenu: keystroke: #inspectorKey:from:)		frame: (0@0.7 corner: 0.2@1).	window addMorph: (PluggableTextMorph on: self receiverInspector			text: #contents accept: #accept:			readSelection: #contentsSelection menu: #codePaneMenu:shifted:)		frame: (0.2@0.7 corner: 0.5@1).	window addMorph: (		PluggableListMorph new			doubleClickSelector: #inspectSelection;			on: self contextVariablesInspector list: #fieldList			selected: #selectionIndex changeSelected: #toggleIndex:			menu: #fieldListMenu: keystroke: #inspectorKey:from:)		frame: (0.5@0.7 corner: 0.7@1).	window addMorph: (PluggableTextMorph on: self contextVariablesInspector			text: #contents accept: #accept:			readSelection: #contentsSelection menu: #codePaneMenu:shifted:)		frame: (0.7@0.7 corner: 1@1).	window openInWorld.	self toggleContextStackIndex: oldContextStackIndex.	^ window ! !!Debugger methodsFor: 'notifier menu' stamp: 'RAA 1/30/2001 14:36'!debug	"Open a full DebuggerView."	| topView |	topView _ self topView.	topView model: nil.  "so close won't release me."	Smalltalk isMorphic		ifTrue:			[self breakDependents.			self openFullMorphicLabel: topView label.			^ topView delete].	topView controller controlTerminate.	topView deEmphasize; erase.	"a few hacks to get the scroll selection artifacts out when we got here by clicking in the list"	topView subViewWantingControl ifNotNil: [		topView subViewWantingControl controller controlTerminate	].	topView controller status: #closed.	self openFullNoSuspendLabel: topView label.	topView controller closeAndUnscheduleNoErase.	Processor terminateActive.! !!Debugger methodsFor: 'context stack menu' stamp: 'rhi 12/20/2000 16:56'!buildMorphicNotifierLabelled: label message: messageString	| notifyPane window contentTop extentToUse |	self expandStack.	window _ (PreDebugWindow labelled: label) model: self.	contentTop _ 0.2.	extentToUse _ 450 @ 156. "nice and wide to show plenty of the error msg"	window addMorph: (self buttonRowForPreDebugWindow: window)				frame: (0@0 corner: 1 @ contentTop).	Preferences eToyFriendly		ifFalse:			[notifyPane _ PluggableListMorph on: self list: #contextStackList				selected: #contextStackIndex changeSelected: #debugAt:				menu: nil keystroke: nil]		ifTrue:			[notifyPane _ PluggableTextMorph on: self text: nil accept: nil				readSelection: nil menu: #debugProceedMenu:.			notifyPane editString: (self preDebugNotifierContentsFrom: messageString);				askBeforeDiscardingEdits: false].	window addMorph: notifyPane frame: (0@contentTop corner: 1@1).	"window deleteCloseBox.		chickened out by commenting the above line out, sw 8/14/2000 12:54"	window setBalloonTextForCloseBox.	^ window openInWorldExtent: extentToUse! !