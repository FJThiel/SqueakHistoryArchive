'From Squeak 2.3 of January 14, 1999 on 15 January 1999 at 3:09:11 am'!"Change Set:		BalloonFlushFix-arDate:			15 January 1999Author:			Andreas RaabFixes a problem due to premature flushes ofthe rendering pipeline in Balloon by addinga new primitive to set the flush bit fromthe Smalltalk side and using it in generalshapes."!!BalloonEngine methodsFor: 'drawing' stamp: 'ar 1/15/1999 03:02'!drawGeneralBezierShape: contours fill: fillStyle borderWidth: borderWidth borderColor: borderFill transform: aTransform	| fills |	self edgeTransform: aTransform.	self resetIfNeeded.	fills _ self registerFill: fillStyle and: borderFill.	contours do:[:points|		self primAddBezierShape: points			segments: (points size // 3)			fill: (fills at: 1)			lineWidth: borderWidth			lineFill: (fills at: 2).		"Note: To avoid premature flushing of the pipeline we need to		reset the flush bit within the engine."		self primFlushNeeded: false.	].	"And set the flush bit afterwards"	self primFlushNeeded: true.	self postFlushIfNeeded.! !!BalloonEngine methodsFor: 'drawing' stamp: 'ar 1/15/1999 03:02'!drawGeneralPolygon: contours fill: fillStyle borderWidth: borderWidth borderColor: borderFill transform: aTransform	| fills |	self edgeTransform: aTransform.	self resetIfNeeded.	fills _ self registerFill: fillStyle and: borderFill.	contours do:[:points|		self primAddPolygon: points			segments: points size			fill: (fills at: 1)			lineWidth: borderWidth			lineFill: (fills at: 2).		"Note: To avoid premature flushing of the pipeline we need to		reset the flush bit within the engine."		self primFlushNeeded: false.	].	"And set the flush bit afterwards"	self primFlushNeeded: true.	self postFlushIfNeeded.! !!BalloonEngine methodsFor: 'primitives-access' stamp: 'ar 1/15/1999 03:03'!primFlushNeeded: aBoolean	<primitive:'gePrimitiveNeedsFlushPut'>	^self primitiveFailed! !!BalloonEngineBase methodsFor: 'primitives-access' stamp: 'ar 1/15/1999 02:48'!gePrimitiveNeedsFlushPut	| needFlush |	self export: true.	self inline: false.	interpreterProxy methodArgumentCount = 1		ifFalse:[^interpreterProxy primitiveFail].	needFlush _ interpreterProxy stackObjectValue: 0.	engine _ interpreterProxy stackObjectValue: 1.	interpreterProxy failed ifTrue:[^nil].	needFlush _ interpreterProxy booleanValueOf: needFlush.	interpreterProxy failed ifTrue:[^nil].	(self quickLoadEngineFrom: engine)		ifFalse:[^interpreterProxy primitiveFail].	needFlush == true 		ifTrue:[self needsFlushPut: 1]		ifFalse:[self needsFlushPut: 0].	self storeEngineStateInto: engine.	interpreterProxy pop: 1. "Leave rcvr on stack"! !