'From Squeak3.2alpha of 14 October 2001 [latest update: #4441] on 21 October 2001 at 9:10:53 pm'!"Change Set:		mailOutUserNameDate:			21 October 2001Author:			Lex SpoonDon't put quotes and such around the email address supplied by Celeste -- that can fail if the Celeste address already contains some delimiters."!!ChangeSet methodsFor: 'fileIn/Out' stamp: 'ls 10/21/2001 21:09'!buildMessageForMailOutWithUser: userName	| message compressBuffer compressStream data compressedStream compressTarget |	"prepare the message"	message := MailMessage empty.	message setField: 'from' toString: userName.	message setField: 'to' toString: 'squeak-dev@lists.squeakfoundation.org'.	message setField: 'subject' toString: (self chooseSubjectPrefixForEmail, name). 	message body: (MIMEDocument contentType: 'text/plain' content: (String streamContents: [ :str |		str nextPutAll: 'from preamble:'; cr; cr.		self fileOutPreambleOn: str ])).	"Prepare the gzipped data"	data _ WriteStream on: String new.	data header; timeStamp.	self fileOutPreambleOn: data.	self fileOutOn: data.	self fileOutPostscriptOn: data.	data trailer.	data _ ReadStream on: data contents.	compressBuffer _ ByteArray new: 1000.	compressStream _ GZipWriteStream on: (compressTarget _ WriteStream on: (ByteArray new: 1000)).	[data atEnd]		whileFalse: [compressStream nextPutAll: (data nextInto: compressBuffer)].	compressStream close.	compressedStream _ ReadStream on: compressTarget contents asString.	message addAttachmentFrom: compressedStream withName: (name, '.cs.gz').	^ message! !