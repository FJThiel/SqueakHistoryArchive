'From Squeak3.2alpha of 2 October 2001 [latest update: #4457] on 28 October 2001 at 4:26:53 pm'!"Change Set:		JPEGMoreCompactDate:			28 October 2001Author:			Andreas RaabReduce the memory requirements for the jpeg reader."!!JPEGReadWriter methodsFor: 'public access' stamp: 'ar 10/28/2001 16:25'!nextImageDitheredToDepth: depth	| form xStep yStep x y bb |	ditherMask _ DitherMasks		at: depth		ifAbsent: [self error: 'can only dither to display depths'].	residuals _ WordArray new: 3.	sosSeen _ false.	self parseFirstMarker.	[sosSeen] whileFalse: [self parseNextMarker].	form _ Form extent: (width @ height) depth: depth.	bb _ BitBlt current toForm: form.	bb sourceForm: mcuImageBuffer.	bb colorMap: (mcuImageBuffer colormapIfNeededFor: form).	bb sourceRect: mcuImageBuffer boundingBox.	bb combinationRule: Form over.	xStep _ mcuWidth * DCTSize.	yStep _ mcuHeight * DCTSize.	y _ 0.	1 to: mcuRowsInScan do:		[:row |		x _ 0.		1 to: mcusPerRow do:			[:col |			self decodeMCU.			self idctMCU.			self colorConvertMCU.			bb destX: x; destY: y; copyBits.			x _ x + xStep].		y _ y + yStep].	^ form! !!FlashJPEGDecoder methodsFor: 'decoding' stamp: 'ar 10/28/2001 16:25'!nextImageDitheredToDepth: depth	"Overwritten to yield every now and then."	| form xStep yStep x y |	ditherMask _ DitherMasks		at: depth		ifAbsent: [self error: 'can only dither to display depths'].	residuals _ WordArray new: 3.	sosSeen _ false.	self parseFirstMarker.	[sosSeen] whileFalse: [self parseNextMarker].	form _ Form extent: (width @ height) depth: depth.	xStep _ mcuWidth * DCTSize.	yStep _ mcuHeight * DCTSize.	y _ 0.	1 to: mcuRowsInScan do:		[:row |		"self isStreaming ifTrue:[Processor yield]."		x _ 0.		1 to: mcusPerRow do:			[:col |			self decodeMCU.			self idctMCU.			self colorConvertMCU.			mcuImageBuffer displayOn: form at: (x @ y).			x _ x + xStep].		y _ y + yStep].	^ form! !