'From Squeak3.1alpha [latest update: #''Squeak3.1alpha'' of 20 February 2001 update 3960] on 7 May 2001 at 11:49:31 am'!"Change Set:		PartsFix-mdrDate:			7 May 2001Author:			Mike RutenbergThis fixes the Celeste parts... menu command to again list the proper names of each of the attachments"!!Celeste methodsFor: 'table of contents pane' stamp: 'mdr 5/7/2001 11:49'!partsMenu	"Show a menu listing all the parts of this message, and let the user save the chosen part to a file"	| menu currMessage part |	menu _ CustomMenu new.	currMessage _ self currentMessage.	currMessage atomicParts do: [:e | menu add: 'save ' , e printString action: e].	part _ menu startUp.	part ifNotNil: [part save]! !!MIMEDocument methodsFor: 'accessing' stamp: 'mdr 5/7/2001 11:47'!parts	"Return the parts of this message.  There is a far more reliable implementation of parts in MailMessage, but for now we are continuing to use this implementation"	| parseStream currLine separator msgStream messages |	self isMultipart ifFalse: [^ #()].	parseStream _ ReadStream on: self content.	currLine _ ''.	['--*' match: currLine]		whileFalse: [currLine _ parseStream nextLine].	separator _ currLine copy.	msgStream _ LimitingLineStreamWrapper on: parseStream delimiter: separator.	messages _ OrderedCollection new.	[parseStream atEnd]		whileFalse: 			[messages add: msgStream upToEnd.			msgStream skipThisLine].	^ messages collect: [:e | MailMessage from: e]! !!MailMessage methodsFor: 'printing/formatting' stamp: 'mdr 5/7/2001 11:07'!excerpt	"Return a short excerpt of the text of the message"	^ self bodyText withSeparatorsCompacted truncateWithElipsisTo: 60! !!MailMessage methodsFor: 'printing/formatting' stamp: 'mdr 5/7/2001 11:48'!printOn: aStream 	"For text parts with no filename show: 'text/plain: first line of text...'    	for attachments/filenamed parts show: 'attachment: filename.ext'"	| name |	"This is not designed to work on multipart messages"	[self body isMultipart = false] assert.	aStream nextPutAll: ((name _ self name) ifNil: ['Text: ' , self excerpt]			ifNotNil: ['File: ' , name])! !!MailMessage methodsFor: 'multipart' stamp: 'mdr 5/7/2001 11:22'!atomicParts	"Answer all of the leaf parts of this message, including those of multipart included messages"	self body isMultipart ifFalse: [^ OrderedCollection with: self].	^ self parts inject: OrderedCollection new into: [:col :part | col , part atomicParts]! !