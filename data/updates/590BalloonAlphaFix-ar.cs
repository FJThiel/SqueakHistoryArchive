'From Squeak 2.3 of January 14, 1999 on 14 January 1999 at 3:43:46 pm'!"Change Set:		BalloonAlphaFix-arDate:			14 January 1999Author:			Andreas RaabFixes a transparency problem with Balloon."!!BalloonEngine methodsFor: 'drawing' stamp: 'ar 1/14/1999 15:24'!registerFill: aFillStyle	"Register the given fill style."	| theForm |	aFillStyle ifNil:[^0].	aFillStyle isSolidFill 		ifTrue:[^aFillStyle scaledPixelValue32].	aFillStyle isGradientFill ifTrue:[		^self primAddGradientFill: aFillStyle pixelRamp			from: aFillStyle origin			along: aFillStyle direction			normal: aFillStyle normal			radial: aFillStyle isRadialFill		].	aFillStyle isBitmapFill ifTrue:[		theForm _ aFillStyle form.		theForm unhibernate.		forms _ forms copyWith: theForm.		^self primAddBitmapFill: theForm				colormap: (theForm colormapIfNeededForDepth: 32)				tile: aFillStyle isTiled				from: aFillStyle origin				along: aFillStyle direction				normal: aFillStyle normal				xIndex: forms size].	^0! !!BalloonEngine methodsFor: 'drawing' stamp: 'ar 1/14/1999 15:24'!registerFill: aFillStyle transform: aTransform	aFillStyle ifNil:[^0].	aFillStyle isSolidFill 		ifTrue:[^aFillStyle scaledPixelValue32].	aFillStyle isGradientFill ifTrue:[		^self primAddGradientFill: aFillStyle pixelRamp			from: aFillStyle origin			along: aFillStyle direction			normal: aFillStyle normal			radial: aFillStyle isRadialFill			matrix: aTransform.		].	^0! !!BalloonEngine methodsFor: 'primitives-adding' stamp: 'ar 1/14/1999 15:37'!primAddRectFrom: start to: end fillIndex: fillIndex borderWidth: width borderColor: pixelValue32	<primitive: 'gePrimitiveAddRect'>	(self canProceedAfter: self primGetFailureReason) ifTrue:[		^self primAddRectFrom: start to: end fillIndex: fillIndex borderWidth: width borderColor: pixelValue32	].	^self primitiveFailed! !!Color methodsFor: 'queries' stamp: 'ar 1/14/1999 15:27'!isBitmapFill	^false! !!Color methodsFor: 'conversions' stamp: 'ar 1/14/1999 15:28'!scaledPixelValue32	"Return the alpha scaled pixel value for depth 32"	^self pixelWordForDepth: 32! !!FillStyle methodsFor: 'accessing' stamp: 'ar 1/14/1999 15:23'!scaledPixelValue32	"Return a pixel value of depth 32 for the primary color in the fill style"	^self asColor scaledPixelValue32! !!SolidFillStyle methodsFor: 'accessing' stamp: 'ar 1/14/1999 15:24'!color: aColor	color _ aColor.	pixelValue32 _ aColor scaledPixelValue32! !!SolidFillStyle methodsFor: 'accessing' stamp: 'ar 1/14/1999 15:25'!scaledPixelValue32	"Return the alpha scaled pixel value for depth 32"	^pixelValue32! !!TranslucentColor methodsFor: 'conversions' stamp: 'ar 1/14/1999 15:30'!scaledPixelValue32	"Return the alpha scaled pixel value for depth 32"	| pv32 a b g r |	pv32 _ super scaledPixelValue32.	a _ (self alpha * 255.0) rounded.	b _ (pv32 bitAnd: 255) * a // 256.	g _ ((pv32 bitShift: -8) bitAnd: 255) * a // 256.	r _ ((pv32 bitShift: -16) bitAnd: 255) * a // 256.	^b + (g bitShift: 8) + (r bitShift: 16) + (a bitShift: 24)! !Color removeSelector: #pixelValue32!FillStyle removeSelector: #pixelValue32!SolidFillStyle removeSelector: #pixelValue32!