"Change Set:		8666MonticelloConfigurations-ar.71MonticelloConfigurations-ar.71:With the additional progress info from MC, configs are a bit noisy when updating. Suppress a good chunk of progress depending (for now) on a preference. The result are smoother and less noisy progress notifications during updates."!Object subclass: #MCConfiguration	instanceVariableNames: 'name dependencies repositories log'	classVariableNames: 'DefaultLog ExtraProgressInfo LogToFile'	poolDictionaries: ''	category: 'MonticelloConfigurations'!!MCConfiguration methodsFor: 'private' stamp: 'ar 12/30/2009 17:31'!depsSatisfying: selectBlock versionDo: verBlock displayingProgress: progressString	| repoMap count action |	repoMap := Dictionary new.	self repositories do: [:repo |		MCRepositoryGroup default addRepository: repo.		repo allVersionNames			ifEmpty: [self logWarning: 'cannot read from ', repo description]			ifNotEmptyDo: [:all | all do: [:ver | repoMap at: ver put: repo]]].	count := 0.	action := [:dep |		| ver repo |		ver := dep versionInfo name.		repo := repoMap at: ver ifAbsent: [			self logError: 'Version ', ver, ' not found in any repository'.			self logError: 'Aborting'.			^count].		(selectBlock value: dep) ifTrue: [			| new |			new := self versionNamed: ver for: dep from: repo.			new ifNil: [					self logError: 'Could not download version ', ver, ' from ', repo description.					self logError: 'Aborting'.					^count]				ifNotNil: [					self logUpdate: dep package with: new.					self class extraProgressInfo						ifTrue:[ProgressNotification signal: '' extra: 'Installing ', ver].					verBlock value: new.					count := count + 1.				]		].		dep package workingCopy repositoryGroup addRepository: repo.	].	self class extraProgressInfo 		ifTrue:[self dependencies do: action displayingProgress: progressString]		ifFalse:[self dependencies do: action].	^count! !!MCConfiguration class methodsFor: 'preferences' stamp: 'ar 12/30/2009 17:30'!extraProgressInfo: aBool	"Whether to display for additional progress info during load."	ExtraProgressInfo := aBool.! !!MCConfiguration methodsFor: 'private' stamp: 'ar 12/30/2009 17:33'!versionNamed: verName for: aDependency from: repo	| baseName fileName ver |	(repo filterFileNames: repo cachedFileNames forVersionNamed: verName) ifNotEmptyDo: [:cachedNames |		fileName := cachedNames anyOne.		self class extraProgressInfo			ifTrue:[ProgressNotification signal: '' extra: 'Using cached ', fileName].		ver := repo versionFromFileNamed: fileName].	ver ifNil: [		baseName := self diffBaseFor: aDependency.		(baseName notNil and: [baseName ~= verName and: [repo includesVersionNamed: baseName]]) ifTrue: [			fileName := (MCDiffyVersion nameForVer: verName base: baseName), '.mcd'.			self class extraProgressInfo				ifTrue:[ProgressNotification signal: '' extra: 'Downloading ', fileName].			ver := repo versionFromFileNamed: fileName]].	ver ifNil: [		fileName := verName, '.mcz'.		self class extraProgressInfo			ifTrue:[ProgressNotification signal: '' extra: 'Downloading ', fileName].		ver := repo versionFromFileNamed: fileName].	^ver! !!MCConfiguration class methodsFor: 'preferences' stamp: 'ar 12/30/2009 17:30'!extraProgressInfo	"Answer true for additional progress info during load. 	With the newly added MC down/upload operations this seems unnecessary	but some people might disagree, so let's leave it as a preference right now"	<preference: 'Extra Progress Info' 		category: 'Monticello' 		description: 'If true, additional progress information is displayed when loading MC configurations (i.e., during updates)' 		type: #Boolean>	^ExtraProgressInfo ifNil:[false]! !