'From SqueakLight|II of 31 May 2008 [latest update: #7239] on 30 September 2009 at 11:13:26 am'!Object subclass: #MCPackageLoader	instanceVariableNames: 'requirements unloadableDefinitions obsoletions additions removals errorDefinitions provisions '	classVariableNames: 'ChangeHIghUp '	poolDictionaries: ''	category: 'Monticello-Loading'!!MCPackageLoader methodsFor: 'private' stamp: 'edc 9/30/2009 11:07'!useChangeSetNamed: baseName during: aBlock    "Use the named change set, or create one with the given name."    | changeHolder oldChanges newChanges csName |    changeHolder := (ChangeSet respondsTo: #newChanges:)                        ifTrue: [ChangeSet]                        ifFalse: [Smalltalk].    oldChanges := (ChangeSet respondsTo: #current)                        ifTrue: [ChangeSet current]                        ifFalse: [Smalltalk changes].(self class changeHighestUpdate) ifTrue:[csName := (SystemVersion current highestUpdate + 1) asString,baseName.    newChanges := (ChangesOrganizer changeSetNamed: csName) ifNil: [ ChangeSet new name: csName ].    changeHolder newChanges: newChanges.    [aBlock value] ensure: [changeHolder newChanges: oldChanges].SystemVersion current registerUpdate: SystemVersion current highestUpdate + 1]ifFalse:[	newChanges := (ChangesOrganizer changeSetNamed: baseName) ifNil: [ ChangeSet new name: baseName ].	changeHolder newChanges: newChanges.	[aBlock value] ensure: [changeHolder newChanges: oldChanges].]! !!MCPackageLoader class methodsFor: 'as yet unclassified' stamp: 'edc 9/29/2009 12:03'!changeHighestUpdate" MCPackageLoader changeHighestUpdate""Whether change highestUpdate by default.	If true, logs to a file named after the configuration (config.nn.log).	If false, logs to the transcript."	<preference: 'Change SystemVersion current highestUpdate' 		category: 'Monticello' 		description: 'If true,  each monticello package loaded rises the highestUpdate)' 		type: #Boolean>	^ChangeHIghUp  ifNil:[ChangeHIghUp := false].! !!MCPackageLoader class methodsFor: 'as yet unclassified' stamp: 'edc 9/29/2009 11:57'!togleHighestUpdate" MCPackageLoader togleHighestUpdate"self changeHighestUpdate.	^ChangeHIghUp  := ChangeHIghUp not! !!MCPackageLoader class methodsFor: 'as yet unclassified' stamp: 'edc 9/30/2009 11:07'!useChangeSetNamed: baseName during: aBlock    "Use the named change set, or create one with the given name."    | changeHolder oldChanges newChanges csName |    changeHolder := (ChangeSet respondsTo: #newChanges:)                        ifTrue: [ChangeSet]                        ifFalse: [Smalltalk].    oldChanges := (ChangeSet respondsTo: #current)                        ifTrue: [ChangeSet current]                        ifFalse: [Smalltalk changes].(self class changeHighestUpdate) ifTrue:[csName := (SystemVersion current highestUpdate + 1) asString,baseName.    newChanges := (ChangesOrganizer changeSetNamed: csName) ifNil: [ ChangeSet new name: csName ].    changeHolder newChanges: newChanges.    [aBlock value] ensure: [changeHolder newChanges: oldChanges].SystemVersion current registerUpdate: SystemVersion current highestUpdate + 1]ifFalse:[	newChanges := (ChangesOrganizer changeSetNamed: baseName) ifNil: [ ChangeSet new name: baseName ].	changeHolder newChanges: newChanges.	[aBlock value] ensure: [changeHolder newChanges: oldChanges].]! !!Utilities class methodsFor: 'fetching updates' stamp: 'edc 9/29/2009 12:05'!updateFromServer	"Update the image by loading all pending updates from the server.  Also save local copies of the update files if the #updateSavesFile preference is set to true"	MCPackageLoader  togglePreferenceValue.	MCMcmUpdater updateFromRepositories: #(		'http://source.squeak.org/trunk'	).	MCPackageLoader  togglePreferenceValue.	"self readServerUpdatesSaveLocally: Preferences updateSavesFile updateImage: true"! !Object subclass: #MCPackageLoader	instanceVariableNames: 'requirements unloadableDefinitions obsoletions additions removals errorDefinitions provisions'	classVariableNames: 'ChangeHIghUp'	poolDictionaries: ''	category: 'Monticello-Loading'!